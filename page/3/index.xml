<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æ±ŸäºŒåä¸‰çš„æ€è€ƒ</title><link>https://forcemz.net/</link><description>Recent content on æ±ŸäºŒåä¸‰çš„æ€è€ƒ</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>Copyright (c) 2009-2024 J23</copyright><lastBuildDate>Mon, 01 Apr 2024 20:00:00 +0800</lastBuildDate><atom:link href="https://forcemz.net/index.xml" rel="self" type="application/rss+xml"/><item><title>ä»‹ç» Bela</title><link>https://forcemz.net/posts/2019/2019-05-25-introduction-bela/</link><pubDate>Sat, 25 May 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-05-25-introduction-bela/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-05-25-introduction-bela/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>åœ¨å‰é¢ï¼Œæˆ‘æ›¾ç»å†™è¿‡ä¸€ç¯‡æ–‡ç«  &lt;a href="https://forcemz.net/cxx/2019/04/29/StringFormattingTalk/">ã€Šå­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼«è°ˆã€‹&lt;/a> æ–‡ç« æœ€åæåˆ°äº† &lt;a href="https://github.com/fcharlie/bela">&lt;code>Bela&lt;/code>&lt;/a> é‡Œé¢å®ç°äº†ä¸€ä¸ªç±»å‹å®‰å…¨çš„ &lt;code>bela::StrFormat&lt;/code>ï¼Œå®é™…ä¸Š &lt;code>bela&lt;/code> è¿˜æœ‰å¾ˆå¤šæœ‰è¶£çš„åŠŸèƒ½ï¼Œæœ¬æ–‡ä¹Ÿå°±æ˜¯è¯´ä¸€è¯´ Bela æœ‰å“ªäº›æœ‰è¶£åŠŸèƒ½å’Œæ•…äº‹ã€‚&lt;/p>
&lt;h1 id="ä¸€-bela-çš„ç¼˜ç”±">ä¸€. Bela çš„ç¼˜ç”±&lt;/h1>
&lt;p>ä¹‹å‰ï¼Œæˆ‘å¼€å‘äº†å‡ ä¸ªå¼€æºè½¯ä»¶ï¼Œå¦‚ Windows ç³»ç»Ÿä»¥æŒ‡å®šæƒé™å¯åŠ¨è¿›ç¨‹çš„ &lt;a href="https://github.com/M2Team/Privexec">Privexec&lt;/a>ï¼ŒClang Windows æ“ä½œç³»ç»Ÿä¸Šè‡ªåŠ¨åŒ–æ„å»ºä¾èµ–ç®¡ç†å·¥å…· &lt;a href="https://github.com/fstudio/clangbuilder">Clangbuilder&lt;/a>ï¼Œè¿˜æœ‰ PE åˆ†æå·¥å…· &lt;a href="https://github.com/fcharlie/PEAnalyzer">PEAnalyzer&lt;/a>ï¼Œæ–‡ä»¶åˆ†æå·¥å…· &lt;a href="https://github.com/fcharlie/Planck">Planck&lt;/a> ç­‰ç­‰ã€‚åœ¨ç¼–å†™è¿™äº›å·¥å…·æ—¶è¦é‡å¤ç¼–å†™ä¸€äº›ä»£ç ï¼Œæ¯•ç«Ÿå¤§å®¶éƒ½çŸ¥é“ C++ STL æœ‰æ—¶å€™å¹¶ä¸èƒ½ç§°å¿ƒå¦‚æ„ã€‚åœ¨ &lt;a href="https://github.com/abseil/abseil-cpp">Google Abseil&lt;/a> å¼€æºåï¼Œæˆ‘å€Ÿé‰´äº†è¿™ä¸ªé¡¹ç›®çš„ä¸€äº›ä»£ç é‡æ–°é€ äº†ä¸€äº› &lt;code>wchar_t&lt;/code> ç‰ˆæœ¬çš„è½®å­ï¼Œåæ¥æŠŠè¿™äº›ä»£ç å•ç‹¬æŠ½ç¦»å‡ºæ¥ï¼Œè¿›ä¸€æ­¥æ”¹è¿›ï¼Œä¹Ÿå°±æˆäº†ç°åœ¨çš„ &lt;code>Bela&lt;/code>ã€‚ä¸ç›´æ¥ç”¨ &lt;code>Absl&lt;/code> çš„åŸå› å¾ˆç®€å•ï¼Œå®ƒä¸æ”¯æŒ &lt;code>wchar_t&lt;/code>ã€‚æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ä½¿ç”¨ &lt;code>fmtlib&lt;/code> çš„åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œä¸å–œæ¬¢å¼‚å¸¸ï¼Œå®ƒçš„ä»£ç åº“ä¹Ÿæ¯”è¾ƒå¤§ã€‚å« &lt;code>bela ['bÉ™lÉ™]&lt;/code> çš„åŸå› ä¾ç„¶å¾ˆç®€å•ï¼Œç®€çŸ­æ˜“è¯»æ˜“æ‹¼å†™ã€‚&lt;/p>
&lt;p>Bela çš„å­—ç¬¦ä¸²å‡½æ•°åŸºæœ¬åŸºäº &lt;code>Abseil&lt;/code>ï¼Œ&lt;code>Unicode&lt;/code> è½¬æ¢åŸºäº LLVM çš„ &lt;code>ConvertUTF.cpp&lt;/code>ï¼Œæœ€åˆ &lt;code>ConvertUTF&lt;/code> çš„ç‰ˆæƒå±äº &lt;strong>Unicode.org&lt;/strong> , &lt;code>charconv&lt;/code> åŸºäº &lt;code>Visual C++ STL&lt;/code>ï¼Œ&lt;code>EscapeArgv&lt;/code> å€Ÿé‰´äº† Golang æºç ï¼Œ&lt;code>endian.hpp&lt;/code>ï¼Œ&lt;code>tokenziecmdline.hpp&lt;/code> å€Ÿé‰´äº† &lt;code>LLVM Support Library&lt;/code> ç­‰ç­‰ã€‚&lt;/p>
&lt;h1 id="äºŒ-bela-å­—ç¬¦ä¸²åŠŸèƒ½åº“">äºŒ. Bela å­—ç¬¦ä¸²åŠŸèƒ½åº“&lt;/h1>
&lt;h2 id="belaerror_code">bela::error_code&lt;/h2>
&lt;p>&lt;code>bela::error_code&lt;/code> ä½äº &lt;code>&amp;lt;bela/base.hpp&amp;gt;&lt;/code> ç±»ä¼¼ &lt;code>std::error_code&lt;/code>ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ç®€åŒ– Windows API é”™è¯¯ä¿¡æ¯çš„æ ¼å¼åŒ–ï¼Œå½“äººä»¬ä½¿ç”¨ &lt;code>make_system_error_code&lt;/code> å°±å¯ä»¥å°† Windows é”™è¯¯ä¿¡æ¯ä¿å­˜åˆ° &lt;code>bela::error_code&lt;/code> å¯¹è±¡ï¼Œåˆ©ç”¨ C++ RAII æœºåˆ¶ï¼Œå®Œå…¨å¯ä»¥ä¸ç”¨æ‹…å¿ƒå†…å­˜é‡Šæ”¾ï¼ŒåŒæ ·ä½ è¿˜å¯ä»¥ä½¿ç”¨ &lt;code>bela::make_error_code&lt;/code> æ„é€ è‡ªå·±çš„é”™è¯¯ä¿¡æ¯ï¼Œ&lt;code>bela::make_error_code&lt;/code> ä¾èµ– &lt;code>bela::strings_internal::CatPieces&lt;/code>ï¼Œå› æ­¤ï¼Œä½ å¯ä»¥åƒä½¿ç”¨ &lt;code>bela::StringCat&lt;/code> ä½¿ç”¨ &lt;code>bela::make_error_code&lt;/code>&lt;/p>
&lt;h2 id="stringcat">StringCat&lt;/h2>
&lt;p>&lt;code>StringCat&lt;/code> å­¦ä¹ äº† &lt;code>absl::StrCat&lt;/code>ï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºä½¿ç”¨ &lt;code>wchar_t&lt;/code> ä½œä¸ºå­—ç¬¦åŸºæœ¬ç±»å‹ï¼Œåœ¨ Windows ç³»ç»Ÿä¸­ï¼Œ&lt;code>StrCat&lt;/code> å®é™…ä¸Šè¢« &lt;code>shlwapi&lt;/code> ä½œä¸ºå®å®šä¹‰ä½¿ç”¨äº†ï¼Œä¸ºäº†é¿å…åœ¨ä½¿ç”¨ Windows API æ—¶é€ æˆå›°æƒ‘ï¼Œæˆ‘å°†å…¶å‘½åä¸º &lt;code>StringCat&lt;/code>ã€‚è¿™ç§å‡½æ•°çš„å¥½å¤„æ˜¯è¿æ¥å­—ç¬¦ä¸²æ—¶åªéœ€è¦ä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œå¯ä»¥å°†åŸºæœ¬ç±»å‹è½¬å˜ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œç„¶åè¿æ¥åˆ°ä¸€èµ·ï¼Œååˆ†æœ‰ç”¨ï¼Œå¹¶ä¸”ï¼Œ&lt;code>bela::StringCat&lt;/code> æ¯” &lt;code>absl::StrCat&lt;/code> æœ‰è¶£çš„ä¸€ç‚¹æ˜¯æ”¯æŒ &lt;code>char32_t&lt;/code> Unicode ç ç‚¹ï¼Œå› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>bela::StringCat&lt;/code> è¿æ¥ Unicode ç ç‚¹æ¥æ‹¼æ¥ Emoji æˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œç„¶åè¾“å‡ºåˆ° &lt;code>Windows Terminal&lt;/code> æˆ–è€…æ˜¾ç¤ºåˆ°æ–‡æœ¬æˆ–è€…ä½¿ç”¨ Dwrite ç»˜åˆ¶åˆ°å›¾å½¢ç•Œé¢ä¸Šã€‚&lt;/p>
&lt;p>&lt;code>StringCat&lt;/code> å®šä¹‰åœ¨ &lt;code>&amp;lt;bela/strcat.hpp&amp;gt;&lt;/code> æ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;h2 id="ascii">Ascii&lt;/h2>
&lt;p>bela å­¦ä¹ äº† &lt;code>absl/strings/ascii.h&lt;/code> ï¼Œå¹¶å°†å…¶ç§»æ¤åˆ° &lt;code>wchar_t&lt;/code>ã€‚åœ¨ç§»æ¤çš„æ—¶å€™è¦è€ƒè™‘åœ¨ Windows ç³»ç»Ÿä¸Š &lt;code>wchar_t&lt;/code> çš„èŒƒå›´æ˜¯ &lt;code>0~65535&lt;/code>ï¼Œå› æ­¤ä¸€äº›å‡½æ•°éœ€è¦åˆ¤æ–­å¤§äº &lt;code>0xFF&lt;/code> æ—¶çš„ç­–ç•¥ã€‚åœ¨ &lt;code>&amp;lt;bela/ascii.hpp&amp;gt;&lt;/code> æ–‡ä»¶ä¸­ &lt;code>AsciiStrToUpper&lt;/code> ï¼Œ&lt;code>AsciiStrToLower&lt;/code>ï¼Œ &lt;code>StripLeadingAsciiWhitespace&lt;/code>ï¼Œ&lt;code>StripTrailingAsciiWhitespace&lt;/code>ï¼Œ &lt;code>StripAsciiWhitespace&lt;/code> è¿™äº›å‡½æ•°ååˆ†æœ‰å¸®åŠ©ã€‚&lt;/p>
&lt;h2 id="å…¶ä»–å­—ç¬¦ä¸²å‡½æ•°">å…¶ä»–å­—ç¬¦ä¸²å‡½æ•°&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‡½æ•°&lt;/th>
&lt;th>åŠŸèƒ½&lt;/th>
&lt;th>æ–‡ä»¶&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>StrSplit&lt;/td>
&lt;td>å­—ç¬¦ä¸²åˆ‡å‰²ï¼ŒDelimiter æ”¯æŒæŒ‰å­—ç¬¦ï¼ŒæŒ‰å­—ç¬¦ä¸²æˆ–è€…æŒ‰é•¿åº¦ï¼Œæ”¯æŒè·³è¿‡ç©ºæˆ–è€…ç©ºç™½ï¼Œæ¯” Golang çš„ strings.Split è¦å¥½ç”¨ä¸€äº›&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/str_split.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>StrReplaceAll&lt;/td>
&lt;td>æ›¿æ¢å­—ç¬¦ä¸²&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/str_replace.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ConsumePrefixï¼ŒConsumeSuffixï¼ŒStripPrefixï¼ŒStripSuffix&lt;/td>
&lt;td>åˆ é™¤ç‰¹å®šå‰ç¼€æˆ–è€…åç¼€&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/strip.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>StartsWithï¼ŒEndsWithï¼ŒEqualsIgnoreCaseï¼ŒStartsWithIgnoreCaseï¼ŒEndsWithIgnoreCase&lt;/td>
&lt;td>ç‰¹å®šçš„æ¯”è¾ƒå‡½æ•°ï¼Œå‰ä¸¤è€… C++20 è¢«å¼•å…¥ï¼ˆstd::string::starts_withï¼Œstd::string::ends_withï¼‰ï¼ŒVisual 2019 16.1 C++ /std:c++latest å¼€å¯&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/match.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Substituteï¼ŒSubstituteAndAppend&lt;/td>
&lt;td>åœ¨å‰æ–‡ &lt;a href="https://forcemz.net/cxx/2019/04/29/StringFormattingTalk/">ã€Šå­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼«è°ˆã€‹&lt;/a> æœ‰æåŠï¼Œå­—ç¬¦ä¸²å¡«å……ã€‚&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/subsitute.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SimpleAtobï¼ŒSimpleAtoi&lt;/td>
&lt;td>å­—ç¬¦ä¸²è½¬æ•´å‹æˆ–è€… Booleanï¼Œè¦è½¬æ¢æµ®ç‚¹ç±»å‹ï¼Œè¯·ä½¿ç”¨ &lt;code>&amp;lt;bela/charconv.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/numbers.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="ç¼–ç è½¬æ¢">ç¼–ç è½¬æ¢&lt;/h2>
&lt;p>åœ¨ Bela ä¸­ï¼Œæˆ‘åŸºäº LLVM çš„ ConvertUTF å®ç°äº† UTF-16/UTF-8 UTF-32 çš„ä¸€äº›å‡½æ•°ï¼Œå£°æ˜æ–‡ä»¶å‡åœ¨ &lt;code>&amp;lt;bela/codecvt.hpp&amp;gt;&lt;/code>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‡½æ•°&lt;/th>
&lt;th>åŠŸèƒ½&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>char32tochar16&lt;/td>
&lt;td>Unicode ç ç‚¹è½¬ UTF-16ï¼Œç¼“å†²åŒºé•¿åº¦åº”å½“è‡³å°‘ä¸º 2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char32tochar8&lt;/td>
&lt;td>Unicode ç ç‚¹è½¬ UTF-8ï¼Œç¼“å†²åŒºé•¿åº¦è‡³å°‘ä¸º 4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>c16tomb&lt;/td>
&lt;td>UTF16 ç¼–ç è½¬ UTF-8ï¼Œä½çº§ API&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>mbrtowc&lt;/td>
&lt;td>UTF-8 ç¼–ç è½¬ UTF-16 (wchar_t)ï¼Œä½çº§ API&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>mbrtoc16&lt;/td>
&lt;td>UTF-8 ç¼–ç è½¬ UTF-16 (char16_t)ï¼Œä½çº§ API&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ToNarrow&lt;/td>
&lt;td>UTF-16 è½¬ UTF-8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ToWide&lt;/td>
&lt;td>UTF-8 è½¬ UTF-16&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æ¶‰åŠåˆ°ç¼–ç è½¬æ¢æ—¶ï¼Œåº”å½“ä½¿ç”¨é«˜çº§ API &lt;code>bela::ToNarrow&lt;/code> å’Œ &lt;code>bela::ToWide&lt;/code>&lt;/p>
&lt;h2 id="strformat">StrFormat&lt;/h2>
&lt;p>Bela ç›®å‰æä¾›äº†ä¸€ä¸ªç±»å‹å®‰å…¨ç®€å•çš„ &lt;code>StrFormat&lt;/code>, &lt;code>StrFormat&lt;/code> åŸºäº C++ å˜å‚æ¨¡æ¿ï¼Œä½¿ç”¨ &lt;code>union&lt;/code> è®°å½•å‚æ•°ç±»å‹ï¼Œåœ¨è§£ææ—¶æŒ‰ç…§è¾“å…¥çš„å ä½ç¬¦å°†å…¶ä»–ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿æ¥åœ¨ä¸€èµ·ï¼Œä»è€Œå®ç°æ ¼å¼åŒ–åŠŸèƒ½ã€‚&lt;code>bela::StrFormat&lt;/code> å€Ÿé‰´äº† &lt;code>Chromium SafeNPrintf&lt;/code> å‡½æ•°ï¼Œä½†æ”¯æŒçš„ç±»å‹è¦æ¯” &lt;code>SafeNPrintf&lt;/code> å¤šå¾ˆå¤šã€‚&lt;/p>
&lt;p>æ”¯æŒçš„ç±»å‹å’Œå“åº”çš„å ä½ç¬¦å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç±»å‹&lt;/th>
&lt;th>å ä½ç¬¦&lt;/th>
&lt;th>å¤‡æ³¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>char&lt;/td>
&lt;td>&lt;code>%c&lt;/code>&lt;/td>
&lt;td>ASCII å­—ç¬¦ï¼Œä¼šè¢«æå‡ä¸º wchar_t&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>unsigned char&lt;/td>
&lt;td>&lt;code>%c&lt;/code>&lt;/td>
&lt;td>ASCII å­—ç¬¦ï¼Œä¼šè¢«æå‡ä¸º wchar_t&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>wchar_t&lt;/td>
&lt;td>&lt;code>%c&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char16_t&lt;/td>
&lt;td>&lt;code>%c&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char32_t&lt;/td>
&lt;td>&lt;code>%c&lt;/code>&lt;/td>
&lt;td>UTF-32 Unicode å­—ç¬¦ï¼Œä¼šè¢«è½¬ä¸º UTF-16 å­—ç¬¦ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ Unicode ç ç‚¹ä»¥ %c çš„æ–¹å¼è¾“å‡º emojiã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>short&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>16ä½æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>unsigned short&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>16ä½æ— ç¬¦å·æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>32ä½æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>unsigned int&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>32ä½æ— ç¬¦å·æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>long&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>32ä½æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>unsigned long&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>32ä½æ— ç¬¦å·æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>long long&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>64ä½æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>unsigned long long&lt;/td>
&lt;td>&lt;code>%d&lt;/code>&lt;/td>
&lt;td>64ä½æ— ç¬¦å·æ•´å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>float&lt;/td>
&lt;td>&lt;code>%f&lt;/code>&lt;/td>
&lt;td>ä¼šè¢«æå‡ä¸º &lt;code>double&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>double&lt;/td>
&lt;td>&lt;code>%f&lt;/code>&lt;/td>
&lt;td>64ä½æµ®ç‚¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>const char *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-8 å­—ç¬¦ä¸²ï¼Œä¼šè¢«è½¬æ¢æˆ UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-8 å­—ç¬¦ä¸²ï¼Œä¼šè¢«è½¬æ¢æˆ UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::string&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-8 å­—ç¬¦ä¸²ï¼Œä¼šè¢«è½¬æ¢æˆ UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::string_view&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-8 å­—ç¬¦ä¸²ï¼Œä¼šè¢«è½¬æ¢æˆ UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>const wchar_t *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>wchar_t *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::wstring&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::wstring_view&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>const char16_t *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char16_t *&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::u16string&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::u16string_view&lt;/td>
&lt;td>&lt;code>%s&lt;/code>&lt;/td>
&lt;td>UTF-16 å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>void *&lt;/td>
&lt;td>&lt;code>%p&lt;/code>&lt;/td>
&lt;td>æŒ‡é’ˆç±»å‹ï¼Œä¼šæ ¼å¼åŒ–æˆ &lt;code>0xffff00000&lt;/code> è¿™æ ·çš„å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å¦‚æœä¸æ ¼å¼åŒ– UTF-8 å­—ç¬¦ä¸²ï¼Œä¸”æ‹¥æœ‰å›ºå®šå¤§å°å†…å­˜ç¼“å†²åŒºï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>StrFormat&lt;/code> çš„å¦‚ä¸‹é‡è½½ï¼Œæ­¤é‡è½½å¯ä»¥è½»æ¾çš„ç§»æ¤åˆ° POSIX ç³»ç»Ÿå¹¶æ”¯æŒå¼‚æ­¥ä¿¡å·å®‰å…¨:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬åŸºäº &lt;code>StrFormat&lt;/code> å®ç°äº†ç±»å‹å®‰å…¨çš„ &lt;code>bela::FPrintF&lt;/code>ï¼Œè¿™ä¸ªå‡½æ•°èƒ½å¤Ÿæ ¹æ®è¾“å‡ºè®¾å¤‡çš„ç±»å‹è‡ªåŠ¨è½¬æ¢ç¼–ç ï¼Œå¦‚æœæ˜¯ &lt;code>Conhost&lt;/code> åˆ™ä¼šè¾“å‡º &lt;code>UTF-16&lt;/code>ï¼Œå¦åˆ™åˆ™è¾“å‡º &lt;code>UTF-8&lt;/code>ã€‚å¦‚æœ &lt;code>Conhost&lt;/code> ä¸æ”¯æŒ &lt;code>VT&lt;/code> æ¨¡å¼ï¼Œbela åˆ™ä¼šå°†è¾“å‡ºå­—ç¬¦ä¸²ä¸­çš„ ASCII é¢œè‰²è½¬ä¹‰å»é™¤ï¼Œä½† bela å¹¶æ²¡æœ‰åš Windows æ—§ç‰ˆæœ¬çš„é€‚é…ï¼Œæˆ‘ä»¬åº”è¯¥å§‹ç»ˆä½¿ç”¨ Windows æœ€æ–°å‘è¡Œç‰ˆã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">/// C++17
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/strcat.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/stdwriter.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">cv&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">__cplusplus&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">wmain&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>&lt;span style="color:#58a1dd">argv&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">ux&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">\xf0\x9f\x98\x81&lt;/span>&lt;span style="color:#a6be9d"> UTF-8 text &lt;/span>&lt;span style="color:#a6be9d">\xE3\x8D\xA4&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// force encode UTF-8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#58a1dd">wx&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Engine &lt;/span>&lt;span style="color:#a6be9d">\xD83D\xDEE0&lt;/span>&lt;span style="color:#a6be9d"> ä¸­å›½&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">stderr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Argc: %d Arg0: &lt;/span>&lt;span style="color:#a6be9d">\x1b&lt;/span>&lt;span style="color:#a6be9d">[32m%s&lt;/span>&lt;span style="color:#a6be9d">\x1b&lt;/span>&lt;span style="color:#a6be9d">[0m W: %s UTF-8: %s C++ version: %d&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>], &lt;span style="color:#58a1dd">wx&lt;/span>, &lt;span style="color:#58a1dd">ux&lt;/span>, &lt;span style="color:#58a1dd">cv&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char32_t&lt;/span> &lt;span style="color:#58a1dd">em&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0x1F603&lt;/span>;&lt;span style="color:#828b96;font-style:italic">//ğŸ˜ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StringCat&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Look emoji --&amp;gt;&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">em&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; U: &amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">static_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">uint32_t&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">em&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;emoji test %c %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">em&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;hStderr Mode: %s hStdin Mode: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FileTypeName&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>), &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FileTypeName&lt;/span>(&lt;span style="color:#58a1dd">stdin&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯·æ³¨æ„ï¼Œå¦‚æœä¸Šè¿° emoji è¦æ­£å¸¸æ˜¾ç¤ºï¼Œåº”å½“ä½¿ç”¨ &lt;code>Windows Terminal&lt;/code> æˆ–è€…æ˜¯ &lt;code>Mintty&lt;/code>ã€‚&lt;/p>
&lt;h1 id="ä¸‰-bela-windows-ç³»ç»ŸåŠŸèƒ½åº“">ä¸‰. Bela Windows ç³»ç»ŸåŠŸèƒ½åº“&lt;/h1>
&lt;h2 id="belafinaly">bela::finaly&lt;/h2>
&lt;p>åœ¨ä½¿ç”¨ Golang æ—¶ï¼Œ&lt;code>defer&lt;/code> å¯ä»¥åœ¨å‡½æ•°é€€å‡ºæ—¶æ‰§è¡Œä¸€äº›ä»£ç ï¼Œåœ¨ C++ ä¸­ &lt;a href="https://github.com/microsoft/gsl">Microsoft/GSL&lt;/a> é‡Œé¢æœ‰ä¸€ä¸ª &lt;code>finaly&lt;/code> å®ç°ï¼Œå¼‚æ›²åŒå·¥ã€‚åœ¨è¿™é‡Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>finaly&lt;/code> é¿å…èµ„æºæ³„éœ²ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/finaly.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">wmain&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">file&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">fopen&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;somelog&amp;#34;&lt;/span>,&lt;span style="color:#a6be9d">&amp;#34;w+&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">closer&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">finaly&lt;/span>([&lt;span style="color:#ff636f">&amp;amp;&lt;/span>]{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">file&lt;/span>&lt;span style="color:#ff636f">!=&lt;/span>&lt;span style="color:#ff636f">nullptr&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fclose&lt;/span>(&lt;span style="color:#58a1dd">file&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/// do some codes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="pathcat-è·¯å¾„è§„èŒƒåŒ–è¿æ¥å‡½æ•°">PathCat è·¯å¾„è§„èŒƒåŒ–è¿æ¥å‡½æ•°&lt;/h2>
&lt;p>&lt;code>PathCat&lt;/code> å‡½æ•°å€Ÿé‰´äº† &lt;code>StringCat&lt;/code> å‡½æ•°ï¼Œå°†è·¯å¾„ç»„ä»¶è¿æ¥èµ·æ¥ã€‚ä¾‹å­å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">p&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathCat&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">\\\\&lt;/span>&lt;span style="color:#a6be9d">?&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">C:&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">Windows/System32&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;drivers/etc&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;hosts&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;PathCat: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">p&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">p2&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathCat&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;C:&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">Windows/System32&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;drivers/../..&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;PathCat: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">p2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">p3&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathCat&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Windows/System32&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;drivers/./././.&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">.&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">etc&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;PathCat: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">p3&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">p4&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathCat&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;.&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;test/pathcat/./pathcat_test.exe&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;PathCat: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">p4&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>PathCat&lt;/code> çš„æ€è·¯æ˜¯å…ˆå°† &lt;code>UNC&lt;/code> å‰ç¼€å’Œç›˜ç¬¦è®°å½•å¹¶å»é™¤ï¼Œç„¶åå°†æ‰€æœ‰çš„å‚æ•°ä½¿ç”¨ &lt;code>PathSpilt&lt;/code> å‡½æ•°ä»¥ Windows è·¯å¾„åˆ†éš”ç¬¦å’Œ Linux è·¯å¾„åˆ†éš”ç¬¦æ‹†åˆ†æˆ &lt;code>std::wstring_view&lt;/code> æ•°ç»„ï¼Œå½“å½“å‰è·¯å¾„å…ƒç´ ä¸º &lt;code>..&lt;/code> æ—¶ï¼Œå¼¹å‡ºå­—ç¬¦ä¸²æ•°ç»„ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœä¸º &lt;code>.&lt;/code> åˆ™ä¿æŒä¸å˜ï¼Œå¦åˆ™å°†è·¯å¾„å…ƒç´ å‹å…¥æ•°ç»„ã€‚æ‹†åˆ†å®Œæ¯•åï¼Œéå†æ•°ç»„è®¡ç®—æ‰€éœ€ç¼“å†²åŒºå¤§å°ï¼Œè°ƒæ•´ &lt;code>std::wstring&lt;/code> å®¹é‡ï¼Œç„¶åè¿›è¡Œè·¯å¾„é‡ç»„ã€‚&lt;/p>
&lt;p>å½“ç¬¬ä¸€ä¸ªå‚æ•°å€¼ä¸º &lt;code>.&lt;/code> æ—¶ï¼Œ&lt;code>PathCat&lt;/code> å°†è§£æç¬¬ä¸€ä¸ªè·¯å¾„ä¸ºå½“å‰ç›®å½•ï¼Œç„¶åå‚ä¸è§£æã€‚å¦‚æœ &lt;code>PathCat&lt;/code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œ&lt;code>PathCat&lt;/code> å¹¶ä¸ä¼šä¸»åŠ¨å°†è·¯å¾„è½¬å˜ä¸ºç»å¯¹è·¯å¾„ï¼Œå› æ­¤ï¼Œä½ åº”å½“ä¸»åŠ¨çš„å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º &lt;code>.&lt;/code> ä»¥æœŸè§£æä¸ºç»å¯¹è·¯å¾„ã€‚&lt;/p>
&lt;p>&lt;code>PathCat&lt;/code> å¹¶ä¸ä¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå› æ­¤éœ€è¦æ³¨æ„ã€‚&lt;/p>
&lt;p>è·¯å¾„è§£æé”™è¯¯æ˜¯å¾ˆå¤šè½¯ä»¶çš„æ¼æ´æ ¹æºï¼Œåˆç†çš„è§„èŒƒåŒ–è·¯å¾„éå¸¸æœ‰å¿…è¦ï¼Œè€Œ &lt;code>PathCat&lt;/code> åœ¨è§„èŒƒåŒ–è·¯å¾„æ—¶ï¼Œä½¿ç”¨ C++17/C++20(Span) çš„ç‰¹æ€§ï¼Œå‡å°‘å†…å­˜åˆ†é…ï¼Œç®€åŒ–äº†è§„èŒƒåŒ–æµç¨‹ã€‚&lt;/p>
&lt;p>&lt;code>PathCat&lt;/code> ä½¿ç”¨äº† &lt;code>bela::Span&lt;/code> ï¼ˆ&lt;code>&amp;lt;bela/span.hpp&amp;gt;&lt;/code>ï¼‰ï¼Œ&lt;code>Span&lt;/code> è¢« C++20 é‡‡çº³ï¼Œ&lt;code>bela::Span&lt;/code> åŸºäº &lt;code>absl::Span&lt;/code>ã€‚&lt;/p>
&lt;h2 id="pathexists-å‡½æ•°">PathExists å‡½æ•°&lt;/h2>
&lt;p>&lt;code>PathExists&lt;/code> å‡½æ•°åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå½“ä½¿ç”¨é»˜è®¤å‚æ•°æ—¶ï¼Œåªä¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœéœ€è¦åˆ¤æ–­è·¯å¾„çš„å…¶ä»–å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathExists&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;C:&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">Windows&amp;#34;&lt;/span>,&lt;span style="color:#58a1dd">FileAttribute&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dir&lt;/span>)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>,&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;C:&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">Windows not dir or not exists&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="lookuprealpath-å‡½æ•°">LookupRealPath å‡½æ•°&lt;/h2>
&lt;p>&lt;code>LookupRealPath&lt;/code> ç”¨äºè§£æ Windows ç¬¦å·é“¾æ¥å’Œå·æŒ‚è½½ç‚¹ã€‚&lt;/p>
&lt;h2 id="lookupappexeclinktarget-å‡½æ•°">LookupAppExecLinkTarget å‡½æ•°&lt;/h2>
&lt;p>&lt;code>LookupAppExecLinkTarget&lt;/code> ç”¨äºè§£æ Windows AppExecLink ç›®æ ‡ï¼Œåœ¨ Windows 10 ç³»ç»Ÿä¸­ï¼Œ&lt;code>AppExecLink&lt;/code> æ˜¯ä¸€ç§ Store App çš„å‘½ä»¤è¡Œå…¥å£ï¼Œé€šå¸¸ä½äº &lt;code>C:\Users\$Username\AppData\Local\Microsoft\WindowsApps&lt;/code>ï¼Œè¿™ç§æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é‡è§£æç‚¹ï¼Œå› æ­¤è§£ææ—¶éœ€è¦æŒ‰ç…§é‡è§£æç‚¹çš„æ–¹æ³•å»è§£æã€‚&lt;/p>
&lt;h2 id="executableexistsinpath-æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶">ExecutableExistsInPath æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶&lt;/h2>
&lt;p>åœ¨ Windows cmd ä¸­ï¼Œæœ‰ä¸€ä¸ªå‘½ä»¤å«åš &lt;code>where&lt;/code>ï¼Œç”¨äºæŸ¥æ‰¾å‘½ä»¤æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œè€Œ &lt;code>ExecutableExistsInPath&lt;/code> åˆ™æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¾“å…¥çš„å‘½ä»¤æˆ–è€…è·¯å¾„æŸ¥æ‰¾å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª &lt;code>where&lt;/code> å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">////
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/strcat.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/stdwriter.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/path.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">wmain&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>&lt;span style="color:#58a1dd">argv&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">argc&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;usage: %s command&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">exe&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">ExecutableExistsInPath&lt;/span>(&lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>], &lt;span style="color:#58a1dd">exe&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;command not found: %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stdout&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;%s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">exe&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‘½ä»¤è¡Œåˆæˆæ‹†åˆ†å’Œè§£æ">å‘½ä»¤è¡Œåˆæˆï¼Œæ‹†åˆ†å’Œè§£æ&lt;/h2>
&lt;p>åœ¨ bela ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å‘½ä»¤è¡Œåˆæˆï¼Œæ‹†åˆ†å’Œè§£æç±»ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç±»å&lt;/th>
&lt;th>åŠŸèƒ½&lt;/th>
&lt;th>æ–‡ä»¶&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ParseArgv&lt;/td>
&lt;td>è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œç±»ä¼¼ GNU &lt;code>getopt_long&lt;/code>ï¼Œæ”¯æŒ &lt;code>wchar_t&lt;/code>ï¼Œä¸ä½¿ç”¨å…¨å±€å˜é‡ï¼Œé”™è¯¯ä¿¡æ¯è¯¦ç»†&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/parseargv.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tokenizer&lt;/td>
&lt;td>å°†å‘½ä»¤è¡Œå­—ç¬¦ä¸² Windows commandline å½¢å¼è½¬å˜ä¸º &lt;code>wchar_t **Argv&lt;/code> å½¢å¼&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/tokenizecmdline.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EscapeArgv&lt;/td>
&lt;td>å°† &lt;code>Argv&lt;/code> å½¢å¼å‘½ä»¤è¡Œå‚æ•°è½¬ä¸º &lt;code>commdline&lt;/code> å½¢å¼ï¼Œä¸»è¦ç”¨äº &lt;code>CreateProcess&lt;/code>&lt;/td>
&lt;td>&lt;code>&amp;lt;bela/escapeargv.hpp&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="mapview">MapView&lt;/h2>
&lt;p>åœ¨ bela ä¸­ï¼Œæˆ‘è¿˜æä¾› &lt;code>MapView&lt;/code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåªè¯»çš„æ–‡ä»¶å†…å­˜æ˜ å°„ï¼Œé€šå¸¸ç”¨äºæ–‡ä»¶è§£æã€‚æ–‡ä»¶ &lt;code>&amp;lt;bela/mapview.hpp&amp;gt;&lt;/code> è¿˜æœ‰ä¸ &lt;code>std::string_view&lt;/code> ç±»ä¼¼çš„ &lt;code>MemView &lt;/code> ç±»ã€‚&lt;/p>
&lt;h2 id="pesimpledetailsaze-è·å¾—-pe-çš„ç®€å•ä¿¡æ¯">PESimpleDetailsAze è·å¾— PE çš„ç®€å•ä¿¡æ¯&lt;/h2>
&lt;p>åœ¨ Bela ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ª &lt;code>PESimpleDetailsAze&lt;/code> ç”¨äºè·å¾— PE å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼Œå…¶ç»“æ„ä½“å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">PESimpleDetails&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">clrmsg&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">depends&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// depends dll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">delays&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// delay load library
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">PEVersionPair&lt;/span> &lt;span style="color:#58a1dd">osver&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PEVersionPair&lt;/span> &lt;span style="color:#58a1dd">linkver&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PEVersionPair&lt;/span> &lt;span style="color:#58a1dd">imagever&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Machine&lt;/span> &lt;span style="color:#58a1dd">machine&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Subsytem&lt;/span> &lt;span style="color:#58a1dd">subsystem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uint16_t&lt;/span> &lt;span style="color:#58a1dd">characteristics&lt;/span>{&lt;span style="color:#a6be9d">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uint16_t&lt;/span> &lt;span style="color:#58a1dd">dllcharacteristics&lt;/span>{&lt;span style="color:#a6be9d">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">IsConsole&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">subsystem&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">Subsytem&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">CUI&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">IsDLL&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">uint16_t&lt;/span> &lt;span style="color:#58a1dd">imagefiledll&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0x2000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">characteristics&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">imagefiledll&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‡½æ•°çš„å£°æ˜å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">PESimpleDetails&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">PESimpleDetailsAze&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">file&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error_code&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ec&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ­¤å‡½æ•°ï¼Œä½ å¯ä»¥è·å¾— PE å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®æ ‡æœºå™¨ç±»å‹ï¼Œå­ç³»ç»Ÿï¼Œè¿æ¥å™¨ç‰ˆæœ¬ï¼Œç³»ç»Ÿç‰ˆæœ¬ï¼ŒImage ç‰ˆæœ¬ï¼ŒPE çš„ç‰¹å¾ï¼ŒPE ä¾èµ–çš„ dll å’Œå»¶æ—¶åŠ è½½çš„ dllã€‚å¦‚æœæ˜¯ CLR PE æ–‡ä»¶ï¼Œåˆ™clrmsg ä¸ä¸ºç©ºæè¿°çš„æ˜¯ CLR çš„ä¿¡æ¯ã€‚&lt;code>PESimpleDetailsAze&lt;/code> å¹¶ä¸ä¾èµ– &lt;code>DbgHelp.dll (ImageRvaToVa)&lt;/code>ã€‚&lt;/p>
&lt;h1 id="æœ€å">æœ€å&lt;/h1>
&lt;p>Bela åº”è¯¥æ˜¯ä¸æ–­å‘å±•çš„ï¼Œå¦‚æœæˆ‘æœ‰æ–°çš„ Idea äº†ï¼Œå°±ä¼šåŠæ—¶çš„ç§»æ¤è¿›å»çš„ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-05-25-introduction-bela/ - Copyright (c) 2009-2024 J23</description></item><item><title>å­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼«è°ˆ</title><link>https://forcemz.net/posts/2019/2019-04-29-string-formatting-talk/</link><pubDate>Mon, 29 Apr 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-04-29-string-formatting-talk/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-04-29-string-formatting-talk/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>æ˜¥é£åŒ–é›¨ï¼Œä¸‡ç‰©å¤è‹ï¼Œç¼–ç¨‹å§‹äº &lt;code>Hello world&lt;/code>ï¼ŒC è¯­è¨€çš„ Hello world å¯å¦‚ä¸‹ï¼ŒåŒæ · C++ äº¦å¯å¦‚ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">printf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Hello World!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>printf å‡½æ•°ç±»å‹ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">printf&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>,...);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŒ‰ç…§æ­¤å£°æ˜æˆ‘ä»¬å¯ä»¥æ ¼å¼åŒ–è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">name&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Tony Stark&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">printf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Hello %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>,&lt;span style="color:#58a1dd">name&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ C ç¼–è¯‘å™¨ Clang/MSVC/GCC å°†å…¶ç¼–è¯‘è¿è¡Œï¼Œåœ¨ç»ˆç«¯æˆ–è€…å‘½ä»¤è¡Œä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š&lt;/p>
&lt;blockquote>
&lt;p>$ Hello Tony Stark&lt;/p>
&lt;/blockquote>
&lt;p>printf å‡½æ•°å®¶æ—å£°æ˜å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://en.cppreference.com/w/cpp/header/cstdio
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">printf&lt;/span>( &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, ... );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FILE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">stream&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, ... );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">sprintf&lt;/span>( &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, ... );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">snprintf&lt;/span>( &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">buf_size&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, ... );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">vprintf&lt;/span>( &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">vlist&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">vfprintf&lt;/span>( &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FILE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">stream&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">vlist&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">vsprintf&lt;/span>( &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">vlist&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">vsnprintf&lt;/span>( &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">buf_size&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">vlist&lt;/span> );
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæˆ‘ä»¬éœ€è¦æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code>sprintf&lt;/code> æˆ–è€…æ˜¯ &lt;code>snprintf&lt;/code> ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ&lt;code>snprintf&lt;/code> æ˜¯å¦‚ä½•æ ¼å¼åŒ–çš„ï¼Ÿ&lt;/p>
&lt;h2 id="æ ¼å¼åŒ–å†…å¹•">æ ¼å¼åŒ–å†…å¹•&lt;/h2>
&lt;p>è¦äº†è§£ snprintf çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬éœ€è¦å»æ‰¾ä¸€ä¸ª libc äº†è§£ä¸€ç•ªï¼Œè¿™é‡Œå»ºè®®æ˜¯ &lt;a href="https://github.com/bminor/musl">musl&lt;/a>ï¼Œmusl åªæ”¯æŒ Linuxï¼Œæ²¡æœ‰åƒ Glibc é‚£ä¹ˆå¤šçš„é—ç•™ä»£ç ï¼Œä»£ç æ¯”è¾ƒæ•´æ´ã€‚è€Œ Visual C++ çš„ ucrt æºç åŸºæœ¬ä½¿ç”¨ C++ æ¨¡æ¿ç¼–å†™ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œä¸å®¹æ˜“å€Ÿæ­¤ç†æ¸… snprintf çš„ç»†èŠ‚ã€‚ç¿»é˜… musl snprintf.c æºç ï¼Œæˆ‘ä»¬å‘ç° snprintf å°†ä¼šè°ƒç”¨ &lt;code>vsnprintf&lt;/code>ï¼Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/bminor/musl/blob/master/src/stdio/snprintf.c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;stdarg.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">snprintf&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">restrict&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#ff636f">size_t&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">restrict&lt;/span> &lt;span style="color:#58a1dd">fmt&lt;/span>, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">ret&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">ap&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_start&lt;/span>(&lt;span style="color:#58a1dd">ap&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ret&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">vsnprintf&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">n&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">ap&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_end&lt;/span>(&lt;span style="color:#58a1dd">ap&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ret&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/bminor/musl/blob/master/src/stdio/vsnprintf.c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">vsnprintf&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">restrict&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#ff636f">size_t&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">restrict&lt;/span> &lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">ap&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">dummy&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">cookie&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> { .&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span> : &lt;span style="color:#58a1dd">dummy&lt;/span>, .&lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FILE&lt;/span> &lt;span style="color:#58a1dd">f&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#58a1dd">lbf&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">EOF&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#58a1dd">write&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sn_write&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#58a1dd">lock&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#58a1dd">buf&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">buf&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#58a1dd">cookie&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">c&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">INT_MAX&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">errno&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">EOVERFLOW&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">c&lt;/span>.&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">vfprintf&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">f&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">ap&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ musl ä¹‹ä¸­ï¼Œvsnprintf åˆ›å»ºä¸€ä¸ª FILE ç»“æ„ï¼Œç„¶åæœ€ç»ˆä½¿ç”¨ vfprintf æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚è¿™é‡Œä½¿ç”¨äº† &lt;code>va_list&lt;/code> &lt;code>va_start&lt;/code> &lt;code>va_end&lt;/code> å®ï¼Œè¿™ç»„å®å°†å˜å‚å‡½æ•°çš„å‚æ•°ä»å‡½æ•°æ ˆä¸­å–å‡ºæ¥ï¼Œä»è€Œå®ç°äº†å˜å‚å‡½æ•°çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ Visual C++ åœ¨ &lt;a href="https://gist.github.com/fcharlie/e2b6a2d578d7b484d0338886ce0db768">&lt;code>vadefs.h&lt;/code>&lt;/a> ä¸­çš„å®šä¹‰ã€‚&lt;/p>
&lt;p>è€Œ va_list æœ¬è´¨ä¸Šæ˜¯ä»å‡½æ•°å‚æ•°æ ˆä¸­è·å¾—ç‰¹å®šä½ç½®çš„å€¼ã€‚&lt;/p>
&lt;p>&lt;code>vfprintf&lt;/code> å‡½æ•°çš„æºç åœ¨ï¼š &lt;a href="https://github.com/bminor/musl/blob/master/src/stdio/vfprintf.c">musl: src/stdio/vfprintf.c&lt;/a>ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°æ ¼å¼åŒ–è¾“å‡ºå®é™…ä¸Šæ˜¯è§£æ &lt;code>format&lt;/code> å­—ç¬¦ä¸²ï¼Œåœ¨è§£æåˆ°å ä½ç¬¦æ—¶ï¼Œä½¿ç”¨ &lt;code>va_arg&lt;/code> æå– &lt;code>va_list&lt;/code> ä¸­çš„å˜é‡ï¼ˆæˆ–è€…è½¬å˜ä¸ºç‰¹å®šæ ¼å¼å­—ç¬¦ä¸²åï¼‰æ›¿æ¢å ä½ç¬¦ï¼Œä»è€Œå®ç°æ ¼å¼åŒ–è¾“å‡ºçš„ç›®çš„ï¼ˆæ–‡ä»¶æˆ–è€…ç¼“å†²åŒºï¼‰ã€‚æ ¼å¼åŒ–å ä½ç¬¦ä»¥ &lt;code>%&lt;/code> å¼€å¤´ï¼Œæ”¯æŒæ ¼å¼åŒ–çš„ç±»å‹å¯ä»¥å‚è€ƒ &lt;a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/fprintf.html">http://pubs.opengroup.org/onlinepubs/9699919799/functions/fprintf.html&lt;/a>&lt;/p>
&lt;p>äº†è§£åˆ°æ ¼å¼åŒ–è¾“å‡ºçš„åŸç†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ–è€…æ ¼å¼åŒ–è¾“å‡ºå‡½æ•°ï¼Œåœ¨ nginx æºç ä¸­ï¼Œå°±æœ‰ä¸€ä¸ª ç±»ä¼¼å®ç°ï¼š &lt;a href="https://github.com/nginx/nginx/blob/27b3d3dcca5fcc82350a823881f3d06161327b59/src/core/ngx_string.c#L163">&lt;code>ngx_vslprintf&lt;/code>&lt;/a> ï¼Œè¿™ä¸ªä»£ç æ¯”è¾ƒç®€å•æ¯”è¾ƒå®¹æ˜“ç§»æ¤ã€‚&lt;/p>
&lt;h2 id="c-style-æ ¼å¼åŒ–çš„ç¼ºé™·">C-Style æ ¼å¼åŒ–çš„ç¼ºé™·&lt;/h2>
&lt;p>ä¸Šè¿°æ ¼å¼åŒ–ä½¿ç”¨å˜å‚å‡½æ•°ï¼Œä½¿ç”¨ va_list è·å¾—å‚æ•°å€¼ï¼Œè¿™ç§ä½¿ç”¨ va_list çš„å‡½æ•°åœ¨ C++ ä¸­æ˜¯ä¸è¢«æ¨èçš„ &lt;a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#F-varargs">F.55: Don&amp;rsquo;t use va_arg arguments&lt;/a>ã€‚å½“ç”¨æˆ·ç¼–ç æ—¶ï¼Œå¯èƒ½æ˜¯ç¨‹åºå‘˜ç–å¿½æˆ–è€…æ•…æ„ï¼Œä¾èµ– va_list çš„ä»£ç å¾ˆå®¹æ˜“ç”±äºç±»å‹ä¸åŒ¹é…ï¼Œå‚æ•°ä¸ªæ•°ä¸åŒ¹é…è€Œé€ æˆæ ˆæº¢å‡ºã€‚å¯¼è‡´å®‰å…¨æ¼æ´æˆ–è€…æ˜¯ç¨‹åºå´©æºƒã€‚ä»¥ä¸‹ä»£ç å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¹Ÿä¸ä¼šè­¦å‘Šï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;string_view&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;cstdarg&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">dump&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>,...){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">ret&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_list&lt;/span> &lt;span style="color:#58a1dd">ap&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_start&lt;/span>(&lt;span style="color:#58a1dd">ap&lt;/span>,&lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">vfprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>,&lt;span style="color:#58a1dd">fmt&lt;/span>,&lt;span style="color:#58a1dd">ap&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">va_end&lt;/span>(&lt;span style="color:#58a1dd">ap&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ret&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">name&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Tony Stark&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">dump&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;hello %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>,&lt;span style="color:#58a1dd">name&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘å™¨çš„æ„å»ºä¿¡æ¯å¦‚ä¸‹:&lt;/p>
&lt;pre tabindex="0">&lt;code>ä½¿ç”¨å†…å»º specsã€‚
COLLECT_GCC=/opt/gcc/bin/g++
COLLECT_LTO_WRAPPER=/opt/gcc/libexec/gcc/x86_64-linux-gnu/9.0.1/lto-wrapper
ç›®æ ‡ï¼šx86_64-linux-gnu
é…ç½®ä¸ºï¼š../configure --with-pkgversion=Baslat.Inc --prefix=/opt/gcc --enable-shared --enable-linker-build-id --without-included-gettext --enable-threads=posix --enable-checking=release --enable-languages=c,c++ --disable-multilib --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --with-system-zlib --with-abi=m64 --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
çº¿ç¨‹æ¨¡å‹ï¼šposix
gcc ç‰ˆæœ¬ 9.0.1 20190426 (prerelease) (Baslat.Inc)
&lt;/code>&lt;/pre>&lt;p>è¿è¡Œç¼–è¯‘å™¨å‘½ä»¤ï¼š&lt;/p>
&lt;blockquote>
&lt;p>/opt/gcc/bin/g++ -fsanitize=address -fno-omit-frame-pointer fuck.cc -std=c++17&lt;/p>
&lt;/blockquote>
&lt;p>è¿è¡Œç¨‹åºï¼š&lt;/p>
&lt;blockquote>
&lt;p>./a.out&lt;/p>
&lt;/blockquote>
&lt;p>åœ°å€æ¶ˆæ¯’å‰‚æŠ¥å‘Šå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>AddressSanitizer:DEADLYSIGNAL
=================================================================
==16509==ERROR: AddressSanitizer: SEGV on unknown address 0x00000000000a (pc 0x7fc137bc3af2 bp 0x7ffffbf14ea0 sp 0x7ffffbf145c8 T0)
==16509==The signal is caused by a READ memory access.
==16509==Hint: address points to the zero page.
#0 0x7fc137bc3af1 (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x109af1)
#1 0x7fc137b0e61c (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x5461c)
#2 0x7fc137b0efb4 in __interceptor_vfprintf (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x54fb4)
#3 0x400cf0 in dump(char const*, ...) (/tmp/a.out+0x400cf0)
#4 0x400e06 in main (/tmp/a.out+0x400e06)
#5 0x7fc136dabb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
#6 0x400b09 in _start (/tmp/a.out+0x400b09)
AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x109af1)
==16509==ABORTING
&lt;/code>&lt;/pre>&lt;p>å‡ºç°é—®é¢˜å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œç”±äº std::string_view çš„ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>, &lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">traits&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">char_traits&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// types
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">traits&lt;/span> &lt;span style="color:#58a1dd">traits_type&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">value_type&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">pointer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">const_pointer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">reference&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">const_reference&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">implementation&lt;/span>&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#58a1dd">defined&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span> &lt;span style="color:#58a1dd">iterator&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">reverse_iterator&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">const_iterator&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span> &lt;span style="color:#58a1dd">reverse_iterator&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">ptrdiff_t&lt;/span> &lt;span style="color:#58a1dd">difference_type&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span>(&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// 7.3, basic_string_view constructors and assignment operators
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>() &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">template&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">Allocator&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// 7.4, basic_string_view iterator support
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span> &lt;span style="color:#58a1dd">begin&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span> &lt;span style="color:#58a1dd">end&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span> &lt;span style="color:#58a1dd">cbegin&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_iterator&lt;/span> &lt;span style="color:#58a1dd">cend&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span> &lt;span style="color:#58a1dd">rbegin&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span> &lt;span style="color:#58a1dd">rend&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span> &lt;span style="color:#58a1dd">crbegin&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">const_reverse_iterator&lt;/span> &lt;span style="color:#58a1dd">crend&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// 7.5, basic_string_view capacity
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">length&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">max_size&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">empty&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// 7.6, basic_string_view element access
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_reference&lt;/span> &lt;span style="color:#ff636f">operator&lt;/span>[](&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_reference&lt;/span> &lt;span style="color:#58a1dd">at&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_reference&lt;/span> &lt;span style="color:#58a1dd">front&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_reference&lt;/span> &lt;span style="color:#58a1dd">back&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">const_pointer&lt;/span> &lt;span style="color:#58a1dd">data&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// 7.7, basic_string_view modifiers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#58a1dd">remove_prefix&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#58a1dd">remove_suffix&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#58a1dd">swap&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">copy&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos1&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n1&lt;/span>, &lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos1&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos2&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n2&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos1&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n1&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos1&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n2&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">rfind&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">rfind&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">rfind&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">rfind&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_of&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_of&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_of&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_of&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_not_of&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_not_of&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_not_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_first_not_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_not_of&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_not_of&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_not_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">find_last_not_of&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">npos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">starts_with&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">starts_with&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">starts_with&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">ends_with&lt;/span>(&lt;span style="color:#58a1dd">basic_string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">ends_with&lt;/span>(&lt;span style="color:#58a1dd">charT&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">noexcept&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">ends_with&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">charT&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// C++2a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">const_pointer&lt;/span> &lt;span style="color:#58a1dd">data_&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// exposition only
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">size_type&lt;/span> &lt;span style="color:#58a1dd">size_&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// exposition only
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> };
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äº string_view å€¼è¢«é”™è¯¯çš„è½¬å˜ä¸º &lt;code>char *&lt;/code>ï¼Œè€Œ C-Style çš„å­—ç¬¦ä¸²æ˜¯ &lt;code>null-terminated string&lt;/code>ï¼Œåœ¨å¤„ç† &lt;code>%s&lt;/code> çš„æ—¶å€™æ— æ³•æ­£å¸¸è§£æåˆ°ç»ˆæ­¢å­—ç¬¦ï¼Œå‡ºç°æº¢å‡ºç„¶åå¯¼è‡´ç¨‹åºå´©æºƒï¼ŒåŒæ ·ï¼Œå¦‚æœç±»å‹å®½åº¦ä¸ä¸€è‡´ï¼Œæ¯”å¦‚ format ä¸­éœ€è¦ &lt;code>%lld&lt;/code>ï¼Œè€Œè¾“å…¥ä¸º &lt;code>int&lt;/code> åŒæ ·å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œä½†è¿™ç§é—®é¢˜å¯èƒ½æ›´å¤šçš„é¢„æœŸç»“æœä¸ä¸€è‡´ã€‚ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå°† &lt;code>std::string_view&lt;/code> æ”¹æˆ &lt;code>std::string&lt;/code>, clang 8.0.1 åˆ™ä¼šæŠ¥å‘Š std::string ä¸æ˜¯ POD ç±»å‹çš„é”™è¯¯ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>fuck2.cc:16:21: error: cannot pass object of non-trivial type &amp;#39;std::string&amp;#39; (aka &amp;#39;basic_string&amp;lt;char&amp;gt;&amp;#39;) through variadic
function; call will abort at runtime [-Wnon-pod-varargs]
dump(&amp;#34;hello %s\n&amp;#34;,name);
^
1 error generated.
&lt;/code>&lt;/pre>&lt;h2 id="å®‰å…¨æ ¼å¼åŒ–è§£å†³æ–¹æ¡ˆ">å®‰å…¨æ ¼å¼åŒ–è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;h3 id="ç¼–è¯‘å™¨çš„å‚æ•°åŒ¹é…æ£€æŸ¥">ç¼–è¯‘å™¨çš„å‚æ•°åŒ¹é…æ£€æŸ¥&lt;/h3>
&lt;p>ä¸ºäº†å‡å°‘ä¸Šé¢é”™è¯¯çš„å‘ç”Ÿï¼Œå¼€å‘è€…å¢åŠ äº†å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼Œå¯¹äº C æˆ–è€… C++ è€Œè¨€ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ &lt;code>Attributes&lt;/code> é™åˆ¶å‡½æ•°çš„å±æ€§ï¼Œå½“æ ¼å¼ä¸åŒ¹é…æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifdef __GNUC__
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#58a1dd">log_unlocked&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">level&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">__attribute__&lt;/span>((&lt;span style="color:#58a1dd">__format__&lt;/span>(&lt;span style="color:#58a1dd">__printf__&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#58a1dd">log_unlocked&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">level&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, ...);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†è¿™ç§æ–¹æ¡ˆå—é™äºç¼–è¯‘å™¨ï¼Œä¸æ˜¯ä¸€ä¸ªæ™®éæ–¹æ¡ˆã€‚&lt;a href="https://clang.llvm.org/docs/AttributeReference.html#format">Clang&lt;/a> ä¿æŒäº†å¯¹ GCC çš„å…¼å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿° &lt;code>__attribute__&lt;/code>ã€‚è€Œ MSVC åˆ™å¯ä»¥ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2010/ms235402(v=vs.100)">SAL: &lt;code>_Printf_format_string_&lt;/code>&lt;/a>ã€‚&lt;/p>
&lt;h3 id="å˜å‚å‡½æ•°æ¨¡æ¿çš„è¾…åŠ©">å˜å‚å‡½æ•°æ¨¡æ¿çš„è¾…åŠ©&lt;/h3>
&lt;p>å¦‚æœè¦åœ¨ C++ å½“ä¸­ä½¿ç”¨ç±»ä¼¼çš„æ ¼å¼åŒ–å‡½æ•°æ–¹æ¡ˆï¼Œå¯ä»¥å˜å‚å‡½æ•°æ¨¡æ¿åŒ…è£…ï¼Œcppwinrt çš„ä½œè€… Kenny Kerr å°±æœ‰ä¸€ç¯‡æ–‡ç« å‘Šè¯‰äººä»¬æ”¹æ€ä¹ˆåšï¼š &lt;a href="https://msdn.microsoft.com/en-us/magazine/dn913181.aspx">Windows with C++ - Using Printf with Modern C++&lt;/a>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#58a1dd">Argument&lt;/span>(&lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Argument&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">basic_string&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>.&lt;span style="color:#58a1dd">c_str&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">StringPrint&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">bufferCount&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">snprintf&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">bufferCount&lt;/span>, &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">Argument&lt;/span>(&lt;span style="color:#58a1dd">args&lt;/span>)...);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">StringPrint&lt;/span>(&lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">args&lt;/span>...);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">resize&lt;/span>(&lt;span style="color:#58a1dd">size&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">StringPrint&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">buffer&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>], &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">format&lt;/span>, &lt;span style="color:#58a1dd">args&lt;/span>...);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æ ¼å¼åŒ–æ—¶å°† &lt;code>std::string&lt;/code> è½¬å˜ä¸ºäº† &lt;code>const char *&lt;/code>ï¼Œè¿™ç§æ–¹æ¡ˆçš„ç¼ºé™·æœ‰ä¸¤å¤„ï¼Œç¬¬ä¸€ &lt;code>std::string&lt;/code> æ˜¯å¯ä»¥å­˜åœ¨ &lt;code>\0&lt;/code> è¿™æ ·çš„å­—ç¬¦çš„ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå´è¢«æˆªæ–­ï¼Œç¬¬äºŒï¼Œ&lt;code>std::string&lt;/code> éœ€è¦å†æ¬¡è®¡ç®—é•¿åº¦ã€‚&lt;/p>
&lt;h2 id="ç°ä»£-c-æ ¼å¼åŒ–åº“">ç°ä»£ C++ æ ¼å¼åŒ–åº“&lt;/h2>
&lt;p>æ—¢ç„¶ C-Style çš„æ ¼å¼åŒ–æ–¹æ¡ˆç¼ºé™·é‚£ä¹ˆå¤šï¼Œé‚£ä¹ˆ C++ å¼€å‘è€…ä»¬ä¹Ÿä¼šä¸é—ä½™åŠ›çš„å»é€ è½®å­ï¼Œå®ç°è‡ªå·±çš„ç›®æ ‡çš„ï¼Œæ—©æœŸæ¯”å¦‚æˆ‘åˆšå­¦ C++ é‚£ä¼šï¼Œéƒ½æ˜¯ &lt;code>iostream&lt;/code> å®¶æ—ï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–å¯ä»¥ä½¿ç”¨ &lt;code>stringstream&lt;/code>ï¼Œ&lt;code>iostream&lt;/code> è¿™ç±»æ–¹æ¡ˆä¸€ç›´è¢«è§†ä¸ºç³Ÿç³•çš„è®¾è®¡ï¼Œä¸€æ¥ç»§æ‰¿å¤æ‚ï¼ŒäºŒæ¥æ•ˆç‡ä½ã€‚ç‰¹åˆ«åœ¨ C++11 å˜å‚æ¨¡æ¿ç­‰ç‰¹æ€§å‡ºæ¥åï¼Œé¥±å—é„™è§†ï¼Œå› æ­¤ä¹Ÿä¸æ˜¯å»ºè®®çš„æ ¼å¼åŒ–æ–¹æ¡ˆã€‚ç°åœ¨ C++20 éƒ½å¿«å‘å¸ƒäº†ï¼Œä¹Ÿæ¶Œç°äº†ä¸€äº›æ›´å¥½çš„æ–¹æ¡ˆï¼Œå¥½çš„æ ¼å¼åŒ–åº“æœ‰ç§¯æå…¥æ ‡å‡†çš„ &lt;a href="https://github.com/fmtlib/fmt">fmtlib&lt;/a>ã€‚è¿˜æœ‰ Facebook çš„ C++ æ ‡å‡†åº“è¡¥å…… &lt;a href="https://github.com/facebook/folly">folly&lt;/a> ä¹Ÿæœ‰ä¸€ä¸ª &lt;code>format&lt;/code> å®ç°ã€‚åœ¨ Google é‡Œé¢ï¼Œå¾ˆå¤šé¡¹ç›®ä½¿ç”¨äº† C++ï¼Œä»–ä»¬ä¹Ÿç§¯ç´¯äº†ä¸€äº› C++ ç»„ä»¶ï¼Œåæ¥å¼€æºäº† &lt;a href="https://github.com/abseil/abseil-cpp">Abseil&lt;/a>ï¼ŒAbseil ä¸­ä¹Ÿæœ‰å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•° &lt;code>absl::StrFormat&lt;/code>ï¼Œ&lt;code>absl::StrAppendFormat&lt;/code> ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å®ç°æ¯”è¾ƒæ…¢ï¼Œä»£ç ä¸å¤ªå¹²å‡€çš„ï¼Œè¿™é‡Œä¹Ÿå°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;h3 id="ç§¯æå…¥æ ‡å‡†çš„-fmtlib">ç§¯æå…¥æ ‡å‡†çš„ fmtlib&lt;/h3>
&lt;p>fmtlib ç›®å‰æ˜¯å†²ç€è¿›å…¥ C++ æ ‡å‡†å»çš„ï¼Œå®ƒæ”¯æŒä¸¤ç§é£æ ¼ï¼Œä¸€ä¸ªæ˜¯ç±»ä¼¼ python çš„é£æ ¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">fmt&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The answer is {}.&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">fmt&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">print&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;I&amp;#39;d rather be {1} than {0}.&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;right&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;happy&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§é£æ ¼è¿˜å¯ä»¥é€šè¿‡é‡è½½ &lt;code>format_to&lt;/code> å‡½æ•°ï¼Œ è¾“å‡ºç‰¹å®šçš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>fmtlib è¿˜æ”¯æŒ printf çš„æ ¼å¼åŒ–é£æ ¼ï¼Œä½¿ç”¨å˜å‚æ¨¡æ¿å±•å¼€ï¼Œæ˜¯æ ¼å¼åŒ–å®‰å…¨çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">message&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">fmt&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">sprintf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The answer is %d&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç±»å‹ä¸åŒ¹é…æ—¶ fmtlib ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ç§è¿è¡Œæ—¶è¡Œä¸ºã€‚å¦å¤– fmtlib è¿˜æ”¯æŒ &lt;code>wchar_t&lt;/code>ï¼Œè¿™åœ¨ &lt;code>Windows&lt;/code> ç³»ç»Ÿä¸­æ¯”è¾ƒé‡è¦ã€‚åœ¨æ ¼å¼åŒ–æµ®ç‚¹ç±»å‹æ—¶ï¼Œå¯èƒ½ä¼šå›é€€åˆ° &lt;code>snprintf&lt;/code>ã€‚&lt;/p>
&lt;h3 id="facebook-folly-format">Facebook folly format&lt;/h3>
&lt;p>&lt;a href="https://github.com/facebook/folly/blob/master/folly/docs/Format.md">Folly format&lt;/a> çš„é£æ ¼ç±»ä¼¼äº python çš„æ ¼å¼åŒ–é£æ ¼ï¼Œä¸ fmtlib çš„ç¬¬ä¸€ç§ä¸€è‡´ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">using&lt;/span> &lt;span style="color:#58a1dd">folly&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">format&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">using&lt;/span> &lt;span style="color:#58a1dd">folly&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">sformat&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">using&lt;/span> &lt;span style="color:#58a1dd">folly&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vformat&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">using&lt;/span> &lt;span style="color:#58a1dd">folly&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">svformat&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Objects produced by format() can be streamed without creating
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// an intermediary string; {} yields the next argument using default
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// formatting.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The answers are {} and {}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The answers are 23 and 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// If you just want the string, though, you&amp;#39;re covered.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The answers are {} and {}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The answers are 23 and 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Arguments can be referenced out of order, even multiple times
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The answers are {1}, {0}, and {1} again&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The answers are 42, 23, and 42 again&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// It&amp;#39;s perfectly fine to not reference all arguments
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only answer is {1}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Values can be extracted from indexable containers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// (random-access sequences and integral-keyed maps), and also from
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// string-keyed maps
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">int&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">v&lt;/span> {&lt;span style="color:#a6be9d">23&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">map&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">m&lt;/span> { {&lt;span style="color:#a6be9d">&amp;#34;what&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;answer&amp;#34;&lt;/span>} };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only {1[what]} is {0[1]}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">v&lt;/span>, &lt;span style="color:#58a1dd">m&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// If you only have one container argument, vformat makes the syntax simpler
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">map&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">m&lt;/span> { {&lt;span style="color:#a6be9d">&amp;#34;what&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;answer&amp;#34;&lt;/span>}, {&lt;span style="color:#a6be9d">&amp;#34;value&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;42&amp;#34;&lt;/span>} };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">vformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only {what} is {value}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">m&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// same as
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only {0[what]} is {0[value]}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">m&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// And if you just want the string,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">svformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only {what} is {value}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">m&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only {0[what]} is {0[value]}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">m&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// {} works for vformat too
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">int&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">v&lt;/span> {&lt;span style="color:#a6be9d">42&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">vformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{} {}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">v&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;42 23&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// format and vformat work with pairs and tuples
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">tuple&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">int&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>, &lt;span style="color:#ff636f">int&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">t&lt;/span> {&lt;span style="color:#a6be9d">42&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;hello&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">vformat&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{0} {2} {1}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">t&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;42 23 hello&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Format supports width, alignment, arbitrary fill, and various
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// format specifiers, with meanings similar to printf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// &amp;#34;X&amp;lt;10&amp;#34;: fill with &amp;#39;X&amp;#39;, left-align (&amp;#39;&amp;lt;&amp;#39;), width 10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{:X&amp;lt;10} {}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;hello&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;helloXXXXX world&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Field width may be a runtime value rather than part of the format string
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">x&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{:-^*}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">x&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;hi&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;--hi--&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Explicit arguments work with dynamic field width, as long as indexes are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// given for both the value and the field width.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{2:+^*0}&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;unused&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">456&lt;/span>); &lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;+++456+++&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Format supports printf-style format specifiers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;{0:05d} decimal = {0:04x} hex&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;00042 decimal = 002a hex&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Formatter objects may be written to a string using folly::to or
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// folly::toAppend (see folly/Conv.h), or by calling their appendTo(),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// str(), and fbstr() methods
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;The only answer is {}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">42&lt;/span>).&lt;span style="color:#58a1dd">str&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;The only answer is 42&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Decimal precision usage
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">cout&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">format&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Only 2 decimals is {:.2f}&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">23.34134534535&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// =&amp;gt; &amp;#34;Only 2 decimals is 23.34&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½† Folly çš„æ„å»ºæ˜¯ä¸ªé‡é‡çº§çš„æ´»åŠ¨ï¼Œæ‰€ä»¥åƒæˆ‘è¿™æ ·çš„å¼€å‘è€…ä¸€èˆ¬æ˜¯ä¸ä¼šé‡‡ç”¨ folly çš„ã€‚è™½ç„¶ folly ä¾§é‡ä¸ Linux ï¼Œä½†ç›®å‰å¯ä»¥æ„å»ºä¸º Windows x64 ç›®æ ‡ï¼Œä½¿ç”¨ vcpkg äº¦å¯å®‰è£…ã€‚&lt;/p>
&lt;h3 id="google-abseil-strformat">Google Abseil StrFormat&lt;/h3>
&lt;p>åœ¨ GNK é¡¹ç›®ä¸­ï¼Œæˆ‘æ›¾ä½¿ç”¨ fmtlibï¼Œä½† clang-tidy è€æ˜¯è­¦å‘Šæ²¡æœ‰æ•è·å¼‚å¸¸ï¼Œæ·»åŠ å¼‚å¸¸æ•è·ï¼Œä»£ç ç¹çä¸æ•´æ´ï¼Œæˆ‘åœ¨è€ƒå¯Ÿ Abseil ä¹‹åï¼Œå‘ç°ä½¿ç”¨ä½“éªŒè¦ä¼˜äº fmtlibï¼Œå°±å°†å…¶åˆ‡æ¢åˆ° Abseil äº†ã€‚&lt;br>
Abseil StrFormat åªæ”¯æŒ C-Style çš„æ ¼å¼åŒ–é£æ ¼ï¼Œæ ¼å¼åŒ–æ”¯æŒçš„ç±»å‹å¯ä»¥æŸ¥çœ‹å¦‚ä¸‹æ³¨é‡Šï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>// In specific, the `FormatSpec` supports the following type specifiers:
// * `c` for characters
// * `s` for strings
// * `d` or `i` for integers
// * `o` for unsigned integer conversions into octal
// * `x` or `X` for unsigned integer conversions into hex
// * `u` for unsigned integers
// * `f` or `F` for floating point values into decimal notation
// * `e` or `E` for floating point values into exponential notation
// * `a` or `A` for floating point values into hex exponential notation
// * `g` or `G` for floating point values into decimal or exponential
// notation based on their precision
// * `p` for pointer address values
// * `n` for the special case of writing out the number of characters
// written to this point. The resulting value must be captured within an
// `absl::FormatCountCapture` type.
//
// NOTE: `o`, `x\X` and `u` will convert signed values to their unsigned
// counterpart before formatting.
//
// Examples:
// &amp;#34;%c&amp;#34;, &amp;#39;a&amp;#39; -&amp;gt; &amp;#34;a&amp;#34;
// &amp;#34;%c&amp;#34;, 32 -&amp;gt; &amp;#34; &amp;#34;
// &amp;#34;%s&amp;#34;, &amp;#34;C&amp;#34; -&amp;gt; &amp;#34;C&amp;#34;
// &amp;#34;%s&amp;#34;, std::string(&amp;#34;C++&amp;#34;) -&amp;gt; &amp;#34;C++&amp;#34;
// &amp;#34;%d&amp;#34;, -10 -&amp;gt; &amp;#34;-10&amp;#34;
// &amp;#34;%o&amp;#34;, 10 -&amp;gt; &amp;#34;12&amp;#34;
// &amp;#34;%x&amp;#34;, 16 -&amp;gt; &amp;#34;10&amp;#34;
// &amp;#34;%f&amp;#34;, 123456789 -&amp;gt; &amp;#34;123456789.000000&amp;#34;
// &amp;#34;%e&amp;#34;, .01 -&amp;gt; &amp;#34;1.00000e-2&amp;#34;
// &amp;#34;%a&amp;#34;, -3.0 -&amp;gt; &amp;#34;-0x1.8p+1&amp;#34;
// &amp;#34;%g&amp;#34;, .01 -&amp;gt; &amp;#34;1e-2&amp;#34;
// &amp;#34;%p&amp;#34;, *int -&amp;gt; &amp;#34;0x7ffdeb6ad2a4&amp;#34;
//
// int n = 0;
// std::string s = absl::StrFormat(
// &amp;#34;%s%d%n&amp;#34;, &amp;#34;hello&amp;#34;, 123, absl::FormatCountCapture(&amp;amp;n));
// EXPECT_EQ(8, n);
//
// The `FormatSpec` intrinsically supports all of these fundamental C++ types:
//
// * Characters: `char`, `signed char`, `unsigned char`
// * Integers: `int`, `short`, `unsigned short`, `unsigned`, `long`,
// `unsigned long`, `long long`, `unsigned long long`
// * Floating-point: `float`, `double`, `long double`
//
// However, in the `str_format` library, a format conversion specifies a broader
// C++ conceptual category instead of an exact type. For example, `%s` binds to
// any string-like argument, so `std::string`, `absl::string_view`, and
// `const char*` are all accepted. Likewise, `%d` accepts any integer-like
// argument, etc.
&lt;/code>&lt;/pre>&lt;p>Abseil æ”¯æŒå¦‚ä¸‹å‡½æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>StrFormat&lt;/li>
&lt;li>StrAppendFormat&lt;/li>
&lt;li>StreamFormat&lt;/li>
&lt;li>PrintF&lt;/li>
&lt;li>FPrintF&lt;/li>
&lt;li>SNPrintF&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬åœ¨å®ç°æ—¥å¿—åº“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>StrFormat&lt;/code> æ ¼å¼åŒ–æ—¥å¿—çº§åˆ«ï¼Œæ—¶é—´ç­‰ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨ &lt;code>StrAppendFormat&lt;/code> æ ¼å¼åŒ–æ—¥å¿—å†…å®¹ï¼Œè¿™æ¯” fmtlib è¦æ–¹ä¾¿çš„å¤šã€‚Abseil StrFormat ä½¿ç”¨ç¼–è¯‘æœŸæ£€æŸ¥å–ä»£è¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿™æ˜¯è®©æˆ‘é€‰æ‹©çš„ä¸»è¦åŸå› ã€‚é…åˆ &lt;code>absl::string_view&lt;/code> åœ¨ GNK ä¸€ä¸ª C++14 é¡¹ç›®ä¸­ï¼ŒC++17 çš„ä½¿ç”¨ä½“éªŒéå¸¸å¥½ï¼Œå­—ç¬¦ä¸²å†…å­˜åˆ†é…ä¹Ÿå‡å°‘äº†å¾ˆå¤šã€‚&lt;br>
å¦‚æœåœ¨ Windows ç¯å¢ƒ &lt;code>wchar_t&lt;/code> ç¼–ç ç¯å¢ƒä½¿ç”¨ Abseil å¯èƒ½æ•ˆæœè¿˜ä¸å¦‚ fmtlibã€‚ç”±äºå®ç°äº†ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼Œä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœè¦å°† Abseil StrFormat å‰¥ç¦»å‡ºæ¥è¿˜æ¯”è¾ƒéº»çƒ¦ã€‚&lt;/p>
&lt;h2 id="å­—ç¬¦ä¸²å»æ ¼å¼åŒ–">å­—ç¬¦ä¸²å»æ ¼å¼åŒ–&lt;/h2>
&lt;p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥å–ä»£å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–é—®é¢˜åˆ™ä¼šå°‘å¾ˆå¤šã€‚åœ¨ Abseil ä¹‹ä¸­ï¼Œæœ‰ StrCat å’Œ Subsitute æ–¹æ¡ˆï¼Œå¯ä»¥è¿æ¥æˆ–è€…ç»„è£…å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;h3 id="substitute">Substitute&lt;/h3>
&lt;p>å®é™…ä¸Š &lt;a href="https://github.com/abseil/abseil-cpp/blob/master/absl/strings/substitute.h">Subsitute&lt;/a> ç±»ä¼¼ python æ ¼å¼åŒ–é£æ ¼ï¼Œä½†å‚æ•°åªæ”¯æŒ 0ï½9 ä¸ªï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>auto s=Substitute(&amp;#34;$1 purchased $0 $2. Thanks $1!&amp;#34;, 5, &amp;#34;Bob&amp;#34;, &amp;#34;Apples&amp;#34;);
&lt;/code>&lt;/pre>&lt;p>å®ç° Subsitute çš„å…³é”®æ˜¯éå†æ ¼å¼åŒ–å‚æ•°ï¼Œè§£æåˆ° &lt;code>$&lt;/code> åè·å¾—å‚æ•°ä½ç½®ï¼Œç„¶åå°†ç‰¹å®šçš„å‚æ•°è½¬å˜ä¸º &lt;code>Arg&lt;/code>ï¼ŒArg ç±»å‹é‡è½½æ”¯æŒä¸åŒçš„åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå­—ç¬¦ä¸²ç±»å‹ï¼Œå°†å…¶è½¬å˜ä¸º &lt;code>absl::string_view&lt;/code> æ•°ç»„ï¼Œç„¶åç”± &lt;code>SubstituteAndAppendArray&lt;/code> æ‹¼æ¥åœ¨ä¸€èµ·ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Overloads for std::string-y things
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Explicitly overload `const char*` so the compiler doesn&amp;#39;t cast to `bool`.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">NullSafeStringView&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>)) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span> &lt;span style="color:#58a1dd">Allocator&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>( &lt;span style="color:#828b96;font-style:italic">// NOLINT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">basic_string&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">char&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">char_traits&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>, &lt;span style="color:#58a1dd">Allocator&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Overloads for primitives
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// No overloads are available for signed and unsigned char because if people
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// are explicitly declaring their chars as signed or unsigned then they are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// probably using them as 8-bit integers and would probably prefer an integer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// representation. However, we can&amp;#39;t really know, so we make the caller decide
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// what to do.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>) { &lt;span style="color:#58a1dd">scratch_&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(*)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FastIntToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">float&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>, &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SixDigitsToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">double&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">scratch_&lt;/span>, &lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SixDigitsToBuffer&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#58a1dd">scratch_&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;false&amp;#34;&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#58a1dd">Hex&lt;/span> &lt;span style="color:#58a1dd">hex&lt;/span>); &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#58a1dd">Dec&lt;/span> &lt;span style="color:#58a1dd">dec&lt;/span>); &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// `void*` values, with the exception of `char*`, are printed as
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// &amp;#34;0x&amp;lt;hex value&amp;gt;&amp;#34;. However, in the case of `nullptr`, &amp;#34;NULL&amp;#34; is printed.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">void&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>); &lt;span style="color:#828b96;font-style:italic">// NOLINT(runtime/explicit)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">piece&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">piece_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">scratch_&lt;/span>[&lt;span style="color:#58a1dd">numbers_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kFastToBufferSize&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äº &lt;code>double&lt;/code> å’Œ &lt;code>float&lt;/code> åˆ™ä½¿ç”¨ &lt;code>SixDigitsToBuffer&lt;/code> å°†æµ®ç‚¹è½¬å˜ä¸º &lt;code>%g&lt;/code> çš„æ ¼å¼ã€‚å¦‚æœè¦å®ç°å›ºå®šé•¿åº¦è¾“å‡ºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code>absl::Hex&lt;/code> &lt;code>absl::Dec&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Substitute&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;$0$1$2$3$4 $5&amp;#34;&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#a6be9d">0&lt;/span>), &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kSpacePad2&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#a6be9d">0xf&lt;/span>, &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kSpacePad2&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#ff636f">int16_t&lt;/span>{&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>}, &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kSpacePad5&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#ff636f">int16_t&lt;/span>{&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>}, &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kZeroPad5&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Dec&lt;/span>(&lt;span style="color:#a6be9d">0x123456789abcdef&lt;/span>, &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">kZeroPad16&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äº bool ç±»å‹ï¼Œåˆ™ä¼šè¾“å‡º &lt;code>true&lt;/code> æˆ–è€… &lt;code>false&lt;/code>ã€‚&lt;br>
æœ¬è´¨ä¸Šæ¥è¯´ &lt;code>Substitute&lt;/code> æ˜¯ä¸€ç§ç®€åŒ–çš„æ ¼å¼åŒ–è¾“å‡ºæ–¹æ¡ˆï¼Œä½¿ç”¨ç¼–è¯‘å™¨é‡è½½è§£å†³äº†è¿è¡Œæ—¶æ£€æŸ¥ç±»å‹çš„éº»çƒ¦ï¼Œå› æ­¤ï¼Œè¿™ç§æ–¹æ¡ˆå®‰å…¨ç¨‹åº¦æ¯”è¾ƒé«˜ï¼Œæ•ˆç‡ä¹Ÿéå¸¸ä¸é”™ã€‚ä½† format æ”¯æŒçš„å‚æ•°ä¸ªæ•°æ¯”è¾ƒæœ‰é™ã€‚absl::Substitute åŒæ ·å®ç°äº†ç¼–è¯‘å™¨å‚æ•°ä¸ªæ•°æ£€æŸ¥ã€‚&lt;/p>
&lt;h3 id="strcat">StrCat&lt;/h3>
&lt;p>åœ¨ Abseil ä¹‹ä¸­è¿˜æœ‰ä¸€ä¸ª &lt;a href="https://github.com/abseil/abseil-cpp/blob/master/absl/strings/str_cat.h">absl::StrCat&lt;/a> ç”¨æ¥å–ä»£å­—ç¬¦ä¸²æ ¼å¼åŒ–ã€‚åœ¨ C è¯­è¨€æ ‡å‡†åº“ä¸­ï¼Œ&lt;code>strcat&lt;/code> ç”¨äºè¿æ¥å­—ç¬¦ä¸²ï¼Œå‚æ•°ä¸ªæ•°æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”åªæ”¯æŒ C-Style å­—ç¬¦ä¸²ï¼Œè€Œ Abseil å›¢é˜Ÿåˆ©ç”¨ C++ å˜å‚æ¨¡æ¿ç‰¹æ€§å®ç°äº†ç°ä»£çš„ StrCat.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StrCat&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">4&lt;/span>, &lt;span style="color:#a6be9d">5&lt;/span>, &lt;span style="color:#a6be9d">6&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">8&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;a&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;b&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;c&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;d&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;e&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;f&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;g&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;h&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;i&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;j&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;k&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;l&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;m&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;n&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;o&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;p&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;q&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// 123456789abcdefghijklmnopq
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ Subsititute ä¸€æ ·ï¼ŒStrCat ä¹Ÿæ˜¯ç”¨äº†ç±»ä¼¼ &lt;code>Arg&lt;/code> çš„ &lt;code>AlphaNum&lt;/code> å°†å­—ç¬¦ä¸²å’ŒåŸºæœ¬ç±»å‹æŒ‰ç…§åŸå› ï¼ˆæˆ–è€… Hex,Decï¼‰æ‹¼æ¥æˆç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨æ‹¼æ¥å­—ç¬¦ä¸²æ—¶èƒ½å¤Ÿæå‰ resize ä»è€Œå‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ï¼Œåœ¨ GNK çš„ä»£ç ä¸­ï¼Œå‡¡æ˜¯éœ€è¦è¿æ¥å­—ç¬¦ä¸²çš„æ“ä½œï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ StrCat æ¥æ“ä½œï¼Œé¿å…ä½¿ç”¨ snprintf æˆ–è€… strcat æ“ä½œã€‚
åœ¨ &lt;a href="https://github.com/M2Team/Privexec">Privexec&lt;/a>, &lt;a href="https://github.com/fstudio/clangbuilder">Clangbuilder&lt;/a> å’Œ &lt;a href="https://github.com/fcharlie/Planck">Planck&lt;/a> å½“ä¸­ï¼Œæˆ‘å€Ÿé‰´ absl::StrCat å®ç°äº†ä¸€ä¸ªå®½å­—ç¬¦ç‰ˆæœ¬çš„ &lt;a href="https://github.com/M2Team/Privexec/blob/master/include/strcat.hpp">&lt;code>base::StringCat&lt;/code>&lt;/a> ä¸æ”¯æŒ double/floatï¼Œä¸æ”¯æŒ Hexï¼ŒDec ï¼Œä»…æ”¯æŒå…¶ä»–åŸºæœ¬ç±»å‹å’Œ &lt;code>char*&lt;/code> &lt;code>std::wstring_view&lt;/code> &lt;code>std::wstring&lt;/code>ã€‚&lt;/p>
&lt;h2 id="å¼‚æ­¥ä¿¡å·å®‰å…¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–">å¼‚æ­¥ä¿¡å·å®‰å…¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–&lt;/h2>
&lt;p>ä¸Šè¿°ç°ä»£ C++ æ ¼å¼åŒ–æ–¹æ¡ˆé€šå¸¸æƒ…å†µä¸‹ä»¤äººæ»¡æ„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå¼‚æ­¥ä¿¡å·å®‰å…¨çš„æ ¼å¼åŒ–è¾“å‡ºæ–¹æ¡ˆæ—¶ï¼Œåˆ™ä¸å¾—ä¸é‡æ–°æ‰“ç®—ï¼Œå¼‚æ­¥ä¿¡å·å®‰å…¨æŒ‡çš„æ˜¯åœ¨ä¿¡å·ä¸­æ–­çš„å›è°ƒå‡½æ•°ä¸­ä¸å¾—è°ƒç”¨éå¼‚æ­¥å®‰å…¨çš„å‡½æ•°ï¼Œç”±äºä¿¡å·éšæ—¶å¯èƒ½å‘ç”Ÿï¼Œå› æ­¤ï¼Œåœ¨ä¿¡å·ä¸­æ–­å‡½æ•°ä¸­å¿…é¡»ä¸å­˜åœ¨å†…å­˜åˆ†é…ï¼Œä¸èƒ½æ‹¥æœ‰äº’æ–¥é”ç­‰ï¼Œåœ¨ Glibc å’Œ musl ä¹‹ä¸­ï¼Œç”±äº snprintf ä½¿ç”¨äº†æ–‡ä»¶å¯¹è±¡å’Œé”è°ƒç”¨äº† &lt;code>vfprintf&lt;/code> åˆ™ä¸æ˜¯å¼‚æ­¥ä¿¡å·å®‰å…¨çš„ï¼Œè¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œç”±äº &lt;code>FILE&lt;/code> ä½¿ç”¨äº†ç¼“å­˜ï¼Œéœ€è¦ä½¿ç”¨é”ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨ OpenBSD å½“ä¸­ï¼Œsnprintf å®ç°æ˜¯å¼‚æ­¥ä¿¡å·å®‰å…¨çš„ï¼Œåœ¨ Github ä¸Šæœ‰å¼‚æ­¥ä¿¡å·å®‰å…¨çš„ snprintf å®ç°ï¼Œå¦‚ &lt;a href="https://github.com/weiss/c99-snprintf">c99-snprintf&lt;/a> å’Œ &lt;a href="https://github.com/idning/safe_snprintf">safe_snprintf&lt;/a>ã€‚å‰é¢æ‰€è¯´çš„ &lt;code>ngx_snprintf&lt;/code> ä¹Ÿå¯ä»¥è½»æ¾çš„å®ç°å¼‚æ­¥ä¿¡å·å®‰å…¨ã€‚&lt;/p>
&lt;p>åœ¨ absl::StrFormat ä¸­ï¼ŒæŸ¥çœ‹æºç å‘ç° &lt;code>absl::SNPrintF&lt;/code> æ˜¯æ²¡æœ‰å†…å­˜åˆ†é…çš„ï¼Œä½†å¼‚æ­¥ä¿¡å·å®‰å…¨è¿˜æœ‰å¾…è€ƒå¯Ÿã€‚&lt;/p>
&lt;p>åœ¨ Chromium é¡¹ç›®ä¸­ï¼Œä¹Ÿæœ‰ä¸€ä¸ªåŸºäºç°ä»£ C++ å®ç°çš„å¼‚æ­¥ä¿¡å·å®‰å…¨çš„ &lt;a href="https://github.com/chromium/chromium/blob/master/base/strings/safe_sprintf.h">SafeSNPrintf&lt;/a>ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œä½¿ç”¨ union åŒ…è£…å˜é‡ï¼Œå¹¶å¢åŠ ç±»å‹ä¿¡æ¯ï¼Œè¿™ç§å¸¸è§äº Json, Toml ç­‰æ ¼å¼æ–‡ä»¶çš„è§£æã€‚åœ¨æ ¼å¼åŒ–æ—¶ï¼Œè§£æ format å­—ç¬¦ä¸²ï¼ŒæœŸæœ›çš„æ ¼å¼ä¸è¾“å…¥çš„å‚æ•°åŒ¹é…ç±»å‹ï¼Œä¸€æ—¦ç±»å‹åŒ¹é…ï¼Œåˆ™æ­£å¸¸æ ¼å¼åŒ–ï¼Œä¸åŒ¹é…åˆ™é€€å‡ºï¼Œè¿™ç§æ–¹æ¡ˆæ¯” snprintf è¦å¥½çš„å¤šï¼Œæ¯•ç«Ÿ snprintf åªé¢„æœŸè¾“å…¥æ ¼å¼æ­£ç¡®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">enum&lt;/span> &lt;span style="color:#58a1dd">Type&lt;/span> { &lt;span style="color:#58a1dd">INT&lt;/span>, &lt;span style="color:#58a1dd">UINT&lt;/span>, &lt;span style="color:#58a1dd">STRING&lt;/span>, &lt;span style="color:#58a1dd">POINTER&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Any integer-like value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">signed&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">INT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">UINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">c&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">signed&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">INT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">short&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">UINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">short&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">signed&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">INT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">UINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">signed&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">INT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">UINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">signed&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">INT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">UINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">integer&lt;/span>.&lt;span style="color:#58a1dd">width&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// A C-style text string.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>), &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">STRING&lt;/span>) { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>), &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">STRING&lt;/span>) { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Any pointer value that can be cast to a &amp;#34;void*&amp;#34;.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">template&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">Arg&lt;/span>(&lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">p&lt;/span>) &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">ptr&lt;/span>((&lt;span style="color:#ff636f">void&lt;/span>&lt;span style="color:#ff636f">*&lt;/span>)&lt;span style="color:#58a1dd">p&lt;/span>), &lt;span style="color:#58a1dd">type&lt;/span>(&lt;span style="color:#58a1dd">POINTER&lt;/span>) { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">union&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// An integer-like value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int64_t&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">width&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#58a1dd">integer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// A C-style text string.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// A pointer to an arbitrary object.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">void&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">ptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">enum&lt;/span> &lt;span style="color:#58a1dd">Type&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœè¦å®ç° &lt;code>std::string&lt;/code> &lt;code>std::string_view&lt;/code> çš„æ ¼å¼åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ union ä¸­ä½¿ç”¨å¦‚ä¸‹ç»“æ„å–ä»£ &lt;code>const char* str&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">data&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;span style="color:#58a1dd">stringview&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„å¥½å¤„æ˜¯ &lt;code>std::string/std::string_view&lt;/code> ä¸å†éœ€è¦è®¡ç®—é•¿åº¦ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ &lt;code>%v&lt;/code> æŒ‰ç…§è¾“å…¥å‚æ•°çš„ç±»å‹è‡ªä¸»æ ¼å¼åŒ–ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç±»å‹ä¸åŒ¹é…äº†ã€‚&lt;/p>
&lt;h2 id="bela-strformat">Bela StrFormat&lt;/h2>
&lt;p>&lt;strong>2019-05-17 Update:&lt;/strong> æœ€è¿‘æˆ‘ç¼–å†™äº†ä¸€ä¸ªåŸºäº C++17 çš„ Windows ç³»ç»Ÿä¸Šçš„å·¥å…·åº“ï¼Œå« &lt;a href="https://github.com/fcharlie/bela">Bela&lt;/a>ï¼ŒBela å­¦ä¹ äº† &lt;code>Chromium SafeNPrintf&lt;/code>ï¼Œå®ç°äº†ç±»å‹å®‰å…¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œä»»æ„é•¿åº¦æ•´å‹ &lt;code>%d&lt;/code>ï¼Œå­—ç¬¦ä¸²&lt;code>%s&lt;/code>, æµ®ç‚¹(float, double) &lt;code>%f&lt;/code>, åå…­è¿›åˆ¶ &lt;code>%x&lt;/code> &lt;code>%X&lt;/code>ï¼Œè¿˜æœ‰ &lt;code>%p&lt;/code> è¾“å‡ºæŒ‡é’ˆã€‚æ”¯æŒ Pading è¾“å‡ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/fcharlie/bela/blob/master/include/bela/fmt.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FormatArg&lt;/span> &lt;span style="color:#58a1dd">arg_array&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {&lt;span style="color:#58a1dd">args&lt;/span>...};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StrFormatInternal&lt;/span>(&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">arg_array&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">sizeof&lt;/span>...(&lt;span style="color:#58a1dd">args&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span> (&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>)[&lt;span style="color:#58a1dd">N&lt;/span>], &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Use Arg() object to record type information and then copy arguments to an
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// array to make it easier to iterate over them.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FormatArg&lt;/span> &lt;span style="color:#58a1dd">arg_array&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {&lt;span style="color:#58a1dd">args&lt;/span>...};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StrFormatInternal&lt;/span>(&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">arg_array&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">sizeof&lt;/span>...(&lt;span style="color:#58a1dd">args&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FormatArg&lt;/span> &lt;span style="color:#58a1dd">arg_array&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {&lt;span style="color:#58a1dd">args&lt;/span>...};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StrFormatInternal&lt;/span>(&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">arg_array&lt;/span>, &lt;span style="color:#ff636f">sizeof&lt;/span>...(&lt;span style="color:#58a1dd">args&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Fast-path when we don&amp;#39;t actually need to substitute any arguments.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">N&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span> (&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>)[&lt;span style="color:#58a1dd">N&lt;/span>], &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#58a1dd">N&lt;/span>, &lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¯æŒçš„å­—ç¬¦ä¸²ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::wstring&lt;/code>&lt;/li>
&lt;li>&lt;code>std::wstring_view&lt;/code>&lt;/li>
&lt;li>&lt;code>const wchar_t *&lt;/code>&lt;/li>
&lt;li>&lt;code>wchar_t *&lt;/code>&lt;/li>
&lt;li>&lt;code>std::u16string&lt;/code>&lt;/li>
&lt;li>&lt;code>std::u16string_view&lt;/code>&lt;/li>
&lt;li>&lt;code>const char16_t *&lt;/code>&lt;/li>
&lt;li>&lt;code>char16_t *&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä»¥åŠä»¥ä¸‹ä¼šè½¬æ¢ä¸º UTF-16 çš„ UTF-8 å­—ç¬¦ä¸²ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::string&lt;/code>&lt;/li>
&lt;li>&lt;code>std::string_view&lt;/code>&lt;/li>
&lt;li>&lt;code>const char *&lt;/code>&lt;/li>
&lt;li>&lt;code>char *&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åŸºäº &lt;code>Bela Format&lt;/code> æˆ‘è¿˜ç¼–å†™äº† &lt;code>bela::FPrintF&lt;/code> å°†æ ¼å¼åŒ–çš„æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°ç»ˆç«¯æˆ–è€…æ–‡ä»¶ï¼Œå½“è¾“å‡ºåˆ° Conhost æ—¶ï¼Œåˆ™ä¼šä»¥ UTF-16 ç¼–ç è¾“å‡ºï¼Œè‹¥è¾“å‡ºåˆ°æ–‡ä»¶æˆ–è€… Cygwin ç»ˆç«¯æ—¶ï¼Œåˆ™ä¼šè½¬ä¸º UTF-8 è¾“å‡ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//https://github.com/fcharlie/bela/blob/master/include/bela/stdwriter.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">StdWrite&lt;/span>(&lt;span style="color:#58a1dd">FILE&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">out&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">msg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span>... &lt;span style="color:#58a1dd">Args&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">FILE&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">out&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">Args&lt;/span>... &lt;span style="color:#58a1dd">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FormatArg&lt;/span> &lt;span style="color:#58a1dd">arg_array&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {&lt;span style="color:#58a1dd">args&lt;/span>...};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span> &lt;span style="color:#ff636f">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">format_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StrFormatInternal&lt;/span>(&lt;span style="color:#58a1dd">fmt&lt;/span>, &lt;span style="color:#58a1dd">arg_array&lt;/span>, &lt;span style="color:#ff636f">sizeof&lt;/span>...(&lt;span style="color:#58a1dd">args&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">StdWrite&lt;/span>(&lt;span style="color:#58a1dd">out&lt;/span>, &lt;span style="color:#58a1dd">str&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">ssize_t&lt;/span> &lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">FILE&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">out&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">fmt&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">StrFormat&lt;/span>(&lt;span style="color:#58a1dd">fmt&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">StdWrite&lt;/span>(&lt;span style="color:#58a1dd">out&lt;/span>, &lt;span style="color:#58a1dd">str&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆæ­¤ä»£ç èƒ½å¤Ÿåœ¨ Windows Terminal å’Œ Mintty ç­‰ç»ˆç«¯ä¸Šæ­£å¸¸æ˜¾ç¤º emojiï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/fcharlie/bela/blob/master/test/fmt/main.cc
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;bela/stdwriter.hpp&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">wmain&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>&lt;span style="color:#58a1dd">argv&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">ux&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">\xf0\x9f\x98\x81&lt;/span>&lt;span style="color:#a6be9d"> UTF-8 text &lt;/span>&lt;span style="color:#a6be9d">\xE3\x8D\xA4&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// force encode UTF-8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#58a1dd">wx&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Engine &lt;/span>&lt;span style="color:#a6be9d">\xD83D\xDEE0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FPrintF&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;Argc: %d Arg0: %s W: %s UTF-8: %s __cplusplus: %d&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>], &lt;span style="color:#58a1dd">wx&lt;/span>, &lt;span style="color:#58a1dd">ux&lt;/span>, &lt;span style="color:#58a1dd">__cplusplus&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç»“å°¾">ç»“å°¾&lt;/h2>
&lt;p>åœ¨æ ¼å¼åŒ–å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼ŒC++ çš„ä¸è¶³åœ¨äºæ²¡æœ‰åå°„ï¼Œä»è€Œæ— æ³•å¾ˆå¥½çš„è·å¾—å¯¹è±¡çš„ç±»å‹ï¼Œè¿™æ ·ä¼ ç»Ÿçš„æ ¼å¼åŒ–æ–¹æ¡ˆå°±å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œè€Œæ˜¯ç”¨å˜å‚æ¨¡æ¿ï¼Œåœ¨å¤æ‚çš„ç¼–ç æŠ€å·§åŠ æˆåï¼Œä½¿ç”¨ç¼–è¯‘å™¨çš„æ£€æŸ¥èƒ½å¤Ÿå¾ˆå¥½çš„å®ç°ç±»å‹å®‰å…¨é«˜æ•ˆçš„æ ¼å¼åŒ–ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ç¨‹åºç¼–è¯‘åæäº¤è¾ƒå¤§ï¼Œä½†éƒ½åˆ°äº† 9012ï¼Œåªè¦ä¸è¶…è¿‡ Clang çš„ä½“ç§¯éƒ½æ˜¯èƒ½æ¥å—çš„ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-04-29-string-formatting-talk/ - Copyright (c) 2009-2024 J23</description></item><item><title>å®ç° Git ç›®å½•æƒé™æ§åˆ¶</title><link>https://forcemz.net/posts/2019/2019-04-01-implement-git-dir-accesss-control/</link><pubDate>Mon, 01 Apr 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-04-01-implement-git-dir-accesss-control/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-04-01-implement-git-dir-accesss-control/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>Git ä¸ Subversion æœ‰è¯¸å¤šä¸åŒï¼Œæœ€æ ¸å¿ƒçš„ä¸€ç‚¹æ˜¯å‰è€…å±äºåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œåè€…å±äºé›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚å‰è€…çš„æäº¤è¡Œä¸ºæ˜¯ç¦»çº¿çš„ï¼Œæœ¬åœ°çš„ï¼Œåè€…çš„æäº¤æ˜¯åœ¨çº¿çš„ï¼Œéœ€è¦ä¸è¿œç¨‹ä¸­å¤®æœåŠ¡å™¨é€šä¿¡ï¼Œåœ¨çº¿åˆ›å»ºæäº¤ã€‚åŸºäºè¿™ç§ç°å®ï¼ŒGit å’Œ Subversion åœ¨åŸç”Ÿæä¾›çš„é™„åŠ åŠŸèƒ½ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„å·®åˆ«ã€‚æ¯”å¦‚ç›®å½•æƒé™æ§åˆ¶ã€‚Git åŸç”Ÿå¹¶ä¸æ”¯æŒç›®å½•æƒé™æ§åˆ¶ï¼Œè€Œ Subversion æ”¯æŒã€‚&lt;/p>
&lt;h2 id="subversion-çš„ç›®å½•æƒé™æ§åˆ¶">Subversion çš„ç›®å½•æƒé™æ§åˆ¶&lt;/h2>
&lt;p>ç”¨æˆ·æ¥å…¥è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ Subversion å­˜å‚¨åº“é€šå¸¸å¯ä»¥ä½¿ç”¨ HTTP åè®® SVN åè®®ä»¥åŠ SVN+SSH åè®®ï¼ŒHTTP åè®®æœ¬è´¨ä¸Šæ˜¯ HTTP å®¢æˆ·ç«¯ä¸ Apache httpd æœåŠ¡å™¨é€šä¿¡ï¼Œæ­¤æ—¶ï¼Œè¯·æ±‚ç”± &lt;code>mod_dav_svn.so&lt;/code> æ¨¡å—å¤„ç†ï¼Œç„¶åè°ƒç”¨ subversion çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå’Œå­˜å‚¨åº“æ¨¡å—ã€‚ä½¿ç”¨ HTTP è®¿é—® Subversion å­˜å‚¨åº“æ—¶ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>svn co https://llvm.org/svn/llvm-project/llvm/trunk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜å¯ä»¥ç›´æ¥æ£€å‡ºå­˜å‚¨åº“çš„å­ç›®å½•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>svn co https://llvm.org/svn/llvm-project/llvm/trunk/include/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ SVN åè®®ä¸ SVN+SSH åè®®æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ &lt;code>svnserve&lt;/code> é€šä¿¡ï¼Œå‰è€…æ˜¯ svnserve ç›‘å¬ 3690 TCP ç«¯å£ï¼Œåè€…æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œ &lt;code>svnserve -t&lt;/code>ï¼Œä½†å†…éƒ¨çš„ç»†èŠ‚éƒ½æ˜¯ä¸€è‡´çš„ã€‚æ£€å‡ºä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>svn co svn://llvm.org/svn/llvm-project/llvm/trunk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜å¯ä»¥ç›´æ¥æ£€å‡ºå­˜å‚¨åº“çš„å­ç›®å½•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>svn co svn://llvm.org/svn/llvm-project/llvm/trunk/include/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Subversion çš„æäº¤æ˜¯åœ¨çº¿çš„ï¼Œä»¥ SVN åè®®ä¸ºä¾‹ï¼Œå½“ç”¨æˆ·æäº¤ä»£ç æ—¶ï¼Œsvn å®¢æˆ·ç«¯å°†å‘é€ &lt;code>commit&lt;/code> å‘½ä»¤æ¶ˆæ¯ç»™ svnserveï¼Œç„¶ååœ¨è¿™ä¸ªå‘½ä»¤ä¸­å°†ä¿®æ”¹çš„æ–‡ä»¶å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿œç¨‹æœåŠ¡å™¨ä¸Šä½œå‡ºä¸€äº›åˆ—æ“ä½œï¼Œç„¶ååˆ›å»ºæäº¤ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªè¦å¯¹æ–‡ä»¶ç›¸å¯¹å­˜å‚¨åº“çš„è·¯å¾„ä¸ç›®å½•æƒé™è§„åˆ™ä½œå‡ºåŒ¹é…ï¼Œå°±å¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯å¦ç”±èƒ½åŠ›ä¿®æ”¹ç›¸åº”æ–‡ä»¶ã€‚&lt;/p>
&lt;p>Subversion çš„åŸç†ä¹Ÿå°±ä½¿å…¶å¾ˆå®¹æ˜“æ”¯æŒç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥ç²¾ç¡®åˆ°æ–‡ä»¶ã€‚svnserve å¯ä»¥ä¿®æ”¹ svnserve.conf å®ç°ï¼Œè€Œ HTTP åˆ™ä¸ apache mod_dav_svn æ¨¡å—æœ‰å…³ã€‚&lt;/p>
&lt;p>å¦‚æœè¦ç¦æ­¢ç”¨æˆ·è¯»å–ï¼Œåˆ™åœ¨ checkout çš„æ—¶å€™ç¦æ­¢æ£€å‡ºå³å¯ï¼Œå®ç°èµ·æ¥å¹¶ä¸å›°éš¾ã€‚&lt;/p>
&lt;h2 id="git-ä¸æ”¯æŒç›®å½•æƒé™æ§åˆ¶">Git ä¸æ”¯æŒç›®å½•æƒé™æ§åˆ¶&lt;/h2>
&lt;p>åƒ Git è¿™æ ·çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè·å¾—è¿œç¨‹å­˜å‚¨åº“çš„è¡Œä¸ºå«åš &lt;code>clone&lt;/code>ï¼Œå¸¸è§„æƒ…å†µä¸‹è·å¾—è¿œç¨‹å­˜å‚¨åº“çš„æ‰€æœ‰æ•°æ®ï¼Œä½†è¿™ç§æ–¹å¼æ¯•ç«Ÿéœ€è¦è·å¾—å¤§é‡æ•°æ®ï¼Œå› æ­¤ Git è¿˜æä¾›æµ…è¡¨å…‹éš†ï¼Œè¿˜æœ‰ VFSForGit è¿™æ ·çš„æ–¹å¼åªè·å¾—ç›®å½•ç»“æ„ï¼Œä¸è·å–æ–‡ä»¶å†…å®¹ï¼Œè¿˜æœ‰è§„åˆ’ä¸­çš„éƒ¨åˆ†å…‹éš†ã€‚&lt;/p>
&lt;p>åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¦æ§åˆ¶å­˜å‚¨åº“çš„æ•°æ®æŒ‰ç›®å½•ç²’åº¦æä¾›ç»™ç”¨æˆ·è¯»å–ï¼Œé€šå¸¸æ— æ³•é€šè¿‡ Git å®¢æˆ·ç«¯å®ç°ï¼Œè¿™æ˜¯ç”± Git ä¼ è¾“åè®®å†³å®šçš„ï¼ŒGit åœ¨å…‹éš†è¿œç¨‹å­˜å‚¨åº“æ—¶éœ€å…ˆ &amp;lsquo;å‘ç°å¼•ç”¨åˆ—è¡¨&amp;rsquo;ï¼Œç„¶åæŒ‰éœ€æ±‚è·å¾—å¼•ç”¨åˆ—è¡¨çš„æäº¤ IDï¼ŒæœåŠ¡å™¨å°†è¿™äº› Commit ä»¥åŠç›¸å…³çš„ Tree Blob ç­‰ç­‰å›æº¯æ‰“åŒ…å‘é€ç»™å®¢æˆ·ç«¯ã€‚Git æœåŠ¡å™¨æœ€å¤šèƒ½å®ç°çš„æ˜¯åœ¨åœ¨ &amp;lsquo;å¼•ç”¨å¹¿æ’­&amp;rsquo; æ—¶éšè—ç‰¹å®šçš„å¼•ç”¨å®ç°å¯¹ç”¨æˆ·çš„ç¦æ­¢è¯»å–ï¼Œä½†è¦åšåˆ°ç›®å½•çº§åˆ«çš„ç¦æ­¢è¯»å–ï¼Œç›®å‰ç”±äº Git åè®®é™åˆ¶æš‚æ—¶æ— æ³•å®ç°ã€‚&lt;/p>
&lt;p>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æäº¤è¡Œä¸ºå‘ç”Ÿåœ¨æœ¬åœ°ï¼Œå½“äººä»¬è¿è¡Œ &lt;code>git commit -m &amp;quot;message&amp;quot;&lt;/code> æ—¶ï¼Œå°±ä¼šåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæäº¤ã€‚æ— è®ºæ˜¯ Subversion è¿˜æ˜¯ Gitï¼Œæäº¤åœ¨å­˜å‚¨åº“ä¸­å…·æœ‰å”¯ä¸€æ€§ï¼Œæäº¤åˆ›å»ºåï¼Œç›®å½•ç»“æ„ï¼Œæ–‡ä»¶å†…å®¹ï¼Œæäº¤ä¿¡æ¯ä¹Ÿå°±å·²ç»ç¡®å®šäº†ï¼Œå¦‚æœå†æ¬¡ä¿®æ”¹å°±ä¸å†æ˜¯ç›¸åŒçš„æäº¤ã€‚åœ¨ Subversion ä¸­æäº¤å æ®å”¯ä¸€çš„ä¸€ä¸ªä¿®è®¢å·(Revision)ï¼Œåœ¨ Git ä¸­åˆ™æ˜¯å”¯ä¸€çš„ commitID (ç›®å‰ä¸º SHA1ï¼Œæœªæ¥è®¡åˆ’è½¬å˜ä¸º SHA-256)ã€‚åœ¨æœ¬åœ°æäº¤åï¼ŒGit å­˜å‚¨åº“ç›®å½•ç»“æ„å·²ç»ç¡®å®šï¼Œå› æ­¤æ¨é€åˆ°æœåŠ¡å™¨å¹¶ä¸èƒ½æ”¹å˜å…¶ç›®å½•ç»“æ„ï¼Œè¿™å°±æ„å‘³ç€ï¼Œåœ¨æœåŠ¡å™¨ä¸Š Git ä¸æ”¯æŒç›®å½•çº§åˆ«ç²’åº¦çš„å†™å…¥æ§åˆ¶ã€‚&lt;/p>
&lt;p>ç»¼åˆæ¥çœ‹ï¼Œåœ¨æœåŠ¡å™¨æ–¹ï¼ŒGit æ˜¯å®Œå…¨ä¸æ”¯æŒç›®å½•æƒé™æ§åˆ¶çš„ã€‚&lt;/p>
&lt;h2 id="git-å®ç°ç›®å½•æƒé™æ§åˆ¶çš„ä¸€ç§é€”å¾„">Git å®ç°ç›®å½•æƒé™æ§åˆ¶çš„ä¸€ç§é€”å¾„&lt;/h2>
&lt;p>&lt;strong>Git çš„ç›®å½•çº§åˆ«ç²’åº¦çš„ç¦æ­¢è¯»å–å¹¶ä¸åœ¨æœ¬æ–‡çš„ç ”ç©¶èŒƒå›´ï¼Œæœ¬æ–‡æ‰€è¿°çš„ç›®å½•æƒé™æ§åˆ¶ä»…æŒ‡ &amp;lsquo;ç›®å½•çš„åªè¯»&amp;rsquo;ã€‚&lt;/strong>&lt;/p>
&lt;p>åœ¨è®¾è®¡æ­¤åŠŸèƒ½å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Git çš„ä¸€äº›åŸç†ï¼Œæ¯”å¦‚ï¼Œç›®å½•æƒé™æ§åˆ¶å‘ç”Ÿåœ¨æœåŠ¡ç«¯ï¼Œå› æ­¤ï¼Œå¤„ç†çš„æ—¶æœºä¸º Git æ¨é€ä»£ç ä»£è¿œç¨‹å­˜å‚¨åº“æ—¶ï¼Œä¸€æ—¦å‘ç°æ¨é€ä¸­ä¿®æ”¹äº†åªè¯»æ–‡ä»¶ï¼ˆç›®å½•ï¼‰ï¼Œåˆ™æ‹’ç»æ¨é€ã€‚ç”¨æˆ·è¢«æ‹’ç»æ¨é€åéœ€è¦å›é€€ç‰¹å®šçš„æäº¤ï¼Œç„¶åé‡æ–°æäº¤ï¼Œæäº¤å®Œæˆåæ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå®ç°åä½œå…±äº«ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç›®å½•æƒé™æ§åˆ¶çš„ç›®çš„ã€‚&lt;/p>
&lt;p>å®ç°ç›®å½•æƒé™æ§åˆ¶æ ¸å¿ƒæ“ä½œå°±æ˜¯æ£€æµ‹ç›®å½•ç»“æ„çš„ä¿®æ”¹ï¼Œç„¶åæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™è¿›è¡Œæ‹¦æˆªï¼Œåœ¨ä¸ä¿®æ”¹ Git æºç çš„åŸºç¡€ä¸Šè¦å®ç°è¿™äº›åŠŸèƒ½é€šå¸¸å¯ä»¥ä½¿ç”¨æœåŠ¡ç«¯é’©å­ã€‚æœåŠ¡å™¨ä¸Šçš„ä¸»è¦çš„é’©å­æœ‰ä¸‰ç§ï¼Œ&lt;code>pre-receive&lt;/code>ï¼Œ&lt;code>update&lt;/code>,&lt;code>post-receive&lt;/code> ï¼Œç›¸å…³é’©å­çš„åŸç†åœ¨ &lt;a href="https://forcemz.net/git/2017/11/22/GitNativeHookDepthOptimization/">Git åŸç”Ÿé’©å­çš„æ·±åº¦ä¼˜åŒ–&lt;/a> ä¸€æ–‡ä¸­æœ‰ä»‹ç»ã€‚è¦å®ç°æœ¬èŠ‚æ‰€è¿°åŠŸèƒ½é¦–å…ˆå¾—æ’é™¤ &lt;code>post-receive&lt;/code> é’©å­ï¼Œæ­¤é’©å­çš„æˆåŠŸä¸å¦ä¸ä¼šå½±å“å¼•ç”¨çš„æ›´æ–°ï¼Œæ‰€ä»¥å¹¶ä¸åˆé€‚ï¼Œè€Œ &lt;code>pre-receive&lt;/code> é’©å­ç›®å‰ä½¿ç”¨äº† &lt;a href="https://git-scm.com/docs/git-receive-pack#_quarantine_environment">ç¯å¢ƒéš”ç¦»ï¼š Quarantine Environment&lt;/a> æœºåˆ¶ï¼Œç›®å‰ libgit2 å¹¶ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œæ‰€ä»¥è¦å®ç°ç›®å½•åªè¯»ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨ &lt;code>pre-receive&lt;/code> é’©å­ã€‚&lt;/p>
&lt;p>æœ€ç»ˆï¼Œåªæœ‰ &lt;code>update&lt;/code> é’©å­å¯ç”¨ã€‚&lt;/p>
&lt;p>åœ¨å®ç°ç›®å½•æƒé™æ£€æµ‹æ—¶ï¼Œæˆ‘ä»¬åº”å½“å…ˆåˆå§‹åŒ–è§„åˆ™ï¼Œåœ¨ &lt;a href="https://gitee.com/oscstudio/git-analyze">git-analyze&lt;/a> é¡¹ç›®ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ª &lt;code>update&lt;/code> é’©å­ä½œä¸ºç›®å½•æƒé™æ£€æµ‹çš„åŸå‹ï¼Œè§„åˆ™æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;master&amp;#34;&lt;/span>:{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;dirs&amp;#34;&lt;/span>:[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;lib/&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;build/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;regex&amp;#34;&lt;/span>:[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;build$&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§„åˆ™æŒ‰åˆ†æ”¯ååˆ’åˆ†ï¼Œå½“ç›¸å…³çš„åˆ†æ”¯å¹¶æ²¡æœ‰è®¾ç½®åªè¯»ç›®å½•æ—¶ï¼Œåˆ™æŸ¥æ‰¾ &lt;code>.all&lt;/code> é…ç½®ï¼Œå…¶ä¸­ &lt;code>.all&lt;/code> è¡¨ç¤ºæ‰€æœ‰åˆ†æ”¯ï¼Œ&lt;code>.all&lt;/code> ä¸èƒ½è¢«ç”¨äº git åˆ†æ”¯æˆ–è€…å¼•ç”¨åç§°&lt;sup>1&lt;/sup>ï¼Œå› æ­¤ä»£è¡¨æ‰€æœ‰çš„åˆ†æ”¯ã€‚è§„åˆ™æœ‰ç›®å½•çº§åˆ«åŒ¹é…å’Œæ­£åˆ™åŒ¹é…ï¼Œ&lt;code>lib&lt;/code> è¡¨ç¤º &lt;code>lib&lt;/code> æ–‡ä»¶æˆ–è€…ç›®å½•ä¸å¯è¢«ä¿®æ”¹ã€‚è€Œ &lt;code>regex&lt;/code> åˆ™è¡¨ç¤ºç›®å½•ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è·¯å¾„ä¸å¯è¢«ä¿®æ”¹ã€‚&lt;/p>
&lt;p>å¯¹äºæ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ &lt;a href="https://github.com/google/re2">RE2&lt;/a>ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼åº“ï¼Œç”± Google å¼€å‘ã€‚æ‹¥æœ‰å¤šç§è¯­è¨€ç»‘å®šã€‚&lt;/p>
&lt;p>æ— è®ºæ˜¯ç›®å½•åŒ¹é…è¿˜æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è®¾ç½®è§„åˆ™æ•°é‡çš„ä¸Šé™ï¼Œé¿å…è¿‡å¤šçš„è§„åˆ™å¯¼è‡´è®¡ç®—é‡è¿‡å¤§ã€‚ç›®å½•åŒ¹é…ç›®å‰çš„é™åˆ¶ä¸º 256ï¼Œæ­£åˆ™é™åˆ¶ä¸º 64ã€‚&lt;/p>
&lt;p>åœ¨ç¡®å®šå¥½è§„åˆ™åï¼Œæˆ‘ä»¬éœ€è¦è·å¾—ç›®å½•æ ‘çš„ä¿®æ”¹ç»†èŠ‚ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„ä¿®æ”¹ï¼Œæ–‡ä»¶çš„åˆ é™¤ï¼Œæ–‡ä»¶çš„æ·»åŠ ï¼Œä»¥åŠæ–‡ä»¶çš„é‡å‘½åï¼Œå…¶ä¸­æ–‡ä»¶çš„ UNIX å±æ€§ä¿®æ”¹åº”å½“å±äºæ–‡ä»¶çš„ä¿®æ”¹ã€‚update é’©å­çš„å‘½ä»¤è¡Œä¸º &lt;code>refname oldrev newrev&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>git diff oldrev newrev&lt;/code> è¿™æ ·çš„æ€è·¯è·å¾—æ–‡ä»¶ä¿®æ”¹ç»†èŠ‚ã€‚åœ¨ libgit2 ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>git_diff_tree_to_tree&lt;/code> å»è·å¾—ç›®å½•çš„å·®å¼‚ã€‚å¦‚æœ oldrev æˆ–è€… newrev äºŒè€…ä¸­æœ‰ä¸€ä¸ªæ˜¯ &lt;code>zeroid&lt;/code>ï¼Œæ­¤æ—¶åªéœ€è¦ä½¿ç”¨ treewalk éå†ç›®å½•å³å¯ï¼Œå½“ç„¶ï¼ŒäºŒè€…ä¸å¯èƒ½åŒæ—¶ä¸ºé›¶ IDã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">////////
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;#34;executor.hpp&amp;#34;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;git2.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">commit_t&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">commit_t&lt;/span>() &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">~&lt;/span>&lt;span style="color:#58a1dd">commit_t&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">tree&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_tree_free&lt;/span>(&lt;span style="color:#58a1dd">tree&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">commit&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_commit_free&lt;/span>(&lt;span style="color:#58a1dd">commit&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_commit&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">commit&lt;/span>{&lt;span style="color:#ff636f">nullptr&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_tree&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">tree&lt;/span>{&lt;span style="color:#ff636f">nullptr&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">lookup&lt;/span>(&lt;span style="color:#58a1dd">git_repository&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">git_oid&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">id&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">git_commit_lookup&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">commit&lt;/span>, &lt;span style="color:#58a1dd">repo&lt;/span>, &lt;span style="color:#58a1dd">id&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">git_commit_tree&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">tree&lt;/span>, &lt;span style="color:#58a1dd">commit&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">executor_base&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">executor_base&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">git_libgit2_init&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">~&lt;/span>&lt;span style="color:#58a1dd">executor_base&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">repo_&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_repository_free&lt;/span>(&lt;span style="color:#58a1dd">repo_&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_libgit2_shutdown&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">open&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">path&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">git_repository_open&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">repo_&lt;/span>, &lt;span style="color:#58a1dd">path&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>()) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_repository&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>() { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">repo_&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_repository&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">repo_&lt;/span>{&lt;span style="color:#ff636f">nullptr&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Executor&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Executor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// initialzie todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">base&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">new&lt;/span> &lt;span style="color:#58a1dd">executor_base&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Executor&lt;/span>&lt;span style="color:#ff636f">::~&lt;/span>&lt;span style="color:#58a1dd">Executor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// delete
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span> &lt;span style="color:#58a1dd">base&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Executor&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">InitializeRules&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">sv&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">ref&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ref&lt;/span>.&lt;span style="color:#58a1dd">compare&lt;/span>(&lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;refs/heads/&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;refs/heads/&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">branch&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">ref&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;refs/heads/&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">engine&lt;/span>.&lt;span style="color:#58a1dd">PreInitialize&lt;/span>(&lt;span style="color:#58a1dd">sv&lt;/span>, &lt;span style="color:#58a1dd">branch&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">////////////////////////////////////////////////
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">git_treewalk_impl&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">root&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">git_tree_entry&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">entry&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">payload&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">e&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">reinterpret_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">Executor&lt;/span> &lt;span style="color:#ff636f">*&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">payload&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#58a1dd">name&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">root&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">name&lt;/span>.&lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">git_tree_entry_name&lt;/span>(&lt;span style="color:#58a1dd">entry&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">FullMatch&lt;/span>(&lt;span style="color:#58a1dd">name&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;Path %s is readonly&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">name&lt;/span>.&lt;span style="color:#58a1dd">c_str&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Executor&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">ExecuteTreeWalk&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">rev&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_oid&lt;/span> &lt;span style="color:#58a1dd">oid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">git_oid_fromstrn&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">oid&lt;/span>, &lt;span style="color:#58a1dd">rev&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">rev&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">commit_t&lt;/span> &lt;span style="color:#58a1dd">commit&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">commit&lt;/span>.&lt;span style="color:#58a1dd">lookup&lt;/span>(&lt;span style="color:#58a1dd">base&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>(), &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">oid&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">git_tree_walk&lt;/span>(&lt;span style="color:#58a1dd">commit&lt;/span>.&lt;span style="color:#58a1dd">tree&lt;/span>, &lt;span style="color:#58a1dd">GIT_TREEWALK_PRE&lt;/span>, &lt;span style="color:#58a1dd">git_treewalk_impl&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">this&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">git_diff_callback&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">git_diff_delta&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">delta&lt;/span>, &lt;span style="color:#ff636f">float&lt;/span> &lt;span style="color:#58a1dd">progress&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">payload&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#ff636f">void&lt;/span>)&lt;span style="color:#58a1dd">progress&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">e&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">reinterpret_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">Executor&lt;/span> &lt;span style="color:#ff636f">*&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">payload&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">switch&lt;/span> (&lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">status&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">GIT_DELTA_ADDED&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/*fallthrough*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">GIT_DELTA_MODIFIED&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/*fallthrough*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">GIT_DELTA_COPIED&lt;/span>: &lt;span style="color:#828b96;font-style:italic">// copy to new path
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">FullMatch&lt;/span>(&lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">new_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;Path &amp;#39;%s&amp;#39; is readonly&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">GIT_DELTA_DELETED&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">FullMatch&lt;/span>(&lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;Path &amp;#39;%s&amp;#39; is readonly&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">default&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// ex. GIT_DELTA_RENAMED
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">FullMatch&lt;/span>(&lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">new_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;Path &amp;#39;%s&amp;#39; is readonly&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">FullMatch&lt;/span>(&lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;Path &amp;#39;%s&amp;#39; is readonly&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">delta&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">old_file&lt;/span>.&lt;span style="color:#58a1dd">path&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">diff_t&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">~&lt;/span>&lt;span style="color:#58a1dd">diff_t&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">p&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_diff_free&lt;/span>(&lt;span style="color:#58a1dd">p&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_diff&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">p&lt;/span>{&lt;span style="color:#ff636f">nullptr&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Executor&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">Execute&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">path&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">oldrev&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">newrev&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">engine&lt;/span>.&lt;span style="color:#58a1dd">Empty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Engine rules empty so return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">base&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">open&lt;/span>(&lt;span style="color:#58a1dd">path&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">zerooid&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;0000000000000000000000000000000000000000&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">oldrev&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">zerooid&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ExecuteTreeWalk&lt;/span>(&lt;span style="color:#58a1dd">newrev&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">newrev&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">zerooid&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ExecuteTreeWalk&lt;/span>(&lt;span style="color:#58a1dd">oldrev&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_oid&lt;/span> &lt;span style="color:#58a1dd">ooid&lt;/span>, &lt;span style="color:#58a1dd">noid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">git_oid_fromstrn&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ooid&lt;/span>, &lt;span style="color:#58a1dd">oldrev&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">oldrev&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">git_oid_fromstrn&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">noid&lt;/span>, &lt;span style="color:#58a1dd">newrev&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">newrev&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">commit_t&lt;/span> &lt;span style="color:#58a1dd">oldcommit&lt;/span>, &lt;span style="color:#58a1dd">newcommit&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">oldcommit&lt;/span>.&lt;span style="color:#58a1dd">lookup&lt;/span>(&lt;span style="color:#58a1dd">base&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>(), &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ooid&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">newcommit&lt;/span>.&lt;span style="color:#58a1dd">lookup&lt;/span>(&lt;span style="color:#58a1dd">base&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>(), &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">noid&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">diff_t&lt;/span> &lt;span style="color:#58a1dd">diff&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_diff_options&lt;/span> &lt;span style="color:#58a1dd">opts&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">git_diff_init_options&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">opts&lt;/span>, &lt;span style="color:#58a1dd">GIT_DIFF_OPTIONS_VERSION&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">git_diff_tree_to_tree&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">diff&lt;/span>.&lt;span style="color:#58a1dd">p&lt;/span>, &lt;span style="color:#58a1dd">base&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">repo&lt;/span>(), &lt;span style="color:#58a1dd">oldcommit&lt;/span>.&lt;span style="color:#58a1dd">tree&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">newcommit&lt;/span>.&lt;span style="color:#58a1dd">tree&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">opts&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">git_diff_foreach&lt;/span>(&lt;span style="color:#58a1dd">diff&lt;/span>.&lt;span style="color:#58a1dd">p&lt;/span>, &lt;span style="color:#58a1dd">git_diff_callback&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">this&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>update å·¥å…·æºç åœ°å€ä¸ºï¼š&lt;a href="https://gitee.com/oscstudio/git-analyze/tree/master/tools/update">https://gitee.com/oscstudio/git-analyze/tree/master/tools/update&lt;/a>ã€‚&lt;/p>
&lt;p>åœ¨æœ¬æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬ç›´æ¥æ¯”è¾ƒ oldrev-newrev çš„å·®å¼‚ï¼Œè€Œä¸æ˜¯å›æº¯é€’å½’å»åˆ¤æ–­ commit ä¸ parent-commit çš„å·®å¼‚ï¼Œè¿™æœ‰ä»¥ä¸‹è€ƒè™‘ï¼š&lt;/p>
&lt;ul>
&lt;li>æˆ‘ä»¬éœ€è¦é™åˆ¶çš„æ˜¯æœ€ç»ˆçš„ç»“æœè€Œæ— éœ€è€ƒè™‘ä¸­é—´çš„è¿‡ç¨‹ï¼Œæ— è®ºä¸­é—´ç¯èŠ‚å¦‚ä½•å˜åŒ–ï¼Œåªè¦æœ€ç»ˆçš„åªè¯»ç›®å½•ï¼Œæ–‡ä»¶æœªå‘ç”Ÿä¿®æ”¹å³å¯ã€‚æœªå‘ç”Ÿä¿®æ”¹è¡¨ç¤º blob ä¸å˜ï¼Œtree ä¸å˜ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬åª diff oldrev-newrev ä¸¤è€…ï¼Œé¿å…æ ¡éªŒä¸­é—´ç¯å¢ƒèƒ½å¤Ÿé™ä½åªè¯»æ–‡ä»¶åŠŸèƒ½é€ æˆä»£ç æ¨é€çš„å“åº”é€Ÿç‡ä¸‹é™ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™å®é™…ä¸Šä¸ä½¿ç”¨ &lt;code>update&lt;/code> é’©å­å®ç°å¤§æ–‡ä»¶æ£€æµ‹çš„ç­–ç•¥æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå¤§æ–‡ä»¶æ£€æµ‹å¦‚æœä¸å›æº¯å»æ£€æµ‹ï¼Œåˆ™å¯èƒ½ä¼šå¿½ç•¥ä¸­é—´ commit å¼•å…¥çš„å¤§æ–‡ä»¶ï¼Œè¿™äº›å¤§æ–‡ä»¶ä¼šä¸€ç›´å­˜åœ¨äºå­˜å‚¨åº“ä¸­ï¼Œå¯¼è‡´å­˜å‚¨åº“ä½“ç§¯è¾ƒå¤§ï¼Œæ‰“åŒ…å›°éš¾ï¼Œä¼ è¾“æ—¶é—´é•¿ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä½¿ç”¨ pre-receive é’©å­åŸºäºç¯å¢ƒéš”ç¦»ï¼Œä½¿ç”¨ Pack-Index æ–‡ä»¶æ£€æµ‹å¤§æ–‡ä»¶å–ä»£ update é’©å­çš„åŸå› ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>åœ¨ git diff çš„æ–‡ä»¶ä¿®æ”¹ä¸­ï¼Œæ–‡ä»¶è·¯å¾„ä¸ºç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœæ˜¯åœ¨ worktree ä¸­ï¼Œdiff çš„è¾“å‡ºç»“æœä¸å½“å‰ç›®å½•æœ‰å…³ï¼Œè€Œåœ¨è£¸å­˜å‚¨åº“ä¸­ï¼Œdiff çš„æ–‡ä»¶è·¯å¾„ä¸æ˜¯ç›¸å¯¹äº å­˜å‚¨åº“ worktree æ ¹ç›®å½•çš„è·¯å¾„ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ç”Ÿæˆè·¯å¾„æ ¡éªŒè§„åˆ™æ—¶ï¼Œåˆ™éœ€å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œå¤„ç†ä»¥ç¬¦åˆç›¸å¯¹è·¯å¾„ã€‚å¹¶ä¸” git diff çš„æ–‡ä»¶è·¯å¾„ä»¥ &lt;code>/&lt;/code> åˆ†å‰²ï¼Œè¦åˆ¤æ–­ä¸€ä¸ªè·¯å¾„æ˜¯å¦ä¸ºåªè¯»æ–‡ä»¶æˆ–è€…å±äºåªè¯»ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œåªéœ€è¦åˆ¤æ–­æ–‡ä»¶è·¯å¾„è¢«åŒ…å«åœ¨åªè¯»è·¯å¾„ä¹‹ä¸­å³å¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå°†è·¯å¾„è§„èŒƒåŒ–ï¼Œä¹Ÿå°±æ˜¯å»é™¤å¤šä½™çš„ &lt;code>/&lt;/code>ï¼Œç„¶åæ¯”è¾ƒæ–‡ä»¶è·¯å¾„ä»¥åªè¯»è·¯å¾„å¼€å¤´å¹¶ä¸”å­˜åœ¨å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>æ–‡ä»¶è·¯å¾„é•¿åº¦ä¸åªè¯»è·¯å¾„é•¿åº¦ç›¸ç¬¦ï¼Œæ–‡ä»¶è·¯å¾„ä¸ºåªè¯»æ–‡ä»¶è·¯å¾„ã€‚&lt;/li>
&lt;li>åªè¯»è·¯å¾„é•¿åº¦ä¸º lï¼Œæ–‡ä»¶è·¯å¾„ä¸ºç¬¦å· Pï¼Œå…¶ä¸­ &lt;code>P[l]='/'&lt;/code>ï¼Œæ­¤æ—¶è·¯å¾„ä¸ºåªè¯»è·¯å¾„çš„å­è·¯å¾„ã€‚&lt;/li>
&lt;/ul>
&lt;p>è·¯å¾„åŒ…å«åˆ¤æ–­ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// when sub startswith parant
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// 1. size equal --&amp;gt; path equal
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// 2. path[p.size()]==&amp;#39;/&amp;#39; At this point, &amp;#39;path&amp;#39; is a subpath of p
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">IsPathContains&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">parent&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">sub&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">parent&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#58a1dd">sub&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">memcmp&lt;/span>(&lt;span style="color:#58a1dd">parent&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">sub&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">parent&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">sub&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">parent&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">sub&lt;/span>[&lt;span style="color:#58a1dd">parent&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;/&amp;#39;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½¿ç”¨ &lt;code>update&lt;/code> é’©å­å®ç° commit ç§æœ‰é‚®ç®±è¿‡æ»¤ï¼Œä¸ºäº†é¿å…ç§æœ‰é‚®ç®±é€ƒé€¸ï¼Œåˆ™éœ€è¦å›æº¯ã€‚&lt;/p>
&lt;h2 id="åæ€">åæ€&lt;/h2>
&lt;p>è™½ç„¶æœ¬æ–‡è®²è¿°äº†å®ç° Git ç›®å½•æƒé™æ§åˆ¶çš„å®ç°çš„ä¸€ç§é€”å¾„ï¼Œä½†ç¬”è€…æ¯”è¾ƒåå¯¹è¿‡åˆ†ä½¿ç”¨ Git æœåŠ¡ç«¯é’©å­å®ç°è¿‡å¤šé¢å¤–çš„åŠŸèƒ½ã€‚ä¸€æ–¹é¢ï¼Œè¿™äº›åŠŸèƒ½å¹¶éä¸å¯æ›¿ä»£ï¼Œå¤§å¤šæ•°éƒ½èƒ½å¯ä»¥é€šè¿‡è§„èŒƒçš„åä½œæ–¹å¼å®ç°ç›¸åŒçš„ç›®çš„ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fork-RP æ¨¡å‹å‚ä¸åä½œå¼€å‘ï¼Œç„¶ååœ¨ä¸»å­˜å‚¨åº“ä¸­è®¾ç½®ä¿æŠ¤åˆ†æ”¯ï¼Œä¸¥æ ¼é™åˆ¶ä¿®æ”¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°åªè¯»å­˜å‚¨åº“ï¼Œå³ä¿®æ”¹åªèƒ½é€šè¿‡ PR ä¿®æ”¹å­˜å‚¨åº“ï¼Œæ‹’ç»ä»å®¢æˆ·ç«¯æ¨é€ç­‰ã€‚&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœåœ¨é’©å­ä¸­å®ç°çš„åŠŸèƒ½è¿‡å¤šï¼Œè¿™åŠ¿å¿…ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šå­˜å‚¨åº“å“åº”æ—¶é—´å˜é•¿ï¼ŒæœåŠ¡å™¨å¹¶å‘é™ä½ï¼Œè¿™æ—¶å€™åŠ æœºå™¨ä¹Ÿæ•ˆæœæœ‰é™ï¼Œç‰¹åˆ«æ˜¯ç¡¬ä»¶è®¾æ–½ä¸è¶³çš„å½±å“æ›´å¤§ã€‚åŠŸèƒ½è¿‡å¤šä¹Ÿä¼šå¯¼è‡´å¼€å‘å˜å¾—å¼‚å¸¸å¤æ‚ï¼Œé’©å­é™¤äº†åšè¿™ä¸ªè¿˜è¦åšé‚£ä¸ªï¼Œæ•´ä¸ªæµç¨‹å¤„ç†æµç¨‹ä¸€ç¯æ‰£ä¸€ç¯ï¼Œè¿™å¯¹å¼€å‘è€…è¦æ±‚æ¯”è¾ƒé«˜ã€‚å¦‚æœå‡ºäºæ•ˆç‡åŸå› ä¿®æ”¹ git æºç å®ç°è¿™äº›åŠŸèƒ½åˆ™å¯èƒ½å¸¦æ¥è‡ªè¡Œç»´æŠ¤ git åˆ†æ”¯çš„å›°å¢ƒï¼Œç‰¹åˆ«æ˜¯ git ä¹Ÿæ˜¯åœ¨ä¸æ–­å‘å±•çš„ï¼Œæ¯”å¦‚ git è®¡åˆ’å®æ–½çš„éƒ¨åˆ†å…‹éš†ï¼ŒSHA1 åˆ° SHA-256 çš„è½¬æ¢ï¼Œv2 åè®®çš„è¿›ä¸€æ­¥å‘å±•ï¼Œä»¥åŠ VFSforGit ç§»æ¤åˆ° Linuxã€‚å¦‚æœæ²¡æœ‰å……è¶³çš„äººåŠ›å»ç»´æŠ¤è¿™äº›ä¿®æ”¹ï¼Œå¾ˆå®¹æ˜“å°±è·Ÿä¸ä¸Š git çš„æ­¥ä¼ï¼Œåˆ™å¾ˆå®¹æ˜“åœ¨ä»£ç æ‰˜ç®¡å¹³å°çš„ç«äº‰ä¸­è½åã€‚&lt;/p>
&lt;h2 id="å¤‡æ³¨">å¤‡æ³¨&lt;/h2>
&lt;ol>
&lt;li>Git å¼•ç”¨åæ ¼å¼æ£€æŸ¥ï¼š&lt;a href="https://git-scm.com/docs/git-check-ref-format">https://git-scm.com/docs/git-check-ref-format&lt;/a>&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2019/2019-04-01-implement-git-dir-accesss-control/ - Copyright (c) 2009-2024 J23</description></item><item><title>è®°å½• SSH çš„ä¸€ä¸ª Bug</title><link>https://forcemz.net/posts/2019/2019-03-18-ssh-one-bug/</link><pubDate>Mon, 18 Mar 2019 18:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-03-18-ssh-one-bug/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-03-18-ssh-one-bug/ -&lt;h2 id="æœåŠ¡å™¨ä¸Šé”™è¯¯çš„å‘½ä»¤è¡Œ">æœåŠ¡å™¨ä¸Šé”™è¯¯çš„å‘½ä»¤è¡Œ&lt;/h2>
&lt;p>æœ€è¿‘åœ¨æ”¹è¿› BSSHDï¼Œå°†ä¸è¢«å…è®¸çš„å‘½ä»¤æ‰“å°åˆ°æ—¥å¿—ï¼Œä½†æ˜¯æˆ‘é‡åˆ°äº†ä¸€ä¸ªä¸ç¬¦åˆé¢„æœŸçš„è¾“å‡ºï¼Œæ¯”å¦‚ï¼Œåœ¨å®¢æˆ·ç«¯è¿è¡Œ SSHï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ssh git@localhost &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;There are spaces in the statement&amp;#34;&lt;/span> &lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘å°†å‘½ä»¤è¡Œä½¿ç”¨å¦‚ä¸‹å¤„ç†åè¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;%s\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">Join&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Command&lt;/span>(), &lt;span style="color:#a6be9d">&amp;#34;;&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå‘½ä»¤è¡Œçš„è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>echo;There;are;spaces;in;the;statement;&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿°è¾“å‡ºä¸é¢„æœŸå®Œå…¨ä¸ä¸€è‡´ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå‘½ä»¤è¡Œçš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>echo;There are spaces in the statement;&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥ç¼–è¯‘ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºéªŒè¯ä¸€ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// echo.go
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// go build echo.go
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">package&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;%s\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">Join&lt;/span>(&lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Args&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;;&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åè¿è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>./echo &lt;span style="color:#a6be9d">&amp;#34;There are spaces in the statement&amp;#34;&lt;/span> &lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./echo;There are spaces in the statement;&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™å°±è¯´æ˜ï¼ŒSSH çš„è§£æå‡ºäº†é—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ &lt;a href="https://github.com/gliderlabs/ssh">github.com/gliderlabs/ssh&lt;/a>ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯å¦æ˜¯ä¸ &lt;code>gliderlabs/ssh&lt;/code> è§£ææœ‰å…³ï¼Œæˆ‘ä»¬ä¸èƒ½è¿‡æ—©çš„ä¸‹ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ &lt;code>gliderlabs/ssh&lt;/code> çš„æºç éªŒè¯ä¸€ç•ªã€‚&lt;/p>
&lt;p>&lt;code>gliderlabs/ssh&lt;/code> çš„å‘½ä»¤è¡Œè§£æä»£ç åœ¨ï¼š&lt;a href="https://github.com/gliderlabs/ssh/blob/ef6d89046be36104109e42ac1fee6601f9be95d7/session.go#L217">https://github.com/gliderlabs/ssh/blob/ef6d89046be36104109e42ac1fee6601f9be95d7/session.go#L217&lt;/a>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">payload&lt;/span> = &lt;span style="color:#ff636f">struct&lt;/span>{ &lt;span style="color:#58a1dd">Value&lt;/span> &lt;span style="color:#ff636f">string&lt;/span> }{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">gossh&lt;/span>.&lt;span style="color:#58a1dd">Unmarshal&lt;/span>(&lt;span style="color:#58a1dd">req&lt;/span>.&lt;span style="color:#58a1dd">Payload&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">payload&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sess&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span>, &lt;span style="color:#58a1dd">_&lt;/span> = &lt;span style="color:#58a1dd">shlex&lt;/span>.&lt;span style="color:#58a1dd">Split&lt;/span>(&lt;span style="color:#58a1dd">payload&lt;/span>.&lt;span style="color:#58a1dd">Value&lt;/span>, &lt;span style="color:#ff636f">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// If there&amp;#39;s a session policy callback, we need to confirm before
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// accepting the session.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">sess&lt;/span>.&lt;span style="color:#58a1dd">sessReqCb&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> !&lt;span style="color:#58a1dd">sess&lt;/span>.&lt;span style="color:#58a1dd">sessReqCb&lt;/span>(&lt;span style="color:#58a1dd">sess&lt;/span>, &lt;span style="color:#58a1dd">req&lt;/span>.&lt;span style="color:#58a1dd">Type&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sess&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span> = &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">req&lt;/span>.&lt;span style="color:#58a1dd">Reply&lt;/span>(&lt;span style="color:#ff636f">false&lt;/span>, &lt;span style="color:#ff636f">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥åœ¨ &lt;code>shlex.Split&lt;/code> å‰é¢æ’å…¥ä¸€æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;command: [%s]\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">payload&lt;/span>.&lt;span style="color:#58a1dd">Value&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åæˆ–å¾— BSSHD å‘½ä»¤è¡Œè¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>command: [echo There are spaces in the statement done]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo;There;are;spaces;in;the;statement;done
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œ command çš„å†…å®¹ç›´æ¥ä» SSH Exe è¯·æ±‚çš„åŠ å¯†æ•°æ®è§£æå‡ºæ¥çš„ï¼Œè¿™å°±æ„å‘³ç€ SSH ä¼ å…¥äº†é”™è¯¯çš„å‘½ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬ç¿»é˜… OpenSSH æºç ã€‚&lt;/p>
&lt;h2 id="æ™®éçš„ç³Ÿç³•">æ™®éçš„ç³Ÿç³•&lt;/h2>
&lt;p>åœ¨ OpenSSH çš„æºç é•œåƒä¸­ï¼š&lt;a href="https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/ssh.c#L1061">https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/ssh.c#L1061&lt;/a> æœ‰ä¸€æ®µä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* A command has been specified. Store it into the buffer. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">ac&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ((&lt;span style="color:#58a1dd">r&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sshbuf_putf&lt;/span>(&lt;span style="color:#58a1dd">command&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;%s%s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#a6be9d">&amp;#34; &amp;#34;&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">av&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>])) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fatal&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;%s: buffer error: %s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">__func__&lt;/span>, &lt;span style="color:#58a1dd">ssh_err&lt;/span>(&lt;span style="color:#58a1dd">r&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç å°†å­—ç¬¦ä¸²æ•°ç»„å˜æˆäº†å­—ç¬¦ä¸²ï¼Œä½†å¿˜è®°äº†å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰å¯èƒ½å«æœ‰ç©ºæ ¼å­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨å‘½ä»¤è¡Œè§£æä¹‹æ—¶å°±ä¼šå‡ºç°ä¸é¢„æœŸä¸ä¸€è‡´çš„ç»“æœã€‚è¿™ä¸ªé—®é¢˜åœ¨ Dropbear SSH ä¸­ä¹Ÿå‡ºç°äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//https://github.com/mkj/dropbear/blob/cb945f9f670e95305c7c5cc5ff344d1f2707b602/cli-runopts.c#L390
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>)&lt;span style="color:#58a1dd">argc&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Build the command to send */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmdlen&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>)&lt;span style="color:#58a1dd">argc&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmdlen&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">strlen&lt;/span>(&lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]) &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>; &lt;span style="color:#828b96;font-style:italic">/* +1 for spaces */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Allocate the space */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cli_opts&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span>)&lt;span style="color:#58a1dd">m_malloc&lt;/span>(&lt;span style="color:#58a1dd">cmdlen&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cli_opts&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Append all the bits */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>)&lt;span style="color:#58a1dd">argc&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">strlcat&lt;/span>(&lt;span style="color:#58a1dd">cli_opts&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>], &lt;span style="color:#58a1dd">cmdlen&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">strlcat&lt;/span>(&lt;span style="color:#58a1dd">cli_opts&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34; &amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">cmdlen&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* It&amp;#39;ll be null-terminated here */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">TRACE&lt;/span>((&lt;span style="color:#a6be9d">&amp;#34;cmd is: %s&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">cli_opts&lt;/span>.&lt;span style="color:#58a1dd">cmd&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œåƒ libssh libssh2 ä»¥åŠ go &lt;code>crypto/ssh&lt;/code> çš„æƒ¯ç”¨æ–¹æ³•ä¹Ÿæœªè€ƒè™‘åˆ°å‘½ä»¤è¡Œå­˜åœ¨ç©ºæ ¼çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œå¾ˆå¤šåŸºäºè¿™äº›åº“å®ç°çš„å®¢æˆ·ç«¯ä¹Ÿæœªè€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œåœ¨ &lt;a href="https://tools.ietf.org/html/rfc4254#section-6.5">SSH RFC 4252&lt;/a> ä¸­ï¼Œå¯¹ &lt;code>exec&lt;/code> å‘½ä»¤è¡Œçš„è§£æï¼Œä»…ä»…åªæœ‰å¦‚ä¸‹ä¸€æ®µè¯ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code> byte SSH_MSG_CHANNEL_REQUEST
uint32 recipient channel
string &amp;#34;exec&amp;#34;
boolean want reply
string command
This message will request that the server start the execution of the
given command. The &amp;#39;command&amp;#39; string may contain a path. Normal
precautions MUST be taken to prevent the execution of unauthorized
commands.
&lt;/code>&lt;/pre>&lt;p>SSH çš„è§„èŒƒå¹¶æ²¡æœ‰æŒ‡å‡ºå‘½ä»¤è¡Œçš„è§£ææ ¼å¼è§„åˆ™ï¼Œä½†å®é™…ä¸Šï¼Œ&lt;code>command&lt;/code> çš„è§£æåº”å½“ç¬¦åˆ POSIX 1003.1 çš„ Shell éƒ¨åˆ†ã€‚å½“ç„¶ï¼Œæ˜¾å¼æè¿°ä¸€ä¸‹ä¼šæ›´å¥½ã€‚&lt;/p>
&lt;p>æˆ‘è§‰å¾— Windows è¿™ä¸€ç‚¹åšçš„æ¯”è¾ƒå¥½ï¼Œæ–‡æ¡£è§„èŒƒæ¯”è¾ƒå®Œå¤‡ï¼š&lt;a href="https://docs.microsoft.com/en-us/previous-versions/ms880421(v=msdn.10)">Parsing C Command-Line Arguments&lt;/a>ã€‚&lt;/p>
&lt;h2 id="openssh-æœåŠ¡ç«¯çš„å‘½ä»¤è¡Œè§£æ">OpenSSH æœåŠ¡ç«¯çš„å‘½ä»¤è¡Œè§£æ&lt;/h2>
&lt;p>åœ¨ OpenSSH SSHD çš„æºç ä¸­ï¼Œå‘½ä»¤è¡Œçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>å½“è¯·æ±‚ä¸º &lt;code>exec&lt;/code> æ—¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L2221
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;shell&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_shell_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;exec&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_exec_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;pty-req&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_pty_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;x11-req&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_x11_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;auth-agent-req@openssh.com&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_auth_agent_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;subsystem&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_subsystem_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strcmp&lt;/span>(&lt;span style="color:#58a1dd">rtype&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;env&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">session_env_req&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è·å¾— &lt;code>Command&lt;/code> å¹¶æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L2047
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">session_exec_req&lt;/span>(&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">Session&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">s&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">u_int&lt;/span> &lt;span style="color:#58a1dd">success&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">r&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">command&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ((&lt;span style="color:#58a1dd">r&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sshpkt_get_cstring&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">command&lt;/span>, &lt;span style="color:#58a1dd">NULL&lt;/span>)) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> &lt;span style="color:#ff636f">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">r&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sshpkt_get_end&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>)) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sshpkt_fatal&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">r&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;%s: parse packet&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">__func__&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">success&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">do_exec&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">command&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">free&lt;/span>(&lt;span style="color:#58a1dd">command&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">success&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ— è®ºæ˜¯ä½•ç§é€”å¾„ï¼Œåœ¨ OpenSSH ä¸­ï¼Œsshd å¯åŠ¨è¿›ç¨‹éƒ½æ˜¯é€šè¿‡ &lt;code>sh -c&lt;/code> è¿™æ ·çš„æ–¹å¼å®ç°çš„ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå‘½ä»¤è¡Œåº”å½“ç¬¦åˆ shell çš„æ ‡å‡†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L1681
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">command&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">argv0&lt;/span>[&lt;span style="color:#a6be9d">256&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Start the shell. Set initial character to &amp;#39;-&amp;#39;. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv0&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;-&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strlcpy&lt;/span>(&lt;span style="color:#58a1dd">argv0&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">shell0&lt;/span>, &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">argv0&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">argv0&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">errno&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">EINVAL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">perror&lt;/span>(&lt;span style="color:#58a1dd">shell&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Execute the shell. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">argv0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">execve&lt;/span>(&lt;span style="color:#58a1dd">shell&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>, &lt;span style="color:#58a1dd">env&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Executing the shell failed. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">perror&lt;/span>(&lt;span style="color:#58a1dd">shell&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * Execute the command using the user&amp;#39;s shell. This uses the -c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * option to execute the command.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>) &lt;span style="color:#58a1dd">shell0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-c&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">2&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>) &lt;span style="color:#58a1dd">command&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#a6be9d">3&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">execve&lt;/span>(&lt;span style="color:#58a1dd">shell&lt;/span>, &lt;span style="color:#58a1dd">argv&lt;/span>, &lt;span style="color:#58a1dd">env&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">perror&lt;/span>(&lt;span style="color:#58a1dd">shell&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨ä¸Šçš„ Shell å¯èƒ½æ˜¯ Dash shellï¼ŒæŠ‘æˆ–æ˜¯ Bash Shellï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ Zsh ç­‰ç­‰ï¼Œä¸åŒçš„ shell è¯­æ³•çš„æ‘å­ä¸€å®šçš„å·®å¼‚ï¼Œå¯¹ &lt;code>sh -c '$command'&lt;/code> çš„è§£æå¹¶ä¸ä¸€å®šç›¸åŒï¼Œè¿™ä¹Ÿå¯èƒ½å¯¼è‡´æ›´å¤šçš„ä¸ç¡®å®šæ€§ã€‚&lt;/p>
&lt;h2 id="å°è¯•ä¿®å¤">å°è¯•ä¿®å¤&lt;/h2>
&lt;p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ª PRï¼š&lt;a href="https://github.com/openssh/openssh-portable/pull/123">Fix SSH incorrect command line conversion&lt;/a>ï¼Œè¿™ä¸ª PR å°†å‘½ä»¤è¡Œå‚æ•°ç¼–ç ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">escape_argument&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">buf&lt;/span>, &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">bufsize&lt;/span>, &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">arg&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">strlen&lt;/span>(&lt;span style="color:#58a1dd">arg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">len&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">2&lt;/span>&lt;span style="color:#ff636f">&amp;gt;=&lt;/span>&lt;span style="color:#58a1dd">bufsize&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">arg&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">hasspace&lt;/span>, &lt;span style="color:#58a1dd">i&lt;/span> ,&lt;span style="color:#58a1dd">n&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">hasspace&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">len&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">switch&lt;/span>(&lt;span style="color:#58a1dd">arg&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>]){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">n&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\t&amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">hasspace&lt;/span> &lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">default&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">hasspace&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">n&lt;/span>&lt;span style="color:#ff636f">+=&lt;/span>&lt;span style="color:#a6be9d">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>&lt;span style="color:#ff636f">||&lt;/span>&lt;span style="color:#58a1dd">bufsize&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">n&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">arg&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">hasspace&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;&amp;#34;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span>(&lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">len&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">switch&lt;/span>(&lt;span style="color:#58a1dd">arg&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>]){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">arg&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span>(;&lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;&lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">--&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">arg&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">default&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">arg&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">hasspace&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span>(;&lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;&lt;span style="color:#58a1dd">slashes&lt;/span>&lt;span style="color:#ff636f">--&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;&amp;#34;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buf&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//memchr(, int __c, size_t __n)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">buf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½† PR è¢«å…³é—­äº†,è¿™ä¸ªé—®é¢˜æœ€ç»ˆéœ€è¦ SSH åè®®çš„æ”¹è¿›ï¼Œå¦åˆ™éš¾ä»¥ä¿®å¤ã€‚è€Œåœ¨ OpenSSH BUG ç¤¾åŒºå®é™…ä¸Šæ—©æœ‰è®¨è®ºï¼š&lt;a href="http://bugzilla.mindrot.org/show_bug.cgi?id=2283">http://bugzilla.mindrot.org/show_bug.cgi?id=2283&lt;/a>ã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>SSH å¹¶ä¸å®Œç¾ï¼ŒOpenSSH ä¹Ÿä¸å®Œç¾ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-03-18-ssh-one-bug/ - Copyright (c) 2009-2024 J23</description></item><item><title>æ„å»ºæ°å½“çš„ Git SSH Server</title><link>https://forcemz.net/posts/2019/2019-03-15-make-a-git-ssh-server/</link><pubDate>Fri, 15 Mar 2019 18:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-03-15-make-a-git-ssh-server/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-03-15-make-a-git-ssh-server/ -&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>ç›¸å¯¹äº HTTP(HTTPS) åè®®ï¼ŒGit åœ¨ä½¿ç”¨ SSH åè®®æ“ä½œè¿œç¨‹å­˜å‚¨åº“æ—¶ï¼Œå› ä¸ºçœå»äº†è¾“å…¥ç”¨æˆ·åå¯†ç çš„ç¯èŠ‚ï¼Œå¾€å¾€è¦æ›´æ–¹ä¾¿ä¸€äº›ï¼Œå¹¶ä¸”ï¼Œåœ¨ Gitlab è¿™æ ·çš„ä»£ç æ‰˜ç®¡æœåŠ¡ä¸­ï¼ŒSSH åœ¨æ—¶é•¿ä¸Šæ›´å…·ä¼˜åŠ¿ï¼Œæ—©æœŸ Gitlab ä½¿ç”¨äº† Grack æä¾› Git HTTP è®¿é—®æ”¯æŒï¼Œç”±äº Unicron+Grack å›ºå®šæ•°ç›®å¤šçº¿ç¨‹åŒæ­¥æ¨¡å‹å¯¼è‡´æœåŠ¡å™¨ä¸Šçš„ HTTP è¶…æ—¶ä¸å¾—ä¸è®¾ç½®éå¸¸å°ï¼Œè€Œ SSH fork å¤šçº¿ç¨‹åŒæ­¥æ¨¡å‹åè€Œèƒ½å¤Ÿæ”¯æŒæ›´å¤§çš„è®¿é—®æ—¶é•¿ã€‚å®é™…æƒ…å†µä¸­ï¼ŒGitee å¹³å°é‡Œ Git æ¥å…¥çš„æœ€å¤§ä»½é¢ä¹Ÿæ˜¯ SSHã€‚æ„å»ºæ°å½“çš„ Git SSH Server å¯¹äºæ•´ä¸ª Gitee å¹³å°ä¹Ÿå°±éå¸¸é‡è¦ã€‚&lt;/p>
&lt;h2 id="git-ssh-åŸºäº-openssh">Git SSH åŸºäº OpenSSH&lt;/h2>
&lt;p>åœ¨ OpenSSH çš„ &lt;a href="https://linux.die.net/man/5/sshd_config">&lt;code>sshd_config&lt;/code>&lt;/a> ä¸­æœ‰ä¸€äº›å…³é”®é…ç½®é¡¹ &lt;code>AuthorizedKeysFile&lt;/code> (é€šå¸¸ä¸º &lt;code>.ssh/authorized_keys&lt;/code>) &lt;code>AuthorizedKeysCommand&lt;/code>ã€‚Git SSH çš„æˆæƒä¹Ÿæ˜¯ç”±è¿™äº›ç‰¹æ€§å®ç°çš„ï¼Œå…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/gitlabhq/gitlab-shell">gitlab-shell&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>git pull/push over ssh -&amp;gt; gitlab-shell -&amp;gt; API call to gitlab-rails (Authorization) -&amp;gt; accept or decline -&amp;gt; execute git command&lt;/p>
&lt;/blockquote>
&lt;p>æ—©åœ¨ 2015 å¹´ï¼ŒGitee ç”± NFS æ¶æ„è½¬å‘ä¸ºç›®å‰çš„åˆ†å¸ƒå¼æ¶æ„ä¹‹åˆï¼Œæˆ‘ä»¬é¢ä¸´äº†ä¸€ä¸ªéš¾é¢˜ï¼Œå¦‚ä½•ä½¿å¾— Git SSH çš„æµé‡åˆ†å‘åˆ°ä¸åŒçš„å­˜å‚¨åç«¯ï¼Œæœ€åˆçš„æƒ³æ³•æ˜¯è¿˜æ˜¯ä½¿ç”¨ OpenSSHï¼ŒåŸºäºç«¯å£è½¬å‘ï¼Œä½†ç«¯å£è½¬å‘çš„æµé‡åœ¨å†…ç½‘ä¸­ä»ç„¶éœ€è¦é‡å¤åŠ å¯†è§£å¯†ï¼Œè¿™éå¸¸æ¶ˆè€— CPU èµ„æºã€‚å¹¶ä¸”éªŒè¯æµç¨‹ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œéœ€è¦å¯åŠ¨å‘½ä»¤å®ŒæˆéªŒè¯ï¼Œè¿™å¯¹äºä½“é‡è¾ƒå¤§çš„ä»£ç æ‰˜ç®¡å¹³å°æ¥è¯´æ˜¯ä¸èƒ½å¿å—çš„ã€‚&lt;/p>
&lt;h2 id="gitee-çš„-ssh-server">Gitee çš„ SSH Server&lt;/h2>
&lt;p>åœ¨ Gitee åˆ†å¸ƒå¼æ¶æ„æ¼”è¿›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼€å‘äº† git-srvï¼Œæœ€åˆå®ç°äº† git-upload-packï¼Œgit-receive-pack è¿™æ ·çš„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¼šå–ä»£å‰ç«¯æœåŠ¡å™¨ä¸Šçš„ git-upload-pack/git-receive-packï¼Œå½“è¢«æ‰“å¼€æ—¶ï¼Œä¼šæŸ¥è¯¢å­˜å‚¨æœåŠ¡å™¨è·¯ç”±å¹¶ä¸å­˜å‚¨æœåŠ¡å™¨ä¸Šçš„ git-srv é€šè®¯ï¼Œæœ€ç»ˆåœ¨å­˜å‚¨æœåŠ¡å™¨ä¸Šè¿è¡Œ git-upload-pack/git-receive-packã€‚è¿™ç§æ–¹æ¡ˆä¸ç›®å‰ Gitlab gitlay çš„æ¶æ„ç±»ä¼¼ã€‚ä½†æ­¤æ–¹æ¡ˆä»ç„¶æœ‰å¾ˆå¤šä¸è¶³ï¼Œæ¯æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œåˆ™éœ€è¦å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ã€‚å­è¿›ç¨‹è¿˜è¦ç»å†ä¸€äº›å¤æ‚çš„æ“ä½œæ‰èƒ½ä¸åç«¯å»ºç«‹è¿æ¥ï¼Œè¿™å¹¶ä¸é«˜æ•ˆã€‚&lt;/p>
&lt;p>å› æ­¤æˆ‘ä»¬ç›´æ¥å°† å…¼å®¹çš„ git-receive-pack/git-upload-pack è¿™ä¸€ä¸­é—´ç»„ä»¶æ‹¿æ‰ï¼Œå®ç°ä¸€ä¸ª SSH æœåŠ¡ä¸ Git-SRV é€šä¿¡ã€‚äºæ˜¯æˆ‘ä»¬åŸºäº libssh å¼€å‘äº† Basalt SSHDã€‚ç”±äº libssh åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªåŒæ­¥é˜»å¡çš„åº“ï¼Œï¼ˆlibssh2 æ²¡æœ‰æœåŠ¡ç«¯ APIï¼‰, sshd ä¹Ÿå°±åªèƒ½ä½¿ç”¨ pre-fork æ¨¡å‹ï¼Œè¿™ä¸ OpenSSH ç±»ä¼¼ã€‚&lt;/p>
&lt;p>ä½† Gitee çš„ SSH Server å¹¶ä¸éœ€è¦ fork å­è¿›ç¨‹æ‰§è¡Œï¼Œpre-fork æ¨¡å‹ä¹Ÿå°±æ˜¾å¾—éå¸¸é¸¡è‚‹ã€‚åæ¥æˆ‘ä»¬åˆä½¿ç”¨ Golang &lt;a href="https://github.com/gliderlabs/ssh">gliderlabs/ssh&lt;/a> å®ç°äº†ä¸€ä¸ª SSH Serverã€‚ç›®å‰ Gitee è¿è¡Œçš„ SSH æœåŠ¡æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯åŸºäº libssh çš„ Basalt v1ï¼Œä¸€ä¸ªæ˜¯åŸºäº Golang çš„ Basalt v2ã€‚è¦æŸ¥çœ‹ Gitee ä½¿ç”¨çš„ SSH Server ç‰ˆæœ¬ï¼Œå¯ä»¥è¿è¡Œ &lt;code>ssh -Tv git@gitee.com&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># libssh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug1: Remote protocol version 2.0, remote software version Basalt-1.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># Golang&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug1: Remote protocol version 2.0, remote software version Basalt-2.5.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ssh-server-çš„é€‰å‹æ¯”è¾ƒ">SSH Server çš„é€‰å‹æ¯”è¾ƒ&lt;/h2>
&lt;p>SSH åè®®æŒ‡çš„æ˜¯ &lt;a href="https://en.wikipedia.org/wiki/Secure_Shell">å®‰å…¨ Shell (Secure Shell)&lt;/a> åè®®ï¼ŒSSH ç”¨äºæ›¿ä»£ä¸å®‰å…¨çš„ Telnet åè®®å’Œ Shell åè®®ï¼Œæ‰€æœ‰çš„æµé‡å‡é€šè¿‡åŠ å¯†ä¼ è¾“ï¼Œåè®®çš„ä¸»è¦ç‰ˆæœ¬æœ‰ SSH-1ï¼ŒSSH-2ã€‚SSH è§„èŒƒå¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>RFC 4250, The Secure Shell (SSH) Protocol Assigned Numbers&lt;/li>
&lt;li>RFC 4251, The Secure Shell (SSH) Protocol Architecture&lt;/li>
&lt;li>RFC 4252, The Secure Shell (SSH) Authentication Protocol&lt;/li>
&lt;li>RFC 4253, The Secure Shell (SSH) Transport Layer Protocol&lt;/li>
&lt;li>RFC 4254, The Secure Shell (SSH) Connection Protocol&lt;/li>
&lt;li>RFC 4255, Using DNS to Securely Publish Secure Shell (SSH) Key Fingerprints&lt;/li>
&lt;li>RFC 4256, Generic Message Exchange Authentication for the Secure Shell Protocol (SSH)&lt;/li>
&lt;li>RFC 4335, The Secure Shell (SSH) Session Channel Break Extension&lt;/li>
&lt;li>RFC 4344, The Secure Shell (SSH) Transport Layer Encryption Modes&lt;/li>
&lt;li>RFC 4345, Improved Arcfour Modes for the Secure Shell (SSH) Transport Layer Protocol&lt;/li>
&lt;/ul>
&lt;p>ä¿®æ”¹å’Œæ‰©å±•ï¼š&lt;/p>
&lt;ul>
&lt;li>RFC 4419, Diffie-Hellman Group Exchange for the Secure Shell (SSH) Transport Layer Protocol (March 2006)&lt;/li>
&lt;li>RFC 4432, RSA Key Exchange for the Secure Shell (SSH) Transport Layer Protocol (March 2006)&lt;/li>
&lt;li>RFC 4462, Generic Security Service Application Program Interface (GSS-API) Authentication and Key Exchange for the Secure Shell (SSH) Protocol (May 2006)&lt;/li>
&lt;li>RFC 4716, The Secure Shell (SSH) Public Key File Format (November 2006)&lt;/li>
&lt;li>RFC 4819: Secure Shell Public Key Subsystem (March 2007)&lt;/li>
&lt;li>RFC 5647: AES Galois Counter Mode for the Secure Shell Transport Layer Protocol (August 2009)&lt;/li>
&lt;li>RFC 5656, Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer (December 2009)&lt;/li>
&lt;li>RFC 6187: X.509v3 Certificates for Secure Shell Authentication (March 2011)&lt;/li>
&lt;li>RFC 6239: Suite B Cryptographic Suites for Secure Shell (SSH) (May 2011)&lt;/li>
&lt;li>RFC 6594: Use of the SHA-256 Algorithm with RSA, Digital Signature Algorithm (DSA), and Elliptic Curve DSA (ECDSA) in SSHFP Resource Records&lt;/li>
&lt;li>RFC 6668, SHA-2 Data Integrity Verification for the Secure Shell (SSH) Transport Layer Protocol (July 2012)&lt;/li>
&lt;li>RFC 7479: [[Ed25519]] SSHFP Resource Records&lt;/li>
&lt;/ul>
&lt;p>è™½ç„¶ SSH æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¯”è¾ƒå¤š&lt;sup>1&lt;/sup>ï¼Œä½†åŸºäºç°æˆçš„ SSH åº“å¼€å‘ SSH Server çš„é€‰æ‹©å¹¶ä¸å¤šï¼Œåœ¨ C æˆ–è€… C++ ä¸­ï¼ŒåŸºæœ¬ä¸Šåªæœ‰ libssh å¯é€‰ï¼Œlibssh è¢«ç”¨æ¥å®ç° Git SSH Server çš„æœ‰ Gitee å’Œ Githubã€‚ä½†ç›®å‰ Github çš„ SSH Server æ ‡è¯†å˜æˆäº† &lt;code>babeld-9d924d26&lt;/code>ï¼Œç›®å‰æ˜¯å¦åˆ‡æ¢åˆ°å…¶ä»–å®ç°ä¸å¾—è€ŒçŸ¥ã€‚&lt;/p>
&lt;p>Libssh çš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå¼‚æ­¥éé˜»å¡æ”¯æŒæ¯”è¾ƒå¼±ï¼Œå¦å¤–å¼€å‘è€…æ¯”è¾ƒå°‘ï¼Œé•¿æœŸåªæœ‰ Andreas Schneider ä¸€ä¸ªäººæäº¤ã€‚å¹¶ä¸” Bug æ¯”è¾ƒå¤šï¼ŒGitee çº¿ä¸Šçš„ Libssh ä¹Ÿæ˜¯éœ€è¦åº”ç”¨ç‰¹å®šçš„ Patch æ‰è¡Œã€‚ç»´æŠ¤ SSHD éœ€è¦ç»å¸¸ç™»é™† &lt;a href="https://bugs.libssh.org/">https://bugs.libssh.org/&lt;/a> æŸ¥çœ‹ libssh åŠ¨æ€ã€‚&lt;/p>
&lt;p>å…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨ libssh çš„ç»‘å®šæ¥å¼€å‘ SSH æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹åº”è¯­è¨€çš„ SSH åº“å®ç°ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„è¯­è¨€ä¸å¯¹åº”çš„ SSH åº“å®ç°ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è¯­è¨€&lt;/th>
&lt;th>åº“&lt;/th>
&lt;th>ç‰¹ç‚¹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Go&lt;/td>
&lt;td>&lt;a href="https://github.com/golang/crypto/tree/master/ssh">crypto/ssh&lt;/a>&lt;/td>
&lt;td>å¼‚æ­¥ï¼ŒGolang å®˜æ–¹æ”¯æŒï¼Œä½¿ç”¨å¹¿æ³›&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Java&lt;/td>
&lt;td>&lt;a href="https://github.com/apache/mina-sshd">Apache Mina SSHD&lt;/a>&lt;/td>
&lt;td>é«˜æ€§èƒ½ï¼ŒåŠŸèƒ½å®Œæ•´&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rust&lt;/td>
&lt;td>&lt;a href="https://pijul.org/thrussh/">Thrussh&lt;/a>&lt;/td>
&lt;td>å¼‚æ­¥ IOï¼Œç¼“å†²åŒºå®‰å…¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>C#&lt;/td>
&lt;td>&lt;a href="https://github.com/Aimeast/FxSsh">FxSsh&lt;/a>&lt;/td>
&lt;td>ä¸»è¦ç”¨äº GitCandyï¼ŒåŠŸèƒ½æœ‰é™&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>åŸºäº Golang &lt;code>crypto/ssh&lt;/code> å®ç°çš„ SSH Server æ¯”è¾ƒå¤šï¼Œè€ŒåŸºäº Golang çš„å¼€æºä»£ç æ‰˜ç®¡å¹³å° Gogs/Gitea å‡ä½¿ç”¨äº† &lt;code>crypto/ssh&lt;/code>ã€‚&lt;/p>
&lt;p>Apache Mina SSHD åœ¨ Java ç¤¾åŒºé‡Œè¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚ Jenkins CI å°±æœ‰ä¸ª &lt;a href="https://mvnrepository.com/artifact/org.jenkins-ci.modules/sshd">SSH Server&lt;/a> æ¨¡å—ã€‚åŸºäº Scala (JVM) çš„ä»£ç æ‰˜ç®¡å¹³å° &lt;a href="https://github.com/gitbucket/gitbucket">https://github.com/gitbucket/gitbucket&lt;/a> ä½¿ç”¨äº† Apache Mina SSHD å®ç° Git SSH Serverã€‚&lt;/p>
&lt;p>è€Œ Thrussh åˆ™ä¸»è¦è¢«ç”¨äºåŸºäº Rust çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…· &lt;a href="https://pijul.org/">pijul&lt;/a> æé«˜ SSH åè®®æ”¯æŒã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€äº›å•†ä¸šä¸Šçš„ SSH Server åº“ï¼Œä½¿ç”¨è¾ƒå°‘ã€‚&lt;/p>
&lt;h2 id="git-ssh-server-æŠ€æœ¯ç»†èŠ‚">Git SSH Server æŠ€æœ¯ç»†èŠ‚&lt;/h2>
&lt;p>å®ç° Git SSH Server ä¸å®ç°å¸¸è§„çš„ SSH Server çš„åŒºåˆ«ä¸»è¦æ˜¯ï¼ŒGit SSH Server åªæ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å­é›†ï¼Œsession é˜¶æ®µåªéœ€è¦å®ç° &lt;code>env&lt;/code> &lt;code>exec&lt;/code> ä¸¤ç§è¯·æ±‚ã€‚ä¸éœ€è¦å®ç° &lt;code>sftp&lt;/code> å’Œç«¯å£è½¬å‘ã€‚&lt;/p>
&lt;p>å› æ­¤ç®€å•çš„å®ç°ä¸€ä¸ª Git SSH Server å³å¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">package&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;os/exec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;os/user&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;path/filepath&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;syscall&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;github.com/gliderlabs/ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Error
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">var&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ErrPublicKeyNotFound&lt;/span> = &lt;span style="color:#58a1dd">errors&lt;/span>.&lt;span style="color:#58a1dd">New&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Public key not found&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ErrEncodeHandshake&lt;/span> = &lt;span style="color:#58a1dd">errors&lt;/span>.&lt;span style="color:#58a1dd">New&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Handshake encode error&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ErrRepositoryNotFound&lt;/span> = &lt;span style="color:#58a1dd">errors&lt;/span>.&lt;span style="color:#58a1dd">New&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Repository Not Found&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ErrUnreachablePath&lt;/span> = &lt;span style="color:#58a1dd">errors&lt;/span>.&lt;span style="color:#58a1dd">New&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Path is unreachable&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// StrSplitSkipEmpty skip empty string suggestcap is suggest cap
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">StrSplitSkipEmpty&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>, &lt;span style="color:#58a1dd">sep&lt;/span> &lt;span style="color:#ff636f">byte&lt;/span>, &lt;span style="color:#58a1dd">suggestcap&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>) []&lt;span style="color:#ff636f">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sv&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">make&lt;/span>([]&lt;span style="color:#ff636f">string&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">suggestcap&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">first&lt;/span>, &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> ; &lt;span style="color:#58a1dd">i&lt;/span> &amp;lt; &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>); &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>] &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">sep&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">first&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sv&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">sv&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#58a1dd">first&lt;/span>:&lt;span style="color:#58a1dd">i&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">first&lt;/span> = &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">first&lt;/span> &amp;lt; &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sv&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">sv&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#58a1dd">first&lt;/span>:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">sv&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// RepoPathClean todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">RepoPathClean&lt;/span>(&lt;span style="color:#58a1dd">p&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) (&lt;span style="color:#ff636f">string&lt;/span>, &lt;span style="color:#ff636f">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">xp&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">path&lt;/span>.&lt;span style="color:#58a1dd">Clean&lt;/span>(&lt;span style="color:#58a1dd">p&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pv&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">StrSplitSkipEmpty&lt;/span>(&lt;span style="color:#58a1dd">xp&lt;/span>, &lt;span style="color:#a6be9d">&amp;#39;/&amp;#39;&lt;/span>, &lt;span style="color:#a6be9d">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">pv&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">pv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>]) &amp;lt; &lt;span style="color:#a6be9d">2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">ErrUnreachablePath&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">pv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">TrimSuffix&lt;/span>(&lt;span style="color:#58a1dd">pv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>], &lt;span style="color:#a6be9d">&amp;#34;.git&amp;#34;&lt;/span>), &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// GetSessionEnv env
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">GetSessionEnv&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Session&lt;/span>, &lt;span style="color:#58a1dd">key&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">prefix&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;=&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">kl&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">prefix&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> &lt;span style="color:#58a1dd">_&lt;/span>, &lt;span style="color:#58a1dd">str&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">range&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Environ&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">kl&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">str&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">HasPrefix&lt;/span>(&lt;span style="color:#58a1dd">str&lt;/span>, &lt;span style="color:#58a1dd">prefix&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">str&lt;/span>[&lt;span style="color:#58a1dd">kl&lt;/span>:]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// RepoPathStat stat repo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">RepoPathStat&lt;/span>(&lt;span style="color:#58a1dd">repo&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) (&lt;span style="color:#ff636f">string&lt;/span>, &lt;span style="color:#ff636f">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">r&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">filepath&lt;/span>.&lt;span style="color:#58a1dd">Join&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;/home/git/root&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">repo&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>:&lt;span style="color:#a6be9d">2&lt;/span>], &lt;span style="color:#58a1dd">repo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> !&lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">HasSuffix&lt;/span>(&lt;span style="color:#58a1dd">r&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;.git&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">r&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;.git&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">_&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Stat&lt;/span>(&lt;span style="color:#58a1dd">r&lt;/span>); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">ErrRepositoryNotFound&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">r&lt;/span>, &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// GitCommand exe git-*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">GitCommand&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Session&lt;/span>, &lt;span style="color:#58a1dd">scmd&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>, &lt;span style="color:#58a1dd">repo&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">User&lt;/span>() &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;git&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// filter unallowed user
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>(), &lt;span style="color:#a6be9d">&amp;#34;Permission denied, user: \x1b[31m&amp;#39;%s&amp;#39;\x1b[0m\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">User&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pwn&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">RepoPathClean&lt;/span>(&lt;span style="color:#58a1dd">repo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>(), &lt;span style="color:#a6be9d">&amp;#34;Permission denied: \x1b[31m%v\x1b[0m\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// TODO AUTH
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">diskrepo&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">RepoPathStat&lt;/span>(&lt;span style="color:#58a1dd">pwn&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintf&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>(), &lt;span style="color:#a6be9d">&amp;#34;Access deined: \x1b[31m%v\x1b[0m\n&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">version&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">GetSessionEnv&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;GIT_PROTOCOL&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">exec&lt;/span>.&lt;span style="color:#58a1dd">Command&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;git&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">scmd&lt;/span>, &lt;span style="color:#58a1dd">diskrepo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ProcAttr&lt;/span>(&lt;span style="color:#58a1dd">cmd&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">environ&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;GL_ID=key-&amp;#34;&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#58a1dd">strconv&lt;/span>.&lt;span style="color:#58a1dd">FormatInt&lt;/span>(&lt;span style="color:#a6be9d">1111&lt;/span>, &lt;span style="color:#a6be9d">10&lt;/span>)) &lt;span style="color:#828b96;font-style:italic">/// to set envid
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">version&lt;/span>) &amp;gt; &lt;span style="color:#a6be9d">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">environ&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;GIT_PROTOCOL=&amp;#34;&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#58a1dd">version&lt;/span>) &lt;span style="color:#828b96;font-style:italic">/// to set envid
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">environ&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Environ&lt;/span>()&lt;span style="color:#ff636f">...&lt;/span>) &lt;span style="color:#828b96;font-style:italic">/// include other
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span> = &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Stdin&lt;/span> = &lt;span style="color:#58a1dd">s&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Stdout&lt;/span> = &lt;span style="color:#58a1dd">s&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// FIXME: check timeout
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> = &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Start&lt;/span>(); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Fprintln&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>(), &lt;span style="color:#a6be9d">&amp;#34;Server internal error, unable to run git-&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">scmd&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>.&lt;span style="color:#58a1dd">Printf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Server internal error, unable to run git-%s error: %v&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">scmd&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">exitcode&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exitChain&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">make&lt;/span>(&lt;span style="color:#ff636f">chan&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">go&lt;/span> &lt;span style="color:#ff636f">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> = &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Wait&lt;/span>(); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exitcode&lt;/span> = &lt;span style="color:#a6be9d">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exitChain&lt;/span> &lt;span style="color:#ff636f">&amp;lt;-&lt;/span> &lt;span style="color:#ff636f">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">select&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#ff636f">&amp;lt;-&lt;/span>&lt;span style="color:#58a1dd">exitChain&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">exitcode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#ff636f">&amp;lt;-&lt;/span>&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Context&lt;/span>().&lt;span style="color:#58a1dd">Done&lt;/span>():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">Process&lt;/span>.&lt;span style="color:#58a1dd">Kill&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">sshAuth&lt;/span>(&lt;span style="color:#58a1dd">ctx&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Context&lt;/span>, &lt;span style="color:#58a1dd">key&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">PublicKey&lt;/span>) &lt;span style="color:#ff636f">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/// TODO auth
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">sessionHandler&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Session&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Command&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">cmd&lt;/span>) &amp;lt; &lt;span style="color:#a6be9d">2&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> !&lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">HasPrefix&lt;/span>(&lt;span style="color:#58a1dd">cmd&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>], &lt;span style="color:#a6be9d">&amp;#34;git-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">Stderr&lt;/span>().&lt;span style="color:#58a1dd">Write&lt;/span>([]&lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;bad command &amp;#34;&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#58a1dd">cmd&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;\n&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GitCommand&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">TrimPrefix&lt;/span>(&lt;span style="color:#58a1dd">cmd&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>], &lt;span style="color:#a6be9d">&amp;#34;git-&amp;#34;&lt;/span>), &lt;span style="color:#58a1dd">cmd&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Userid get
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">Userid&lt;/span> &lt;span style="color:#ff636f">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Groupid in
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">Groupid&lt;/span> &lt;span style="color:#ff636f">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// NeedSetsid is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">NeedSetsid&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// ProcAttr is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">ProcAttr&lt;/span>(&lt;span style="color:#58a1dd">cmd&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">exec&lt;/span>.&lt;span style="color:#58a1dd">Cmd&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">NeedSetsid&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">cmd&lt;/span>.&lt;span style="color:#58a1dd">SysProcAttr&lt;/span> = &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">syscall&lt;/span>.&lt;span style="color:#58a1dd">SysProcAttr&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Credential&lt;/span>: &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">syscall&lt;/span>.&lt;span style="color:#58a1dd">Credential&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Uid&lt;/span>: &lt;span style="color:#58a1dd">Userid&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Gid&lt;/span>: &lt;span style="color:#58a1dd">Groupid&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Setsid&lt;/span>: &lt;span style="color:#ff636f">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//InitializeUtils ini
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">InitializeUtils&lt;/span>() &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">syscall&lt;/span>.&lt;span style="color:#58a1dd">Getuid&lt;/span>() &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NeedSetsid&lt;/span> = &lt;span style="color:#ff636f">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Userid&lt;/span> = &lt;span style="color:#58a1dd">uint32&lt;/span>(&lt;span style="color:#58a1dd">syscall&lt;/span>.&lt;span style="color:#58a1dd">Getuid&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Groupid&lt;/span> = &lt;span style="color:#58a1dd">uint32&lt;/span>(&lt;span style="color:#58a1dd">syscall&lt;/span>.&lt;span style="color:#58a1dd">Getgid&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">user&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">user&lt;/span>.&lt;span style="color:#58a1dd">Lookup&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;git&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">xid&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">strconv&lt;/span>.&lt;span style="color:#58a1dd">ParseUint&lt;/span>(&lt;span style="color:#58a1dd">user&lt;/span>.&lt;span style="color:#58a1dd">Uid&lt;/span>, &lt;span style="color:#a6be9d">10&lt;/span>, &lt;span style="color:#a6be9d">32&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">environ&lt;/span> = &lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Environ&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>, &lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">range&lt;/span> &lt;span style="color:#58a1dd">environ&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">strings&lt;/span>.&lt;span style="color:#58a1dd">HasPrefix&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;HOME=&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">environ&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>] = &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Sprintf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;HOME=%s&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">user&lt;/span>.&lt;span style="color:#58a1dd">HomeDir&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Userid&lt;/span> = &lt;span style="color:#58a1dd">uint32&lt;/span>(&lt;span style="color:#58a1dd">xid&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">zid&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">strconv&lt;/span>.&lt;span style="color:#58a1dd">ParseUint&lt;/span>(&lt;span style="color:#58a1dd">user&lt;/span>.&lt;span style="color:#58a1dd">Gid&lt;/span>, &lt;span style="color:#a6be9d">10&lt;/span>, &lt;span style="color:#a6be9d">32&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Groupid&lt;/span> = &lt;span style="color:#58a1dd">uint32&lt;/span>(&lt;span style="color:#58a1dd">zid&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NeedSetsid&lt;/span> = &lt;span style="color:#ff636f">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">environ&lt;/span> []&lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">srv&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Server&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Handler&lt;/span>: &lt;span style="color:#58a1dd">sessionHandler&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PublicKeyHandler&lt;/span>: &lt;span style="color:#58a1dd">sshAuth&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">MaxTimeout&lt;/span>: &lt;span style="color:#58a1dd">time&lt;/span>.&lt;span style="color:#58a1dd">Second&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">180&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">IdleTimeout&lt;/span>: &lt;span style="color:#58a1dd">time&lt;/span>.&lt;span style="color:#58a1dd">Second&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">3600&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Version&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Basalt-2.0-Single&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">InitializeUtils&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>.&lt;span style="color:#58a1dd">Println&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;starting ssh server on port 2222...&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ln&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">net&lt;/span>.&lt;span style="color:#58a1dd">Listen&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;tcp&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;:2222&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">srv&lt;/span>.&lt;span style="color:#58a1dd">Serve&lt;/span>(&lt;span style="color:#58a1dd">ln&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé¡¹ç›®éå¸¸ç®€å•ï¼Œä½†è¶³ä»¥è¯´æ˜å®ç° Git SSH Server çš„ç»†èŠ‚ã€‚&lt;/p>
&lt;p>è¦ç”Ÿæˆ SSH Key ä¹Ÿéå¸¸ç®€å•ï¼Œä¸‹é¢æ˜¯ ECDSA RSA ED25519 SSH Key ç”Ÿæˆç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">package&lt;/span> &lt;span style="color:#58a1dd">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;crypto/ecdsa&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;crypto/elliptic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;crypto/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;crypto/rsa&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;crypto/x509&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;encoding/pem&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;io/ioutil&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">mrand&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;golang.org/x/crypto/ed25519&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;golang.org/x/crypto/ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Thanks https://github.com/mikesmitty/edkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// MarshalED25519PrivateKey todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">/* Writes ed25519 private keys into the new OpenSSH private key format.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">I have no idea why this isn&amp;#39;t implemented anywhere yet, you can do seemingly
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">everything except write it to disk in the OpenSSH private key format. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">MarshalED25519PrivateKey&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span> &lt;span style="color:#58a1dd">ed25519&lt;/span>.&lt;span style="color:#58a1dd">PrivateKey&lt;/span>) []&lt;span style="color:#ff636f">byte&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Add our key header (followed by a null byte)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">magic&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">append&lt;/span>([]&lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;openssh-key-v1&amp;#34;&lt;/span>), &lt;span style="color:#a6be9d">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">var&lt;/span> &lt;span style="color:#58a1dd">w&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CipherName&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">KdfName&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">KdfOpts&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NumKeys&lt;/span> &lt;span style="color:#ff636f">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PubKey&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PrivKeyBlock&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Fill out the private key fields
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pk1&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Check1&lt;/span> &lt;span style="color:#ff636f">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Check2&lt;/span> &lt;span style="color:#ff636f">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Keytype&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Pub&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Priv&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Comment&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Pad&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span> &lt;span style="color:#a6be9d">`ssh:&amp;#34;rest&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Set our check ints
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ci&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">mrand&lt;/span>.&lt;span style="color:#58a1dd">Uint32&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Check1&lt;/span> = &lt;span style="color:#58a1dd">ci&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Check2&lt;/span> = &lt;span style="color:#58a1dd">ci&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Set our key type
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Keytype&lt;/span> = &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">KeyAlgoED25519&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Add the pubkey to the optionally-encrypted block
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pk&lt;/span>, &lt;span style="color:#58a1dd">ok&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>.&lt;span style="color:#58a1dd">Public&lt;/span>().(&lt;span style="color:#58a1dd">ed25519&lt;/span>.&lt;span style="color:#58a1dd">PublicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> !&lt;span style="color:#58a1dd">ok&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//fmt.Fprintln(os.Stderr, &amp;#34;ed25519.PublicKey type assertion failed on an ed25519 public key. This should never ever happen.&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pubKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> []&lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#58a1dd">pk&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Pub&lt;/span> = &lt;span style="color:#58a1dd">pubKey&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Add our private key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Priv&lt;/span> = []&lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Might be useful to put something in here at some point
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Comment&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Add some padding to match the encryption block size within PrivKeyBlock (without Pad field)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// 8 doesn&amp;#39;t match the documentation, but that&amp;#39;s what ssh-keygen uses for unencrypted keys. *shrug*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">bs&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#a6be9d">8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">blockLen&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Marshal&lt;/span>(&lt;span style="color:#58a1dd">pk1&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">padLen&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> (&lt;span style="color:#58a1dd">bs&lt;/span> &lt;span style="color:#ff636f">-&lt;/span> (&lt;span style="color:#58a1dd">blockLen&lt;/span> &lt;span style="color:#ff636f">%&lt;/span> &lt;span style="color:#58a1dd">bs&lt;/span>)) &lt;span style="color:#ff636f">%&lt;/span> &lt;span style="color:#58a1dd">bs&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Pad&lt;/span> = &lt;span style="color:#58a1dd">make&lt;/span>([]&lt;span style="color:#ff636f">byte&lt;/span>, &lt;span style="color:#58a1dd">padLen&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Padding is a sequence of bytes like: 1, 2, 3...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">for&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &amp;lt; &lt;span style="color:#58a1dd">padLen&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pk1&lt;/span>.&lt;span style="color:#58a1dd">Pad&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>] = &lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Generate the pubkey prefix &amp;#34;\0\0\0\nssh-ed25519\0\0\0 &amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">prefix&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> []&lt;span style="color:#ff636f">byte&lt;/span>{&lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x0b&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">prefix&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">prefix&lt;/span>, []&lt;span style="color:#58a1dd">byte&lt;/span>(&lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">KeyAlgoED25519&lt;/span>)&lt;span style="color:#ff636f">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">prefix&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">prefix&lt;/span>, []&lt;span style="color:#ff636f">byte&lt;/span>{&lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x20&lt;/span>}&lt;span style="color:#ff636f">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Only going to support unencrypted keys for now
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">CipherName&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;none&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">KdfName&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;none&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">KdfOpts&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">NumKeys&lt;/span> = &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">PubKey&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">prefix&lt;/span>, &lt;span style="color:#58a1dd">pubKey&lt;/span>&lt;span style="color:#ff636f">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">PrivKeyBlock&lt;/span> = &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Marshal&lt;/span>(&lt;span style="color:#58a1dd">pk1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">magic&lt;/span> = &lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">magic&lt;/span>, &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">Marshal&lt;/span>(&lt;span style="color:#58a1dd">w&lt;/span>)&lt;span style="color:#ff636f">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">magic&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// AuthenticationKeyGenerationRSA RSA
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">AuthenticationKeyGenerationRSA&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">privKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">rsa&lt;/span>.&lt;span style="color:#58a1dd">GenerateKey&lt;/span>(&lt;span style="color:#58a1dd">rand&lt;/span>.&lt;span style="color:#58a1dd">Reader&lt;/span>, &lt;span style="color:#a6be9d">2048&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// generate public key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">publicKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">NewPublicKey&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">privKey&lt;/span>.&lt;span style="color:#58a1dd">PublicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pemKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">Block&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Type&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;RSA PRIVATE KEY&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Bytes&lt;/span>: &lt;span style="color:#58a1dd">x509&lt;/span>.&lt;span style="color:#58a1dd">MarshalPKCS1PrivateKey&lt;/span>(&lt;span style="color:#58a1dd">privKey&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">privateKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">EncodeToMemory&lt;/span>(&lt;span style="color:#58a1dd">pemKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">authorizedKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">MarshalAuthorizedKey&lt;/span>(&lt;span style="color:#58a1dd">publicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> = &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>, &lt;span style="color:#58a1dd">privateKey&lt;/span>, &lt;span style="color:#a6be9d">0600&lt;/span>); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;.pub&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">authorizedKey&lt;/span>, &lt;span style="color:#a6be9d">0644&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// AuthenticationKeyGenerationECDSA ecdsa
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// by default we gen 256
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">AuthenticationKeyGenerationECDSA&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">privKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ecdsa&lt;/span>.&lt;span style="color:#58a1dd">GenerateKey&lt;/span>(&lt;span style="color:#58a1dd">elliptic&lt;/span>.&lt;span style="color:#58a1dd">P256&lt;/span>(), &lt;span style="color:#58a1dd">rand&lt;/span>.&lt;span style="color:#58a1dd">Reader&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">publicKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">NewPublicKey&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">privKey&lt;/span>.&lt;span style="color:#58a1dd">PublicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pembyte&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">x509&lt;/span>.&lt;span style="color:#58a1dd">MarshalECPrivateKey&lt;/span>(&lt;span style="color:#58a1dd">privKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// EC PRIVATE KEY
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">pemKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">Block&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Type&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;EC PRIVATE KEY&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Bytes&lt;/span>: &lt;span style="color:#58a1dd">pembyte&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">privateKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">EncodeToMemory&lt;/span>(&lt;span style="color:#58a1dd">pemKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">authorizedKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">MarshalAuthorizedKey&lt;/span>(&lt;span style="color:#58a1dd">publicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> = &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>, &lt;span style="color:#58a1dd">privateKey&lt;/span>, &lt;span style="color:#a6be9d">0600&lt;/span>); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;.pub&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">authorizedKey&lt;/span>, &lt;span style="color:#a6be9d">0644&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// AuthenticationKeyGenerationED25519 ED25519 keygen
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">AuthenticationKeyGenerationED25519&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pubKey&lt;/span>, &lt;span style="color:#58a1dd">privKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ed25519&lt;/span>.&lt;span style="color:#58a1dd">GenerateKey&lt;/span>(&lt;span style="color:#58a1dd">rand&lt;/span>.&lt;span style="color:#58a1dd">Reader&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">publicKey&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">NewPublicKey&lt;/span>(&lt;span style="color:#58a1dd">pubKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">pemKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">Block&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Type&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;OPENSSH PRIVATE KEY&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Bytes&lt;/span>: &lt;span style="color:#58a1dd">MarshalED25519PrivateKey&lt;/span>(&lt;span style="color:#58a1dd">privKey&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">privateKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">pem&lt;/span>.&lt;span style="color:#58a1dd">EncodeToMemory&lt;/span>(&lt;span style="color:#58a1dd">pemKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">authorizedKey&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ssh&lt;/span>.&lt;span style="color:#58a1dd">MarshalAuthorizedKey&lt;/span>(&lt;span style="color:#58a1dd">publicKey&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> = &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>, &lt;span style="color:#58a1dd">privateKey&lt;/span>, &lt;span style="color:#a6be9d">0600&lt;/span>); &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ioutil&lt;/span>.&lt;span style="color:#58a1dd">WriteFile&lt;/span>(&lt;span style="color:#58a1dd">keyPath&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;.pub&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">authorizedKey&lt;/span>, &lt;span style="color:#a6be9d">0644&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="svnssh-å®ç°">SVN+SSH å®ç°&lt;/h2>
&lt;p>Gitee ç›®å‰æä¾› &lt;code>svn+ssh&lt;/code> åè®®è®¿é—®ï¼Œè€Œæ­¤åè®®å®é™…ä¸Šæ˜¯é€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ &lt;code>svnserve -t&lt;/code>ï¼Œä»è€Œè¯»å†™å­˜å‚¨åº“æ•°æ®ï¼Œè€Œ Gitee çš„ svn åŠŸèƒ½åŸºäº git-as-svn ï¼Œæˆ‘ä»¬åªéœ€åœ¨è¯·æ±‚å‘½ä»¤ä¸º &lt;code>svnserve&lt;/code> æ—¶ï¼Œå°†æµé‡ä»£ç†è½¬å‘åˆ° git-as-svn ä¸Šå³å¯ã€‚åœ¨ Gitee ä¸Šé€šè¿‡ ssh+svn è®¿é—®å­˜å‚¨åº“éœ€è¦ç”¨æˆ·å¯¹å­˜å‚¨åº“å…·æœ‰å†™æƒé™ï¼Œè¿™æ˜¯ç‰¹æ„è€Œä¸ºä¹‹ã€‚&lt;/p>
&lt;h2 id="é™„å½•">é™„å½•&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Comparison_of_SSH_clients">Comparison of SSH clients&lt;/a> , &lt;a href="https://en.wikipedia.org/wiki/Comparison_of_SSH_servers">Comparison of SSH servers&lt;/a>&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2019/2019-03-15-make-a-git-ssh-server/ - Copyright (c) 2009-2024 J23</description></item><item><title>æ–‡ä»¶çš„è§£æ</title><link>https://forcemz.net/posts/2019/2019-01-25-file-parsing/</link><pubDate>Fri, 25 Jan 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-01-25-file-parsing/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-01-25-file-parsing/ -&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>æœ¬æ–‡æ¢è®¨çš„æ˜¯è®¡ç®—æœºæ–‡ä»¶ï¼Œ&lt;strong>è®¡ç®—æœºæ–‡ä»¶&lt;/strong> ç”¨äºè®°å½•æ•°æ®åˆ°è®¡ç®—æœºè®¾å¤‡ä¸Šï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ç®€çŸ­çš„ä»‹ç»ï¼š&lt;/p>
&lt;blockquote>
&lt;p>A computer file is a computer resource for recording data discretely in a computer storage device. Just as words can be written to paper, so can information be written to a computer file.&lt;/p>
&lt;/blockquote>
&lt;p>å½“äººä»¬éœ€è¦ä½¿ç”¨è¿™äº›æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ä»å…‰ç›˜ï¼Œç£ç›˜ï¼Œé—ªå­˜ç­‰è®¾å¤‡ä¸Šå°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ï¼ŒæŒ‰ç…§æ–‡ä»¶çš„æ ¼å¼è¿›è¡Œè§£æï¼Œç„¶åä¾›ç”¨æˆ·ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®çš„è·å¾—æ–‡ä»¶æ ¼å¼ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ï¼Œåªæœ‰åœ¨è¯†åˆ«å‡ºæ–‡ä»¶æ ¼å¼ä¹‹åï¼Œæ‰èƒ½å¤Ÿé€‰æ‹©æ­£ç¡®çš„çš„å¤„ç†ç¨‹åºå¯¹æ–‡ä»¶è¿›è¡Œè§£æã€‚åœ¨ Windows ä¸Šé€šå¸¸æ˜¯ Shell å¤–å£³ï¼ˆ&lt;code>Shell32.dll&lt;/code>ï¼‰åœ¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾æ–‡ä»¶åç¼€åçš„å…³è”ç¨‹åºï¼Œç„¶åäº¤ç”±å…³è”ç¨‹åºå¤„ç†ç›¸åº”çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ &lt;code>.docx&lt;/code> çš„å…³è”ç¨‹åºå¾€å¾€æ˜¯ &lt;code>Microsoft Word&lt;/code>ã€‚&lt;code>.txt&lt;/code> çš„å…³è”ç¨‹åºæ˜¯ &lt;code>Notepad&lt;/code>ã€‚ä½†å¦‚æœæ–‡ä»¶æ²¡æœ‰åç¼€åæ—¶ï¼ŒWindows Shell å°±éœ€è¦ç”¨ç”¨æˆ·è‡ªå·±é€‰æ‹©å¯¹åº”çš„å…³è”ç¨‹åºäº†ã€‚&lt;/p>
&lt;p>åœ¨ Unix æ“ä½œç³»ç»Ÿä¸Šï¼Œå‘½ä»¤è¡Œä¸‹æ£€æµ‹æ–‡ä»¶æ ¼å¼çš„æ£€æµ‹é€šå¸¸ä½¿ç”¨ &lt;code>file&lt;/code> (&lt;a href="https://linux.die.net/man/1/file">&lt;code>file â€” determine file type&lt;/code>&lt;/a>) ï¼Œfile çš„æºç å¯ä»¥åœ¨ Github ä¸Šæœ‰æ‰¾åˆ°ï¼š&lt;a href="https://github.com/file/file">https://github.com/file/file&lt;/a>ã€‚file è¿™æ ·çš„å·¥å…·é€šè¿‡åˆ†ææ–‡ä»¶é­”æ•°ï¼Œæ–‡ä»¶å¤´éƒ¨ç‰¹å¾åˆ†ææ–‡ä»¶æ ¼å¼ã€‚è¿™æ ·çš„å·¥å…·ä¸¥é‡ä¾èµ– &lt;strong>Magdir&lt;/strong>ï¼ŒMagic æ–‡ä»¶è¶Šå¤šæ”¯æŒçš„æ ¼å¼è¶Šä¸°å¯Œã€‚ä¸ Windows èµ„æºç®¡ç†å™¨ç›¸æ¯”ï¼Œfile å¯¹æ–‡ä»¶æ ¼å¼çš„æ„ŸçŸ¥å®é™…ä¸Šæ›´åŠ å¼ºå¤§ã€‚&lt;/p>
&lt;p>åœ¨ Unix like å›¾å½¢ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„æ£€æµ‹ç”±æ–‡ä»¶ç®¡ç†å™¨å®ç°ï¼Œåƒ &lt;code>Gnome Nemo&lt;/code> è¿™æ ·çš„æ–‡ä»¶ç®¡ç†å™¨ä¼šä¼˜å…ˆå¤„ç†æ–‡ä»¶åç¼€åï¼Œåœ¨è¯†åˆ«ä¸åˆ°æ–‡ä»¶æ ¼å¼æ—¶æ‰ä¼šå»æ ¹æ®æ–‡ä»¶ç‰¹å¾æ£€æµ‹æ–‡ä»¶æ ¼å¼ã€‚Nemo ä¾èµ– glib(gio &lt;a href="https://github.com/GNOME/glib/blob/cbfa776fc149fcc3e351fbdf68c1a299519f4905/gio/xdgmime/xdgmimemagic.c#L657">&lt;code>_xdg_mime_magic_lookup_data&lt;/code>&lt;/a>)ï¼Œè§£ææ–‡ä»¶æ ¼å¼çš„åŸç†ä¸ file ç±»ä¼¼ï¼Œä½†ä¸åŠ file å¼ºå¤§ã€‚&lt;/p>
&lt;p>&lt;code>file&lt;/code> ç¨‹åºç›®å‰å·²ç»è¢«ç§»æ¤åˆ° Windows ä½¿ç”¨ï¼Œæ¯”å¦‚ &lt;code>Cygwin&lt;/code>ï¼Œ&lt;code>MSYS2&lt;/code> çš„ Bash ç¯å¢ƒä¸­ï¼Œå‡æºå¸¦æœ‰ &lt;code>file&lt;/code> å‘½ä»¤ã€‚&lt;/p>
&lt;p>æˆ‘æœ€å¼€å§‹å»äº†è§£æ–‡ä»¶ç±»å‹çš„æ£€æµ‹æ˜¯åœ¨å®ç° LFS æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒåŸºäº C++ ç¼–å†™çš„ LFS æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ &lt;code>libmagic&lt;/code>, libmagic å³ &lt;code>file&lt;/code> çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒåŸºäº &lt;code>Golang&lt;/code> ç¼–å†™çš„ LFS æœåŠ¡å™¨ä½¿ç”¨çš„åˆ™æ˜¯ &lt;a href="https://github.com/h2non/filetype">https://github.com/h2non/filetype&lt;/a>&lt;/p>
&lt;p>åœ¨é‡æ„å®Œ &lt;code>Privexec&lt;/code> ä¹‹åï¼Œçªç„¶æƒ³å†™ä¸€ä¸ªæ–‡ä»¶ç±»å‹æ£€æµ‹å·¥å…·ï¼Œæœ€å¼€å§‹å«åš &lt;code>FileView&lt;/code> åæ¥æ”¹åä¸º &lt;code>Planck&lt;/code>ï¼Œå½“ &lt;code>Planck&lt;/code> å¤§æ¦‚èƒ½ç”¨çš„æ—¶å€™ï¼Œæƒ³æŠŠä¸€äº›è§è§£åˆ†äº«ç»™å¤§å®¶ï¼Œäºæ˜¯æœ‰äº†æ­¤ç¯‡æ–‡ç« ã€‚&lt;/p>
&lt;h2 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†&lt;/h2>
&lt;h3 id="å­—èŠ‚åº">å­—èŠ‚åº&lt;/h3>
&lt;p>å­—èŠ‚åºï¼š&lt;a href="https://en.wikipedia.org/wiki/Endianness">Endianness&lt;/a>ï¼Œå­—èŠ‚é¡ºåºï¼Œåˆç§°ç«¯åºæˆ–å°¾åºï¼ˆè‹±è¯­ï¼šEndiannessï¼‰ï¼Œåœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸä¸­ï¼ŒæŒ‡å­˜å‚¨å™¨ä¸­æˆ–åœ¨æ•°å­—é€šä¿¡é“¾è·¯ä¸­ï¼Œç»„æˆå¤šå­—èŠ‚çš„å­—çš„å­—èŠ‚çš„æ’åˆ—é¡ºåºã€‚&lt;/p>
&lt;ul>
&lt;li>x86ã€MOS Technology 6502ã€Z80ã€VAXã€PDP-11ç­‰å¤„ç†å™¨ä¸ºå°ç«¯åºï¼›&lt;/li>
&lt;li>Motorola 6800ã€Motorola 68000ã€PowerPC 970ã€System/370ã€SPARCï¼ˆé™¤V9å¤–ï¼‰ç­‰å¤„ç†å™¨ä¸ºå¤§ç«¯åºï¼›&lt;/li>
&lt;li>ARMã€PowerPCï¼ˆé™¤PowerPC 970å¤–ï¼‰ã€DEC Alphaã€SPARC V9ã€MIPSã€PA-RISCåŠIA64çš„å­—èŠ‚åºæ˜¯å¯é…ç½®çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç½‘ç»œå­—èŠ‚åºä¸º &lt;code>Big Endian&lt;/code>ï¼Œç›®å‰ Windows x86, AMD64, ARM, ARM64 å‡ä¸º &lt;code>Little Endian&lt;/code>ã€‚&lt;/p>
&lt;p>Planck ä¸­å­—èŠ‚åºè½¬æ¢ä»£ç åœ¨ï¼š&lt;a href="https://github.com/fcharlie/Planck/blob/c6f677dda9a894de97f1f55639b90ff722c04a0d/include/endian.hpp">https://github.com/fcharlie/Planck/blob/c6f677dda9a894de97f1f55639b90ff722c04a0d/include/endian.hpp&lt;/a>ã€‚&lt;/p>
&lt;h3 id="æ–‡ä»¶åå…­è¿›åˆ¶æŸ¥çœ‹å·¥å…·">æ–‡ä»¶åå…­è¿›åˆ¶æŸ¥çœ‹å·¥å…·&lt;/h3>
&lt;p>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯å¯ä»¥ä½¿ç”¨æ”¯æŒ 16 è¿›åˆ¶çš„å·¥å…·æŸ¥çœ‹ï¼ŒGUI çš„å·¥å…·æœ‰ &lt;code>Sublime Text&lt;/code>ï¼Œ&lt;code>010Editor&lt;/code> ç­‰ï¼ŒCLI çš„å·¥å…·æœ‰ &lt;code>hexdump&lt;/code>ï¼Œ&lt;code>xxd&lt;/code>ï¼Œè¿˜æœ‰æœ€è¿‘å¸¦é¢œè‰²é«˜äº®çš„&lt;/p>
&lt;ul>
&lt;li>Hastyhex: &lt;a href="https://github.com/skeeto/hastyhex">https://github.com/skeeto/hastyhex&lt;/a>&lt;/li>
&lt;li>Hexyl: &lt;a href="https://github.com/sharkdp/hexyl">https://github.com/sharkdp/hexyl&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Hastyhex åŸºäº C ç¼–å†™ï¼Œä½†ä¸æ”¯æŒæŒ‡å®šé•¿åº¦ï¼Œå¯¹ Windows 10 æ§åˆ¶å°æ”¯æŒä¸å¤ªå¥½ï¼Œäºæ˜¯æˆ‘ fork Hastyhexï¼Œå¯¹å…¶æ”¹è¿›ï¼Œä½¿å…¶æ”¯æŒç‰¹å®šé•¿åº¦å’Œä»æŒ‡å®šä½ç½®å¼€å§‹è¯»å–ã€‚åœ¨ Windows ä¸Šæ”¹è¿›äº†æ§åˆ¶å°é¢œè‰²è¾“å‡ºã€‚&lt;/p>
&lt;p>Unix ç‰ˆæœ¬ï¼š&lt;a href="https://github.com/fcharlie/hastyhex">HastyHex : a faster hex dumper&lt;/a>&lt;br>
é’ˆå¯¹ Windows 10 æ§åˆ¶å°æ”¹è¿›çš„ç‰ˆæœ¬ï¼š&lt;a href="https://github.com/fcharlie/Planck/tree/c6f677dda9a894de97f1f55639b90ff722c04a0d/utils/hastyhex">https://github.com/fcharlie/Planck/tree/c6f677dda9a894de97f1f55639b90ff722c04a0d/utils/hastyhex&lt;/a>&lt;/p>
&lt;h2 id="æ–‡ä»¶ç¡¬é“¾æ¥è½¯è¿æ¥å¿«æ·æ–¹å¼">æ–‡ä»¶ï¼Œç¡¬é“¾æ¥ï¼Œè½¯è¿æ¥ï¼Œå¿«æ·æ–¹å¼&lt;/h2>
&lt;p>åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶é€šå¸¸æ˜¯å¸¸è§„æ–‡ä»¶ï¼Œä½†æ–‡ä»¶ä¹Ÿæœ‰å¯èƒ½æŒ‡å‘å…¶å®ƒæ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥">ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥&lt;/h3>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Hard_link">Hard Link&lt;/a> é€šå¸¸æ„å‘³ç€ä¸€ä¸ªåŸå§‹æ–‡ä»¶å¯èƒ½å­˜åœ¨æœ‰å¤šä¸ªæ–‡ä»¶åï¼Œæ¯”å¦‚ Linux ä¸€ä¸ª inode å¯¹åº”å¤šä¸ªè·¯å¾„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>In computing, a hard link is a directory entry that associates a name with a file on a file system. All directory-based file systems must have at least one hard link giving the original name for each file. The term â€œhard linkâ€ is usually only used in file systems that allow more than one hard link for the same file.&lt;/p>
&lt;/blockquote>
&lt;p>Windows NTFSï¼ŒUnix EXT4ï¼ŒZFSï¼ŒBtrfs ç­‰æ–‡ä»¶ç³»ç»Ÿå‡æ”¯æŒç¡¬é“¾æ¥ï¼ŒReFS æš‚æ—¶ä¸æ”¯æŒç¡¬é“¾æ¥ã€‚&lt;/p>
&lt;p>åœ¨ Windows ä¸­ï¼Œç¡¬é“¾æ¥è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯ &lt;a href="https://en.wikipedia.org/wiki/Side-by-side_assembly">Side-by-side assembly&lt;/a> æœºåˆ¶å¤§é‡ä½¿ç”¨äº†ç¡¬é“¾æ¥ ï¼ŒæŸ¥çœ‹ &lt;code>C:\Windows\System32&lt;/code> çš„æ–‡ä»¶ï¼ŒåŸºæœ¬éƒ½ä¼šæœ‰ç›¸åº”çš„ç¡¬é“¾æ¥å­˜åœ¨äº &lt;code>C:\Windows\WinSxS&lt;/code>ã€‚&lt;/p>
&lt;p>Git åœ¨å…‹éš†æœ¬åœ°å­˜å‚¨åº“æ—¶ï¼Œ&lt;code>objects&lt;/code> ç›®å½•çš„å¯¹è±¡æ–‡ä»¶ï¼ˆä¸»è¦æ˜¯ packï¼‰åˆ›å»ºçš„æ˜¯ç¡¬é“¾æ¥ã€‚è¿™æ ·é¿å…äº†å¤åˆ¶ï¼Œgit çš„&lt;strong>å¯¹è±¡&lt;/strong>æ–‡ä»¶åä¸å…¶å†…å®¹çš„ SHA1 ä¸€è‡´ï¼Œå½“æ–‡ä»¶å†…å®¹æ”¹å˜æ—¶ï¼Œæ–‡ä»¶åä¹Ÿä¼šæ”¹å˜ï¼Œgit ä¿®æ”¹å­˜å‚¨åº“ pack æ–‡ä»¶çš„æµç¨‹å®é™…ä¸Šæ˜¯ &lt;code>æ–°å»º&lt;/code>&amp;ndash;&lt;code>åˆ é™¤&lt;/code>ï¼Œå› æ­¤ï¼Œä½¿ç”¨ç¡¬é“¾æ¥ä¸ç”¨å½“å¿ƒäº’ç›¸ä¿®æ”¹ç ´åã€‚&lt;/p>
&lt;p>åœ¨ Windows ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>GetFileInformationByHandle&lt;/code>, &lt;code>FindFirstFileNameW&lt;/code>, &lt;code>FindNextFileNameW&lt;/code> ç»„åˆæŸ¥è¯¢æ–‡ä»¶æ‰€æœ‰çš„ç¡¬é“¾æ¥ã€‚
åœ¨ POSIX ç³»ç»Ÿä¸­ï¼ŒæŸ¥è¯¢ç¡¬é“¾æ¥éœ€è¦è§£æå¯¹åº”çš„ inodeï¼Œå¦‚æœ inode å€¼ç›¸åŒï¼Œåˆ™äº’ä¸ºç¡¬é“¾æ¥ã€‚&lt;code>struct stat&lt;/code> ç»“æ„ä¸­æœ‰ &lt;code>st_nlink&lt;/code> è¡¨ç¤ºæ­¤æ–‡ä»¶æœ‰å¤šå°‘ä¸ªç¡¬é“¾æ¥ã€‚&lt;/p>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Symbolic_link">Symbolic link&lt;/a> ç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰æ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œ å…¶åŒ…å«æœ‰ä¸€æ¡ä»¥ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„çš„å½¢å¼æŒ‡å‘å…¶å®ƒæ–‡ä»¶æˆ–è€…ç›®å½•çš„å¼•ç”¨ã€‚&lt;/p>
&lt;p>è½¯é“¾æ¥åœ¨ Unix ç³»ç»Ÿä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š&lt;code>ls -l /usr/bin&lt;/code> å¯ä»¥çœ‹åˆ°å¤§é‡çš„è½¯é“¾æ¥ã€‚&lt;/p>
&lt;p>æ—©æœŸç¬¦å·é“¾æ¥çš„å®ç°ï¼Œé‡‡ç”¨ç›´æ¥åˆ†é…ç£ç›˜ç©ºé—´æ¥å­˜å‚¨ç¬¦å·é“¾æ¥çš„ä¿¡æ¯ï¼Œè¿™ç§æœºåˆ¶ä¸æ™®é€šæ–‡ä»¶ä¸€è‡´ã€‚è¿™ç§ç¬¦å·é“¾æ¥æ–‡ä»¶é‡ŒåŒ…å«æœ‰ä¸€ä¸ªæŒ‡å‘ç›®æ ‡æ–‡ä»¶çš„æ–‡æœ¬å½¢å¼çš„å¼•ç”¨ï¼Œä»¥åŠä¸€ä¸ªæŒ‡ç¤ºè‡ªå·±ä¸ºç¬¦å·é“¾æ¥çš„æ ‡å¿—ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„å­˜å‚¨æ–¹å¼è¢«è¯æ˜æœ‰äº›ç¼“æ…¢ï¼Œå¹¶ä¸”æ—©ä¸€äº›å°å‹ç³»ç»Ÿä¸Šä¼šæµªè´¹ç£ç›˜ç©ºé—´ã€‚ä¸€ç§åä¸ºå¿«é€Ÿç¬¦å·é“¾æ¥çš„æ–°å‹å­˜å‚¨æ–¹å¼èƒ½å¤Ÿå°†æ–‡æœ¬å½¢å¼çš„é“¾æ¥å­˜å‚¨åœ¨ç”¨äºå­˜æ”¾æ–‡ä»¶ä¿¡æ¯çš„ç£ç›˜ä¸Šçš„æ ‡å‡†æ•°æ®ç»“æ„ä¹‹ä¸­ï¼ˆinodeï¼‰ã€‚ä¸ºäº†è¡¨ç¤ºåŒºåˆ«ï¼ŒåŸå…ˆçš„ç¬¦å·é“¾æ¥å­˜å‚¨æ–¹å¼ä¹Ÿè¢«ç§°ä½œæ…¢é€Ÿç¬¦å·é“¾æ¥ã€‚NTFS æ–‡ä»¶ç³»ç»Ÿçš„ç¬¦å·é“¾æ¥æ˜¯åŸºäº NTFS ReparsePoint åŠŸèƒ½å®ç°ã€‚&lt;/p>
&lt;p>åœ¨ POSIX ç³»ç»Ÿä¸­ï¼Œ&lt;code>readlink&lt;/code> å¯ä»¥è§£æç¬¦å·é“¾æ¥è·å¾—çœŸå®çš„ç›®æ ‡è·¯å¾„ï¼Œåœ¨ Windows ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code>GetFinalPathNameByHandleW&lt;/code> è·å¾—æ–‡ä»¶çœŸå®çš„è·¯å¾„ã€‚&lt;/p>
&lt;p>NTFS ç³»ç»Ÿè¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„é‡è§£æç‚¹ï¼ŒåŒ…æ‹¬ &lt;code>MountPoint&lt;/code>, ä¸ UWP å¿«æ·å‘½ä»¤ç›®æ ‡ç›¸å…³çš„ &lt;code>AppExecLink&lt;/code>, ä¸ Windows 10 Unix domain socket ç›¸å…³çš„ &lt;code>AF Unix&lt;/code>, ä¸ OneDrive ç›¸å…³çš„ &lt;code>OneDrive&lt;/code>, ä¸ Git VFSï¼ˆGVFSï¼‰ ç›¸å…³çš„ &lt;code>ProjFS&lt;/code>, ä»¥åŠä¸ WIM æŒ‚è½½ç›¸å…³çš„ &lt;code>WimImage&lt;/code> è¿˜æœ‰ &lt;a href="https://devblogs.microsoft.com/oldnewthing/20190618-00/?p=102597">WOF - Windows Overlay Filter&lt;/a> ç­‰ç­‰ã€‚Planck ä¸­å®ç°äº†å‡½æ•° &lt;a href="https://github.com/fcharlie/Planck/blob/a400828e62804b9c38c4e164e9f3efe559245e50/lib/inquisitive/resolve.cc#L82">&lt;code>ResolveTarget&lt;/code>&lt;/a> ç”¨äºåˆ†æé‡è§£æç‚¹ã€‚&lt;/p>
&lt;h3 id="å¿«æ·æ–¹å¼å’Œæ¡Œé¢æ–‡ä»¶">å¿«æ·æ–¹å¼å’Œæ¡Œé¢æ–‡ä»¶&lt;/h3>
&lt;p>åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œæ¡Œé¢å¿«æ·æ–¹å¼æ–‡ä»¶çš„åç¼€åä¸º &lt;code>.lnk&lt;/code>ï¼Œç”¨æˆ·åªéœ€è¦ç‚¹å‡»æ¡Œé¢ä¸Šçš„å¿«æ·æ–¹å¼å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œç½‘ç«™æˆ–è€…æ–‡ä»¶ã€‚å¿«æ·æ–¹å¼çš„æ ¼å¼åç§°å«åš &lt;code>Shell Link&lt;/code>ï¼Œæ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ï¼Œç›¸åº”çš„è§„èŒƒåœ¨ &lt;a href="https://msdn.microsoft.com/en-us/library/dd871305.aspx">[MS-SHLLINK]: Shell Link (.LNK) Binary File Format&lt;/a>ã€‚åœ¨ Planck ä¸­ï¼ŒShellLink çš„å®šä¹‰å’Œå®ç°åˆ†åˆ«æ˜¯ &lt;a href="https://github.com/fcharlie/Planck/blob/a400828e62804b9c38c4e164e9f3efe559245e50/lib/inquisitive/shl.hpp">lib/inquisitive/shl.hpp&lt;/a> å’Œ &lt;a href="https://github.com/fcharlie/Planck/blob/a400828e62804b9c38c4e164e9f3efe559245e50/lib/inquisitive/shl.cc">lib/inquisitive/shl.cc&lt;/a>ï¼Œç›®å‰åªæ”¯æŒè§£æ &lt;code>HasLinkInfo&lt;/code> ä»¥åŠ &lt;code>HasRelativePath&lt;/code> æ ‡å¿—çš„å¿«æ·æ–¹å¼ã€‚&lt;/p>
&lt;p>åœ¨ X-Window ç³»ç»Ÿä¸Šï¼Œä¹Ÿå­˜åœ¨ä¸€ç§ç±»ä¼¼æ¡Œé¢å¿«æ·æ–¹å¼çš„æ–‡ä»¶ï¼Œåç¼€åä¸º &lt;code>.desktop&lt;/code> ï¼Œå½“æ–‡ä»¶å±æ€§ä¸ºå¯æ‰§è¡Œæ—¶ï¼Œæ–‡ä»¶ç®¡ç†å™¨ä¼šè§£æ &lt;code>Icon&lt;/code>ï¼Œ&lt;code>Name&lt;/code> ç„¶åè¯»å–è®¾ç½®çš„å›¾æ ‡ï¼Œåç§°æ˜¾ç¤ºå‡ºæ¥ã€‚ä¸‹é¢æ˜¯æˆ‘ä½¿ç”¨çš„ Ubuntu ç³»ç»Ÿä¸Šçš„ &lt;code>wireshark.desktop&lt;/code> æ–‡ä»¶å†…å®¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#!/usr/bin/env xdg-open
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">[&lt;/span>Desktop Entry&lt;span style="color:#ff636f">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Name&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>Wireshark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Comment&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>Wireshark build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">GenericName&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>Demo Application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Exec&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>/opt/wireshark/bin/wireshark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Icon&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>wireshark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Type&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>Application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">StartupNotify&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Categories&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>GNOME;GTK;Development;Documentation;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">MimeType&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>text/plain;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ &lt;a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">&lt;code>Shebang&lt;/code>&lt;/a> å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ Ubuntu ä¸­ï¼Œ&lt;code>xdg-open&lt;/code> è‡ªèº«ä¸º &lt;code>Shell&lt;/code> è„šæœ¬ï¼ˆåœ¨MacOS Xä¸‹çš„Darwinä¸­ï¼Œè§£é‡Šå™¨æŒ‡å®šçš„æ–‡ä»¶å¿…é¡»æ˜¯å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”æœ¬èº«ä¸èƒ½æ˜¯è„šæœ¬ã€‚ï¼‰ï¼Œè™½ç„¶è¿™æ˜¯ä¸€ä¸ª &lt;code>Shebang&lt;/code> å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œåœ¨ Ubuntu ä¸­ï¼Œä½ æ— æ³•ç›´æ¥ä»å‘½ä»¤è¡Œä¸­ä½¿ç”¨ &lt;code>xdg-open&lt;/code> å¯åŠ¨ç›¸åº”çš„ç¨‹åºï¼Œè¿™æ˜¯ä¸€ä¸ªå­˜åœ¨äº†è¶…è¿‡ 9 å¹´çš„ BUG: &lt;a href="https://bugs.launchpad.net/ubuntu/+source/glib2.0/+bug/378783">xdg-open *.desktop opens text editor&lt;/a>&lt;/p>
&lt;h2 id="æ–‡æœ¬æ–‡ä»¶è¿˜æ˜¯äºŒè¿›åˆ¶">æ–‡æœ¬æ–‡ä»¶è¿˜æ˜¯äºŒè¿›åˆ¶&lt;/h2>
&lt;p>åœ¨è®¡ç®—æœºä¸­ï¼Œæ–‡æœ¬æ–‡ä»¶å®é™…ä¸Šæ”¯æŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€ç§ï¼Œè¿™ç§æ–‡ä»¶å‡ ä¹åªç”±å¯æ‰“å°å­—ç¬¦ï¼Œæ§åˆ¶å­—ç¬¦ç»„æˆï¼Œè€ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ™åŒ…å«å¤§é‡çš„ä¸å¯è§å­—ç¬¦ã€‚å¤„ç†ç¨‹åºå°†æŒ‰ç…§å®šä¹‰çš„äºŒè¿›åˆ¶æ ¼å¼å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œè§£æã€‚&lt;/p>
&lt;h3 id="å¿«é€ŸåŒºåˆ†æ–‡æœ¬äºŒè¿›åˆ¶">å¿«é€ŸåŒºåˆ†æ–‡æœ¬äºŒè¿›åˆ¶&lt;/h3>
&lt;p>æ–‡æœ¬æ–‡ä»¶è¿˜æ˜¯å¶å°”ä¼šæºå¸¦ä¸å¯è§å­—ç¬¦ï¼Œè¿™æ ·æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆéš¾ 100% åŒºåˆ†ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå®¹å¿ä¸€äº›è¯¯å·®ï¼Œ
ï¼Œåˆ™å¯ä»¥é€šè¿‡æ£€æµ‹æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ &lt;code>NUL&lt;/code> æ¥åŒºåˆ†æ–‡ä»¶æ˜¯æ–‡æœ¬æ–‡ä»¶è¿˜æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™ç§æ–¹æ³•çš„æ£€æµ‹è¿‡ç¨‹éå¸¸ç®€å•ï¼Œé€Ÿåº¦ä¹Ÿéå¸¸å¯è§‚ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè¢« &lt;code>git&lt;/code> ä½¿ç”¨ï¼Œç”¨äºåœ¨ diff è¿‡ç¨‹ä¸­åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯äºŒè¿›åˆ¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//https://github.com/git/git/blob/d166e6afe5f257217836ef24a73764eba390c58d/xdiff-interface.c#L188
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">buffer_is_binary&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">ptr&lt;/span>, &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">FIRST_FEW_BYTES&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">FIRST_FEW_BYTES&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">!!&lt;/span>&lt;span style="color:#58a1dd">memchr&lt;/span>(&lt;span style="color:#58a1dd">ptr&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">size&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ C è¯­è¨€çš„æ ‡å‡†åº“å‡½æ•° &lt;code>strlen&lt;/code> ä¸­ï¼Œå­—ç¬¦ä¸²çš„é•¿åº¦è®¡ç®—æ˜¯é€šè¿‡åˆ¤æ–­å­—ç¬¦æ˜¯å¦æ˜¯ &lt;a href="https://en.wikipedia.org/wiki/Null-terminated_string">Null-terminated string&lt;/a>ï¼Œè¿™å°±æ„å‘³ç€å¤§å¤šæ•°æ—¶å€™ï¼ŒASCII æ–‡æœ¬æ–‡ä»¶ä¸åº”è¯¥æœ‰ &lt;code>NUL&lt;/code>ï¼Œåœ¨ UTF-8 ä¸ ASCII å…¼å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶è¿™ç§è®¾è®¡ä¹Ÿé¥±å—æ‰¹è¯„ï¼š&lt;a href="http://queue.acm.org/detail.cfm?id=2010365">The Most Expensive One-byte Mistake&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">size_t&lt;/span> &lt;span style="color:#58a1dd">strlen&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">s&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">a&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (; &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">s&lt;/span>; &lt;span style="color:#58a1dd">s&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#58a1dd">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç¼–ç çš„æ–‡æœ¬">ç¼–ç çš„æ–‡æœ¬&lt;/h3>
&lt;p>ASCII ç¼–ç çš„èŒƒå›´æ˜¯ 0 ~127ï¼Œè¿™å°±æ„å‘³ç€åªèƒ½ç”¨äº &lt;code>A-Z;a-z;0-9,+-&lt;/code> æ•°å­—ï¼Œè‹±æ–‡å­—æ¯ä¸€äº›åŸºæœ¬ç¬¦å·æ§åˆ¶å­—ç¬¦ç­‰å°‘é‡çš„å­—ç¬¦ï¼Œå¦‚æœå­˜å‚¨éè‹±è¯­å›½å®¶çš„æ–‡å­—åŸºæœ¬ä¸Šæ˜¯ä¸ç°å®çš„ï¼Œå°±ç®—æŠŠ 128 ~ 255 å…¨éƒ¨ç”¨ä¸Šï¼Œåƒä¸­æ–‡è¿™ç§æœ‰å‡ åƒä¸Šä¸‡æ–‡å­—çš„è¯­è¨€æ˜¯æ— æ³•è¡¨ç¤ºçš„ã€‚ä¸ºäº†æ”¯æŒæ›´å¤šçš„æ–‡å­—ï¼Œåæ¥äººä»¬åˆ¶å®šäº†å›½é™…æ ‡å‡†åŒ–çš„ US4(UTF-32) US2(UTF-16)ï¼ŒUTF-8ï¼Œå›½å†…åˆ¶å®š GBKã€‚å½“ç¼–ç çš„ç§ç±»å¤šèµ·æ¥çš„æ—¶å€™ï¼Œé—®é¢˜åˆæ¥äº†ï¼Œå¦‚ä½•ç¡®å®šæ–‡ä»¶ç¼–ç ï¼Ÿ&lt;/p>
&lt;p>ä¾‹å¦‚ &lt;code>UTF-16&lt;/code>ï¼Œ&lt;code>UTF-32&lt;/code> è¿™æ ·çš„ç¼–ç ï¼Œç”±äºæ˜¯å¤šå­—èŠ‚çš„ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨å¤šå­—èŠ‚åºï¼Œé€šè¿‡æ£€æµ‹å¤šå­—èŠ‚åºå°±å¯ä»¥ç®€å•çš„è·å¾—æ–‡ä»¶ç¼–ç ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç¼–ç &lt;/th>
&lt;th>èµ·å§‹å­—ç¬¦&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>UTF-32 BE&lt;/td>
&lt;td>0x0,0x0,0xFE,0xFF&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTF-32 LE&lt;/td>
&lt;td>0xFF,0xFE,0x00,0x00&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTF-16 BE&lt;/td>
&lt;td>0xFE,0xFF&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTF-16 LE&lt;/td>
&lt;td>0xFF,0xFE&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTF-8 with BOM&lt;/td>
&lt;td>0xEF,0xBB,0xBF&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>UTF-8 æ˜¯ä¸€ç§å­—èŠ‚åºæ— å…³çš„å¯å˜å­—èŠ‚ç¼–ç ï¼ˆ1 ~ 4 å­—èŠ‚ï¼‰ï¼Œå› æ­¤ï¼Œä¸å¸¦å­—èŠ‚åºæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¹¶ä¸” ASCII ç¼–ç  0 ~ 127 å®Œå…¨æ˜¯ UTF-8 çš„å­é›†ï¼Œå¦‚æœä¸æºå¸¦å­—èŠ‚åºï¼Œåˆ™èƒ½å¤Ÿå¾ˆå¥½çš„å…¼å®¹ä»¥å‰çš„ ASCII æ–‡æœ¬ã€‚è¿™ä¹Ÿæ˜¯ UTF-8 åœ¨ Unix ç³»ç»Ÿä¸Šè¢«å¹¿æ³›ä½¿ç”¨çš„åŸå› ä¹‹ä¸€ã€‚è€Œ Windows è®°äº‹æœ¬é‡‡ç”¨ UTF-8 with BOM ä¹Ÿç”±äºä¸å…¼å®¹ ASCII è€Œå¹¿å—æ‰¹è¯„ã€‚&lt;/p>
&lt;p>Windows ç³»ç»Ÿæ˜¯ä¸€ä¸ªå›½é™…åŒ–åšçš„éå¸¸æ£’çš„æ“ä½œç³»ç»Ÿï¼Œå¯¹äºå„å›½çš„æœ¬åœ°å­—ç¬¦é›†æ”¯æŒä¹Ÿéå¸¸å¥½ï¼Œæ¯”å¦‚ï¼Œåœ¨ä¸­å›½å¤§é™†ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨çš„é»˜è®¤ç¼–ç æ˜¯ ANSIï¼Œæ˜¯ ASCII æ‰©å±•ç¼–ç ï¼Œ0 ~ 127 ç¼–ç ä¸ ASCII ç›¸åŒï¼Œ0x80 ~ 0xFFFF åˆ™è¡¨ç¤ºå¯¹åº”ä»£ç é¡µçš„æ‰€æœ‰ç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒANSI ç¼–ç çš„èŒƒå›´å°äº UTF-8ï¼Œå¹¶ä¸”ç»å¤§å¤šæ•° ANSI å­—ç¬¦çš„ç ç‚¹ç›¸åŒæ•°å­—çš„ UTF-8 ç ç‚¹éƒ½æ˜¯æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦ï¼Œå› æ­¤å¦‚æœè¦åŒºåˆ† &lt;code>UTF-8 without BOM&lt;/code> è¿˜æ˜¯ &lt;code>ANSI&lt;/code>ï¼Œå®é™…ä¸Šç›¸å½“éº»çƒ¦ã€‚&lt;/p>
&lt;p>æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦åŒºé—´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * legal utf-8 byte sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * http://www.unicode.org/versions/Unicode6.0.0/ch03.pdf - page 94
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * Code Points 1st 2s 3s 4s
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+0000..U+007F 00..7F
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+0080..U+07FF C2..DF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+0800..U+0FFF E0 A0..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+1000..U+CFFF E1..EC 80..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+D000..U+D7FF ED 80..9F 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+E000..U+FFFF EE..EF 80..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+10000..U+3FFFF F0 90..BF 80..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+40000..U+FFFFF F1..F3 80..BF 80..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> * U+100000..U+10FFFF F4 80..8F 80..BF 80..BF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> */&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦å¤–ï¼Œå¯¹äº ANSI è€Œè¨€ï¼Œä¸åŒå­—ç¬¦é›†çš„éƒ½é‡å¤ä½¿ç”¨ç€ 0x80 ~ 0xFFFF ç¼–ç åŒºé—´ï¼Œè¿™è¿›ä¸€æ­¥åŠ å¤§äº†æ–‡æœ¬å­—ç¬¦æ£€æµ‹çš„éš¾åº¦ã€‚&lt;/p>
&lt;p>æ–‡æœ¬ç¼–ç çš„æ£€æµ‹æœ‰ä¸¤ä¸ªæ¯”è¾ƒæµè¡Œçš„å®ç°ï¼Œä¸€ä¸ªæ˜¯ IE çš„ &lt;a href="https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa741022(v=vs.85)">IMultiLanguage&lt;/a>ï¼Œå¦ä¸€ä¸ªæ˜¯ Firefox çš„ &lt;a href="https://github.com/mozilla/gecko-dev/tree/52568d10660dfb0ce950f6983b20228374602efe/extensions/universalchardet/src/base">UniversalCharsetDetection&lt;/a>ï¼Œåè€…çš„å‡†ç¡®æ€§æ›´é«˜ï¼Œä½¿ç”¨æ›´åŠ å¹¿æ³›ï¼Œæ¯”å¦‚ &lt;code>Notepad++&lt;/code> å°±æ˜¯ä½¿ç”¨äº† &lt;code>universalchardet&lt;/code>ã€‚&lt;/p>
&lt;p>ç”¨æˆ·é€šå¸¸ä¸åº”ç›´æ¥ä½¿ç”¨ Mozilla ç›®å½•ä¸­çš„ &lt;code>Universalchardet&lt;/code>ï¼Œ&lt;code>Universalchardet&lt;/code> ä¸ Firefox æ•´åˆè¾ƒä¸ºç´§å¯†ï¼Œå‰¥ç¦»ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œæœ€è¿‘çš„ç‰ˆæœ¬åªæœ‰å¾ˆå°‘çš„å‡ ä¸ª &lt;code>LangModels&lt;/code> å®ç°ã€‚å¦‚æœè¦ä½¿ç”¨ &lt;code>Universalchardet&lt;/code>ï¼Œå¯ä»¥ä½¿ç”¨ Freedesktop ç»´æŠ¤çš„ï¼š&lt;a href="https://www.freedesktop.org/wiki/Software/uchardet/">uchardet&lt;/a>ï¼Œè¿™ä¸ªåº“åŸºäº &lt;code>Universalchardet&lt;/code> å‘å±•èµ·æ¥çš„ï¼Œèƒ½ç¼–è¯‘æˆåŠ¨æ€åº“æˆ–è€…é™æ€åº“ä¾›å¼€å‘è€…æ•´åˆåˆ°è‡ªå·±çš„ç¨‹åºä¹‹ä¸­ã€‚&lt;/p>
&lt;p>ä½† &lt;code>uchardet&lt;/code> çš„è®¸å¯è¯ä¸º &lt;code>MPL 1.1&lt;/code> ,&lt;code>GPL 2.0&lt;/code> &lt;code>LGPL 2.1&lt;/code>ï¼Œç¨‹åºåœ¨ä¾èµ– &lt;code>uchardet&lt;/code> æ—¶è¦è€ƒè™‘è®¸å¯è¯çš„é—®é¢˜ã€‚å¦‚æœä»…ä»…åªéœ€è¦åˆ¤æ–­æ–‡æœ¬æ˜¯å¦æ˜¯ UTF-8ï¼Œå¯ä»¥æŒ‰ç…§ä¸Šå›¾çš„ UTF-8 ç¼–ç åŒºé—´å¯¹æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Thanks
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/lemire/Code-used-on-Daniel-Lemire-s-blog/blob/master/2018/05/08/checkutf8.c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">uint8_t&lt;/span> &lt;span style="color:#58a1dd">utf8d&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// 00..1f
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// 20..3f
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// 40..5f
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// 60..7f
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#a6be9d">9&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// 80..9f
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#a6be9d">7&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// a0..bf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">8&lt;/span>, &lt;span style="color:#a6be9d">8&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// c0..df
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0xa&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x4&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// e0..ef
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0xb&lt;/span>, &lt;span style="color:#a6be9d">0x6&lt;/span>, &lt;span style="color:#a6be9d">0x6&lt;/span>, &lt;span style="color:#a6be9d">0x6&lt;/span>, &lt;span style="color:#a6be9d">0x5&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span> &lt;span style="color:#828b96;font-style:italic">// f0..ff
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">uint8_t&lt;/span> &lt;span style="color:#58a1dd">utf8d_transition&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">0x0&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x2&lt;/span>, &lt;span style="color:#a6be9d">0x3&lt;/span>, &lt;span style="color:#a6be9d">0x5&lt;/span>, &lt;span style="color:#a6be9d">0x8&lt;/span>, &lt;span style="color:#a6be9d">0x7&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x4&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0x6&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#a6be9d">0x1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// s0..s0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// s1..s2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// s3..s4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// s5..s6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">3&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// s7..s8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#58a1dd">updatestate&lt;/span>(&lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">state&lt;/span>, &lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#58a1dd">byte&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">utf8d&lt;/span>[&lt;span style="color:#58a1dd">byte&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">state&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">utf8d_transition&lt;/span>[&lt;span style="color:#a6be9d">16&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">state&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#58a1dd">type&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">state&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">validate_utf8&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">c&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">cu&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>)&lt;span style="color:#58a1dd">c&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#58a1dd">state&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uint32_t&lt;/span> &lt;span style="color:#58a1dd">byteval&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#ff636f">uint32_t&lt;/span>)&lt;span style="color:#58a1dd">cu&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">updatestate&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">state&lt;/span>, &lt;span style="color:#58a1dd">byteval&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">UTF8_REJECT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯æ‰§è¡Œæ–‡ä»¶">å¯æ‰§è¡Œæ–‡ä»¶&lt;/h2>
&lt;p>åœ¨è®¡ç®—æœºä¸­ï¼Œå¯æ‰§è¡Œæ–‡ä»¶æ˜¯éå¸¸ç‰¹æ®Šçš„å­˜åœ¨ï¼Œç°ä»£è®¡ç®—æœºçš„è¿è¡Œç¦»ä¸å¼€åº”ç”¨ç¨‹åºï¼Œè€Œåº”ç”¨ç¨‹åºåœ¨ç£ç›˜ä¸Šçš„å½¢å¼å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ç®€çŸ­çš„ä»‹ç»ï¼š&lt;/p>
&lt;blockquote>
&lt;p>å¯æ‰§è¡Œæ–‡ä»¶åœ¨è®¡ç®—æœºç§‘å­¦ä¸Šï¼ŒæŒ‡ä¸€ç§å†…å®¹å¯è¢«è®¡ç®—æœºè§£é‡Šä¸ºç¨‹åºçš„è®¡ç®—æœºæ–‡ä»¶ã€‚é€šå¸¸å¯æ‰§è¡Œæ–‡ä»¶å†…ï¼Œå«æœ‰ä»¥äºŒè¿›åˆ¶ç¼–ç çš„å¾®å¤„ç†å™¨æŒ‡ä»¤ï¼Œä¹Ÿå› æ­¤å¯æ‰§è¡Œæ–‡ä»¶æœ‰æ—¶ç§°ä¸ºäºŒè¿›åˆ¶æ¡£ã€‚è¿™äº›äºŒè¿›åˆ¶å¾®å¤„ç†å™¨æŒ‡ä»¤çš„ç¼–ç ï¼Œäºå„ç§å¾®å¤„ç†å™¨æœ‰æ‰€ä¸åŒï¼Œæ•…æ­¤å¯æ‰§è¡Œæ–‡ä»¶å¤šæ•°è¦åˆ†å¼€ä¸åŒçš„å¾®å¤„ç†ç‰ˆæœ¬ã€‚ä¸€ä¸ªè®¡ç®—æœºæ–‡ä»¶æ˜¯å¦ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦ç”±æ“ä½œç³»ç»Ÿçš„ä¼ ç»Ÿå†³å®šã€‚ä¾‹å¦‚æ ¹æ®ç‰¹å®šçš„å‘½åæ–¹æ³•ï¼ˆå¦‚æ‰©å±•åä¸ºexeï¼‰æˆ–æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆä¾‹å¦‚UNIXç³»ç»Ÿè®¾ç½®â€œå¯æ‰§è¡Œâ€æƒé™ï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼éå¸¸å¤šï¼Œä½†ç›®å‰åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„åªæœ‰ PE(PE32+)ï¼ŒELFï¼ŒMach-Oã€‚ä¸»è¦çš„æ“ä½œç³»ç»Ÿåˆ†åˆ«æ˜¯ Windowsï¼ŒLinuxï¼ŒmacOSã€‚&lt;/p>
&lt;h3 id="å¯æ‰§è¡Œæ–‡ä»¶çš„æ¯”è¾ƒ">å¯æ‰§è¡Œæ–‡ä»¶çš„æ¯”è¾ƒ&lt;/h3>
&lt;p>ä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç‰¹æ€§æœ‰ä¸€äº›ä¸åŒï¼Œç»´åŸºç™¾ç§‘ä¸Šæœ‰ä¸ªæ¯”è¾ƒï¼š&lt;a href="https://en.wikipedia.org/wiki/Comparison_of_executable_file_formats">Comparison of executable file formats&lt;/a>ã€‚&lt;/p>
&lt;p>æˆ‘è¿™é‡Œå°† PE(PE32+)ï¼ŒELFï¼ŒMach-O çš„æ ¼å¼æ¯”è¾ƒè´´å‡ºæ¥ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ ¼å¼å&lt;/th>
&lt;th>æ“ä½œç³»ç»Ÿ&lt;/th>
&lt;th>æ–‡ä»¶æ‰©å±•å&lt;/th>
&lt;th>æ˜¾å¼å¤„ç†å™¨å£°æ˜&lt;/th>
&lt;th>ä»»æ„èŠ‚ï¼ˆSectionsï¼‰&lt;/th>
&lt;th>å…ƒæ•°æ®&lt;/th>
&lt;th>ç­¾å&lt;/th>
&lt;th>å­—ç¬¦ä¸²è¡¨&lt;/th>
&lt;th>ç¬¦å·è¡¨&lt;/th>
&lt;th>64ä½&lt;/th>
&lt;th>èƒ–äºŒè¿›åˆ¶&lt;/th>
&lt;th>å¯ä»¥åŒ…å«å›¾æ ‡&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>PE&lt;/td>
&lt;td>Windows, ReactOSï¼ŒHX DOS Extenderï¼ŒBeOS (&amp;gt;=R3)&lt;/td>
&lt;td>.EXE&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âŒ&lt;/td>
&lt;td>âŒ&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PE32+&lt;/td>
&lt;td>Windows 64-bit&lt;/td>
&lt;td>.EXE&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ELF&lt;/td>
&lt;td>Unix-like, OpenVMS&lt;/td>
&lt;td>none&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>Extension&lt;/td>
&lt;td>Extension&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mach-O&lt;/td>
&lt;td>NeXTSTEPï¼ŒmacOS, iOS, watchOSï¼ŒtvOS&lt;/td>
&lt;td>none&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>&lt;code>&amp;lt;=256&lt;/code>&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âœ”&lt;/td>
&lt;td>âŒ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="pe">PE&lt;/h3>
&lt;p>PE æ˜¯ Windows NT ç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼ŒåŒæ ·è¿˜è¢« ReactOS ä½¿ç”¨ï¼ŒPE32+ æ˜¯ PE æ ¼å¼çš„ä¸€ç§æ”¹è¿›ï¼Œç”¨äºæ”¯æŒ 64ä½å¤„ç†å™¨ã€‚è¦æŸ¥çœ‹ PE æ–‡ä»¶æ ¼å¼å¯ä»¥æŸ¥çœ‹ï¼š&lt;a href="https://docs.microsoft.com/en-us/windows/desktop/Debug/pe-format">PE Format&lt;/a>ã€‚åœ¨ Windows SDK ä¸­ï¼Œ&lt;code>winnt.h&lt;/code> å·²ç»å®šä¹‰äº†å¤§é‡çš„ PE ç»“æ„ï¼Œä½†å¹¶ä¸å®Œæ•´ï¼Œå¦‚æœè¦è·å¾—æ›´åŠ å®Œæ•´çš„ç»“æ„ï¼Œéœ€è¦ä½¿ç”¨ Windows WDK çš„ &lt;code>ntimage.h&lt;/code>ï¼Œä½†ä¸€äº›æ–°çš„ç¡¬ä»¶å®šä¹‰éœ€è¦å» &lt;a href="https://docs.microsoft.com/en-us/windows/desktop/Debug/pe-format">PE Format&lt;/a> æŸ¥æ‰¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">/// #define PROCESSOR_ARCHITECTURE_ARM32_ON_WIN64 13
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_FILE_MACHINE_ARM64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">//// IMAGE_FILE_MACHINE_ARM64 is Windows
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_FILE_MACHINE_ARM64 0xAA64 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// ARM64 Little-Endian
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_FILE_MACHINE_RISCV32
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_FILE_MACHINE_RISCV32 0x5032
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_FILE_MACHINE_RISCV64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_FILE_MACHINE_RISCV64 0x5064
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_FILE_MACHINE_RISCV128
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_FILE_MACHINE_RISCV128 0x5128
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_FILE_MACHINE_CHPE_X86
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_FILE_MACHINE_CHPE_X86 0x3A64 &lt;/span>&lt;span style="color:#828b96;font-style:italic">/// defined in ntimage.h
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef IMAGE_SUBSYSTEM_XBOX_CODE_CATALOG
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_SUBSYSTEM_XBOX_CODE_CATALOG 17 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// XBOX Code Catalog
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>EXEï¼ŒDLL æ–‡ä»¶çš„é­”æ•°æ˜¯ &lt;code>{'M','Z',0x90,0x0}&lt;/code> è¿™å®é™…ä¸Šæ˜¯ &lt;code>IMAGE_DOS_HEADER.e_magic&lt;/code> çš„å€¼ï¼Œä¸åŒç³»ç»Ÿçš„ç­¾åå¹¶ä¸ä¸€æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef _MAC
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;#34;pshpack4.h&amp;#34;&lt;/span>&lt;span style="color:#828b96;font-style:italic"> &lt;/span>&lt;span style="color:#828b96;font-style:italic">// 4 byte packing is the default
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DOS_SIGNATURE 0x5A4D &lt;/span>&lt;span style="color:#828b96;font-style:italic">// MZ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_OS2_SIGNATURE 0x454E &lt;/span>&lt;span style="color:#828b96;font-style:italic">// NE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_OS2_SIGNATURE_LE 0x454C &lt;/span>&lt;span style="color:#828b96;font-style:italic">// LE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_VXD_SIGNATURE 0x454C &lt;/span>&lt;span style="color:#828b96;font-style:italic">// LE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_NT_SIGNATURE 0x00004550 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// PE00
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;#34;pshpack2.h&amp;#34;&lt;/span>&lt;span style="color:#828b96;font-style:italic"> &lt;/span>&lt;span style="color:#828b96;font-style:italic">// 16 bit headers are 2 byte packed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;#34;pshpack1.h&amp;#34;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DOS_SIGNATURE 0x4D5A &lt;/span>&lt;span style="color:#828b96;font-style:italic">// MZ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_OS2_SIGNATURE 0x4E45 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// NE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_OS2_SIGNATURE_LE 0x4C45 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// LE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_NT_SIGNATURE 0x50450000 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// PE00
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>PE æ ¼å¼çš„ &lt;code>IMAGE_NT_HEADERS&lt;/code> æ‰æ˜¯çœŸæ­£çš„ NT å¤´ï¼ŒDOS å¤´æˆ–è€… OS2 å¤´ï¼Œç›®å‰å­˜åœ¨çš„åŸå› æ˜¯ä¸ºäº†ä¿æŒå…¼å®¹ï¼Œæ¯•ç«Ÿ Windows æ“ä½œç³»ç»Ÿæ˜¯ä» 16 ä½è¿‡æ¥çš„ã€‚&lt;/p>
&lt;p>&lt;code>IMAGE_FILE_HEADER&lt;/code> ç»“æ„å­˜å‚¨äº†æœºå™¨æ¶æ„ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ç‰¹å¾å’Œå¯é€‰å¤´å¤§å°ç­‰ï¼Œè§£æåˆ° &lt;code>IMAGE_OPTIONAL_HEADER&lt;/code> æ‰ç®—æ­£å¼è§£æ PEã€‚IMAGE_OPTIONAL_HEADER32 ä¸ IMAGE_OPTIONAL_HEADER64 ä¸­çš„æˆå‘˜é¡ºåºæœ‰ä¸€äº›å·®åˆ«ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨ä»¥ 32ä½ IMAGE_OPTIONAL_HEADER è¯»å– 64 ä½ PE æ—¶ä¾ç„¶èƒ½å¤Ÿè§£æåˆ°åŸºæœ¬å­—æ®µï¼ˆåä¹‹ä¹Ÿæ˜¯ä¸€æ ·ï¼‰ã€‚è§£æ PE å¾ˆé‡è¦çš„ä¸€ä¸ªå‡½æ•°æ˜¯ &lt;a href="https://docs.microsoft.com/en-us/windows/desktop/api/dbghelp/nf-dbghelp-imagervatova">&lt;code>ImageRvaToVa&lt;/code>&lt;/a> åœ¨æ˜ å°„ä¸ºæ–‡ä»¶çš„æ–‡ä»¶çš„æ˜ åƒå¤´ä¸­æŸ¥æ‰¾ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼ˆRVAï¼‰ï¼Œå¹¶è¿”å›æ–‡ä»¶ä¸­ç›¸åº”å­—èŠ‚çš„è™šæ‹Ÿåœ°å€ã€‚&lt;/p>
&lt;p>è§£æ PE æ–‡ä»¶å¯¼å…¥å¯¼å‡ºï¼Œèµ„æºç­‰éœ€è¦è§£æå¯é€‰å¤´çš„ &lt;code>DataDirectory&lt;/code> æ•°ç»„ï¼Œæ•°ç»„çš„åºå·å¯¹åº”çš„æ—¶ä¸åŒçš„èµ„æºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_EXPORT 0 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Export Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_IMPORT 1 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Import Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_RESOURCE 2 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Resource Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_EXCEPTION 3 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Exception Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_SECURITY 4 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Security Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_BASERELOC 5 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Base Relocation Table
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_DEBUG 6 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Debug Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// IMAGE_DIRECTORY_ENTRY_COPYRIGHT 7 // (X86 usage)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE 7 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Architecture Specific Data
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR 8 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// RVA of GP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_TLS 9 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// TLS Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG 10 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Load Configuration Directory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT 11 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Bound Import Directory in headers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_IAT 12 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Import Address Table
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT 13 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// Delay Load Import Descriptors
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14 &lt;/span>&lt;span style="color:#828b96;font-style:italic">// COM Runtime descriptor
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§£æ PE æ–‡ä»¶ä¾èµ–éœ€è¦è§£æ &lt;code>IMAGE_DIRECTORY_ENTRY_IMPORT&lt;/code> ç›®å½•ï¼Œè€Œ &lt;code>IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR&lt;/code> å¯¹åº”çš„ 14 åœ¨ .Net ä¸­è¢«ä½¿ç”¨ï¼Œç”¨äºæŒ‡å‘ &lt;code>IMAGE_COR20_HEADER&lt;/code> ä¿¡æ¯ã€‚&lt;/p>
&lt;p>è§£æ PE æ–‡ä»¶çš„åº“éå¸¸å¤šï¼Œæœ‰è¢« &lt;a href="https://github.com/avast-tl/pelib">&lt;code>Avast Threat Labs&lt;/code>&lt;/a> ä½¿ç”¨çš„ &lt;code>pelib&lt;/code>ï¼ˆæ²¡é”™ï¼Œå°±æ˜¯é‚£ä¸ªæ€æ¯’è½¯ä»¶ Avastï¼‰ï¼Œè¿˜æœ‰ &lt;a href="https://github.com/hasherezade/bearparser">https://github.com/hasherezade/bearparser&lt;/a>ï¼Œ&lt;a href="https://github.com/lief-project/LIEF">https://github.com/lief-project/LIEF&lt;/a> ç­‰éå¸¸ä¼˜ç§€çš„å¼€æºåº“ã€‚åœ¨ .NET å¹³å°è¿˜æœ‰ &lt;a href="https://github.com/secana/PeNet">PeNet&lt;/a>ã€‚å…¶ä¸­ &lt;code>LIFF&lt;/code> è¿˜æ”¯æŒ ELFï¼ŒMach-Oï¼ŒARTï¼ŒOAT ç­‰æ ¼å¼ã€‚åœ¨ LLVM çš„æºç ä¸­ PE æ–‡ä»¶è§£æä»£ç åœ¨ &lt;a href="https://github.com/llvm/llvm-project/blob/master/llvm/lib/Object/COFFObjectFile.cpp">llvm/lib/Object/COFFObjectFile.cpp&lt;/a> æ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å…³äº PE æ–‡ä»¶æ ¼å¼åˆ†æçš„æ–‡ç« éå¸¸å¤šï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡æ¯”è¾ƒè¯¦ç»†çš„ï¼š&lt;a href="https://en.wikibooks.org/wiki/X86_Disassembly/Windows_Executable_Files">x86 Disassembly/Windows Executable Files&lt;/a>&lt;/p>
&lt;p>åˆ†æ PE çš„å·¥å…·éå¸¸å¤šï¼ŒWindows Internal 7th ä½œè€…ä¹‹ä¸€çš„ Pavel Yosifovich ä¹Ÿå¼€å‘äº†ä¸€ä¸ª &lt;a href="https://github.com/zodiacon/PEExplorer">Portable Executable Explorer&lt;/a>ã€‚&lt;/p>
&lt;p>Planck åˆ†æäº† &lt;a href="https://github.com/fcharlie/Planck/blob/master/lib/inquisitive/pe.cc">PE&lt;/a> æ–‡ä»¶çš„æœºå™¨ç±»å‹ï¼Œå­ç³»ç»Ÿï¼Œä¾èµ–ï¼Œç‰¹å¾ç­‰ã€‚åæ¥åˆ©ç”¨ Planck çš„æˆæœå°† &lt;a href="https://github.com/fcharlie/PEAnalyzer">PEAnalyzer&lt;/a> é‡æ„äº†ä¸€ç•ªï¼Œæˆªå›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/fcharlie/PEAnalyzer/raw/master/docs/images/view.png" alt="PEAnalyze">&lt;/p>
&lt;p>æˆ‘æœ‰æ—¶å€™éœ€è¦ä» &lt;code>MSYS2 Mingw64&lt;/code> ä¸­æå– &lt;code>wget.exe&lt;/code>ï¼Œç»å¸¸éœ€è¦æ‰‹åŠ¨æŸ¥çœ‹æ–‡ä»¶ä¾èµ–ï¼Œéå¸¸éº»çƒ¦ï¼Œå®ç° Planck PE è§£ææ¨¡å—åï¼Œäºæ˜¯ç¼–å†™äº† &lt;a href="https://github.com/fcharlie/nodeps">Nodeps&lt;/a> ç”¨äºå°† PE æ–‡ä»¶å°†åŒç›®å½•ä¸‹çš„æ‰€æœ‰ä¾èµ–æ‹·è´åˆ°ç›®æ ‡ç›®å½•ã€‚&lt;/p>
&lt;h3 id="elf">ELF&lt;/h3>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Executable and Linkable Format (ELF, formerly named Extensible Linking Format)&lt;/a> æ˜¯ä¸€ç§è¿ç”¨éå¸¸å¹¿æ³›çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œç›®å‰ Unix-like æ“ä½œç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ç»å¤§å¤šæ•°éƒ½æ˜¯ ELF ã€‚ELF çš„é­”æ•°æ˜¯ &lt;code>{0x7f,'E','L','F'}&lt;/code>ã€‚ELF è§£æåº“æœ‰å‰é¢çš„ &lt;a href="https://github.com/lief-project/LIEF">LIFF&lt;/a> è¿˜æœ‰è¢« &lt;code>Avast Threat Labs&lt;/code> ä½¿ç”¨çš„ &lt;a href="https://github.com/avast-tl/elfio">elfio&lt;/a> å®˜æ–¹ç‰ˆæœ¬åœ°å€æ˜¯ï¼š&lt;a href="https://github.com/serge1/ELFIO">https://github.com/serge1/ELFIO&lt;/a>&lt;/p>
&lt;p>ä¸ PE æ˜¾è‘—ä¸åŒçš„æ˜¯ï¼ŒELF æ–‡ä»¶å¯ä»¥æœ‰ &lt;code>SONAME&lt;/code> &lt;code>RPATH&lt;/code> &lt;code>RUPATH&lt;/code> è¿™æ ·çš„èŠ‚ã€‚é™¤äº†å¯æ‰§è¡Œæ–‡ä»¶ä¸»åŠ¨åŠ è½½ä¾èµ–åŠ¨æ€åº“ï¼Œæœ‰æ“ä½œç³»ç»Ÿæˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½å™¨è¢«åŠ¨åŠ è½½ä¾èµ–æ—¶ï¼ŒPE æ–‡ä»¶ä¾èµ– dll å¯ä»¥ä» PATH ä»¥åŠ PE æ–‡ä»¶æ‰€åœ¨ç›®å½•åŠ è½½ï¼Œè€Œ ELF åªèƒ½åŠ è½½ LD_LIBRARY_PATH ä»¥åŠ RPATH RUPATH æŒ‡å®šç›®å½•ä¸‹çš„åŠ¨æ€é“¾æ¥åº“ã€‚PE çš„æœºåˆ¶å®¹æ˜“å¸¦æ¥æ³¨å…¥é—®é¢˜ï¼Œè€Œ Windows æ“ä½œç³»ç»Ÿç›®å‰ä¹Ÿå¢åŠ äº† KnownDlls æœºåˆ¶å‡å°‘æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿã€‚è€Œ ELF çš„æœºåˆ¶åœ¨åˆ†å‘äºŒè¿›åˆ¶æ—¶å®¹æ˜“å¸¦æ¥ä¸€äº›éº»çƒ¦ï¼Œä½†ç›®å‰å¾ˆå¤šæ“ä½œç³»ç»Ÿå·²ç»æ”¯æŒ &lt;code>RUPATH=$ORIGIN/../lib&lt;/code> è¿™æ ·çš„æ–¹å¼è®¾ç½® &lt;code>RUPATH&lt;/code>ã€‚å¦å¤– ELF è®¡ç®—çœŸå®åœ°å€æ—¶ä¸åƒ Péœ€è¦ä½¿ç”¨ &lt;code>ImageRvaToVa&lt;/code> æ¢ç®—ï¼Œåœ¨ ELF æ–‡ä»¶çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å°†åç§»åœ°å€ä¸æ–‡ä»¶æ˜ å°„çš„èµ·å§‹åœ°å€ç›¸åŠ å³å¯å¾—åˆ°æ•°æ®åœ°å€ã€‚&lt;/p>
&lt;p>ELF ç¨‹åºåœ¨å®‰è£…çš„æ—¶å€™å¯ä»¥ä¸»åŠ¨ä¿®æ”¹ RPATH/RUPATHï¼Œcmake ä¹Ÿæ”¯æŒ &lt;code>CMAKE_INSTALL_RPATH&lt;/code> ç”¨äºè®¾ç½® &lt;code>RPATH/RUPATH&lt;/code>ã€‚RPATH å’Œ RUPATH çš„åŒºåˆ«æœ‰ç¯‡åšå®¢æœ‰ä»‹ç»ï¼š&lt;a href="https://blog.qt.io/blog/2011/10/28/rpath-and-runpath/">RPATH and RUNPATH&lt;/a>ï¼Œä¸åŒæ“ä½œç³»ç»Ÿé“¾æ¥å™¨çš„å¤„ç†ä¹Ÿç¨å¾®æœ‰ä¸€äº›å·®åˆ«ï¼Œå¤§å¤šæ•°æ—¶å€™åªè¦è®¾ç½®ä¸€ä¸ªå³å¯ã€‚&lt;/p>
&lt;p>æˆ‘å°† cmake ä¸­æ›¿æ¢ RPATH çš„åŠŸèƒ½æŠ½å‡ºæ¥ï¼Œåˆ›å»ºäº†é¡¹ç›®ï¼š &lt;a href="https://github.com/fcharlie/cmchrpath">cmchrpath&lt;/a>ï¼Œåœ¨ cmchrpath ä¸­è¿˜æœ‰ &lt;code>elfinfo&lt;/code> ç”¨äºæŸ¥çœ‹ ELF çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="mach-o">Mach-O&lt;/h3>
&lt;p>æˆ‘æ²¡æœ‰ä»»ä½• mac è®¾å¤‡ï¼Œå› æ­¤æ²¡æœ‰è¿›ä¸€æ­¥åˆ†æ Mach-O æ ¼å¼ï¼Œå®é™…ä¸Šå¾ˆå¤šå‰è¾ˆä»¬å†™äº†éå¸¸ä¸é”™çš„æ–‡ç« ï¼Œæ¯”å¦‚ï¼š&lt;a href="https://lowlevelbits.org/parsing-mach-o-files/">PARSING MACH-O FILES&lt;/a>ã€‚&lt;/p>
&lt;p>Mach-O ä¸€ä¸ªé²œæ˜çš„ç‰¹æ€§å°±æ˜¯å®ƒæ˜¯ä¸€ä¸ªæ”¯æŒ FatBinaryçš„æ ¼å¼ï¼ˆPE32+ å®é™…ä¸Šä¹Ÿæ”¯æŒï¼Œä½†ä½¿ç”¨è¾ƒå°‘ï¼‰ï¼Œè¿™æ„å‘³ç€ä¸åŒçš„å¤„ç†å™¨æ¶æ„æŒ‡ä»¤èƒ½å¤Ÿå­˜å‚¨åœ¨åŒä¸€æ–‡ä»¶å½“ä¸­ï¼Œåœ¨ Mac å°†å¤„ç†å™¨ä» PowerPC æ¶æ„è¿ç§»åˆ° Intel çš„è¿‡ç¨‹ä¸­è¿ç”¨éå¸¸å¹¿æ³›ã€‚&lt;/p>
&lt;p>åœ¨ Planck ä¸­ï¼ŒMach-O æ ¼å¼çš„å®šä¹‰ç›®å½•ä¸ºï¼š&lt;a href="https://github.com/fcharlie/Planck/blob/master/lib/inquisitive/macho.hpp">lib/inquisitive/macho.hpp&lt;/a>&lt;/p>
&lt;h3 id="å¯æ‰§è¡Œæ–‡ä»¶çš„è·¨å¹³å°">å¯æ‰§è¡Œæ–‡ä»¶çš„è·¨å¹³å°&lt;/h3>
&lt;p>ä¸Šè¿°é›†ä¸­å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼éƒ½æ”¯æŒè‹¥å¹²ä¸ªå¹³å°ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥è·¨å¹³å°ï¼Œå¯æ‰§è¡Œæ–‡ä»¶è·¨å¹³å°çš„ä¸»è¦é˜»ç¢æœ‰ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯æ“ä½œç³»ç»Ÿä¸åŒï¼ŒäºŒæ˜¯å¤„ç†å™¨æ¶æ„ä¸åŒã€‚&lt;/p>
&lt;p>æ“ä½œç³»ç»Ÿä¸åŒï¼Œé‡‡ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸åŒï¼Œæ¯”å¦‚ Windowsé‡‡ç”¨äº† PE/PE32+ï¼ŒLinux é‡‡ç”¨äº† ELFï¼ŒmacOS é‡‡ç”¨äº† Mach-Oï¼Œé™¤äº†å¯æ‰§è¡Œæ–‡ä»¶ä¸åŒä¹‹å¤–ï¼Œæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œç³»ç»Ÿè°ƒç”¨ç­‰ç­‰å‡ä¸ç›¸åŒã€‚è¿™å°±ç»™å¯æ‰§è¡Œæ–‡ä»¶è·¨å¹³å°å¸¦æ¥äº†é‡é‡é˜»éš”ã€‚è™½ç„¶å¯æ‰§è¡Œæ–‡ä»¶è·¨å¹³å°æ”¯æŒéå¸¸éº»çƒ¦ï¼Œä½†ç¡®å®æœ‰ä¸€äº›é¡¹ç›®åšåˆ°äº†åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šæ”¯æŒå¦ä¸€æ“ä½œç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¯¹äºä¸€äº›å¼€å‘è€…è€Œè¨€ï¼ŒWindows 10 æœ€æŒ¯å¥‹äººå¿ƒçš„åŠŸèƒ½è«è¿‡äºï¼š&lt;a href="https://docs.microsoft.com/en-us/windows/wsl/about">Windows Subsytem for Linux&lt;/a>ï¼Œwsl æ”¯æŒåœ¨ Windows ç³»ç»Ÿä¸Šè¿è¡Œæœªç»ä¿®æ”¹çš„ ELF æ–‡ä»¶ï¼ˆç›®å‰æ”¯æŒçš„æœ‰ Windows 64/ARM64 ç³»ç»Ÿï¼‰ã€‚WSL è¦åšåˆ°æ”¯æŒè¿è¡Œ ELF ï¼Œé¦–å…ˆå¾—å†…åŠ è½½ ELF åˆ°å†…å­˜ï¼Œç„¶åèƒ½åˆ›å»º Linux è¿›ç¨‹ï¼Œå†ç„¶åæ˜¯æ”¯æŒ Linux ç³»ç»Ÿè°ƒç”¨ï¼Œæ–‡ä»¶ç³»ç»Ÿä¹Ÿè¦å®ç° Linux ç‰¹æ€§ï¼ˆæ¯”å¦‚å¤§å°å†™æ•æ„Ÿï¼Œå¯æ‰§è¡Œæƒé™ç­‰ï¼‰ã€‚WSL åˆ›å»º Linux è¿›ç¨‹å®é™…ä¸Šä¾èµ–çš„æ˜¯ &lt;a href="https://blogs.msdn.microsoft.com/wsl/2016/05/23/pico-process-overview/">Pico process&lt;/a> ç‰¹æ€§ã€‚Linux è¿›ç¨‹å‘èµ·çš„ç³»ç»Ÿè°ƒç”¨ä¼šè¢«è½¬å˜ä¸º NT å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼š&lt;a href="https://blogs.msdn.microsoft.com/wsl/2016/06/08/wsl-system-calls/">WSL System Calls&lt;/a>ï¼Œç›®å‰ NTFS æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ”¯æŒäº† Linux æ–‡ä»¶ç³»ç»Ÿï¼ˆEXT4 Btrfsï¼‰çš„ä¸€äº›ç‰¹æ€§ï¼š&lt;a href="https://blogs.msdn.microsoft.com/wsl/2016/06/15/wsl-file-system-support/">WSL File System Support&lt;/a>ã€‚&lt;/p>
&lt;p>Github ä¸Šè¿˜æœ‰ä¸ª &lt;a href="https://github.com/wishstudio/flinux">Foreign LINUX&lt;/a> ä¸ WSL æ€è·¯ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨ Windows ç³»ç»Ÿä¸Šè¿è¡Œæœªä¿®æ”¹çš„ ELF æ–‡ä»¶ï¼Œä½†æˆç†Ÿåº¦éå¸¸ä½ã€‚WSL æ¨å‡ºåä¹Ÿå°±æ²¡æœ‰ç»´æŠ¤äº†ã€‚&lt;/p>
&lt;p>åœ¨ Linuxï¼ŒmacOSï¼ŒFreeBSD ç­‰æ“ä½œç³»ç»Ÿä¸Šä¹Ÿæœ‰ä¸ªé¡¹ç›®ç”¨äºæ”¯æŒåœ¨è¿™äº›å¹³å°è¿è¡Œ PE/PE32+ å¯æ‰§è¡Œæ–‡ä»¶ï¼š&lt;a href="https://www.winehq.org/">Wine: Wine Is Not an Emulator&lt;/a>ã€‚æ­¤é¡¹ç›®çš„å†å²æ¯” WSL æ›´ä¹…ï¼ŒåŸç†å¤§åŒå°å¼‚ã€‚å›½å†…çš„ Linux å‘è¡Œç‰ˆæ·±åº¦çš„æ‹›ç‰Œç‰¹æ€§å°±æ˜¯å’Œ Wine å®˜æ–¹åˆä½œï¼ŒåŒ…å«å•†ä¸šç‰ˆçš„ Wineï¼Œæ›´å¥½çš„è¿è¡Œ QQ ç­‰è½¯ä»¶ã€‚&lt;/p>
&lt;p>Github ä¸Šä¹Ÿæœ‰å¼€å‘è€…å®ç°äº†åœ¨ macOS ç³»ç»Ÿä¸Šè¿è¡Œ Linux ELF æ–‡ä»¶ï¼š &lt;a href="https://github.com/linux-noah/noah">Bash on Ubuntu on macOS&lt;/a>&lt;/p>
&lt;p>åœ¨ Linux ä¸ŠåŠ è½½è¿è¡Œ Mach-O çš„é¡¹ç›®æ˜¯ï¼š&lt;a href="https://github.com/shinh/maloader">Mach-o loader for linux&lt;/a>&lt;/p>
&lt;p>Github ä¸Šæœ‰ä¸ªé¡¹ç›®å« &lt;code>loadlibrary&lt;/code>: &lt;a href="https://github.com/taviso/loadlibrary">Porting Windows Dynamic Link Libraries to Linux&lt;/a>ï¼Œç”¨äºåœ¨ Linux ç³»ç»Ÿä¸Šç›´æ¥è°ƒç”¨ PE DLL åŠ¨æ€åº“ã€‚&lt;/p>
&lt;p>å¦‚æœæ“ä½œç³»ç»Ÿç›¸åŒï¼Œè€Œ CPU å¤„ç†å™¨æ¶æ„ä¸åŒï¼Œæ¯”å¦‚åœ¨ Windows ARM64 ç³»ç»Ÿä¸Šè¿è¡Œ x86 PEï¼Œè¿™éœ€è¦å®ç°æ¨¡æ‹Ÿå™¨è¿›è¡Œ CPU æŒ‡ä»¤è½¬æ¢ï¼Œå¹¶ä¸”å°† x86 çš„ NT è°ƒç”¨è½¬å˜ä½ ARM64 NT çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœå¤„ç†å™¨æ¶æ„ç›¸åŒï¼Œæ¯”å¦‚åœ¨ Windows AMD64 ç³»ç»Ÿä¸Šè¿è¡Œ x86 PEï¼Œåˆ™çœå»äº†CPU æŒ‡ä»¤è½¬æ¢è¿™ä¸€ç¯èŠ‚ï¼Œx86-64 å®Œå…¨å…¼å®¹ x86ã€‚&lt;/p>
&lt;h3 id="è‡ªè§£å‹æ–‡ä»¶å’Œå®‰è£…ç¨‹åº">è‡ªè§£å‹æ–‡ä»¶å’Œå®‰è£…ç¨‹åº&lt;/h3>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Self-extracting_archive">Self-extracting archive&lt;/a> æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œè‡ªè§£å‹æ–‡ä»¶æ—¶ï¼Œè‡ªè§£å‹æ–‡ä»¶å°†å‹ç¼©åŒ…è§£å‹åˆ°ç”¨æˆ·æŒ‡å®šç›®å½•ï¼Œè‡ªè§£å‹æ–‡ä»¶ä¸éœ€è¦å…¶ä»–çš„å‹ç¼©è½¯ä»¶å³å¯è¿è¡Œï¼Œå¹¶ä¸”è¿˜èƒ½æ‰§è¡Œä¸€äº›åˆ—çš„åŠ¨ä½œï¼Œåœ¨ Windows ç³»ç»Ÿä¸­é€šå¸¸è¢«ç”¨æ¥å®ç°è½¯ä»¶å®‰è£…ã€‚å¾ˆå¤šå®‰è£…ç¨‹åºå°±æ˜¯ä¸€ä¸ªè‡ªè§£å‹æ–‡ä»¶ï¼Œä½ å¦‚ NSIS å®‰è£…åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨ 7z è§£å‹ã€‚å¸¸è§çš„ 7z WinRAR å‡æ”¯æŒåˆ›å»ºè‡ªè§£å‹æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æœ‰äº›å®‰è£…ç¨‹åºå¹¶ä¸æ˜¯å¸¸è§„çš„è‡ªè§£å‹æ–‡ä»¶ï¼Œæ¯”å¦‚ &lt;code>InstallShield&lt;/code> åˆ¶ä½œçš„å®‰è£…ç¨‹åºï¼Œå®ƒä»¬å°† MSI Package å­˜å‚¨åœ¨ PE æ–‡ä»¶çš„èµ„æºç›®å½•ï¼Œè¿è¡Œæ—¶ç›´æ¥æå–ï¼Œç„¶åè°ƒç”¨ msiexec è¿›è¡Œå®‰è£…ã€‚&lt;/p>
&lt;p>è‡ªè§£å‹æ–‡ä»¶å’Œå®‰è£…ç¨‹åºï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªéå¸¸å¤§çš„ç¼ºç‚¹ï¼Œå³æ–‡ä»¶çš„å¤§å°ä¸èƒ½è¶…è¿‡ CPU å¯»å€é•¿åº¦ï¼Œæ¯”å¦‚ 32ä½ç³»ç»Ÿä¸èƒ½è¶…è¿‡ 4 GBã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿåœ¨è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œéœ€è¦å°†å¯æ‰§è¡Œæ–‡ä»¶ &lt;code>mmap&lt;/code> åˆ°å†…å­˜ï¼Œæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æœ€å¤§é•¿åº¦ã€‚&lt;/p>
&lt;p>åœ¨ Unix ç³»ç»Ÿä¸Šï¼Œå¾ˆå°‘æœ‰ä½¿ç”¨ ELF åˆ¶ä½œå®‰è£…åŒ…çš„ï¼Œé€šå¸¸ä½¿ç”¨ Shell Script æ¥åˆ¶ä½œ STGZ å®‰è£…åŒ…ï¼Œæ¯”å¦‚ cmake åœ¨ Unix ç³»ç»Ÿä¸­è¿è¡Œ cpack é»˜è®¤æ‰“åŒ…æ—¶ä¼šå°†æ¨¡å— &lt;a href="https://github.com/Kitware/CMake/blob/master/Modules/CPack.STGZ_Header.sh.in">CPack.STGZ_Header.sh.in&lt;/a> ä¸å‹ç¼©åŒ…åˆå¹¶åˆ¶ä½œæˆä¸€ä¸ª &lt;code>.sh&lt;/code> çš„å®‰è£…ç¨‹åºã€‚&lt;/p>
&lt;p>ä»è‡ªè§£å‹æ–‡ä»¶æˆ–è€…å®‰è£…åŒ…ä¸­æå–ç»¿è‰²è½¯ä»¶é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ 7z è§£å‹ã€‚è€Œ MSI çš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨ msiexec æå–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–çš„ MSI æå–å·¥å…· &lt;a href="https://github.com/fcharlie/Krycekium">Krycekium Installer&lt;/a> æå–ï¼Œmsiexec çš„å‘½ä»¤ä½¿ç”¨å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#https://github.com/fstudio/clangbuilder/blob/master/modules/Devi/Devi.psm1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">Function&lt;/span> &lt;span style="color:#58a1dd">Expand-Msi&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">param&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$Path&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$DestinationPath&lt;/span> &lt;span style="color:#828b96;font-style:italic">### Full dir of destination path&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$process&lt;/span> = &lt;span style="color:#58a1dd">Start-Process&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;msiexec&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-ArgumentList&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;/a &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Path&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> /qn TARGETDIR=&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$DestinationPath&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-PassThru&lt;/span> &lt;span style="color:#58a1dd">-Wait&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$process&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Expand-Msi: &lt;/span>&lt;span style="color:#58a1dd">$Path&lt;/span>&lt;span style="color:#a6be9d"> failed. &lt;/span>$(&lt;span style="color:#58a1dd">$process&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span>)&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$process&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸºäº InnoSetup åˆ¶ä½œçš„å®‰è£…åŒ…å¯ä»¥ä½¿ç”¨ &lt;a href="https://sourceforge.net/projects/innounp/">Inno Setup Unpacker&lt;/a> æˆ–è€…æ˜¯ &lt;a href="https://github.com/dscharrer/innoextract/">innoextract&lt;/a> æå–ã€‚&lt;/p>
&lt;h2 id="æ–‡æ¡£æ ¼å¼">æ–‡æ¡£æ ¼å¼&lt;/h2>
&lt;p>ç°ä»£è®¡ç®—æœºéå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æ–‡æ¡£å¤„ç†ï¼Œç‰¹åˆ«æ˜¯åŠå…¬å®¤ç™½é¢†ï¼Œæ°‘å·¥ç»å¸¸éœ€è¦æ¥è§¦åˆ°æ–‡æ¡£å¤„ç†è½¯ä»¶ï¼Œæ¯”å¦‚åšæ¼”ç¤ºè¦å†™ PPTï¼Œæ±‚èŒç®€å†è¦ç”¨ WORDï¼ŒæŸ¥çœ‹æŠ€æœ¯æ–‡æ¡£éœ€è¦ PDF é˜…è¯»å™¨ç­‰ç­‰ã€‚&lt;/p>
&lt;p>æ–‡æ¡£æ ¼å¼æœ‰éå¸¸å¤šçš„ç§ç±»ï¼Œæœ‰å¯Œæ–‡æœ¬æ ¼å¼ RTFï¼ŒOLE æ–‡æ¡£æ ¼å¼ &lt;code>Microsoft Word .doc&lt;/code>ï¼Œæœ‰ä¾¿æºå¼æ–‡æ¡£æ ¼å¼ PDFï¼Œæœ‰ Office Open XML (.docx) ç­‰ç­‰ã€‚&lt;/p>
&lt;p>RTF çš„æ ¼å¼æ˜¯ä¸€ç§æ–‡æœ¬æ ¼å¼ï¼Œç”±æ§åˆ¶å­—ç¬¦ä¸²å’Œæ–‡æ¡£å†…å®¹ç»„æˆï¼ŒRTF çš„æ ¼å¼è§„èŒƒä¸‹è½½åœ°å€ä¸ºï¼š&lt;a href="https://www.microsoft.com/en-us/download/details.aspx?id=10725">Word 2007: Rich Text Format (RTF) Specification, version 1.9.1&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªç©º RTF æ–‡æ¡£å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>{\rtf1}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>RTF å®é™…ä¸Šè¡¨ç°åŠ›åº¦æœ‰é™ï¼Œåœ¨ 2007 å¹´ä¹‹å‰ï¼ŒMicrosoft Word ä¼˜å…ˆæ”¯æŒçš„æ ¼å¼æ˜¯äºŒè¿›åˆ¶ word æ ¼å¼ï¼Œè¿™æ˜¯ä¸€ç§ OLE æµæ ¼å¼ï¼Œç›¸å…³çš„è§„èŒƒå¯ä»¥è®¿é—®ï¼š&lt;a href="https://docs.microsoft.com/zh-cn/previous-versions/office/gg615596(v=office.14)">äº†è§£ Word MS-DOC äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼&lt;/a>ã€‚å®é™…ä¸Šæ— è®ºæ˜¯ &lt;code>.doc&lt;/code> è¿˜æ˜¯ &lt;code>.xls&lt;/code> ä»¥åŠ &lt;code>.ppt&lt;/code>ï¼Œä¸‰ç§æ–‡ä»¶æ ¼å¼å®é™…ä¸Šéƒ½æ˜¯äºŒè¿›åˆ¶æ–‡æ¡£æ ¼å¼ä¸‹çš„ç‰¹æ®Šå®ç°ï¼ŒåŸºæœ¬ä¸Šæ— æ³•åªæ£€æµ‹ Magic å°±åˆ¤æ–­æ–‡ä»¶åˆ°åº•æ˜¯å“ªä¸€ä¸ªç±»å‹ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ£€æµ‹ã€‚&lt;/p>
&lt;p>PDF æ–‡æ¡£è¢«ç”¨æ¥ä¼ æ’­å±…å¤šï¼Œå¤§å¤šæ•°æ—¶å€™äººä»¬ä½¿ç”¨å…¶ä»–å·¥å…·æˆ–è€…è¯­è¨€ç¼–å†™æ–‡æ¡£ï¼Œç„¶åç”Ÿæˆ PDF æ–‡æ¡£å¹¶å‘å¸ƒåˆ°äº’è”ç½‘ï¼ŒPDF æ–‡æ¡£æ ¼å¼ç±»ä¼¼ RTFï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ä¸²+æ–‡æ¡£å†…å®¹çš„æ ¼å¼ï¼Œæ–‡æ¡£ä»¥ &lt;code>%PDF-$version&lt;/code> å¼€å¤´ã€‚&lt;/p>
&lt;p>åœ¨ Microsoft Office 2007 ä¸­ï¼Œå¾®è½¯å°† Office çš„é»˜è®¤æ–‡æ¡£æ ¼å¼åˆ‡æ¢åˆ° &lt;code>Office Open XML&lt;/code>ï¼Œè¿™ç§æ ¼å¼ä½¿ç”¨ xml ä½œä¸ºæè¿°è¯­è¨€ï¼Œå°†å›¾ç‰‡æ–‡æ¡£ï¼Œä¸»é¢˜ç­‰å•ç‹¬å­˜å‚¨åœ¨ç‰¹å®šç›®å½•ï¼Œæœ€åå°†æ–‡æ¡£ç›®å½•ä½¿ç”¨ Zip å‹ç¼©èµ·æ¥ï¼Œè¿™ç§æ ¼å¼çš„ä¼˜ç‚¹æ˜¯æ ¼å¼è§£ææ›´ç®€å•ï¼Œå‹ç¼©åçš„æ–‡æ¡£ä½“ç§¯æ›´å°ã€‚è¦æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ PPTX DOCX XLSX åªéœ€è¦åœ¨æ£€æµ‹æ–‡ä»¶æ˜¯ Zip æ–‡ä»¶çš„å‰æä¸‹ï¼Œåˆ¤æ–­ Zip å‹ç¼©åŒ…çš„ç›®å½•ç»“æ„æ˜¯å¦ç”±ç‰¹æ®Šçš„æ–‡ä»¶åã€‚å¯ä»¥å‚è€ƒ Planck å®ç°ï¼š &lt;a href="https://github.com/fcharlie/Planck/blob/master/lib/inquisitive/zip.cc">lib/inquisitive/zip.cc&lt;/a>&lt;/p>
&lt;h2 id="æ–‡ä»¶çš„å‹ç¼©">æ–‡ä»¶çš„å‹ç¼©&lt;/h2>
&lt;p>å°†æ–‡ä»¶é€šè¿‡å‹ç¼©ç®—æ³•å‡å°å­˜å‚¨æˆ–ä¼ è¾“çš„ä½“ç§¯è¿™æ˜¯å‹ç¼©è½¯ä»¶ä¸»è¦çš„åˆè¡·ã€‚å‹ç¼©è½¯ä»¶æ—¢è¦æ”¯æŒå°†ä¸åŒçš„æ–‡ä»¶å½’æ¡£åˆ°åŒä¸€æ–‡ä»¶è¿˜è¦å°†æ–‡ä»¶å‹ç¼©ï¼Œ
å¸¸è§çš„å‹ç¼©æ–‡ä»¶æ ¼å¼æœ‰ &lt;code>.zip&lt;/code>ï¼Œ&lt;code>.7z&lt;/code>ï¼Œ&lt;code>.rar&lt;/code>ï¼Œ&lt;code>.tar.gz&lt;/code>ï¼Œé™¤äº† &lt;code>tar.*&lt;/code> æ ¼å¼ä¹‹å¤–ï¼Œå…¶ä»–å‹ç¼©æ ¼å¼å¤§å¤šæ˜¯è‡ªæœ‰çš„å½’æ¡£æœºåˆ¶ï¼Œé€šå¸¸å‹ç¼©å’Œå½’æ¡£åˆå¹¶åœ¨ä¸€èµ·ï¼Œè€Œå¯¹äº &lt;code>tar.*&lt;/code> è€Œè¨€ï¼Œå…ˆä½¿ç”¨ tar å°†æ–‡ä»¶å½’æ¡£ï¼Œç„¶åå†ä½¿ç”¨ç‰¹å®šçš„å‹ç¼©ç®—æ³•å°†å…¶å‹ç¼©ã€‚ä¸åŒçš„æ–‡ä»¶æ ¼å¼æ”¯æŒçš„å‹ç¼©ç®—æ³•ä¸åŒï¼Œé€šå¸¸å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Format&lt;/th>
&lt;th>Compression methods&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>zip&lt;/td>
&lt;td>Deflate&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>7z&lt;/td>
&lt;td>LZMA, LZMA2, Bzip2, PPMd, Deflate, Zstd, Brotli&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rar&lt;/td>
&lt;td>PPMII&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.gz&lt;/td>
&lt;td>Deflate&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.bz2&lt;/td>
&lt;td>Bzip2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.xz&lt;/td>
&lt;td>LZMA/LZMA2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æœ‰å…³å‹ç¼©è½¯ä»¶çš„æ¯”è¾ƒå¯ä»¥å‚è€ƒï¼š&lt;a href="https://en.wikipedia.org/wiki/Comparison_of_file_archivers">Comparison of file archivers&lt;/a>&lt;/p>
&lt;h3 id="zip-æ–‡ä»¶æ ¼å¼">Zip æ–‡ä»¶æ ¼å¼&lt;/h3>
&lt;p>Zip æ˜¯ä¸€ç§æ¯”è¾ƒæ‚ ä¹…çš„å‹ç¼©æ–‡ä»¶æ ¼å¼ï¼Œæ–‡ä»¶å¤´ä¸º &lt;code>{'P','K'}&lt;/code>ï¼Œè¿™æ˜¯ä»¥ &lt;a href="https://en.wikipedia.org/wiki/Phil_Katz">Phil Katz&lt;/a> çš„åå­—ç¼©å†™å¼€å¤´ï¼Œåœ¨ Windows ç³»ç»Ÿä¸Šï¼Œèµ„æºç®¡ç†å™¨é»˜è®¤æ”¯æŒæ‰“å¼€ Zip æ–‡ä»¶ï¼Œåœ¨ Unix ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ unzip å‘½ä»¤è§£å‹ zip æ–‡ä»¶ï¼Œzip æ ¼å¼è¿˜è¢«ç”¨äºå…¶ä»–æ–‡ä»¶æ ¼å¼ä½œä¸ºå®¹å™¨æ ¼å¼ï¼Œå¦‚
&lt;code>Office Open XML&lt;/code>ï¼Œ&lt;code>OpenDocument&lt;/code>ï¼Œ&lt;code>EPUB&lt;/code>ï¼Œè¿˜æœ‰ Windows UWP appx ç­‰å‡ä½¿ç”¨äº† zip æ ¼å¼ã€‚&lt;/p>
&lt;p>Zip æ ¼å¼æ•°æ®å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://upload.wikimedia.org/wikipedia/commons/6/63/ZIP-64_Internal_Layout.svg" alt="ZIP-64_Internal_Layout">&lt;/p>
&lt;p>Zip é€šå¸¸ä½¿ç”¨ &lt;code>Deflate&lt;/code> å‹ç¼©ç®—æ³•ï¼Œè§£æ Zip æ–‡ä»¶å¯ä»¥ä½¿ç”¨ &lt;a href="https://github.com/madler/zlib/tree/master/contrib/minizip">&lt;code>zlib: contrib/minizip&lt;/code>&lt;/a>ã€‚zlib åº“è¢«éå¸¸å¤šçš„è½¯ä»¶ä½¿ç”¨ï¼Œæ¯”å¦‚ git ä»¥åŠ libgit2 éƒ½ä¾èµ– zlibï¼ˆgit çš„å¯¹è±¡å‹ç¼©ç®—æ³•å°±æ˜¯ Deflateï¼‰ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æ–‡ä»¶æ ¼å¼ç§ç±»ç¹å¤šï¼Œä¸€ä¸€ç ”ç©¶ä¹Ÿååˆ†åƒåŠ›ï¼ŒæŒæ¡æ–‡ä»¶çš„æ ¼å¼è§„å¾‹ï¼Œä¸å¤±ä¸ºä¸€æ¡æ·å¾„ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-01-25-file-parsing/ - Copyright (c) 2009-2024 J23</description></item><item><title>Privexec æ‚è°ˆ</title><link>https://forcemz.net/posts/2018/2018-11-30-privexec-new/</link><pubDate>Fri, 30 Nov 2018 21:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2018/2018-11-30-privexec-new/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2018/2018-11-30-privexec-new/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>æœ¬ç«™çš„å¼€ç¯‡å°±æ˜¯è®²çš„ &lt;a href="https://forcemz.net/container/2015/06/12/AppContainer/">ã€ŠWindows AppContainer é™æƒï¼Œéš”ç¦»ä¸å®‰å…¨ã€‹&lt;/a>ï¼Œä¸€æ™ƒä¸‰å¹´å¤šè¿‡å»äº†ï¼Œè¿™ä¸‰å¹´ä¹‹ä¸­ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ª &lt;a href="https://github.com/M2Team/Privexec">Privexec&lt;/a>ï¼Œä¸€ä¸ªä»¥å…¶ä»–æƒé™å¯åŠ¨è¿›ç¨‹çš„å·¥å…·ï¼Œæ”¯æŒå¯åŠ¨ &lt;code>AppContainer&lt;/code> è¿›ç¨‹ï¼Œå‰æ®µå®ç°æœ‰ç”¨æˆ·å‘èµ·äº†åŠŸèƒ½è¯·æ±‚&lt;sup>1&lt;/sup>ï¼Œè®© &lt;code>Privexec&lt;/code> æ”¯æŒè®¾ç½® &lt;code>AppContainer&lt;/code> çš„ &lt;code>Capabilities&lt;/code>ï¼Œè€Œä¸æ˜¯åƒä»¥å‰ä¸€æ ·åœ¨å¯åŠ¨ &lt;code>AppContainer&lt;/code> è¿›ç¨‹æ—¶ä½¿ç”¨ &lt;code>CreateWellKnownSid&lt;/code> åˆ›å»ºæ‰€æœ‰çš„ä¸ &lt;code>AppContainer&lt;/code> ç›¸å…³çš„ &lt;code>Capabilities SIDs&lt;/code>ã€‚äºæ˜¯ä¹ï¼Œæˆ‘å°±èŠ±äº†ä¸€ç‚¹æ—¶é—´å°† Privexec é‡æ„äº†ä¸€ç•ªï¼Œæœ‰æ‰€æ„Ÿæ‚Ÿï¼Œä¾¿å°†å…¶å†™ä¸‹æ¥ã€‚&lt;/p>
&lt;h2 id="process">Process&lt;/h2>
&lt;p>åœ¨ Windows å¹³å°ä¸Šï¼Œåˆ›å»ºè¿›ç¨‹æœ‰ &lt;code>WinExec&lt;/code>ï¼Œ&lt;code>system&lt;/code>ï¼Œ&lt;code>_spawn/_wspawn&lt;/code>ï¼Œ&lt;code>CreateProcess&lt;/code>ï¼Œ&lt;code>ShellExecute&lt;/code> ç­‰å¤šç§é€”å¾„ï¼Œä½†ä¸Šè¿°å‡½æ•°åŸºæœ¬ä¸Šè¿˜æ˜¯ç”± &lt;code>CreateProcess Family&lt;/code> å°è£…çš„ã€‚åœ¨ Windows ä½¿ç”¨ &lt;code>C/C++&lt;/code> åˆ›å»ºè¿›ç¨‹åº”å½“ä¼˜å…ˆä½¿ç”¨ &lt;code>CreateProcess&lt;/code>ï¼ŒCreateProcess æœ‰ä¸‰ä¸ªå˜ä½“ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒä»¥å…¶ä»–æƒé™å¯åŠ¨è¿›ç¨‹ï¼Œ CreateProcess åŠå…¶å˜ä½“å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Feature&lt;/th>
&lt;th>Details&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>CreateProcessW/A&lt;/td>
&lt;td>åˆ›å»ºå¸¸è§„è¿›ç¨‹ï¼Œæƒé™ç»§æ‰¿çˆ¶è¿›ç¨‹æƒé™&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CreateProcessAsUserW/A&lt;/td>
&lt;td>ä½¿ç”¨ä¸» Token åˆ›å»ºè¿›ç¨‹ï¼Œå­è¿›ç¨‹æƒé™ä¸ Token é™å®šä¸€è‡´&lt;/td>
&lt;td>å¿…é¡»å¼€å¯ &lt;code>SE_INCREASE_QUOTA_NAME&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CreateProcessWithTokenW&lt;/td>
&lt;td>ä½¿ç”¨ä¸» Token åˆ›å»ºè¿›ç¨‹ï¼Œå­è¿›ç¨‹æƒé™ä¸ Token é™å®šä¸€è‡´&lt;/td>
&lt;td>å¿…é¡»å¼€å¯ &lt;code>SE_IMPERSONATE_NAME&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CreateProcessWithLogonW/A&lt;/td>
&lt;td>ä½¿ç”¨æŒ‡å®šç”¨æˆ·å‡­æ®å¯åŠ¨è¿›ç¨‹&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;code>CreateProcessWithLogonW&lt;/code> ä½¿ç”¨ç”¨æˆ·å‡­æ®è·å¾—ç”¨æˆ·ä»¤ç‰Œï¼Œç„¶åå¯åŠ¨è¿›ç¨‹ï¼Œè¿™ç­‰ä»·äºä½¿ç”¨ &lt;code>LogonUser&lt;/code> +&lt;code>CreateProcessAsUser&lt;/code> å¯åŠ¨è¿›ç¨‹ã€‚&lt;/p>
&lt;p>&lt;code>CreateProcessWithTokenW&lt;/code> æ˜¯ &lt;code>Windows Vista&lt;/code> æ‰å¼•å…¥æ¡Œé¢ç³»ç»Ÿçš„ï¼Œæ²¡æœ‰ ANSI ç‰ˆæœ¬ï¼ŒGithub ä¸Šæœ€å¸¸è§çš„ç”¨æ³•æ˜¯æ‰“å¼€æ¡Œé¢è¿›ç¨‹ï¼Œè·å–å…¶ Tokenï¼Œç„¶åæ‹·è´è¿™ä¸ª Token åˆ›å»ºä¸æ¡Œé¢æƒé™ä¸€è‡´çš„è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸€ç§é™æƒæœºåˆ¶ï¼Œä»…å½“å½“å‰ç™»å½•ç”¨æˆ·æ˜¯æ ‡å‡†ç”¨æˆ·æ‰èƒ½é™æƒæˆåŠŸã€‚
&lt;code>CreateProcessWithTokenW&lt;/code> å†…éƒ¨åœ¨è°ƒç”¨å¥½å‡ ä¸ªå‡½æ•°ä¹‹åæ‰ä¼šè°ƒç”¨ &lt;code>CreateProcessAsUserW&lt;/code>ï¼Œåœ¨ &lt;code>Privexec&lt;/code> ä¸­å¹¶æœªä½¿ç”¨å®ƒã€‚
åœ¨ &lt;code>ReactOS&lt;/code> ä¸­ï¼Œæ²¡æœ‰å®ç° &lt;code>CreateProcessWithTokenW&lt;/code>ï¼Œä¸‹é¢é™„ä¸Š &lt;code>CreateProcessWithTokenW&lt;/code> è°ƒç”¨å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/62693095-6645d980-ba04-11e9-92bf-53fb526d11e9.png" alt="CreateProcessWithTokenW">
&lt;img src="https://user-images.githubusercontent.com/6904176/62693086-62b25280-ba04-11e9-84ee-d0ec5786bed3.png" alt="CreateProcessWithTokenW">&lt;/p>
&lt;p>å®é™…ä¸Šåœ¨ &lt;code>ReactOS&lt;/code> ä¸­ï¼Œ&lt;code>CreateProcessAsUser&lt;/code> æœ€ç»ˆä¾ç„¶è°ƒç”¨çš„æ˜¯ &lt;code>CreateProcess&lt;/code> åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åå°†è¿›ç¨‹æŒ‚èµ·ï¼Œè®¾ç½®å¥½ &lt;code>Token&lt;/code> åå†æ¢å¤è¿›ç¨‹ã€‚åœ¨ Windows ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>Process Monitor&lt;/code> è·Ÿè¸ª &lt;code>CreateProcessAsUser&lt;/code> çš„è°ƒç”¨å †æ ˆï¼Œåœ¨ Windows 10 18.09 (10.0.17763.167) ä¸­ï¼Œ&lt;code>CreateProcessAsUser&lt;/code> ä¼šè°ƒç”¨ &lt;code>CreateProcessInternalW&lt;/code>ï¼Œè€Œ CreateProcess ä¹Ÿæ˜¯è°ƒç”¨ &lt;code>CreateProcessInternalW&lt;/code>ã€‚å¦‚æœç”¨ &lt;code>IDA Freeware&lt;/code> &lt;sup>2&lt;/sup> åæ±‡ç¼– &lt;code>KernelBase.dll&lt;/code> å¯ä»¥å‘ç° &lt;code>CreateProcessAsUserW&lt;/code> çš„æƒé™æœ€åä¼ é€’åˆ° &lt;code>CreateProcessInternalW&lt;/code> ç”± &lt;code>CreateProcessInternalW&lt;/code> å¤„ç†äº†ï¼Œè¿™é‡Œä¸ &lt;code>ReactOS&lt;/code> æœ‰ä¸€å®šå·®åˆ«ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/M2Team/Privexec/raw/master/docs/images/austack.png" alt="CreateProcessAsUserW">&lt;/p>
&lt;p>è€Œå†…æ ¸ä¸­åˆ›å»ºè¿›ç¨‹çš„ç»†èŠ‚è®²èµ·æ¥ç¯‡å¹…è¿‡é•¿ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ ã€Šæ·±å…¥è§£æ Windows æ“ä½œç³»ç»Ÿ ç¬¬å…­ç‰ˆï¼ˆä¸Šå†Œï¼‰ã€‹P364 &lt;em>CreateProcessçš„æµç¨‹&lt;/em> ã€‚&lt;/p>
&lt;p>åœ¨ Windows ä¸­ï¼Œå¦‚æœè¦å®ç° &lt;code>UAC&lt;/code> ææƒï¼Œéœ€è¦è°ƒç”¨ &lt;code>ShellExecute&lt;/code> ä»¥ &lt;code>runas&lt;/code> çš„å‚æ•°å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚å¦‚æœåœ¨ç¨‹åºç¼–è¯‘çš„æ¸…å•æ–‡ä»¶ä¸­æ·»åŠ äº†å¦‚ä¸‹æ¸…å•ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;trustInfo&lt;/span> &lt;span style="color:#58a1dd">xmlns=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;urn:schemas-microsoft-com:asm.v2&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;security&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;requestedPrivileges&lt;/span> &lt;span style="color:#58a1dd">xmlns=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;urn:schemas-microsoft-com:asm.v3&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;requestedExecutionLevel&lt;/span> &lt;span style="color:#58a1dd">level=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;requireAdministrator&amp;#39;&lt;/span> &lt;span style="color:#58a1dd">uiAccess=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;false&amp;#39;&lt;/span> &lt;span style="color:#58a1dd">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/requestedPrivileges&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/security&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/trustInfo&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Shell åœ¨å¯åŠ¨æ¸…å•é™„å¸¦æœ‰ UAC ææƒçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ä¹Ÿä¼šå‘ç”Ÿææƒã€‚ä»¥ &lt;code>Windows 10&lt;/code> ä¸ºä¾‹ï¼Œææƒæœ€ç»ˆç”± &lt;code>AicLaunchAdminProcess&lt;/code> å‡½æ•°å®ç°ï¼Œæ­¤å‡½æ•°ç›®å‰å®ç°åœ¨ &lt;code>Windows.Storage.dll&lt;/code> ä¸­ï¼ŒUAC ææƒéœ€è¦ä¸ &lt;code>Appinfo&lt;/code> æœåŠ¡é€šä¿¡ï¼Œ&lt;code>Appinfo&lt;/code> éªŒè¯ææƒè¡Œä¸ºåä½¿ç”¨ &lt;code>CreateProcessAsUserW&lt;/code> å¯åŠ¨è¿›ç¨‹ï¼Œå¹¶å°†å…¶çˆ¶è¿›ç¨‹è®¾ç½®ä¸º &lt;code>ShellExecute&lt;/code> è°ƒç”¨è€…ã€‚è°ƒç”¨ç»†èŠ‚(Windows Vista)&lt;sup>3&lt;/sup>å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>AppInfo goes and talks to the Local Security Authority to get the elevated token of the logged in user of Session 1.&lt;/li>
&lt;li>AppInfo loads up a STARTUPINFOEX structure (new to Vista), and calls the brand new Vista API InitializeProcThreadAttributeList() with room for one attribute.&lt;/li>
&lt;li>OpenProcess() is called to get a handle to the process that initiated the RPC call.&lt;/li>
&lt;li>UpdateProcThreadAttribute() is called with &lt;code>PROC_THREAD_ATTRIBUTE_PARENT_PROCESS&lt;/code>, and uses the handle retrieved in step 3.&lt;/li>
&lt;li>CreateProcessAsUser() is called with &lt;code>EXTENDED_STARTUPINFO_PRESENT&lt;/code> and the results of steps 1 and 4.&lt;/li>
&lt;li>DeleteProcThreadAttributeList() is called.&lt;/li>
&lt;li>Results are gathered, and handles are cleaned up.&lt;/li>
&lt;/ol>
&lt;p>Appinfo æœåŠ¡æè¿°ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨è¾…åŠ©ç®¡ç†æƒé™ä¾¿äºäº¤äº’å¼åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚å¦‚æœåœæ­¢æ­¤æœåŠ¡ï¼Œç”¨æˆ·å°†æ— æ³•ä½¿ç”¨è¾…åŠ©ç®¡ç†æƒé™å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè€Œæ‰§è¡Œæ‰€éœ€ç”¨æˆ·ä»»åŠ¡å¯èƒ½éœ€è¦è¿™äº›æƒé™ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å½“æˆ‘ä»¬äº†è§£åˆ° Windows åˆ›å»ºè¿›ç¨‹çš„ç²—ç•¥ç»†èŠ‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹ Privexec åˆ›å»ºå…¶ä»–æƒé™çš„è¿›ç¨‹åšå‡ºå°è£…äº†ã€‚Privexec æ”¯æŒçš„æƒé™ç±»å‹æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>AppContainer&lt;/li>
&lt;li>Mandatory Integrity Control&lt;/li>
&lt;li>No Elevated(UAC)&lt;/li>
&lt;li>Administrator&lt;/li>
&lt;li>System&lt;/li>
&lt;li>TrustedInstaller&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>AppContainer&lt;/strong> é€šå¸¸å¯ä»¥ä½¿ç”¨ &lt;code>CreateProcess&lt;/code> åˆ›å»ºï¼Œä½¿ç”¨ &lt;code>EXTENDED_STARTUPINFO_PRESENT&lt;/code> é¢å¤–çš„ &lt;code>dwCreateFlags&lt;/code> åˆ›å»ºæƒé™ä¸º &lt;code>AppContainer&lt;/code> çš„è¿›ç¨‹å³å¯ã€‚AppContainer é…ç½®éœ€ç”± &lt;code>CreateAppContainerProfile&lt;/code> åˆ›å»ºï¼Œç›¸åº”çš„ &lt;code>Capability SID&lt;/code> å¯ç”± &lt;code>DeriveCapabilitySidsFromName&lt;/code> æˆ–è€… &lt;code>CreateWellKnownSid&lt;/code> åˆ›å»ºï¼Œ&lt;del>è€Œ &lt;code>Privexec(GUI)&lt;/code> å—é™ä¸ UI é™åˆ¶ï¼Œç›®å‰ä»…æ”¯æŒ 9 ä¸ª &lt;code>WellKnownSid&lt;/code>ï¼Œè€Œ&lt;/del>, &lt;code>Privexec (GUI)&lt;/code> æ”¯æŒä» ListView ä¸­é€‰æ‹©å¸¸è§çš„ &lt;code>Capabilities&lt;/code> ä¹Ÿæ”¯æŒä»æ¸…å•æ–‡ä»¶ä¸­è¯»å–ï¼Œä¸¤ç§é€”å¾„è·å¾—çš„ &lt;code>Capabilities&lt;/code> ä¼šè¢«åˆå¹¶ï¼Œ &lt;code>wsudo&lt;/code> æ”¯æŒ &lt;code>--appx&lt;/code> ä»æ–‡ä»¶ä¸­è®¾ç½® &lt;code>Capabilities&lt;/code>ï¼Œ&lt;code>wsudo&lt;/code> ä¸­ä½¿ç”¨äº† &lt;code>DeriveCapabilitySidsFromName&lt;/code> åˆ›å»º &lt;code>Capabilities SID&lt;/code>ã€‚&lt;/p>
&lt;p>å‚æ•° &lt;code>EXTENDED_STARTUPINFO_PRESENT&lt;/code> è¡¨ç¤ºä½¿ç”¨ &lt;code>STARTUPINFOEX&lt;/code> ç»“æ„ï¼Œä½¿ç”¨ &lt;code>InitializeProcThreadAttributeList&lt;/code> åˆå§‹åŒ– &lt;code>STARTUPINFOEX::lpAttributeList&lt;/code>, ä½¿ç”¨ &lt;code>UpdateProcThreadAttribute&lt;/code> è®¾ç½® &lt;code>lpAttributeList&lt;/code> ä¸º &lt;code>PROC_THREAD_ATTRIBUTE_SECURITY_CAPABILITIES&lt;/code> å¹¶å°† &lt;code>SECURITY_CAPABILITIES &lt;/code> ç»‘å®šåˆ° &lt;code>STARTUPINFOEX&lt;/code> ä¸Šã€‚&lt;/p>
&lt;p>&lt;strong>Mandatory Integrity Control&lt;/strong> ä¸»è¦ä½¿ç”¨ &lt;code>SetTokenInformation&lt;/code> å°†é«˜å®Œæ•´æ€§çº§åˆ«çš„ &lt;code>Token&lt;/code> è®¾ç½®ä¸ºä½å®Œæ•´æ€§çº§åˆ«çš„ &lt;code>Token&lt;/code> ç„¶åä½¿ç”¨ &lt;code>CreateProcessAsUser&lt;/code> åˆ›å»ºè¿›ç¨‹ã€‚&lt;/p>
&lt;p>&lt;strong>No Elevated(UAC)&lt;/strong> å½“å½“å‰ç”¨æˆ·ä¸ºç®¡ç†å‘˜æ—¶éœ€è¦ä½¿ç”¨è®¡åˆ’ä»»åŠ¡å¯åŠ¨ UAC æœªæå‡è¿›ç¨‹ï¼Œè€Œè®¡åˆ’ä»»åŠ¡ä¸»æœºè¿›ç¨‹ä¹Ÿæ˜¯ä½¿ç”¨ &lt;code>CreateProcessAsUser&lt;/code> å¯åŠ¨éæå‡çš„è¿›ç¨‹ã€‚å½“å½“å‰ç”¨æˆ·ä¸ä¸ºç®¡ç†å‘˜æ—¶ï¼Œä½¿ç”¨ &lt;code>CreateProcess&lt;/code> åˆ›å»ºè¿›ç¨‹å³å¯ã€‚å½“ç„¶å¦‚æœå½“å‰ç®¡ç†å‘˜æƒé™è¿›ç¨‹æ¨¡æ‹Ÿäº† &lt;code>System&lt;/code> ä»¤ç‰Œï¼Œå¯ä»¥å¼€å¯è¿›ç¨‹ &lt;code>SE_TCB_NAME&lt;/code> æƒé™ï¼Œç„¶åä½¿ç”¨ &lt;code>WTSQueryUserToken&lt;/code> è·å¾—å½“å‰æ ‡å‡†ç”¨æˆ·çš„ä»¤ç‰Œï¼Œæ‹·è´ä¸€ä»½æ­¤ä»¤ç‰Œï¼Œä½¿ç”¨ &lt;code>CreateProcessAsUser&lt;/code> å³å¯å¯åŠ¨æœªææƒçš„è¿›ç¨‹ã€‚&lt;/p>
&lt;p>&lt;strong>Administrator&lt;/strong> å½“å½“å‰è¿›ç¨‹ä¸ä¸ºç®¡ç†å‘˜ï¼Œåˆ™éœ€è¦ UAC ææƒï¼Œç»†èŠ‚å‰æ–‡ç”±æè¿°ã€‚åä¹‹åˆ™ä½¿ç”¨ &lt;code>CreateProcess&lt;/code> å³å¯ã€‚&lt;/p>
&lt;p>&lt;strong>System&lt;/strong> å½“å‰è¿›ç¨‹å¿…é¡»æ˜¯ç®¡ç†å‘˜æƒé™ç­‰çº§åŠä»¥ä¸Šè¿›ç¨‹ï¼Œéœ€è¦å¼€å¯ &lt;code>SE_DEBUG_NAME&lt;/code> æƒé™ï¼Œç„¶åè·å¾—ç³»ç»Ÿæƒé™è¿›ç¨‹çš„ Token, å°†è‡ªèº«æƒé™æ¨¡æ‹Ÿ &lt;code>System&lt;/code> Tokenï¼Œç„¶åæ‹·è´è‡ªèº« &lt;code>Token&lt;/code> ä¿®æ”¹ &lt;code>Token&lt;/code> ä¸º &lt;code>Primary Token&lt;/code>ï¼Œå³ &lt;code>hPrimary&lt;/code>ï¼Œå› ä¸ºåªæœ‰ä¸» Token æ‰èƒ½è¢«ç”¨äºåˆ›å»ºå­è¿›ç¨‹ã€‚ã€ŠWindows Internal 7th Editionã€‹ä½œè€…ä¹‹ä¸€ &lt;a href="https://github.com/zodiacon">Pavel Yosifovich&lt;/a> å°±å†™äº†ä¸€ä¸ª sysrun çš„ä¾‹å­ï¼š&lt;a href="https://github.com/zodiacon/sysrun">sysrun&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;strong>TrustedInstaller&lt;/strong> æ­¤æƒé™ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ˜¯å±äº &lt;strong>Windows Modules Installer&lt;/strong> æœåŠ¡çš„ä¸“æœ‰æƒé™ï¼Œ&lt;strong>Windows Modules Installer&lt;/strong> çš„æœåŠ¡æè¿°ä¸ºï¼š&lt;/p>
&lt;blockquote>
&lt;p>å¯ç”¨ Windows æ›´æ–°å’Œå¯é€‰ç»„ä»¶çš„å®‰è£…ã€ä¿®æ”¹å’Œç§»é™¤ã€‚å¦‚æœæ­¤æœåŠ¡è¢«ç¦ç”¨ï¼Œåˆ™æ­¤è®¡ç®—æœºçš„ Windows æ›´æ–°çš„å®‰è£…æˆ–å¸è½½å¯èƒ½ä¼šå¤±è´¥ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å› æ­¤è¦è·å¾—æ­¤æƒé™ï¼Œéœ€è¦å…ˆæ¨¡æ‹Ÿåˆ° &lt;code>System&lt;/code> æƒé™ï¼Œç„¶åå¯åŠ¨ &lt;code>TrustedInstaller&lt;/code> æœåŠ¡ï¼Œç„¶åè·å¾—æœåŠ¡è¿›ç¨‹çš„æƒé™å¥æŸ„ï¼Œä»¥è¯¥å¥æŸ„æ‹·è´å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚&lt;/p>
&lt;p>Privexec çš„è¿›ç¨‹å¯åŠ¨ç›¸å…³ä»£ç åœ¨ï¼š&lt;a href="https://github.com/M2Team/Privexec/tree/master/lib/ProcessCore">https://github.com/M2Team/Privexec/tree/master/lib/ProcessCore&lt;/a>ï¼Œä½¿ç”¨ C++17ï¼Œåˆ©ç”¨ &lt;em>Lambda&lt;/em>ï¼Œ&lt;em>RIIA&lt;/em> è¿™æ ·çš„åŠŸèƒ½å¯ä»¥è½»æ˜“çš„å†™å‡ºå¥æŸ„å®‰å…¨çš„ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">explicit&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span>(&lt;span style="color:#58a1dd">F&lt;/span> &lt;span style="color:#58a1dd">f&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">f_&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">f&lt;/span>)), &lt;span style="color:#58a1dd">invoke_&lt;/span>(&lt;span style="color:#58a1dd">true&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">final_act&lt;/span>(&lt;span style="color:#58a1dd">final_act&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">other&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">f_&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">other&lt;/span>.&lt;span style="color:#58a1dd">f_&lt;/span>)), &lt;span style="color:#58a1dd">invoke_&lt;/span>(&lt;span style="color:#58a1dd">other&lt;/span>.&lt;span style="color:#58a1dd">invoke_&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">other&lt;/span>.&lt;span style="color:#58a1dd">invoke_&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">final_act&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">final_act&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">~&lt;/span>&lt;span style="color:#58a1dd">final_act&lt;/span>() &lt;span style="color:#ff636f">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">invoke_&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">f_&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">F&lt;/span> &lt;span style="color:#58a1dd">f_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">invoke_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// finally() - convenience function to generate a final_act
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">finally&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">F&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">f&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">f&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">finally&lt;/span>(&lt;span style="color:#58a1dd">F&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">f&lt;/span>) &lt;span style="color:#ff636f">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">final_act&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">forward&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">F&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">f&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">filetodo&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">file&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">hFile&lt;/span>&lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">CreateFileW&lt;/span>(&lt;span style="color:#58a1dd">file&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GENERIC_READ&lt;/span>, &lt;span style="color:#58a1dd">FILE_SHARE_READ&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#58a1dd">OPEN_EXISTING&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FILE_ATTRIBUTE_NORMAL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">hFile&lt;/span>&lt;span style="color:#ff636f">==&lt;/span>&lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">closer&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">finally&lt;/span>([&lt;span style="color:#ff636f">&amp;amp;&lt;/span>] {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">hFile&lt;/span>&lt;span style="color:#ff636f">!=&lt;/span>&lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">hFile&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/// some codes...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å›è¿‡å¤´æ¥è¯´ï¼Œä½ å®Œå…¨å¼€å‘ä¸€ä¸ªæœåŠ¡æ¥å®ç°ä»¥å…¶ä»–ç”¨æˆ·æƒé™å¯åŠ¨è¿›ç¨‹ï¼Œç„¶åå°è£…ä¸€ä¸ªå‘½ä»¤ï¼Œå‘½ä»¤éœ€è¦å¯åŠ¨è¿›ç¨‹æ—¶ä¸æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œåœ¨æœåŠ¡ä¸­ä½¿ç”¨ &lt;code>CreateProcessAsUser&lt;/code> å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚ä½¿ç”¨æœåŠ¡å®ç°æ­¤åŠŸèƒ½æ—¶ï¼Œéœ€è¦é¿å…ä¸å¯ä¿¡çš„ææƒå‘ç”Ÿã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/MouriNaruto">æ¯›åˆ©&lt;/a> çš„ &lt;a href="https://github.com/M2Team/NSudo">NSudo&lt;/a> ä¸ Privexec ç±»ä¼¼ï¼Œä½†å®ç°åŸºæœ¬ä¸Šæ˜¯ä½¿ç”¨ &lt;code>CreateProcessAsUser&lt;/code> + &lt;code>Token&lt;/code> åˆ›å»ºè¿›ç¨‹ã€‚&lt;/p>
&lt;p>é¢˜å¤–è¯ï¼šåœ¨ Windows å¹³å°ä¸Šï¼Œå¯åŠ¨è¿›ç¨‹ä¾ç„¶æœ‰ä¸å°çš„ä»£ä»·ï¼Œä¸­é—´ç¯èŠ‚å¤šï¼Œè€Œåœ¨ Unix å¹³å°ï¼Œå¯åŠ¨è¿›ç¨‹æœ‰ &lt;code>fork/exec&lt;/code>ï¼Œå®é™…ä¸Šè¦å®ç°ç±»ä¼¼ &lt;code>CreateProcess&lt;/code> ä¹‹ç±»çš„é€»è¾‘éœ€è¦ä½¿ç”¨ &lt;code>fork/exec&lt;/code> è”åˆä½¿ç”¨ã€‚ç°å®å¸¦æ¥äº†é—æ†¾ï¼ŒWindows ä¸Šå®ç° &lt;code>fork&lt;/code> å’Œ Unix å®ç°æ›´é«˜æ•ˆçš„ &lt;code>CreateProcess&lt;/code> æˆäº†ä¸¤ä¸ªå¤§éš¾é¢˜ã€‚å½“ç„¶ï¼Œåœ¨å®ç° &lt;code>Windows Subsystem for Linux&lt;/code>&lt;sup>4&lt;/sup>ï¼Œå¾®è½¯ä¹Ÿåœ¨æ”¹è¿›å…¶åˆ›å»ºè¿›ç¨‹çš„æµç¨‹ï¼Œä½†ç›®å‰ä¸ºæ­¢ &lt;code>Minimal process&lt;/code> å¹¶æ²¡æœ‰è®© &lt;code>cygwin&lt;/code> è¿™æ ·çš„ç³»ç»Ÿå—ç›Šã€‚&lt;/p>
&lt;p>&lt;img src="https://msdnshared.blob.core.windows.net/media/2016/05/picoProcess-1024x763.png" alt="picoprocess">&lt;/p>
&lt;h2 id="privexec-gui">Privexec (GUI)&lt;/h2>
&lt;p>Privexec ç‹­ä¹‰ä¸Šæ˜¯æŒ‡ &lt;code>Privexec (GUI)&lt;/code> è¿™ä¸ªç¨‹åºï¼Œç°åœ¨åº”è¯¥æŒ‡ &lt;code>Privexec&lt;/code> æ•´ä¸ªé¡¹ç›®ï¼ŒåŒ…æ‹¬ &lt;code>wsudo&lt;/code>ã€‚åœ¨ Windows å¹³å°ä¸Šï¼Œä½¿ç”¨ C++ å¼€å‘æ¡Œé¢åº”ç”¨è™½ç„¶æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚ &lt;code>API, MFC, WTL, QT, DirectUI&lt;/code> ç­‰ç­‰ï¼Œä½†å®é™…ä¸ŠåŸºæœ¬æ²¡æœ‰ä¸€ä¸ª &lt;strong>ç°ä»£çš„ UI æ¡†æ¶&lt;/strong> å¯ä»¥ä¾›ä½ é€‰æ‹©ï¼Œä¸Šè¿° UI æ¡†æ¶æˆ–ç¼ºå°‘è‡ªé€‚åº”å¤§å°æ”¯æŒï¼Œæˆ–ç¼ºå°‘é«˜ &lt;code>DPI&lt;/code> æ”¯æŒï¼Œä¹Ÿå¯èƒ½ç¼ºå°‘ Emoji æ”¯æŒç­‰ç­‰ï¼Œå¦ä¸€æ–¹é¢ä¸æ–­è§£å†³ä¾èµ–é—®é¢˜ä¹Ÿè®©äººåŒå€¦ã€‚Privexec ä½¿ç”¨ Win32 API å³å¯ï¼Œä¿æŒæç®€é£æ ¼ä¹Ÿä¸é”™ã€‚Privexec æœ€åˆåªæ˜¯æˆ‘è‡ªå·±å¼€å‘å¥½ç©çš„ä¸€ä¸ªå·¥å…·ï¼ˆç›®å‰å¤§æ¦‚ä¾ç„¶æ˜¯ï¼‰ï¼ŒUI å¼€å‘é€‰æ‹©æƒåœ¨æˆ‘è‡ªå·±ï¼Œè€Œ Windows 10 &lt;sup>5&lt;/sup>æ”¹è¿›äº†åŸºäºå¯¹è¯æ¡†åº”ç”¨é«˜ DPI çš„æ”¯æŒï¼Œä¸ºäº†æ”¯æŒæˆ‘çš„ &lt;code>Surface Pro 4&lt;/code> ï¼Œäºæ˜¯é€‰æ‹©äº†ä½¿ç”¨å¯¹è¯æ¡†åšä¸»ç•Œé¢ã€‚ ç•Œé¢å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/M2Team/Privexec/raw/master/docs/images/appcontainer.png" alt="Privexec">&lt;/p>
&lt;p>åœ¨æ­¤æ¬¡æ”¹é€ ä¹‹å‰ Privexec ä½¿ç”¨ä¼ ç»Ÿçš„ &lt;code>Win32 API+ å…¨å±€å˜é‡&lt;/code> è¿™æ ·çš„ä»£ç é€»è¾‘ï¼Œåœ¨ä¸æ–­æ·»åŠ åŠŸèƒ½åå‘ç°ä»£ç è¶Šæ¥è¶Šæ‚ä¹±æ— ç« ï¼Œäºæ˜¯å°±ç”¨ C++ ç±»é‡æ„äº†ï¼Œå¤§é‡ä½¿ç”¨ C++17 ä»£ç ã€‚ä»£ç åœ°å€ä¸ºï¼š&lt;a href="https://github.com/M2Team/Privexec/tree/master/Privexec">https://github.com/M2Team/Privexec/tree/master/Privexec&lt;/a>ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç›®å‰ C çš„ API æ”¯æŒå›è°ƒå‡½æ•°çš„ä¸€å®šåªèƒ½ä½¿ç”¨å…¨å±€å‡½æ•°æˆ–è€…é™æ€æˆå‘˜å‡½æ•°ã€‚åœ¨ä½¿ç”¨ C++ é¢å‘å¯¹è±¡å¼€å‘ UI ç¨‹åºæ—¶ï¼Œéœ€è¦åœ¨çª—å£æ¶ˆæ¯å›è°ƒå‡½æ•°ä¸­å…ˆè·å–å¯¹è±¡çš„ &lt;code>this&lt;/code> æŒ‡é’ˆï¼Œç„¶åå†è°ƒç”¨å¯¹è±¡çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚æ–¹æ¡ˆç”±å¤šç§ï¼Œæ¯”å¦‚ ATL ä½¿ç”¨çš„ &lt;code>Thunk&lt;/code>&lt;sup>6&lt;/sup>ï¼Œè¿˜æœ‰é€šè¿‡ &lt;code>GWLP_USERDATA&lt;/code> å»ä¼ é€’ &lt;code>this&lt;/code> æŒ‡é’ˆï¼Œè¿™ç§ç”¨æˆ·å›è°ƒæºå¸¦ &lt;code>this&lt;/code> æŒ‡é’ˆçš„åšæ³•ç®€ç›´å¤ªå¸¸è§äº†ã€‚&lt;/p>
&lt;p>ATL Thunk ç›¸å…³çš„æ–‡ç« æœ‰ï¼š&lt;a href="https://www.hackcraft.net/cpp/windowsThunk/">https://www.hackcraft.net/cpp/windowsThunk/&lt;/a>&lt;/p>
&lt;p>å®é™…ä¸Šï¼ŒPrivexec å¹¶ä¸éœ€è¦å­¦ä¹  ATL/WTL é‚£æ ·ï¼Œä½¿ç”¨ &lt;code>Thunk&lt;/code> æŠ€æœ¯ï¼Œå®Œå…¨æ²¡æœ‰åˆ°é‚£ä¸ªç¨‹åº¦ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº† &lt;code>GWLP_USERDATA&lt;/code> çš„åšæ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">INT_PTR&lt;/span> &lt;span style="color:#58a1dd">WINAPI&lt;/span> &lt;span style="color:#58a1dd">App&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">WindowProc&lt;/span>(&lt;span style="color:#58a1dd">HWND&lt;/span> &lt;span style="color:#58a1dd">hWnd&lt;/span>, &lt;span style="color:#58a1dd">UINT&lt;/span> &lt;span style="color:#58a1dd">message&lt;/span>, &lt;span style="color:#58a1dd">WPARAM&lt;/span> &lt;span style="color:#58a1dd">wParam&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">LPARAM&lt;/span> &lt;span style="color:#58a1dd">lParam&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">App&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">app&lt;/span>{&lt;span style="color:#ff636f">nullptr&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">message&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">WM_INITDIALOG&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">app&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">reinterpret_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">App&lt;/span> &lt;span style="color:#ff636f">*&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">lParam&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetWindowLongPtr&lt;/span>(&lt;span style="color:#58a1dd">hWnd&lt;/span>, &lt;span style="color:#58a1dd">GWLP_USERDATA&lt;/span>, &lt;span style="color:#ff636f">reinterpret_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">LONG_PTR&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">app&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">app&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">Initialize&lt;/span>(&lt;span style="color:#58a1dd">hWnd&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#58a1dd">if&lt;/span> ((&lt;span style="color:#58a1dd">app&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">GetThisFromHandle&lt;/span>(&lt;span style="color:#58a1dd">hWnd&lt;/span>)) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">app&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">MessageHandler&lt;/span>(&lt;span style="color:#58a1dd">message&lt;/span>, &lt;span style="color:#58a1dd">wParam&lt;/span>, &lt;span style="color:#58a1dd">lParam&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">FALSE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ Windows ä¸­ï¼Œå¾ˆå¤š API å®é™…ä¸Šæ˜¯ç”± &lt;code>COM&lt;/code> ç»„ä»¶ç±»æä¾›ï¼Œç›´æ¥åœ¨ C++ ä¸­ä½¿ç”¨ COM å¯¹è±¡éœ€è¦å°å¿ƒç¿¼ç¿¼é¿å…èµ„æºæ³„æ¼ï¼Œåˆ°äº† 8102 å¹´ï¼Œä½ åº”è¯¥ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæˆ–è€… &lt;code>ComPtr&lt;/code> å»åŒ…è£¹ COM å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨ RAII æ¥é¿å…èµ„æºæ³„æ¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">comptr&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">comptr&lt;/span>() { &lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">comptr&lt;/span>(&lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">p&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">p&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AddRef&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">comptr&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">comptr&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">T&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">sptr&lt;/span>.&lt;span style="color:#58a1dd">ptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AddRef&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>&lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span>() { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ptr&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>() { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ptr&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>(&lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">p&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">this&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">p&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">p&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AddRef&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">operator&lt;/span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>() &lt;span style="color:#ff636f">const&lt;/span> { &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ptr&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">I&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">QueryInterface&lt;/span>(&lt;span style="color:#58a1dd">REFCLSID&lt;/span> &lt;span style="color:#58a1dd">rclsid&lt;/span>, &lt;span style="color:#58a1dd">I&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>&lt;span style="color:#58a1dd">pp&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">pp&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ptr&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">QueryInterface&lt;/span>(&lt;span style="color:#58a1dd">rclsid&lt;/span>, (&lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>)&lt;span style="color:#58a1dd">pp&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">E_FAIL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">CoCreateInstance&lt;/span>(&lt;span style="color:#58a1dd">REFCLSID&lt;/span> &lt;span style="color:#58a1dd">clsid&lt;/span>, &lt;span style="color:#58a1dd">IUnknown&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">pUnknown&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">REFIID&lt;/span> &lt;span style="color:#58a1dd">interfaceId&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">DWORD&lt;/span> &lt;span style="color:#58a1dd">dwClsContext&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">CLSCTX_ALL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">CoCreateInstance&lt;/span>(&lt;span style="color:#58a1dd">clsid&lt;/span>, &lt;span style="color:#58a1dd">pUnknown&lt;/span>, &lt;span style="color:#58a1dd">dwClsContext&lt;/span>, &lt;span style="color:#58a1dd">interfaceId&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#ff636f">**&lt;/span>)&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">~&lt;/span>&lt;span style="color:#58a1dd">comptr&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ptr&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ptr&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">Release&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">T&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">ptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Privexec ä½¿ç”¨äº† &lt;code>pugixml&lt;/code> ç”¨äºè§£æ &lt;code>AppManifest&lt;/code>ï¼Œä½¿ç”¨ &lt;code>json.hpp&lt;/code> è§£æ Alias é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>åœ¨ Privexec ä¸­çš„é”™è¯¯æç¤º &lt;code>MessageBox&lt;/code> å®é™…ä¸Šæ˜¯ä½¿ç”¨ &lt;code>TaskDialog&lt;/code> ç¼–å†™ï¼Œè€Œå…³äºå¯¹è¯æ¡†åŒæ ·ä¹Ÿæ˜¯ã€‚æŸ¥æ‰¾æ–‡ä»¶/æ–‡ä»¶å¤¹å¯¹è¯æ¡†ä½¿ç”¨çš„æ˜¯ &lt;code>IFileDialog&lt;/code>ã€‚&lt;/p>
&lt;h2 id="wsudo">WSUDO&lt;/h2>
&lt;p>WSUDO æ˜¯ Priexec çš„å‘½ä»¤è¡Œç‰ˆæœ¬ã€‚å¾ˆæ—©å°±æ”¯æŒé¢œè‰²é«˜äº®ï¼Œåœ¨å‰æ–‡ä¸­æ›¾å†™è¿‡ä¸€ç¯‡æ–‡ç«  &lt;a href="https://forcemz.net/windows/2017/06/06/ColorConsole/">ã€ŠPrivexec çš„å†…å¹•ï¼ˆä¸€ï¼‰æ ‡å‡†è¾“å‡ºåŸç†ä¸å½©è‰²è¾“å‡ºå®ç°ã€‹&lt;/a> å¯¹æ­¤æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚æ­¤æ¬¡é‡æ„ WSUDOï¼Œæ”¹è¿›äº†å‘½ä»¤è¡Œè§£ææ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®å¯åŠ¨è¿›ç¨‹çš„&lt;strong>å¯åŠ¨ç›®å½•&lt;/strong>ï¼Œ&lt;strong>ç¯å¢ƒå˜é‡&lt;/strong>ï¼Œ&lt;strong>AppConatiner&lt;/strong> æ¸…å•æ–‡ä»¶ï¼Œå…·ä½“çš„å‘½ä»¤è¡Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/M2Team/Privexec/raw/master/docs/images/wsudo.png" alt="WSUDO">&lt;/p>
&lt;p>åœ¨åˆ›å»ºè¿›ç¨‹æ—¶ï¼Œå¦‚æœ &lt;code>CreateProcess&lt;/code> çš„å‚æ•° &lt;a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessw">&lt;code>lpEnvironment&lt;/code>&lt;/a> ä¸º &lt;code>NULL&lt;/code> æ—¶ï¼Œå­è¿›ç¨‹å°†ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ &lt;code>Unix&lt;/code> (&lt;code>exec&lt;/code> å‡½æ•°å®¶æ—) ç³»ç»Ÿæ˜¯ä¸€è‡´çš„ã€‚å¦‚æœæˆ‘ä»¬è¦è®¾ç½®å­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ wsudo çš„ç¯å¢ƒå˜é‡ä¼ é€’ç»™å­è¿›ç¨‹å³å¯ã€‚è¿™æ¬¡ï¼Œæˆ‘ç»™ WSUDO æ·»åŠ äº† &lt;code>-e(--env)&lt;/code> flag. å¯ä»¥ä½¿ç”¨ &lt;code>-eK=V&lt;/code>ï¼Œ&lt;code>-e K=V&lt;/code> &lt;code>--env=K=V&lt;/code>ï¼Œ&lt;code>--env K=V&lt;/code> è¿™æ ·çš„æ–¹å¼è®¾ç½®ç¯å¢ƒå˜é‡ã€‚&lt;/p>
&lt;p>WSUDO ç›®å‰è¿˜æ”¯æŒ &lt;code>--new-console&lt;/code> &lt;code>--wait&lt;/code> è¿™æ ·çš„ flagï¼Œåœ¨ Windows ä¸­ï¼Œåˆ›å»º CUI è¿›ç¨‹æ—¶ï¼Œé»˜è®¤å‚æ•°ä¸‹ï¼Œå¦‚æœç¨‹åºçš„å­ç³»ç»Ÿæ˜¯ &lt;code>Windows CUI&lt;/code>ï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä¹Ÿæ˜¯ &lt;code>CUI&lt;/code> ç¨‹åºå°±ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ§åˆ¶å°çª—å£ï¼Œå¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å°çª—å£ã€‚è¿™å°±æ„å‘³è¿™ WSUDO åœ¨å¯åŠ¨ CUI å­è¿›ç¨‹æ—¶ï¼ŒCUI å­è¿›ç¨‹å®é™…ä¸Šçš„çª—å£ä¹Ÿä¼šç»§æ‰¿ WSUDO çš„å½“å‰çª—å£ï¼Œè€Œä¹‹å‰çš„ WSUDO åœ¨å­è¿›ç¨‹å¯åŠ¨åå°±ç»“æŸäº†ï¼ŒCMD/PowerShell çš„ç­‰å¾…ä¹Ÿå°±ç»“æŸäº†ï¼Œè¿™æ—¶å€™å¦‚æœ CUI å­è¿›ç¨‹è¿˜æ´»è·ƒï¼Œå¯èƒ½å¯¹æ§åˆ¶å°çª—å£è¯»å†™ä»è€Œä¼šå¯¼è‡´æ§åˆ¶å°çª—å£è¾“å…¥è¾“å‡ºç´Šä¹±ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>WSUDO ç­‰å¾…å­è¿›ç¨‹ç»“æŸ&lt;/li>
&lt;li>æˆ–è€…å¯åŠ¨æ–°æ§åˆ¶å°&lt;/li>
&lt;/ul>
&lt;p>è€Œè¿™æ¬¡é‡æ„ä¸“é—¨å¢åŠ äº† &lt;code>--new-console&lt;/code> å’Œ &lt;code>--wait&lt;/code>ï¼Œå¹¶ä¿®æ”¹ WSUDO çš„å¯åŠ¨è¿›ç¨‹çš„é»˜è®¤è¡Œä¸ºï¼Œå…·ä½“æƒ…å½¢å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å­ç³»ç»Ÿ&lt;/th>
&lt;th>&amp;ndash;new-console&lt;/th>
&lt;th>&amp;ndash;wait&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Windows CUI&lt;/td>
&lt;td>é»˜è®¤å…³é—­&lt;/td>
&lt;td>é»˜è®¤å¼€å¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Windows GUI&lt;/td>
&lt;td>N/A&lt;/td>
&lt;td>é»˜è®¤å…³é—­&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å¦‚æœå­è¿›ç¨‹å­ç³»ç»Ÿæ˜¯ &lt;code>Windows GUI&lt;/code> ä¸”å‘½ä»¤è¡Œå‚æ•°åŒ…å« &lt;code>--wait&lt;/code>ï¼ŒWSUDO ä¾ç„¶ä¼šç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚&lt;/p>
&lt;p>åœ¨å¯åŠ¨å­è¿›ç¨‹çš„ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§£æ &lt;code>PE&lt;/code> æ–‡ä»¶æ ¼å¼å»æ„ŸçŸ¥å¯æ‰§è¡Œç¨‹åºå­ç³»ç»Ÿæ˜¯å¦æ˜¯ &lt;code>Windows CUI&lt;/code>ï¼Œå…·ä½“ä»£ç åœ¨ï¼š&lt;a href="https://github.com/M2Team/Privexec/blob/f9a2cbbfa57a3bda65e6c70b74e80b8cc67af333/include/pe.hpp#L130">PESubsystemIsConsole&lt;/a>&lt;/p>
&lt;p>å¦‚æœè¦æ”¯æŒ &lt;code>AppExecLink(IO_REPARSE_TAG_APPEXECLINK)&lt;/code> è¿™æ ·ç‰¹æ®Šçš„æ–‡ä»¶ï¼ˆè¿™ç§æ–‡ä»¶ç±»ä¼¼äº Windows Symbolic Fileï¼Œæ˜¯ UWP App çš„ç¨‹åºçš„ç‰¹æ®Šé“¾æ¥æ–‡ä»¶ã€‚ï¼‰éœ€è¦è§£æé‡è§£æç‚¹ï¼Œå¤§è‡´ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">readlink&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">symfile&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">realfile&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">hFile&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">CreateFileW&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">symfile&lt;/span>.&lt;span style="color:#58a1dd">c_str&lt;/span>(), &lt;span style="color:#a6be9d">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FILE_SHARE_READ&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_WRITE&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_DELETE&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">OPEN_EXISTING&lt;/span>, &lt;span style="color:#58a1dd">FILE_FLAG_BACKUP_SEMANTICS&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_FLAG_OPEN_REPARSE_POINT&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">hFile&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ReparseBuffer&lt;/span> &lt;span style="color:#58a1dd">rbuf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">DWORD&lt;/span> &lt;span style="color:#58a1dd">dwBytes&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">DeviceIoControl&lt;/span>(&lt;span style="color:#58a1dd">hFile&lt;/span>, &lt;span style="color:#58a1dd">FSCTL_GET_REPARSE_POINT&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">MAXIMUM_REPARSE_DATA_BUFFER_SIZE&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">dwBytes&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">TRUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">hFile&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">hFile&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">switch&lt;/span> (&lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">ReparseTag&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_SYMLINK&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">SymbolicLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">PathBuffer&lt;/span> &lt;span style="color:#ff636f">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">SymbolicLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">SubstituteNameOffset&lt;/span> &lt;span style="color:#ff636f">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">WCHAR&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">SymbolicLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">SubstituteNameLength&lt;/span> &lt;span style="color:#ff636f">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">WCHAR&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;?&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">2&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;?&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">3&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Starts with \??\ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ((&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;Z&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;z&amp;#39;&lt;/span>)) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">5&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;:&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">6&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* \??\&amp;lt;drive&amp;gt;:\ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">-=&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">8&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;U&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;u&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">5&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;N&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">5&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;n&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">6&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;C&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">6&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;c&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">7&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* \??\UNC\&amp;lt;server&amp;gt;\&amp;lt;share&amp;gt;\ - make sure the final path looks like */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* \\&amp;lt;server&amp;gt;\&amp;lt;share&amp;gt;\ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">-=&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">realfile&lt;/span>.&lt;span style="color:#58a1dd">assign&lt;/span>(&lt;span style="color:#58a1dd">wstr&lt;/span>, &lt;span style="color:#58a1dd">wlen&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_MOUNT_POINT&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">MountPointReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">PathBuffer&lt;/span> &lt;span style="color:#ff636f">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">MountPointReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">SubstituteNameOffset&lt;/span> &lt;span style="color:#ff636f">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">WCHAR&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">MountPointReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">SubstituteNameLength&lt;/span> &lt;span style="color:#ff636f">/&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">WCHAR&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Only treat junctions that look like \??\&amp;lt;drive&amp;gt;:\ as symlink. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Junctions can also be used as mount points, like \??\Volume{&amp;lt;guid&amp;gt;}, */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* but that&amp;#39;s confusing for programs since they wouldn&amp;#39;t be able to */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* actually understand such a path when returned by uv_readlink(). */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* UNC paths are never valid for junctions so we don&amp;#39;t care about them. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>(&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;?&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">2&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;?&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">3&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ((&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;Z&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">4&lt;/span>] &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;z&amp;#39;&lt;/span>)) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">5&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;:&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">wstr&lt;/span>[&lt;span style="color:#a6be9d">6&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;\\&amp;#39;&lt;/span>))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetLastError&lt;/span>(&lt;span style="color:#58a1dd">ERROR_SYMLINK_NOT_SUPPORTED&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">/* Remove leading \??\ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wstr&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">wlen&lt;/span> &lt;span style="color:#ff636f">-=&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">realfile&lt;/span>.&lt;span style="color:#58a1dd">assign&lt;/span>(&lt;span style="color:#58a1dd">wstr&lt;/span>, &lt;span style="color:#58a1dd">wlen&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_APPEXECLINK&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">StringCount&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">LPWSTR&lt;/span> &lt;span style="color:#58a1dd">szString&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#58a1dd">LPWSTR&lt;/span>)&lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">StringList&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">rbuf&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">StringCount&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">realfile&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">szString&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">szString&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">wcslen&lt;/span>(&lt;span style="color:#58a1dd">szString&lt;/span>) &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">default&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>WSUDO è¿˜æ”¯æŒå†…ç½®å‘½ä»¤ &lt;code>alias&lt;/code>ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤åˆ«åã€‚å¢åŠ åˆ«åæ—¶å¦‚æœåˆ«åå­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-batch" data-lang="batch">&lt;span style="display:flex;">&lt;span>wsudo alias add ehs &lt;span style="color:#a6be9d">&amp;#34;notepad &lt;/span>&lt;span style="color:#58a1dd">%SYSTEMROOT%&lt;/span>&lt;span style="color:#a6be9d">/System32/drivers/etc/hosts&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Edit Hosts&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wsudo alias delete ehs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="details">Details&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://github.com/M2Team/Privexec/issues/2">Feature Request: AppContainer &amp;ldquo;Capabilities&amp;rdquo; Selection&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.hex-rays.com/products/ida/support/download_freeware.shtml">IDA Support: Freeware Version&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.codeproject.com/Articles/19165/Vista-UAC-The-Definitive-Guide">Vista UAC: The Definitive Guide&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blogs.msdn.microsoft.com/wsl/2016/05/23/pico-process-overview/">Pico Process Overview&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blogs.windows.com/buildingapps/2017/04/04/high-dpi-scaling-improvements-desktop-applications-windows-10-creators-update/#GhtloWCUWO8rEeRG.97">High-DPI Scaling Improvements for Desktop Applications in the Windows 10 Creators Update (1703)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Thunk">A thunk is a computer programming subroutine that is created, often automatically, to assist a call to another subroutine .&lt;/a>&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2018/2018-11-30-privexec-new/ - Copyright (c) 2009-2024 J23</description></item><item><title>åŸºäº Git Namespace çš„å­˜å‚¨åº“å¿«ç…§æ–¹æ¡ˆ</title><link>https://forcemz.net/posts/2018/2018-11-18-git-namespace-snapshot/</link><pubDate>Sun, 18 Nov 2018 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2018/2018-11-18-git-namespace-snapshot/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2018/2018-11-18-git-namespace-snapshot/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Git">Git&lt;/a> æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä¸€å¤§ç‰¹æ€§å°±æ˜¯è¿œç¨‹å­˜å‚¨åº“å’Œæœ¬åœ°å­˜å‚¨åº“éƒ½åŒ…å«å­˜å‚¨åº“çš„å®Œæ•´æ•°æ®ã€‚
è€Œé›†ä¸­å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåªæœ‰åœ¨ä¸­å¿ƒæœåŠ¡å™¨ä¸Šæ‰ä¼šåŒ…å«å­˜å‚¨åº“å®Œæ•´çš„æ•°æ®ï¼Œæœ¬åœ°æ‰€è°“çš„å­˜å‚¨åº“åªæ˜¯è¿œç¨‹æœåŠ¡å™¨ç‰¹å®šç‰ˆæœ¬çš„ &lt;code>checkout&lt;/code>ã€‚å½“ä¸­å¿ƒæœåŠ¡å™¨æ•…éšœåï¼Œå¦‚æœæ²¡æœ‰å¤‡ä»½æœåŠ¡å™¨ï¼Œé‚£ä¹ˆé›†ä¸­å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå­˜å‚¨åº“çš„æ•°æ®ç»å¤§éƒ¨åˆ†å°±ä¼šè¢«ä¸¢å¤±ã€‚è¿™å¾ˆå®¹æ˜“å¾—å‡ºåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä»£ç è¦å¿…é›†ä¸­å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ›´åŠ å®‰å…¨ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œå®‰å…¨å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œå°¤å…¶å½“ &lt;code>Git&lt;/code> è¢«è¶Šæ¥è¶Šå¤šçš„äººä½¿ç”¨åï¼Œç”¨æˆ·ä¹Ÿä¼šéœ€è¦ Git å¸æ”¶é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ç‰¹æ€§æ¥æ”¹è¿›ç”¨æˆ·ä½“éªŒï¼Œè¿™ç§æƒ…å½¢ä¸‹ï¼ŒGit åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„å®‰å…¨æ€§ä¹Ÿå°±é¢ä¸´æŒ‘æˆ˜ã€‚ç»ˆç«¯ç”¨æˆ·è·å–çš„ä¸æ˜¯å®Œæ•´çš„æ•°æ®ï¼Œä¸ºäº†ä¿è¯å­˜å‚¨åº“çš„å®‰å…¨ä»ç„¶éœ€è¦å¤‡ä»½æˆ–è€…é•œåƒè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨åº“ã€‚ï¼ˆç”¨æˆ·å¯ä»¥ä½¿ç”¨æµ…è¡¨å…‹éš†ï¼Œå•åˆ†æ”¯å…‹éš†æˆ–è€…ä½¿ç”¨ git vfs(GVFS) ä¹‹ç±»çš„æŠ€æœ¯åŠ å¿« git è®¿é—®ã€‚ï¼‰&lt;/p>
&lt;p>Git ç»™å¼€å‘è€…éå¸¸å¤§çš„è‡ªç”±ï¼Œgit å¯ä»¥ä¿®æ”¹ commit é‡æ–°æäº¤ï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶æ¨é€&lt;sup>1&lt;/sup>å¼•ç”¨åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¦†ç›–ç‰¹å®šçš„å¼•ç”¨ï¼Œä¸åˆç†çš„ä½¿ç”¨å¼ºåˆ¶æ¨é€æ˜¯éå¸¸å±é™©çš„ï¼Œè¿™å¾ˆå®¹æ˜“é€ æˆä»£ç ä¸¢å¤±ï¼Œå¯¹äºä¼ä¸šå­˜å‚¨åº“æ¥è¯´ï¼Œåˆç†çš„å¿«ç…§èƒ½å¤Ÿä»£ç ä¸¢å¤±åå‡å°ä»£ç èµ„äº§çš„æŸå¤±ã€‚(ä½†è¿™å¹¶ä¸æ˜¯è¯´ç»å¯¹ç¦æ­¢å¼ºåˆ¶æ¨é€&lt;sup>2&lt;/sup>)&lt;/p>
&lt;p>åœ¨ Gitee æä¾›äº†ä¼ä¸šç‰ˆåï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸æ¥æ”¶åˆ°ç”¨æˆ·å¯¹äºä»£ç èµ„äº§å®‰å…¨çš„åé¦ˆï¼Œä¸ºäº†åˆ©ç”¨æœ‰é™çš„èµ„æºæä¾›æ›´åŠ å®‰å…¨çš„æœåŠ¡ï¼Œå­˜å‚¨åº“å¤‡ä»½ä¸å¿«ç…§æ–¹æ¡ˆçš„è®¾è®¡ä¹Ÿå°±éå¸¸é‡è¦äº†ã€‚&lt;/p>
&lt;h2 id="æœ¯è¯­åŠç»„ä»¶">æœ¯è¯­åŠç»„ä»¶&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Feature&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Git Native Hook&lt;/td>
&lt;td>åŸºäº C++ ç¼–å†™çš„åŸç”Ÿé’©å­ï¼Œå¤§æ–‡ä»¶æ£€æŸ¥ï¼Œåˆ†æ”¯æƒé™ï¼Œæ¶ˆæ¯åŠåŒæ­¥é˜Ÿåˆ—ï¼Œ&lt;a href="https://forcemz.net/git/2017/11/22/GitNativeHookDepthOptimization/">Git åŸç”Ÿé’©å­çš„æ·±åº¦ä¼˜åŒ–&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blaze&lt;/td>
&lt;td>åŸºäº Go ç¼–å†™çš„å¤‡ä»½ï¼ŒGCï¼Œå­˜å‚¨åº“åˆ é™¤é˜Ÿåˆ—æœåŠ¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Git Diamond&lt;/td>
&lt;td>åŸºäº Asio ç¼–å†™çš„å†…éƒ¨ git åè®®ä¼ è¾“æœåŠ¡å™¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Git Snapshot&lt;/td>
&lt;td>åŸºäº C++ ç¼–å†™çš„å¿«ç…§å’Œæ¢å¤å·¥å…·&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="gitee-ç›®å‰å¤‡ä»½æ–¹æ¡ˆ">Gitee ç›®å‰å¤‡ä»½æ–¹æ¡ˆ&lt;/h2>
&lt;p>&lt;strong>Gitee&lt;/strong> çš„ä¼ä¸šå­˜å‚¨åº“æœ‰ä¸¤ä¸ªå®‰å…¨ç­–ç•¥ä¿è¯å…¶å®‰å…¨ï¼Œåˆ†åˆ«æ˜¯ &lt;code>DGIT&lt;/code> è§¦å‘å¼åŒæ­¥å’Œ &lt;code>rsync&lt;/code> å®šæœŸå¿«ç…§æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>&lt;code>DGIT&lt;/code> è§¦å‘å¼åŒæ­¥çš„ç»„ä»¶æœ‰ï¼š&lt;code>Git Native Hook&lt;/code> ï¼Œ&lt;code>Redis&lt;/code>ï¼Œ&lt;code>Blaze&lt;/code>ï¼Œ&lt;code>Git Diamond&lt;/code>ã€‚GNK(Git Native Hook) ä½œä¸ºç¬¦å·é“¾æ¥å­˜åœ¨ä¸æœåŠ¡å™¨ä¸Šå­˜å‚¨åº“ç›®å½•ä¸‹çš„ &lt;code>hooks&lt;/code> ä¹‹ä¸­ï¼Œå½“ç”¨æˆ·æ¨é€ä»£ç åï¼ŒGNK ä¼šè¢«è§¦å‘ï¼Œåœ¨æ‰§è¡Œå®Œæˆæƒå’Œå¤§æ–‡ä»¶æ£€æµ‹åï¼Œå°†åŒæ­¥äº‹ä»¶å†™å…¥åˆ° &lt;code>Redis&lt;/code> é˜Ÿåˆ—è¢« &lt;code>Blaze&lt;/code> è¯»å–ï¼Œ&lt;code>Blaze&lt;/code> è·å–åˆ°å½“å‰æœåŠ¡å™¨çš„ &lt;code>Slave&lt;/code> æœºå™¨ï¼Œå°†å½“å‰å­˜å‚¨åº“ä½¿ç”¨ &lt;code>git push --mirror&lt;/code> çš„æ–¹å¼åŒæ­¥åˆ° &lt;code>Slave&lt;/code> ä¸Šï¼Œä¼ è¾“åè®®ä¸º &lt;code>git://&lt;/code>ï¼Œ&lt;code>Slave&lt;/code> æœºå™¨ä¸Šçš„æ¥æ”¶ç«¯ä¸º &lt;code>Git Diamond&lt;/code>ï¼Œ&lt;code>Git Diamond&lt;/code> æ˜¯ä¸“é—¨çš„ Git å†…éƒ¨ä¼ è¾“æœåŠ¡ç«¯ã€‚&lt;/p>
&lt;p>&lt;code>rsync&lt;/code> å¿«ç…§æ–¹æ¡ˆå­—é¢æ„æ€éå¸¸å®¹æ˜“ç†è§£ï¼Œå³å®šæœŸè¿è¡Œ &lt;code>rsync&lt;/code> å°†ä¼ä¸šå­˜å‚¨åº“å¿«ç…§åˆ°ä¼ä¸šå¤‡ä»½æœåŠ¡å™¨ä¸Šçš„ç‰¹å®šç›®å½•ã€‚è€Œæœ¬æ–‡çš„ä¼˜åŒ–ä¸»è¦ä¹Ÿå°±æ˜¯æ˜¯å–ä»£ &lt;code>rsync&lt;/code> çš„å¿«ç…§æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š ä½¿ç”¨ &lt;code>rsync&lt;/code> æ–¹å¼å¤‡ä»½ä»¥ä¸€ä¸ªå¹³å‡å¤§å°ä¸º &lt;code>1GB&lt;/code> çš„å­˜å‚¨åº“æ¥è®¡ç®—ï¼Œ90å¤©ä¸€ä¸ªå‘¨æœŸï¼Œæ¯ 7 å¤©å¤‡ä»½ä¸€æ¬¡ï¼Œéœ€è¦è€—è´¹çš„å­˜å‚¨ç©ºé—´ä¸º &lt;code>12.9 GB&lt;/code>ã€‚æŒ‰ç…§å°Šäº«ç‰ˆ 100GB ç©ºé—´ï¼Œä½¿ç”¨ç‡ &lt;code>20%&lt;/code> è®¡ç®—ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>12.9 GB*20=258 GB
&lt;/code>&lt;/pre>&lt;p>ä¸€ç™¾ä¸ªå°Šäº«ç‰ˆä¼ä¸šå°±éœ€è¦ &lt;code>25.2TB&lt;/code> å­˜å‚¨ç©ºé—´ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸºäº &lt;code>rsync&lt;/code> çš„å¿«ç…§æ–¹æ¡ˆæ˜¯éå¸¸å ç”¨å­˜å‚¨ç©ºé—´çš„ã€‚å®é™…ä¸Šï¼Œæ­¤æ–¹æ¡ˆä¸ä»…å ç”¨å­˜å‚¨ç©ºé—´åœ¨åŒæ­¥çš„æ—¶å€™è¿˜å¾ˆè€—æ—¶ï¼ŒæŒ‰ç…§ç›®å‰çš„æ–¹æ¡ˆï¼Œæ¯ä¸€æ¬¡å¿«ç…§éƒ½éœ€è¦é‡æ–°å®Œæ•´çš„è·å–å­˜å‚¨åº“çš„æ‰€æœ‰æ•°æ®ï¼Œè¿˜æ˜¯ä»¥å‰é¢ 1GB å­˜å‚¨åº“ä¸ºä¾‹ï¼Œ12.9ä¸ªå‘¨æœŸå†…ï¼Œå†…ç½‘æµé‡æ¶ˆè€—ä¸º &lt;em>~13 GB&lt;/em>ã€‚&lt;/p>
&lt;p>åŸºäº &lt;code>rsync&lt;/code> çš„å¿«ç…§æ–¹æ¡ˆä¹Ÿæˆäº† &lt;code>Gitee&lt;/code> ä¼ä¸šå¤‡ä»½çš„ç—›ç‚¹ã€‚åœ¨å‰æ®µæ—¶é—´ï¼Œæˆ‘çªç„¶æƒ³åˆ°å¯ä»¥ä½¿ç”¨åŸºäº &lt;code>Git Namespace&lt;/code> å¿«ç…§ä½¿ç”¨ä¼ä¸šå¿«ç…§ï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥å¤§å¹…åº¦çš„èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œäºæ˜¯å¼€å§‹å¼€å‘å®ç°ï¼Œä¹Ÿå°±æœ‰äº†æœ¬æ–‡ã€‚&lt;/p>
&lt;h2 id="git-å¼•ç”¨å¿«ç…§æ–¹æ¡ˆ">Git å¼•ç”¨å¿«ç…§æ–¹æ¡ˆ&lt;/h2>
&lt;p>Git å­˜å‚¨åº“çš„èµ„äº§ä¸»è¦æ˜¯å¯¹è±¡å’Œå¼•ç”¨ï¼Œå¯¹è±¡å®é™…ä¸Šæ˜¯æŒ‰ç…§å“ˆå¸Œå­˜å‚¨åˆ°å­˜å‚¨åº“ä¸­çš„ï¼Œåœ¨ä¹‹å‰çš„å¤‡ä»½æ–¹æ¡ˆä¸­ï¼Œåœ¨åŒä¸€ä¸ªå­˜å‚¨åº“çš„ä¸åŒå¤‡ä»½ä¸­ï¼Œå­˜åœ¨æœ‰å¤§é‡é‡å¤çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å ç”¨äº†å­˜å‚¨ç©ºé—´ã€‚æˆ‘ä»¬åªè¦åœ¨ä¸åŒçš„å¿«ç…§ä¸­å¤ç”¨è¿™äº›å¯¹è±¡å³å¯ã€‚git å­˜å‚¨åº“ä¸­å¤ç”¨å¯¹è±¡å¯ä»¥ä½¿ç”¨ &lt;code>GIT_NAMESPACE&lt;/code> éš”ç¦»æ¨¡æ‹Ÿæˆä¸åŒçš„å­˜å‚¨åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹è±¡å€Ÿç”¨ï¼Œå€Ÿç”¨å¯¹è±¡å¯èƒ½ä½¿ &lt;code>Bitmap&lt;/code> çš„ä¼˜åŒ–å¤±è´¥ï¼Œå¹¶ä¸”å¤šæ¬¡å¿«ç…§å¯èƒ½ä¼šå½¢æˆå€Ÿç”¨ç›®å½•çš„é“¾å¼ä¾èµ–å¸¦æ¥é—®é¢˜ï¼Œå› æ­¤åœ¨æŠ€æœ¯é€‰å‹ä¸Šä¹Ÿå°±é€‰æ‹©äº†åŸºäº GIT_NAMESPACE æ¥å®ç°å¿«ç…§ã€‚&lt;/p>
&lt;p>ä½¿ç”¨å¼•ç”¨å¿«ç…§æ–¹æ¡ˆèƒ½å¤ŸèŠ‚çœå¤§é‡çš„å­˜å‚¨ï¼Œä¸‹é¢æœ‰ä¸¤ä¸ªå¿«ç…§é—´éš”çš„å¯¹æ¯”ï¼š&lt;/p>
&lt;p>90 å¤©å‘¨æœŸå†…ï¼Œ7å¤©ä¸€æ¬¡å¿«ç…§ï¼Œå­˜å‚¨åº“å–å¹³å‡å€¼ 1GBï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ¡ˆ&lt;/th>
&lt;th>å­˜å‚¨æ¶ˆè€—&lt;/th>
&lt;th>å­˜å‚¨åº“æ•°æ®æµé‡æ¶ˆè€—&lt;/th>
&lt;th>å¼•ç”¨æ•°ç›®ï¼ˆå¹³å‡å€¼ 1Wï¼‰&lt;/th>
&lt;th>å­˜å‚¨å æ¯”&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>rsync&lt;/td>
&lt;td>~13 GB&lt;/td>
&lt;td>13 GB&lt;/td>
&lt;td>1 * 13 W&lt;/td>
&lt;td>100%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>git snapshot&lt;/td>
&lt;td>1 GB&lt;/td>
&lt;td>1 GB&lt;/td>
&lt;td>13 W&lt;/td>
&lt;td>~7.8%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>git snapshot (double)&lt;/td>
&lt;td>2 GB&lt;/td>
&lt;td>2 GB&lt;/td>
&lt;td>13 W * 2&lt;/td>
&lt;td>~15.5%&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>90 å¤©å‘¨æœŸå†…ï¼Œæ¯å¤©å¿«ç…§ä¸€æ¬¡ï¼Œå­˜å‚¨åº“å–å¹³å‡å€¼ 1GBï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ¡ˆ&lt;/th>
&lt;th>å­˜å‚¨æ¶ˆè€—&lt;/th>
&lt;th>å­˜å‚¨åº“æ•°æ®æµé‡æ¶ˆè€—&lt;/th>
&lt;th>å¼•ç”¨æ•°ç›®ï¼ˆå¹³å‡å€¼ 1Wï¼‰&lt;/th>
&lt;th>å­˜å‚¨å æ¯”&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>rsync&lt;/td>
&lt;td>90 GB&lt;/td>
&lt;td>90 GB&lt;/td>
&lt;td>1 * 90 W&lt;/td>
&lt;td>100%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>git snapshot&lt;/td>
&lt;td>1 GB&lt;/td>
&lt;td>1 GB&lt;/td>
&lt;td>90 W&lt;/td>
&lt;td>~1.1%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>git snapshot (double)&lt;/td>
&lt;td>2 GB&lt;/td>
&lt;td>2 GB&lt;/td>
&lt;td>90 W * 2&lt;/td>
&lt;td>~2.2%&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="git-snapshot-åŸç†">Git Snapshot åŸç†&lt;/h3>
&lt;p>åœ¨å¿«ç…§å­˜å‚¨åº“æ—¶ï¼Œå¦‚æœå­˜å‚¨åº“ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å…ˆéœ€è¦å°†å­˜å‚¨åº“ä»¥é•œåƒçš„æ–¹å¼å…‹éš†ä¸‹æ¥ï¼Œå‘½ä»¤è¡Œå¦‚ä¸‹ï¼ˆgit clone æ”¯æŒç›®å½•é€’å½’åˆ›å»ºï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git clone git@gitee.com/oscstudio/git.git --mirror --bare /home/git/enbk/os/oscstudio/git.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœå­˜å‚¨åº“å­˜åœ¨ï¼Œåˆ™æ˜¯ç”¨ &lt;code>fetch&lt;/code>ï¼Œå‘½ä»¤è¡Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git fetch git@gitee.com/oscstudio/git.git &lt;span style="color:#a6be9d">&amp;#39;+refs/heads/*:refs/heads/*&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;+refs/tags/*:refs/tags/*&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;+refs/fetches/*:refs/fetches/*&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;+refs/pull/*:refs/pull/*&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;+refs/pull/*:refs/pull/*&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;+refs/git-as-svn/*:refs/git-as-svn/*&amp;#39;&lt;/span> --prune
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ä¸åŒå‰ç¼€çš„å¼•ç”¨å®é™…ç±»å‹ä¸ä¸€æ ·ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Prefix&lt;/th>
&lt;th>Type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>refs/heads/&lt;/td>
&lt;td>å¸¸è§„åˆ†æ”¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>refs/tags&lt;/td>
&lt;td>æ ‡ç­¾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>refs/fetches/&lt;/td>
&lt;td>PR åŠŸèƒ½ç›¸å…³&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>refs/pull/&lt;/td>
&lt;td>PR åŠŸèƒ½ç›¸å…³&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>refs/git-as-svn/&lt;/td>
&lt;td>svn åŠŸèƒ½ç›¸å…³&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä¸ &lt;code>Subversion&lt;/code> ç›¸æ¯”ï¼ŒGit åˆ›å»ºåˆ†æ”¯éå¸¸è½»é‡çº§ï¼Œè€Œåœ¨ Git ä¸­ï¼Œåˆ†æ”¯å®é™…ä¸Šå¯¹åº”çš„æ˜¯ä»¥ &lt;code>refs/heads/&lt;/code> å¼€å¤´çš„å¼•ç”¨ã€‚é‚£ä¹ˆå¼•ç”¨çš„åˆ›å»ºåŒæ ·åº”è¯¥æ˜¯è½»é‡çº§çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°† &lt;code>fetch&lt;/code> å‘½ä»¤ä¸­çš„å¼•ç”¨åˆ›å»ºåŸºäºåç§°ç©ºé—´çš„å¿«ç…§å³å¯ï¼š&lt;/p>
&lt;p>&lt;strong>å¿«ç…§å˜æ¢&lt;/strong>ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>refname ---&amp;gt; refs/namespaces/yyyy-MM-dd/refname
&lt;/code>&lt;/pre>&lt;p>åˆ›å»º Git å¼•ç”¨å¯ä»¥ä½¿ç”¨ git å‘½ä»¤è¡Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>libgit2&lt;/code>ã€‚å‘½ä»¤è¡Œåˆ›å»ºå¼•ç”¨å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ git update-ref refs/namespaces/2018-11-18/refs/heads/master 1a410efbd13591db07496601ebc7a059dd55cfe9
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ libgit2 API: &lt;a href="https://libgit2.org/libgit2/#HEAD/group/reference/git_reference_create">git_reference_create&lt;/a> åˆ›å»ºå¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">git_reference&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">ref&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span>(&lt;span style="color:#58a1dd">git_reference_create&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ref&lt;/span>,&lt;span style="color:#58a1dd">repo&lt;/span>,&lt;span style="color:#a6be9d">&amp;#34;refs/namespaces/2018-11-18/refs/heads/master&amp;#34;&lt;/span>,&lt;span style="color:#58a1dd">id&lt;/span>,&lt;span style="color:#a6be9d">1&lt;/span>,&lt;span style="color:#a6be9d">&amp;#34;cretae&amp;#34;&lt;/span>)&lt;span style="color:#ff636f">!=&lt;/span>&lt;span style="color:#a6be9d">0&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#58a1dd">giterr_last&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">fprintf&lt;/span>(&lt;span style="color:#58a1dd">stderr&lt;/span>,&lt;span style="color:#a6be9d">&amp;#34;create error %s&lt;/span>&lt;span style="color:#a6be9d">\n&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>,&lt;span style="color:#58a1dd">err&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">kmessage&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“å¼•ç”¨æ•°ç›®æ¯”è¾ƒå°‘æ—¶æ— è®ºæ˜¯ä½¿ç”¨å‘½ä»¤è¡Œè¿˜æ˜¯ä½¿ç”¨ API éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œä½†åƒ Gitee çš„æºç å­˜å‚¨åº“ Gitlab è¿™æ ·çš„é¡¹ç›®å¼•ç”¨è¶…è¿‡ &lt;strong>1W&lt;/strong> ä¸ªæ—¶ï¼Œæ— è®ºæ˜¯ API è¿˜æ˜¯å‘½ä»¤è¡Œéƒ½å°†å˜å¾—æ— æ¯”ç¼“æ…¢ã€‚è¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œåˆ›å»ºä¸€æ¬¡å¿«ç…§éœ€è¦åˆ›å»ºåŒç­‰æ•°ç›®çš„å¼•ç”¨ï¼Œlibgit2 åˆ›å»ºå¼•ç”¨éœ€è¦åœ¨ç£ç›˜ä¸Šåˆ›å»ºåŒç­‰æ•°ç›®çš„æ¾æ•£å¼•ç”¨ï¼Œåœ¨åˆ›å»ºå¼•ç”¨å‰éœ€è¦åˆ›å»º refname.lock è¿™æ ·çš„æ–‡ä»¶é¿å…ä¸å…¶ä»– git è¿›ç¨‹æˆ–è€… API å‘ç”Ÿè®¿é—®å†²çªã€‚è¿™æ ·ä¸‹æ¥åˆ›å»ºæ–‡ä»¶çš„ç³»ç»Ÿè°ƒç”¨ä¹Ÿå°±æ˜¯éš¾ä»¥æ¥å—çš„ã€‚è€Œ &lt;code>git&lt;/code> å‘½ä»¤è¡Œåœ¨è¿™ç‚¹ä¸Šä¹Ÿæ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚æœ€å¼€å§‹æˆ‘ç›´æ¥ä½¿ç”¨ &lt;code>libgit2&lt;/code> APIï¼Œå½“åˆ›å»ºåˆ°ç¬¬åæ¬¡å¿«ç…§æ—¶ï¼Œä¸€æ¬¡å¿«ç…§éœ€è¦èŠ±è´¹å‡ åˆ†é’Ÿï¼Œè¿™è‚¯å®šæ—¶ä¸èƒ½æ¥å—çš„ã€‚&lt;/p>
&lt;p>ä¸“é—¨çš„ä¼ä¸šå¿«ç…§æœºå™¨å®é™…ä¸Šå¹¶ä¸éœ€è¦è¿è¡Œå…¶ä»–ä¸šåŠ¡ï¼Œä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒåˆ›å»º Git å¼•ç”¨çš„å®‰å…¨é—®é¢˜ï¼Œè¿™æ—¶å€™åšä¸ªå–èˆå°±å¯ä»¥å®ç°ä¼˜åŒ–ï¼Œæ¯”å¦‚ç›´æ¥åˆ›å»ºå¼•ç”¨ï¼Œå¼•ç”¨å­˜å‚¨åœ¨ç£ç›˜ä¸Šåˆ†ä¸º &lt;code>loose references&lt;/code> å’Œ &lt;code>packed references&lt;/code>ã€‚å¦‚æœè¿˜æ˜¯åˆ›å»ºæ¾æ•£å¼•ç”¨åŠ¿å¿…éœ€è¦åˆ›å»ºæ•°é‡å·¨å¤šçš„æ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ä¼˜åŒ–éå¸¸ä¼˜å…ˆï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ç›´æ¥ç¼–å†™ &lt;code>packed-refs&lt;/code>ï¼Œ&lt;code>packed-refs&lt;/code> æ ¼å¼å³ &lt;code>$COMMITID SP $REFNAME LF&lt;/code>ï¼Œéå¸¸ç®€å•ã€‚æˆ‘ä»¬æŒ‰ç…§è¦æ±‚æ ¼å¼åŒ–è¾“å‡ºå³å¯ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-packed-refs" data-lang="packed-refs"># pack-refs with: peeled fully-peeled sorted
$COMMITID $REFNAME\n
&lt;/code>&lt;/pre>&lt;p>åˆ›å»º &lt;code>packed-refs&lt;/code> ä¹‹å‰å…ˆä½¿ç”¨ &lt;code>git pack-refs --all --prune&lt;/code> å‘½ä»¤å°†åŸæœ‰çš„å¼•ç”¨æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œç„¶åæ‰«ææ—§çš„ &lt;code>packed-refs&lt;/code> å†™å…¥åˆ°æ–°çš„ &lt;code>packed-refs&lt;/code> ï¼ŒæˆåŠŸåæ›¿æ¢æ–‡ä»¶å³å¯ã€‚&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>packed-refs å¼•ç”¨åéœ€è¦æŒ‰ç…§å­—æ¯æ’åºï¼Œå¦åˆ™å¼•ç”¨ä¼šæ‰¾ä¸åˆ°ã€‚&lt;/li>
&lt;li>ä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯å‡å°‘æ‹·è´éå¸¸å¿…è¦ã€‚&lt;/li>
&lt;li>å¯ä»¥ä½¿ç”¨ C++17 std::string_view è¿™æ ·çš„å®¹å™¨æ–¹ä¾¿è§£æã€‚å­˜å‚¨åœ¨å®¹å™¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>string_view&lt;/code>ã€‚&lt;/li>
&lt;li>HEAD ä¹Ÿéœ€è¦å¿«ç…§ï¼Œæˆ‘ä»¬çš„åšæ³•æ—¶å°†å…¶æ”¾åœ¨ &lt;code>.git/_enbk/$NS&lt;/code> è·¯å¾„ä¸‹ã€‚&lt;/li>
&lt;li>ä¸ºäº†ä¿è¯å¼•ç”¨è¢«åˆ é™¤æ—¶æ„ŸçŸ¥ä¸åˆ°ï¼Œå¯ä»¥å…ˆä»è¿œç¨‹æœåŠ¡å™¨è¿è¡Œ &lt;code>ls-remote&lt;/code> è·å¾—å¼•ç”¨åˆ—è¡¨ï¼Œå†™å…¥å¿«ç…§æ—¶åˆ é™¤ä¸å­˜åœ¨çš„å³å¯ã€‚ä¸ºäº†æ”¯æŒæ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>absl::flat_hash_set&lt;/code> ä¹‹ç±»çš„æ— åºæ”¯æŒå¼‚æ„æŸ¥æ‰¾å®¹å™¨ã€‚&lt;/li>
&lt;/ol>
&lt;p>ç»æµ‹è¯•ï¼Œå¿«ç…§çš„æ—¶é—´å‡å°‘å¹…åº¦éå¸¸å¤§ï¼Œä½†å¼•ç”¨æ•°é‡è¾¾åˆ° &lt;code>24W&lt;/code> æ—¶ï¼Œå¿«ç…§æ—¶é—´ä¸º 300 å¤šæ¯«ç§’ï¼ˆæœºæ¢°ç¡¬ç›˜)ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>./bin/git-snapshot bk git@localhost:oschina/gitlab.git -n 2018-11-30 -V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>username: (none)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>use privatekey: /home/example/.ssh/id_rsa
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>url: git@localhost:oschina/gitlab.git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remote git@localhost:oschina/gitlab.git has 10721 refs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>å…‹éš†åˆ°çº¯ä»“åº“ &amp;#39;/home/git/repositories/snapshot/os/oschina/gitlab.git&amp;#39;...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remote: æšä¸¾å¯¹è±¡: 497921, å®Œæˆ.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remote: å¯¹è±¡è®¡æ•°ä¸­: 100% (497921/497921), å®Œæˆ.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remote: å‹ç¼©å¯¹è±¡ä¸­: 100% (99609/99609), å®Œæˆ.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>remote: æ€»å…± 497921 ï¼ˆå·®å¼‚ 393964ï¼‰ï¼Œå¤ç”¨ 497921 ï¼ˆå·®å¼‚ 393964ï¼‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ¥æ”¶å¯¹è±¡ä¸­: 100% (497921/497921), 211.43 MiB | 51.58 MiB/s, å®Œæˆ.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>å¤„ç† delta ä¸­: 100% (393964/393964), å®Œæˆ.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>snapshot write 21442 refs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apply /home/git/repositories/snapshot/os/oschina/gitlab.git HEAD to refs/heads/master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ls-remote time: 88 ms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>prepare time: 12684 ms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>snapshot time: 17 ms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>total time: 12789 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å­˜å‚¨åº“ä»å¿«ç…§æ¢å¤">å­˜å‚¨åº“ä»å¿«ç…§æ¢å¤&lt;/h3>
&lt;p>æ¢å¤å­˜å‚¨åº“çš„æ—¶å€™ä½¿ç”¨åç§°ç©ºé—´éš”ç¦»ï¼Œç„¶å clone åˆ°ç‰¹å®šçš„ç›®å½•å³å¯ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git -c protocol.ext.allow&lt;span style="color:#ff636f">=&lt;/span>always clone &lt;span style="color:#a6be9d">&amp;#39;ext::git --namespace=yyyy-MM-dd %s /path/bk/dir.git&amp;#39;&lt;/span> /path/save/dir.git --mirror
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>åœ¨ç ”ç©¶æ­¤æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦å¯¹ Git çš„ç›¸å…³æŠ€æœ¯ç»†èŠ‚éå¸¸æ¸…æ¥šï¼Œæ¯”å¦‚ï¼Œç¬”è€…åœ¨ç¼–å†™ &lt;code>packed-refs&lt;/code> æ—¶ï¼Œæœ€å¼€å§‹æœªäº†è§£åˆ° &lt;code>packed-refs&lt;/code> å¼•ç”¨æ˜¯æŒ‰å­—æ¯æ’åºçš„ï¼Œç›´æ¥å†™å…¥å¯¼è‡´ä¸€äº›å¼•ç”¨å¼‚å¸¸ï¼Œå†™å…¥å¤±è´¥ã€‚&lt;/p>
&lt;h2 id="å…¶ä»–">å…¶ä»–&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>Git æœåŠ¡å™¨å¹¶ä¸çŸ¥é“ç”¨æˆ·æ˜¯å¦æ˜¯å¼ºåˆ¶æ¨é€ï¼Œé™¤éå¼€å¯äº† &lt;code>receive.denyNonFastForwards=true&lt;/code>ï¼Œ&lt;code>receive-pack&lt;/code> é€šè¿‡ commit å›æº¯æ‰«ææ£€æŸ¥æ‰èƒ½çŸ¥é“ç”¨æˆ·æ˜¯å¦å¼ºåˆ¶æ¨é€ï¼ˆè¿™é€šå¸¸ä¼šå‡ç¼“è¿œç¨‹æœåŠ¡å™¨çš„å“åº”é€Ÿåº¦ï¼Œå¹¶ä¸”ä¸ä¸€æ¬¡æ€§æ¨é€çš„ commit æ•°ç›®å¯†åˆ‡ç›¸å…³ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆç†çš„å¼ºæ¨æœ‰æ—¶å€™æ˜¯å¿…è¦çš„ï¼Œæ¯”å¦‚ä½¿ç”¨å¼ºæ¨åˆ é™¤æ¶‰å¯†ä¿¡æ¯ï¼Œä¿®æ”¹æäº¤å†…å®¹ï¼Œåˆå¹¶æäº¤ç­‰ç­‰ï¼Œ ç¬”è€…åœ¨ç»™ Git è´¡çŒ®ä»£ç æ—¶å°±å¤šæ¬¡ä½¿ç”¨å¼ºæ¨ã€‚ &lt;a href="https://github.com/gitgitgadget/git/pull/69">PR: http: add support selecting http version&lt;/a> ä¸­ä¹Ÿå¼ºæ¨äº†å¥½å‡ æ¬¡ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2018/2018-11-18-git-namespace-snapshot/ - Copyright (c) 2009-2024 J23</description></item><item><title>Clangbuilder å·²æ”¯æŒè‡ªåŠ¨æ„å»º CURL</title><link>https://forcemz.net/posts/2018/2018-11-15-clangbuilder-win-curl/</link><pubDate>Thu, 15 Nov 2018 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2018/2018-11-15-clangbuilder-win-curl/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2018/2018-11-15-clangbuilder-win-curl/ -&lt;h1 id="curl">cURL&lt;/h1>
&lt;p>cURL æ˜¯ä¸€ä¸ªéå¸¸è‘—åçš„å¼€æº URL æ•°æ®ä¼ è¾“å·¥å…·ï¼Œæ”¯æŒ &lt;code>HTTP&lt;/code>,&lt;code>HTTPS&lt;/code>,&lt;code>FTP&lt;/code>,&lt;code>SCP&lt;/code>,&lt;code>SFTP&lt;/code>,&lt;code>Telnet&lt;/code> ç­‰åè®®ã€‚ç»å¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œä¹ŸåŒ…æ‹¬ Windows 10 17134/17763ã€‚ä½†ç³»ç»Ÿè‡ªå¸¦çš„ç‰ˆæœ¬é€šå¸¸éƒ½ä¸ä¼šåŠæ—¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œ &lt;code>cURL&lt;/code> æ˜¯ä¸€ä¸ªéå¸¸æ´»è·ƒçš„é¡¹ç›®ï¼Œå¤§çº¦2ä¸ªæœˆå°±ä¼šå‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚æ¯ä¸€æ¬¡æ›´æ–°éƒ½ä¼šä¿®å¤å¤§é‡ bugï¼Œæ–°å¢å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæ¯”å¦‚æœ€è¿‘å¢åŠ äº† &lt;code>DOH&lt;/code> æ›´å¥½çš„ &lt;code>TLS1.3&lt;/code> æ”¯æŒã€‚&lt;/p>
&lt;p>ç³»ç»Ÿè‡ªå¸¦çš„ &lt;code>curl -V&lt;/code> è¾“å‡ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>curl 7.55.1 (Windows) libcurl/7.55.1 WinSSL
Release-Date: [unreleased]
Protocols: dict file ftp ftps http https imap imaps pop3 pop3s smtp smtps telnet tftp
Features: AsynchDNS IPv6 Largefile SSPI Kerberos SPNEGO NTLM SSL
&lt;/code>&lt;/pre>&lt;p>å®é™…ä¸Šï¼Œåœ¨ cURL ä¸‹è½½é¡µé¢ &lt;a href="https://curl.haxx.se/download.html">https://curl.haxx.se/download.html&lt;/a> Windows å¹³å°æœ‰å¥½å‡ ä¸ªäºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†äºŒè¿›åˆ¶ä¸‹è½½ï¼š&lt;a href="https://curl.haxx.se/windows/">https://curl.haxx.se/windows/&lt;/a> åŸºäº &lt;code>Mingw64&lt;/code> æ„å»ºã€‚åœ¨ Github ä¸Šæœ‰æ„å»ºé¡¹ç›®ï¼š&lt;a href="https://github.com/curl/curl-for-win">https://github.com/curl/curl-for-win&lt;/a>ã€‚è€Œè¿™ä¸ªå‘è¡Œç‰ˆä¹Ÿæ˜¯ curl ä¸€ä¸ªå¼€å‘è€…ä¸ªäººé¡¹ç›®çº³å…¥åˆ° curl ä¸­çš„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ &lt;code>vcpkg&lt;/code> å®‰è£… &lt;code>curl&lt;/code>ï¼Œä½†æˆªè‡³ç›®å‰ï¼Œ&lt;code>vcpkg&lt;/code> çš„ &lt;code>OpenSSL&lt;/code> ç‰ˆæœ¬ä¾ç„¶æ˜¯ &lt;strong>1.0.2p&lt;/strong> æ— æ³•æ”¯æŒ &lt;code>TLS 1.3&lt;/code>ã€‚&lt;/p>
&lt;p>ç¬”è€…æƒ³è¦ä½¿ç”¨ &lt;code>Visual C++&lt;/code> æ„å»ºé™æ€é“¾æ¥æ”¯æŒ &lt;code>TLS 1.3&lt;/code> çš„ &lt;code>curl&lt;/code>ï¼Œæœ€åå‘ç°éƒ½å¾—è‡ªå·±ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œäºæ˜¯å°±å†™äº†æ„å»ºè„šæœ¬ã€‚&lt;/p>
&lt;p>è¯ä¸å¤šè¯´ï¼Œä¸€åˆ‡å°½åœ¨ä»£ç ä¸­ã€‚Github æºä»£ç åœ°å€ï¼š&lt;a href="https://github.com/fstudio/clangbuilder/blob/526183ade63a4a9b8bd2f4b99872536c9da9e997/sources/wincurl/wincurl.ps1">sources/wincurl/wincurl.ps1&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#!/usr/bin/env pwsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># Require Clangbuilder install perl&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">param&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$WD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># Import version info&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>. &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>&lt;span style="color:#a6be9d">/version.ps1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># thanks https://github.com/curl/curl-for-win&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Download urls:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">zlib: &lt;/span>&lt;span style="color:#58a1dd">$ZLIB_URL&lt;/span>&lt;span style="color:#a6be9d">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">openssl: &lt;/span>&lt;span style="color:#58a1dd">$OPENSSL_URL&lt;/span>&lt;span style="color:#a6be9d">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">brotli: &lt;/span>&lt;span style="color:#58a1dd">$BROTLI_URL&lt;/span>&lt;span style="color:#a6be9d">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">libssh2: &lt;/span>&lt;span style="color:#58a1dd">$LIBSSH2_URL&lt;/span>&lt;span style="color:#a6be9d">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">nghttp2: &lt;/span>&lt;span style="color:#58a1dd">$NGHTTP2_URL&lt;/span>&lt;span style="color:#a6be9d">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">curl: &lt;/span>&lt;span style="color:#58a1dd">$CURL_URL&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">################################################## Found commands&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#58a1dd">Net.ServicePointManager&lt;/span>]::&lt;span style="color:#58a1dd">SecurityProtocol&lt;/span> = [&lt;span style="color:#58a1dd">Net.SecurityProtocolType&lt;/span>]::&lt;span style="color:#58a1dd">Tls12&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Import-Module&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>&lt;span style="color:#a6be9d">/Utility&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$clexe&lt;/span> = &lt;span style="color:#58a1dd">Get-Command&lt;/span> &lt;span style="color:#58a1dd">-CommandType&lt;/span> &lt;span style="color:#58a1dd">Application&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;cl&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$clexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install Visual Studio 2017 or BuildTools (C++) and Initialzie DevEnv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Find cl.exe: &lt;/span>$(&lt;span style="color:#58a1dd">$clexe&lt;/span>.&lt;span style="color:#58a1dd">Version&lt;/span>)&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$tarexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;tar&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$decompress&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-xvf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$tarexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$tarexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;cmake&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$tarexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install tar or cmake.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$decompress&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-E tar -xvf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Use &lt;/span>&lt;span style="color:#58a1dd">$tarexe&lt;/span>&lt;span style="color:#a6be9d"> as tar&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">Function&lt;/span> &lt;span style="color:#58a1dd">DecompressTar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">param&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$URL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$File&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$Hash&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">Test-Path&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">WinGet&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$URL&lt;/span> &lt;span style="color:#58a1dd">-O&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ((&lt;span style="color:#58a1dd">Get-FileHash&lt;/span> &lt;span style="color:#58a1dd">-Algorithm&lt;/span> &lt;span style="color:#58a1dd">SHA256&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>).&lt;span style="color:#58a1dd">Hash&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#58a1dd">$Hash&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$File&lt;/span>&lt;span style="color:#a6be9d"> exists and hash not match &lt;/span>&lt;span style="color:#58a1dd">$Hash&lt;/span>&lt;span style="color:#a6be9d">.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Remove-Item&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">WinGet&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$URL&lt;/span> &lt;span style="color:#58a1dd">-O&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$File&lt;/span>&lt;span style="color:#a6be9d"> exists and hash is match. use it.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ((&lt;span style="color:#58a1dd">Get-FileHash&lt;/span> &lt;span style="color:#58a1dd">-Algorithm&lt;/span> &lt;span style="color:#58a1dd">SHA256&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>).&lt;span style="color:#58a1dd">Hash&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#58a1dd">$Hash&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Remove-Item&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">WinGet&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$URL&lt;/span> &lt;span style="color:#58a1dd">-O&lt;/span> &lt;span style="color:#58a1dd">$File&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ((&lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$tarexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$decompress&lt;/span>&lt;span style="color:#a6be9d"> &lt;/span>&lt;span style="color:#58a1dd">$File&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Decompress &lt;/span>&lt;span style="color:#58a1dd">$File&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">$true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$curlexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;curl&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$curlexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install curl or upgrade to Windows 10 17134 or Later.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Find curl install: &lt;/span>&lt;span style="color:#58a1dd">$curlexe&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$cmakeexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;cmake&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install cmake.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Find cmake install: &lt;/span>&lt;span style="color:#58a1dd">$cmakeexe&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;ninja&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install ninja.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Find cmake install: &lt;/span>&lt;span style="color:#58a1dd">$Ninjaexe&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Patchexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$Gitexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;git&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Gitexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install git for windows (or PortableGit).&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$gitinstall&lt;/span> = &lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Parent&lt;/span> (&lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Parent&lt;/span> &lt;span style="color:#58a1dd">$gitexe&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ([&lt;span style="color:#58a1dd">String&lt;/span>]::&lt;span style="color:#58a1dd">IsNullOrEmpty&lt;/span>(&lt;span style="color:#58a1dd">$gitinstall&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install git for windows (or PortableGit).&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$patchx&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$gitinstall&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;usr/bin/patch.exe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Try to find patch from &lt;/span>&lt;span style="color:#58a1dd">$patchx&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">Test-Path&lt;/span> &lt;span style="color:#58a1dd">$patchx&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$xinstall&lt;/span> = &lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Parent&lt;/span> &lt;span style="color:#58a1dd">$gitinstall&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> ([&lt;span style="color:#58a1dd">String&lt;/span>]::&lt;span style="color:#58a1dd">IsNullOrEmpty&lt;/span>(&lt;span style="color:#58a1dd">$xinstall&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install git for windows (or PortableGit).&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$patchx&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$xinstall&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;usr/bin/patch.exe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">Test-Path&lt;/span> &lt;span style="color:#58a1dd">$patchx&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install git for windows (or PortableGit).&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> = &lt;span style="color:#58a1dd">$patchx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Found patch install: &lt;/span>&lt;span style="color:#58a1dd">$Patchexe&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Perlexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;perl&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Perlexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please add perl to your environment.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Found perl install: &lt;/span>&lt;span style="color:#58a1dd">$Perlexe&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">########################################################## Check WD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> ([&lt;span style="color:#58a1dd">String&lt;/span>]::&lt;span style="color:#58a1dd">IsNullOrEmpty&lt;/span>(&lt;span style="color:#58a1dd">$WD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$cbroot&lt;/span> = &lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Parent&lt;/span> (&lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$WD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$cbroot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;out/curl&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Cyan&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Build curl on windows use&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Set-Location&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Prefix&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;build&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CURLOUT&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;out&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;we will deploy curl to: &lt;/span>&lt;span style="color:#58a1dd">$CURLPrefix&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$Prefix&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">################################################## Zlib&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$ZLIB_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$ZLIB_FILENAME&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$ZLIB_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ZLIBDIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PWD&lt;/span> &lt;span style="color:#58a1dd">$ZLIB_FILENAME&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ZLIBBD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$ZLIBDIR&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;build&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply zlib.patch ...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ZLIB_PACTH&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/zlib.patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-Nbp1 -i &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$ZLIB_PACTH&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$ZLIBDIR&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply &lt;/span>&lt;span style="color:#58a1dd">$ZLIB_PACTH&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$ZLIBBD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$cmakeflags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-GNinja &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCMAKE_BUILD_TYPE=Release &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DSKIP_INSTALL_FILES=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DSKIP_BUILD_EXAMPLES=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DBUILD_SHARED_LIBS=OFF &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$ZLIBDIR&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$cmakeflags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$ZLIBBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;zlib: create build.ninja error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;all&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$ZLIBBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;zlib: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;install&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$ZLIBBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;zlib: install error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Rename-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/zlibstatic.lib&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/zlib.lib&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#Copy-Item -Path &amp;#34;$ZLIBDIR/LICENSE&amp;#34; &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">##################################################### OpenSSL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Build OpenSSL &lt;/span>&lt;span style="color:#58a1dd">$OPENSSL_VERSION&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$OPENSSL_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$OPENSSL_FILE&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$OPENSSL_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># Update env&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$env:INCLUDE&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">\include;&lt;/span>&lt;span style="color:#58a1dd">$env:INCLUDE&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$env:LIB&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">\lib;&lt;/span>&lt;span style="color:#58a1dd">$env:LIB&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># perl Configure no-shared no-ssl3 enable-capieng -utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$opensslflags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;Configure no-shared no-unit-test no-tests no-ssl3 enable-capieng -utf-8 &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;VC-WIN64A &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">--prefix=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">--openssldir=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Nasmexe&lt;/span> = &lt;span style="color:#58a1dd">Findcommand&lt;/span> &lt;span style="color:#58a1dd">-Name&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;nasm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Nasmexe&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Not found nasm, build openssl no-asm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$opensslflags&lt;/span> += &lt;span style="color:#a6be9d">&amp;#34; no-asm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$openssldir&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#58a1dd">$OPENSSL_FILE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Perlexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$opensslflags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$openssldir&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;openssl: config error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">nmake&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-f makefile&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$openssldir&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;openssl: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">nmake&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-f makefile install_sw&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$openssldir&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;openssl: install_sw error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># build brotli static&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">######################################################### Brotli&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Build brotli &lt;/span>&lt;span style="color:#58a1dd">$BROTLI_VERSION&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$BROTLI_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BROTLI_FILE&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$BROTLI_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BDIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#58a1dd">$BROTLI_FILE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BBUILD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$BDIR&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;out&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BPATCH&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/brotli.patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$BBUILD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-Nbp1 -i &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BPATCH&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$BDIR&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply &lt;/span>&lt;span style="color:#58a1dd">$BPATCH&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$brotliflags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DBROTLI_DISABLE_TESTS=ON &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> ..&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$brotliflags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$BBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;brotli: create build.ninja error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;all&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$BBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;brotli: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;install&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$BBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;brotli: install error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">## Fix curl not exists&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Move-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlicommon-static.lib&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlicommon.lib&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Move-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlidec-static.lib&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlidec.lib&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Move-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlienc-static.lib&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">/lib/brotlienc.lib&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">######################################################### Nghttp2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Build nghttp2 &lt;/span>&lt;span style="color:#58a1dd">$NGHTTP2_VERSION&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$NGHTTP2_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NGHTTP2_FILE&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$NGHTTP2_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$NGDIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#58a1dd">$NGHTTP2_FILE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$NGBUILD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$NGDIR&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;build&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$NGPATCH&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/nghttp2.patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$NGBUILD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-Nbp1 -i &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NGPATCH&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$NGDIR&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply &lt;/span>&lt;span style="color:#58a1dd">$NGPATCH&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ngflags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DENABLE_LIB_ONLY=ON -DENABLE_ASIO_LIB=OFF &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> ..&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$ngflags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$NGBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;nghttp2: create build.ninja error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;all&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$NGBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;nghttp2: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;install&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$NGBUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;nghttp2: install error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">############################################################# Libssh2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Build libssh2 &lt;/span>&lt;span style="color:#58a1dd">$LIBSSH2_VERSION&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$LIBSSH2_FILE&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$LIBSSH2DIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2_FILE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$LIBSSH2BUILD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2DIR&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;build&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$LIBSSH2PATCH&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/libssh2.patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2BUILD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-Nbp1 -i &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$LIBSSH2PATCH&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2DIR&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply &lt;/span>&lt;span style="color:#58a1dd">$LIBSSH2PATCH&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$libssh2flags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DBUILD_EXAMPLES=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DBUILD_TESTING=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DENABLE_ZLIB_COMPRESSION=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> ..&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$libssh2flags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2BUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;libssh2: create build.ninja error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;all&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2BUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;libssh2: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;install&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$LIBSSH2BUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;libssh2: install error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">############################################################## CURL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Yellow&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Final build curl &lt;/span>&lt;span style="color:#58a1dd">$CURL_VERSION&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">DecompressTar&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$CURL_URL&lt;/span> &lt;span style="color:#ff636f">-File&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$CURL_FILE&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Hash&lt;/span> &lt;span style="color:#58a1dd">$CURL_HASH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CURLDIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$WD&lt;/span> &lt;span style="color:#58a1dd">$CURL_FILE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CURLBD&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$CURLDIR&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;build&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CURLPATCH&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/curl.patch&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CURLICON&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;patch/curl.ico&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">MkdirAll&lt;/span> &lt;span style="color:#58a1dd">-Dir&lt;/span> &lt;span style="color:#58a1dd">$CURLBD&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># copy icon to path&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Copy-Item&lt;/span> &lt;span style="color:#58a1dd">$CURLICON&lt;/span> &lt;span style="color:#58a1dd">-Destination&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$CURLDIR&lt;/span>&lt;span style="color:#a6be9d">/src&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">-Force&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Patchexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-Nbp1 -i &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$CURLPATCH&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$CURLDIR&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Apply &lt;/span>&lt;span style="color:#58a1dd">$CURLPATCH&lt;/span>&lt;span style="color:#a6be9d"> failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#https://github.com/curl/curl/blob/master/CMake/FindBrotli.cmake&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BROTLIDEC_LIBRARY&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$Prefix&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;lib/brotlidec-static.lib&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BROTLICOMMON_LIBRARY&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$Prefix&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;lib/brotlicommon-static.lib&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BROTLI_INCLUDE_DIR&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$Prefix&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;include&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">## Use codepage 1252&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$curlflags&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DUSE_NGHTTP2=ON -DBUILD_TESTING=OFF &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DBUILD_CURL_EXE=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCURL_STATIC_CRT=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCMAKE_USE_OPENSSL=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCMAKE_USE_WINSSL=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCMAKE_USE_LIBSSH2=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCURL_BROTLI=ON &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;-DCMAKE_RC_FLAGS=-c1252 &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DBROTLI_DIR=&lt;/span>&lt;span style="color:#58a1dd">$Prefix&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> &amp;#34;&lt;/span> + `
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#58a1dd">$CURLOUT&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> ..&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$cmakeexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#58a1dd">$curlflags&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$CURLBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;curl: create build.ninja error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;all&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$CURLBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;curl: build error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$ec&lt;/span> = &lt;span style="color:#58a1dd">Exec&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#58a1dd">$Ninjaexe&lt;/span> &lt;span style="color:#58a1dd">-Argv&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;install&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WD&lt;/span> &lt;span style="color:#58a1dd">$CURLBD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$ec&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;curl: install error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># download curl-ca-bundle.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$CA_BUNDLE&lt;/span> = &lt;span style="color:#58a1dd">Join-Path&lt;/span> &lt;span style="color:#58a1dd">$CURLOUT&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;bin/curl-ca-bundle.crt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (!(&lt;span style="color:#58a1dd">WinGet&lt;/span> &lt;span style="color:#58a1dd">-URL&lt;/span> &lt;span style="color:#58a1dd">$CA_BUNDLE_URL&lt;/span> &lt;span style="color:#58a1dd">-O&lt;/span> &lt;span style="color:#58a1dd">$CA_BUNDLE&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;download curl-ca-bundle.crt error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Green&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;curl: build completed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ„å»ºçš„ &lt;code>curl -v&lt;/code> è¾“å‡ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>$ curl -V
curl 7.62.0 (Windows) libcurl/7.62.0 OpenSSL/1.1.1 (WinSSL) zlib/1.2.11 brotli/1.0.7 libssh2/1.8.0 nghttp2/1.34.0
Release-Date: 2018-10-31
Protocols: dict file ftp ftps gopher http https imap imaps ldap pop3 pop3s rtsp scp sftp smtp smtps telnet tftp
Features: AsynchDNS IPv6 Largefile SSPI Kerberos SPNEGO NTLM SSL libz brotli HTTP2 HTTPS-proxy MultiSSL
&lt;/code>&lt;/pre>- https://forcemz.net/posts/2018/2018-11-15-clangbuilder-win-curl/ - Copyright (c) 2009-2024 J23</description></item><item><title>Git LFS çš„åæ€</title><link>https://forcemz.net/posts/2018/2018-07-15-git-lfs-rethinking/</link><pubDate>Sun, 15 Jul 2018 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2018/2018-07-15-git-lfs-rethinking/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2018/2018-07-15-git-lfs-rethinking/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>åœ¨ä¸€å¹´å¤šä»¥å‰ï¼Œç¬”è€…æ›¾ç»å†™è¿‡ä¸€æ–‡ï¼š &lt;a href="https://forcemz.net/git/2017/04/16/Moses/">ã€ŠGit LFS æœåŠ¡å™¨å®ç°æ‚è°ˆã€‹&lt;/a>ï¼Œæœ€è¿‘ç¬”è€…å¼€å‘åŸºäº&lt;strong>å¯¹è±¡å­˜å‚¨&lt;/strong>çš„ LFS æœåŠ¡å™¨åˆæœ‰äº†ä¸€äº›å¿ƒå¾—ï¼Œè¿™é‡Œåˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p>
&lt;h1 id="å…³äº-git-lfs">å…³äº Git LFS&lt;/h1>
&lt;p>Git LFS å³ Git Large File Storage ï¼ˆå¤§æ–‡ä»¶å­˜å‚¨ï¼‰ï¼Œå³å°† git å­˜å‚¨åº“ä¸­çš„ä½“ç§¯è¾ƒå¤§çš„ï¼Œä¸åˆ©äºæ‰“åŒ…çš„ï¼Œä¿®æ”¹ä¸å¤ªé¢‘ç¹çš„æ–‡ä»¶å•ç‹¬å­˜å‚¨åˆ°ç‰¹å®šçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥å‡å°å­˜å‚¨åº“ä½“ç§¯ï¼ŒåŠ å¿«ç”¨æˆ·çš„å…‹éš†æ‹‰å–ä½“éªŒã€‚å…¶ä¸­çš„åŸç†åœ¨ &lt;a href="https://forcemz.net/git/2017/04/16/Moses/">ã€ŠGit LFS æœåŠ¡å™¨å®ç°æ‚è°ˆã€‹&lt;/a> éƒ½æœ‰è¯´æ˜ï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥çš„äº†è§£è¿˜å¯ä»¥å»å‚è€ƒ Git LFS æŠ€æœ¯è§„èŒƒï¼š &lt;a href="https://github.com/git-lfs/git-lfs/blob/master/docs/spec.md"> spec.md&lt;/a>ã€‚&lt;/p>
&lt;p>æŒ‰ç…§ LFS è§„èŒƒï¼Œåªè¦å®ç°äº† Git LFS API ä»¥åŠç›¸åº”çš„æ¥å£ï¼ŒLFS å®¢æˆ·ç«¯å¹¶ä¸ä¼šå…³å¿ƒå¤§æ–‡ä»¶å­˜å‚¨åœ¨é‚£ä¸ªåœ°æ–¹ã€‚&lt;/p>
&lt;h1 id="git-lfs-å­˜å‚¨">Git LFS å­˜å‚¨&lt;/h1>
&lt;p>LFS å¯¹è±¡å¯ä»¥å­˜å‚¨åˆ°ä»£ç æ‰˜ç®¡å¹³å°çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åˆ°å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ä¸Šï¼Œä¸åŒçš„å¹³å°æœ‰ä¸åŒçš„é€‰æ‹©ã€‚è¿™é‡Œé€‰æ‹©å‡ ä¸ªåˆ†æä¸€ä¸‹ã€‚&lt;/p>
&lt;h2 id="github-lfs-å­˜å‚¨">Github LFS å­˜å‚¨&lt;/h2>
&lt;p>Github å¾ˆæ—©å°±ä¸ Amazon æœ‰æ·±åº¦çš„åˆä½œï¼Œæ¯”å¦‚ Github çš„é™„ä»¶ï¼ŒRelease éƒ½æ˜¯å°†æ–‡ä»¶å­˜å‚¨åˆ° AWS S3 ä¸Šï¼Œç„¶åæ—¶å€™å…±äº«å¯†é’¥çš„æ–¹å¼ä¸‹è½½ï¼ŒGithub å°†è¿™äº›æ–‡ä»¶æ”¾åœ¨ S3 ä¸Šï¼Œå‡è½»äº† Github è‡ªèº«æœåŠ¡å™¨çš„è´Ÿè½½ã€‚æ–‡ä»¶å¤‡ä»½ç­‰éƒ½ä¸éœ€è¦ Github è‡ªå·±ç®¡ç†ï¼Œè¿™æ— ç–‘é™ä½äº†å¼€å‘çš„éš¾åº¦ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åœ¨å®ç° Git LFS æ—¶ï¼ŒGithub ä¹Ÿå°†å¯¹è±¡å­˜å‚¨åˆ° AWS S3 ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å»è°ƒè¯• Github çš„å¯¹è±¡å­˜å‚¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">GIT_TRACE_PACKET&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span> &lt;span style="color:#58a1dd">GIT_TRACE&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span> &lt;span style="color:#58a1dd">GIT_CURL_VERBOSE&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span> git push
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢æ˜¯ &lt;strong>upload&lt;/strong> æ•°æ®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;objects&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;oid&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;42e44ce1337ecd9bab99e78f42df5f73ae1a7e5bda505054e04cd4f36ed7bf21&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;size&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">2097152&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;actions&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;upload&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;href&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;https://github-cloud.s3.amazonaws.com/alambic/media/180597487/42/e4/42e44ce1337ecd9bab99e78f42df5f73ae1a7e5bda505054e04cd4f36ed7bf21?actor_id=6904176&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;header&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;Authorization&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;AWS4-HMAC-SHA256 Credential=AKIAIMWPLRQEC4XCWWPA/20180628/us-east-1/s3/aws4_request,SignedHeaders=host;x-amz-content-sha256;x-amz-date,Signature=SignatureString&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;x-amz-content-sha256&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;42e44ce1337ecd9bab99e78f42df5f73ae1a7e5bda505054e04cd4f36ed7bf21&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;x-amz-date&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;20180628T032201Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;expires_at&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;2018-06-28T03:37:01Z&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;expires_in&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">900&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;verify&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;href&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;https://lfs.github.com/lfstest/lfstest/objects/42e44ce1337ecd9bab99e78f42df5f73ae1a7e5bda505054e04cd4f36ed7bf21/verify&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;header&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;Authorization&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;RemoteAuth Token&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;Accept&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;application/vnd.git-lfs+json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†å¯¹è±¡å­˜å‚¨åˆ° S3 ä¸Šï¼Œå­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼Œå³å½“ &lt;strong>upload&lt;/strong> æˆåŠŸåï¼ŒGithub æ˜¯æ— æ³•è¢«åŠ¨æ„ŸçŸ¥çš„ï¼ŒS3 ç›®å‰å¹¶æ²¡æœ‰ Update-Callback è¿™æ ·çš„åŠŸèƒ½ï¼ŒGit LFS æœ‰ä¸€ä¸ª &lt;code>verify&lt;/code> å­—æ®µï¼Œå³é€šçŸ¥æœåŠ¡å™¨å»éªŒè¯ &lt;strong>upload&lt;/strong> æ˜¯å¦æˆåŠŸã€‚&lt;/p>
&lt;h2 id="bitbucket-lfs-å­˜å‚¨">Bitbucket LFS å­˜å‚¨&lt;/h2>
&lt;p>Bitbucket ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼ŒBitbucket çš„ LFS åšçš„æ¯”è¾ƒç²¾è‡´ï¼Œä¸‹é¢æœ‰ä¸€ç¯‡ Tutorials è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ LFSï¼š &lt;a href="https://www.atlassian.com/git/tutorials/git-lfs">Git LFS Tutorials&lt;/a>&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ Bitbucket LFS çš„ç®¡ç†ç•Œé¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://wac-cdn.atlassian.com/dam/jcr:46218516-f4aa-490a-9afc-c36ca863c98f/09.png" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Git è°ƒè¯•æ¨¡å¼è·å¾— Bitbucket çš„ä¸€äº›ç»†èŠ‚ï¼Œä¸‹é¢æ˜¯ &lt;strong>download&lt;/strong> çš„æ•°æ®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;objects&amp;#34;&lt;/span>: [{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;oid&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;e29b4e1206ef04580f63cedd043834296fd56ad777d1903a0cab8b6178f6a6e0&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;actions&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;download&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;header&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;X-Client-ID&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;uuid-token&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;Authorization&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Bearer BearerToken&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;href&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;https://api.media.atlassian.com/file/6d4949ce-2442-424b-9875-983008b943d0/binary&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;size&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">1048576&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä» JSON æ•°æ®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ Bitbucket å¹¶æ²¡æœ‰ç›´æ¥å°†å¯¹è±¡å­˜å‚¨åˆ°äº‘æœåŠ¡å¯¹è±¡å­˜å‚¨ä¸Šï¼Œå¹¶ä¸” Bitbucket ä½¿ç”¨äº† OAuth çš„éªŒè¯æ–¹å¼ã€‚&lt;/p>
&lt;p>Bitbucket è¿™ç§è®¾è®¡åœ¨å®ç°ç²¾è‡´çš„ LFS ç®¡ç†åŠŸèƒ½æ—¶å¾ˆæœ‰å¸®åŠ©ï¼Œè€Œ Github å°†å¯¹è±¡å­˜å‚¨åˆ° S3 ä¸Šï¼Œ ä¸€æ¥æ— æ³•ç›´æ¥æ£€éªŒå¯¹è±¡çš„ SHA256ï¼Œå¦ä¸€æ–¹é¢æ— æ³•æ£€æµ‹å¯¹è±¡çš„ &lt;code>Mime&lt;/code>ï¼Œä¹Ÿå°±æ— æ³•åšåˆ°åƒ Bitbucket è¿™æ ·çš„æ•ˆæœã€‚Bitbucket å¯ä»¥æŸ¥çœ‹ LFS å¯¹è±¡çš„ Mime(File Type)ï¼Œä¸Šä¼ æ—¶é—´ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ é™¤æ¯”è¾ƒæ—§çš„å¯¹è±¡ï¼Œä»è€Œé™ä½ LFS æ–‡ä»¶çš„é…é¢å ç”¨ã€‚ä»è¿™äº›æ–¹é¢æ¥çœ‹ Bitbucket æ›´èƒœä¸€ç­¹ã€‚ä½†ä¹Ÿæ— æ³•äº«å—å¯¹è±¡å­˜å‚¨çš„å¥½å¤„äº†ã€‚&lt;/p>
&lt;h2 id="moses-to-lfsoss">Moses to LFSOSS&lt;/h2>
&lt;p>ç äº‘åœ¨å»å¹´å¼€å‘ LFS åŠŸèƒ½æ—¶ä½¿ç”¨çš„æ˜¯å’Œ Bitbucket ä¸€æ ·çš„æœºåˆ¶ï¼Œæ²¡æœ‰ä½¿ç”¨å¯¹è±¡å…±äº«ï¼Œå³å½“ Sha256 ä¸€è‡´æ—¶ï¼Œå¹¶ä¸æ”¯æŒå…±äº«ï¼Œè¿™æ— ç–‘å¢åŠ äº†æœåŠ¡å™¨å­˜å‚¨å ç”¨ã€‚&lt;/p>
&lt;p>æœ€è¿‘ï¼Œéšç€éœ€æ±‚çš„æ”¹å˜ï¼Œæˆ‘ä»¬è¦å°† LFS å¯¹è±¡å­˜å‚¨åˆ° OSS ä¸Šï¼Œäºæ˜¯ç¬”è€…ä¹Ÿå°±å¼€å‘äº† LFSOSS äº†ï¼Œæ”¯æŒå¤šç§åç«¯ï¼Œåªéœ€è¦ä¿®æ”¹ç‰¹å®š URL çš„ç”Ÿæˆå³å¯æ”¯æŒã€‚è€Œä¸åŒçš„äº‘å­˜å‚¨çš„å¯¹è±¡å­˜å‚¨ä¹Ÿæœ‰ä¸€äº›ä¼˜ç¼ºç‚¹ã€‚&lt;/p>
&lt;h1 id="å¯¹è±¡å­˜å‚¨çš„å¯¹æ¯”">å¯¹è±¡å­˜å‚¨çš„å¯¹æ¯”&lt;/h1>
&lt;p>ç äº‘åœ¨æ”¯æŒ LFS for OSS æ—¶ï¼Œè€ƒå¯Ÿäº†å‡ ä¸ªå¯¹è±¡å­˜å‚¨ã€‚å¦‚ Azure Blobï¼ŒAmazon S3ï¼ŒAliyun OSSï¼ŒTencent COSã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Object Storage&lt;/th>
&lt;th>Shared Key&lt;/th>
&lt;th>Content Verify&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Azure Blob&lt;/td>
&lt;td>Hmac Sha256&lt;/td>
&lt;td>Content-MD5&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Amazon S3&lt;/td>
&lt;td>Hmac Sha256&lt;/td>
&lt;td>Content-MD5, x-amz-content-sha256&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aliyun OSS&lt;/td>
&lt;td>Hmac Sha1&lt;/td>
&lt;td>Content-MD5, x-oss-callback&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tencent COS&lt;/td>
&lt;td>Hmac Sha1&lt;/td>
&lt;td>Content-MD5&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>é€‰æ‹©ä¸åŒçš„äº‘æœåŠ¡ï¼Œä¸ä½†éœ€è¦è€ƒè™‘è¿™äº›äº‘æœåŠ¡çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ°ä¸€äº›ç»æµå› ç´ ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å®‰å…¨ä¸Šï¼ŒAWS S3 æ— ç–‘æ˜¯æœ€å¥½çš„ï¼ŒAzure æ¬¡ä¹‹ï¼Œå…¶ä»–çš„å®‰å…¨æ„è¯†å¹¶ä¸èƒ½ç®—éå¸¸å¥½ï¼Œæ¯•ç«Ÿ MD5/SHA1 æ—©å·²ç»è¢«ç ´è§£ã€‚å¦‚æœè€ƒè™‘åˆ°å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ Hash ä½œä¸ºå¯¹è±¡çš„ç´¢å¼•ï¼ŒSHA1 æ— ç–‘æ˜¯ä¸åˆé€‚çš„ï¼Œå°½ç®¡ Aliyun OSS å¹¶ä¸èƒ½å®Œç¾çš„åˆ‡åˆ LFSï¼Œä½†ç”±äºå›½å†…çš„ä¸€äº›ç°çŠ¶ï¼Œç äº‘ä»æ—§åŸºäº Aliyun åšå‡ºäº†ä¸€äº›è®¾è®¡ä¸Šçš„è®©æ­¥ï¼Œé¿å… LFS åœ¨ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨æ—¶å‡ºç°å¯¹è±¡æ±¡æŸ“çš„æƒ…å†µã€‚&lt;/p>
&lt;p>å›è¿‡å¤´æ¥çœ‹ï¼ŒGit LFS æ›´åƒæ˜¯åŸºäº AWS S3 å®šåˆ¶çš„ä¸€æ ·ï¼ŒS3 ä¸Šä¼ æ”¯æŒ &lt;code>x-amz-content-sha256&lt;/code> è€Œ Git LFS å¯¹è±¡çš„ Hash ç®—æ³•ä¹Ÿæ˜¯é€‰æ‹©çš„ &lt;code>SHA256&lt;/code>ï¼Œè¿˜æä¾›äº† &lt;code>Verify&lt;/code> è¿™æ ·çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;h1 id="åæ€">åæ€&lt;/h1>
&lt;p>å¯¹è±¡å­˜å‚¨çš„å®‰å…¨æ„è¯†è¦è·Ÿä¸Šï¼Œé¿å…å¹³å°çš„å±€é™æ€§è€Œå¯¼è‡´æœåŠ¡è®¾è®¡çš„å¦¥åã€‚&lt;/p>
&lt;p>ä¸åŒçš„è®¾è®¡èƒ½å¤Ÿå®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ›´éœ€è¦å–èˆã€‚&lt;/p>
&lt;h1 id="å…¶ä»–">å…¶ä»–&lt;/h1>
&lt;h2 id="å…±äº«å¯†é’¥ä¸‹è½½">å…±äº«å¯†é’¥ä¸‹è½½&lt;/h2>
&lt;p>å…±äº«å¯†é’¥å®é™…ä¸Šå°±æ˜¯å°†è¯·æ±‚çš„ä¸€äº›æ•°æ®ä¸è¿‡æœŸæ—¶é—´ç­‰åˆæˆä¸€ä¸ª Slatï¼Œä½¿ç”¨äº‘å¹³å°ç”Ÿæˆçš„ AccessKeySecret ä½œä¸º Keyï¼ŒåŸºäº Hmac ç”Ÿæˆçš„ç­¾åï¼Œå…¶ä¸­ä¸åŒçš„å¹³å°æ”¯æŒä¸åŒçš„ Hmac å®‰å…¨ç®—æ³•ã€‚å¤§è‡´çš„åŸç†å®é™…ä¸Šå¯ä»¥ç”¨å¦‚ä¸‹ä¼ªä»£ç è¡¨ç¤ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Slat=PlatfromMethod(ReqData,Expires,....)
Signature=Hmac(Secret,Slat)
&lt;/code>&lt;/pre>- https://forcemz.net/posts/2018/2018-07-15-git-lfs-rethinking/ - Copyright (c) 2009-2024 J23</description></item></channel></rss>