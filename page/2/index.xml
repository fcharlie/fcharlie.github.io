<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æ±ŸäºŒåä¸‰çš„æ€è€ƒ</title><link>https://forcemz.net/</link><description>Recent content on æ±ŸäºŒåä¸‰çš„æ€è€ƒ</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>Copyright (c) 2009-2024 J23</copyright><lastBuildDate>Mon, 01 Apr 2024 20:00:00 +0800</lastBuildDate><atom:link href="https://forcemz.net/index.xml" rel="self" type="application/rss+xml"/><item><title>Baulk - å¼€å‘ä¸€ä¸ªç®€å•çš„åŒ…ç®¡ç†å·¥å…·å†ç¨‹</title><link>https://forcemz.net/posts/2020/2020-07-18-baulk/</link><pubDate>Sat, 18 Jul 2020 20:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2020/2020-07-18-baulk/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2020/2020-07-18-baulk/ -&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>ç›¸å¯¹äºå…¶ä»–æ“ä½œç³»ç»Ÿï¼Œæˆ‘æ›´ä¹ æƒ¯ä½¿ç”¨ Windowsï¼Œä½†ä¸€ç›´ä»¥æ¥ Windows ç¼ºä¹å®˜æ–¹çš„åŒ…ç®¡ç†å™¨ï¼Œè€Œç¬¬ä¸‰æ–¹æ— è®ºæ˜¯ Scoop è¿˜æ˜¯ Chocolatey éƒ½æ— æ³•æ»¡è¶³æˆ‘ç‹¬ç‰¹çš„éœ€æ±‚ï¼Œæˆ‘çš„è¦æ±‚å¾ˆç®€å•ï¼Œæ‰€æœ‰çš„è½¯ä»¶åŒ…éƒ½åº”è¯¥ä½¿ç”¨ç»¿è‰²è§£å‹æ¨¡å¼ï¼Œè¿™åŒ…æ‹¬äº† MSI å®‰è£…åŒ…ï¼Œå¦å¤–å®‰è£…è½¯ä»¶æ—¶ä¸åº”è¯¥ä¿®æ”¹ç³»ç»Ÿå’Œç”¨æˆ·ç¯å¢ƒå˜é‡ã€‚åŒ…ç®¡ç†å·¥å…·åº”è¯¥è¶³å¤Ÿå¿«ï¼Œè¿˜è¦æ”¯æŒåˆ›å»ºå¯åŠ¨å™¨ç­‰ç­‰ã€‚&lt;/p>
&lt;p>ä»æ¯•ä¸šå·¥ä½œä»¥æ¥ï¼Œæˆ‘å¼€å‘äº† &lt;a href="https://github.com/fstudio/clangbuilder">clangbuilder&lt;/a>ï¼Œä¸€ä¸ªç®€åŒ–åœ¨ Windows ä¸Šä½¿ç”¨ Visual Studio æ„å»º LLVM/Clang çš„å·¥å…·ï¼ˆå« GUI å·¥å…·ï¼‰ï¼Œä¸ºäº†è§£å†³å®‰è£…æ„å»º LLVM æ—¶æ‰€éœ€å·¥å…·ä¾èµ–çš„é—®é¢˜ï¼Œåæ¥å¤šæ¬¡å¼€å‘ç¼–å†™å„ç§è½¯ä»¶ï¼Œå¤šå¹´çš„å¤±è´¥ç»éªŒä¸è®¤çŸ¥ä¸æ–­ç§¯ç´¯ï¼Œäºæ˜¯åœ¨ä»Šå¹´è¿™ä¸ªç¯çƒåŒæ­¤å‡‰çƒ­çš„å¹´ä»½ï¼Œæˆ‘å¼€å§‹äº†æ–°å‘ â¡ &lt;a href="https://github.com/baulk/baulk">baulk&lt;/a>ï¼Œbaulk èŠ±è´¹äº†æˆ‘åŠå¹´çš„ä¸‹ç­æ—¶é—´ï¼Œç°åœ¨åŸºæœ¬å¯ç”¨ï¼ŒReadMe ä¹Ÿå†™å¥½äº†ï¼Œåº”è¯¥å¯ä»¥ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹äº†ã€‚&lt;/p>
&lt;h2 id="å®‰è£…å’Œä½¿ç”¨-baulk">å®‰è£…å’Œä½¿ç”¨ Baulk&lt;/h2>
&lt;p>è¿™ä¸ªæ­¥éª¤åªæœ‰å››äº”æ­¥ï¼Œä¸‹è½½ baulk äºŒè¿›åˆ¶åŒ…ï¼Œè§£å‹ baulk äºŒè¿›åˆ¶åŒ…ï¼Œç‚¹å‡» baulkterminalï¼Œæ›´æ–°å…ƒæ•°æ®ï¼Œå®‰è£…ä½ éœ€è¦çš„è½¯ä»¶ï¼ŒğŸ†—ï¼Œä½ å¯ä»¥ä½¿ç”¨ baulk å®‰è£…çš„è½¯ä»¶äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">update&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># i æ˜¯ install çš„åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># baulk i cmake curl 7z ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">install&lt;/span> &lt;span style="color:#58a1dd">cmake&lt;/span> &lt;span style="color:#58a1dd">curl &lt;/span>&lt;span style="color:#58a1dd">7z&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">cmake&lt;/span> -&lt;span style="color:#58a1dd">-version&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>baulk å‡çº§å‘½ä»¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">update&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">upgrade&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># u æ˜¯ç‰¹æ®Šçš„åˆ«åï¼ŒåŒ…å« update å’Œ upgrade ä¸¤ä¸ªæ­¥éª¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># baulk update and upgrade&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">u&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‡çº§ baulk è‡ªèº«å¯ä»¥ä½¿ç”¨å¸®åŠ©ç¨‹åº &lt;code>baulk-update&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk-update&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸è½½è½¯ä»¶ä¹Ÿå¾ˆå®¹æ˜“ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># r æ˜¯ uninstall çš„åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk&lt;/span> &lt;span style="color:#58a1dd">uninstall&lt;/span> &lt;span style="color:#58a1dd">7z&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å¼€å‘ baulk æ—¶ï¼Œæˆ‘å°±å†³å®šåªæ”¯æŒ Windows 10 1903 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå¯ä»¥ä½¿ç”¨ Windows Terminalï¼Œåˆ©ç”¨ ANSI è½¬ä¹‰è¾“å‡ºé¢œè‰²ï¼Œä½“éªŒéå¸¸ä¸é”™ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/UWpROA.png" alt="">&lt;/p>
&lt;p>baulk æä¾›äº† baulk-exec åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ baulk-exec å¯ä»¥åˆå§‹åŒ– baulk ç¯å¢ƒï¼Œè¿˜æä¾›äº† ssh-askpass-baulkï¼Œssh-askpass-baulk ç”¨äº &lt;a href="https://github.com/balibuild/tunnelssh">TunnelSSH&lt;/a> æŸäº› ssh æ— æ³•æ‰“å¼€æ ‡å‡†è¾“å…¥æ—¶è¯·æ±‚è¾“å…¥å¯†ç ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/UW9O3D.png" alt="">&lt;/p>
&lt;p>åœ¨ baulk ä¸­æˆ‘å¼•å…¥äº† VirtualEnv æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶èƒ½å¤Ÿä½¿å¾—ç”¨æˆ·å¹¶è¡Œå®‰è£…å¤šä¸ªè½¯ä»¶ç‰ˆæœ¬ï¼Œåœ¨ baulk-execï¼Œbaulkterminal ä¸­é€šè¿‡æŒ‡å®šå‚æ•°æ”¯æŒå¯åŠ¨ä»»æ„çš„ VENVï¼Œbaulk è¿˜æä¾›äº† baulk-dock èƒ½å¤Ÿé€‰æ‹©æŒ‰ç…§ç‰¹å®šçš„ VENV å¯åŠ¨ç¯å¢ƒï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/UW9wcQ.png" alt="">&lt;/p>
&lt;p>åœ¨ Baulk å…ƒæ•°æ®å­˜å‚¨åº“ &lt;a href="https://github.com/baulk/bucket">bucket&lt;/a>ï¼Œæ”¶å½•äº† OpenJDK8(Java)ï¼ŒOpenJDK9(Java)ï¼ŒGraalVM8(Java)ï¼ŒZulu14(Java)ï¼ŒGo(golang)ï¼ŒDMD(dlang) ç­‰æ”¯æŒ VENV çš„åŒ…ï¼Œå¦‚æœæœ‰äººæƒ³æŠŠ Ruby æ”¶å½•ä¸€ä¸‹ï¼Œåœ¨ Windows ä¸Šå®ç°ç±»ä¼¼ rbenv åŠŸèƒ½ä¹Ÿä¸æ˜¯ä»€ä¹ˆéš¾äº‹ã€‚&lt;/p>
&lt;h2 id="baulk-çš„å†…å¹•">Baulk çš„å†…å¹•&lt;/h2>
&lt;p>å…¥é—¨è¯´å®Œï¼Œå¯ä»¥ç¨ç¨è®²ä¸€ä¸‹ Baulk çš„å®ç°ç»†èŠ‚ï¼Œbaulk çš„åŒ…ç®¡ç†ç±»ä¼¼äº Scoopï¼Œå³å°†åŒ…çš„å…ƒæ•°æ®å­˜å‚¨åœ¨ Github ä¸Šï¼Œå®˜æ–¹æºä¸º &lt;a href="https://github.com/baulk/bucket">baulk/bucket&lt;/a>ï¼Œbaulk è¿˜å¯ä»¥é€šè¿‡ç¼–å†™ &lt;code>$BAULK_ROOT/config/baulk.json&lt;/code> æ·»åŠ æ–°çš„æºï¼Œæˆ–è€…åˆ é™¤æŸä¸ªæºï¼Œå¦‚æœä¸åŒçš„æºä¸­å­˜åœ¨ç›¸åŒåå­—çš„åŒ…ï¼Œbaulk è¿˜èƒ½æ ¹æ® bucket çš„æƒé‡å»é€‰æ‹©ä½¿ç”¨å“ªä¸ªæºï¼Œä½†ç›®å‰ä¸ºæ­¢ï¼Œåªæœ‰ &lt;a href="https://github.com/baulk/bucket">baulk/bucket&lt;/a> ä¸€ä¸ªæºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;bucket&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;description&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Baulk default bucket&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;name&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Baulk&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;url&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;https://github.com/baulk/bucket&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;weights&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>baulk update&lt;/code> å‘½ä»¤æ›´æ–° bucketï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Github Atom RSS æœºåˆ¶ï¼Œä»¥å®˜æ–¹æºä¸ºä¾‹ï¼Œé€šè¿‡ HTTP è¯·æ±‚é¡¹ç›®çš„ &lt;code>commits/master.atom&lt;/code> è·å¾—å½“å‰çš„æœ€æ–°çš„ commitIDï¼Œå¦‚æœæœ¬åœ°ä¸å­˜åœ¨æˆ–è€…ä¸å…¶ä¸åŒï¼Œåˆ™è¯´æ˜ bucket æœ‰æ›´æ–°ï¼Œäºæ˜¯ baulk ä¸‹è½½å¯¹åº”çš„ bucket çš„å‹ç¼©åŒ…ï¼Œè§£å‹å®Œæˆå…ƒæ•°æ®çš„æ›´æ–°ã€‚ç„¶åæ£€æµ‹æœ¬åœ°å·²å®‰è£…çš„åŒ…æ˜¯å¦å­˜åœ¨æ›´æ–°ç‰ˆæœ¬ï¼Œå­˜åœ¨å°±è¾“å‡ºæç¤ºã€‚&lt;/p>
&lt;blockquote>
&lt;p>GET &lt;a href="https://github.com/baulk/bucket/commits/master.atom">https://github.com/baulk/bucket/commits/master.atom&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>å½“äººä»¬è¿è¡Œ &lt;code>baulk upgrade&lt;/code> æ—¶ï¼Œå°±ä¼šçœŸæ­£çš„å‡çº§å·²å®‰è£…çš„åŒ…ï¼Œæ›´æ–°å…ƒæ•°æ®å’Œå‡çº§åˆ†å¼€è¿™ç§æœºåˆ¶ç±»ä¼¼äº &lt;code>apt-get&lt;/code>ï¼Œä¸ºäº†ç®€åŒ–æ“ä½œï¼Œbaulk æä¾›äº† &lt;code>baulk u&lt;/code> åˆ«åå°† update/upgrade åˆå¹¶åœ¨ä¸€èµ·ç®€åŒ–å‡çº§ã€‚&lt;/p>
&lt;p>åœ¨ Baulk ä¸­ï¼Œå®‰è£…è½¯ä»¶å¤§çš„æ­¥éª¤åªæœ‰è§£å‹å’Œç”Ÿæˆå¯åŠ¨å™¨ï¼ˆåˆ›å»ºç¬¦å·é“¾æ¥ï¼‰ï¼Œä¸å­˜åœ¨ä»€ä¹ˆæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼Œä¿®æ”¹æ³¨å†Œè¡¨ï¼Œå…³è”æ–‡ä»¶æ‰“å¼€æ–¹å¼ç­‰ç­‰ç­‰ç­‰ç­‰ã€‚æˆ‘çš„æƒ³æ³•æ˜¯æœ€å¥½åšåˆ°éš”ç¦»äº’ä¸å½±å“ï¼Œå› æ­¤ï¼Œåœ¨å¼€å‘ baulk çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€ç›´æ—¶æœè¿™ä¸ªæ–¹å‘å»è®¾è®¡ã€‚åœ¨ baulk ä¸­çš„ package ä¸­ï¼Œå­˜åœ¨ &lt;code>extension&lt;/code> çš„å…³é”®å­—ï¼Œ&lt;code>extension&lt;/code> ç”¨äºæè¿° package å‹ç¼©åŒ…ï¼ˆå®‰è£…åŒ…ï¼‰å¦‚ä½•è¢« baulk è§£å‹ç¼©ï¼Œ &lt;code>extension&lt;/code> æ”¯æŒ &lt;code>zip&lt;/code>, &lt;code>msi&lt;/code>, &lt;code>7z&lt;/code>, &lt;code>exe&lt;/code>ï¼Œ&lt;code>tar&lt;/code>ï¼Œbaulk æŒ‰ç…§ &lt;code>extension&lt;/code> çš„ç±»å‹æ‰§è¡Œç›¸åº”çš„è§£å‹ç¼©ç¨‹åºã€‚æ‰©å±•çš„è§£å‹ç¨‹åºå¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ‰©å±•&lt;/th>
&lt;th>è§£å‹ç¨‹åº&lt;/th>
&lt;th>é™åˆ¶&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>exe&lt;/code>&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>zip&lt;/code>&lt;/td>
&lt;td>å†…ç½®ï¼ŒåŸºäº minizip&lt;/td>
&lt;td>æ”¯æŒ deflate/bzip2/zstdï¼Œä¸æ”¯æŒåŠ å¯†å’Œ deflate64ï¼ˆdeflate64 å¯ä»¥ä½¿ç”¨ &lt;code>7z&lt;/code>ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>msi&lt;/code>&lt;/td>
&lt;td>å†…ç½®ï¼ŒåŸºäº MSI API&lt;/td>
&lt;td>æ­¤æ–¹å¼ä»…ä½œè§£å‹ï¼Œå’Œåœ¨èµ„æºç®¡ç†å™¨ç‚¹å‡»å®‰è£…ä¸åŒ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>7z&lt;/code>&lt;/td>
&lt;td>ä¼˜å…ˆçº§ï¼š&lt;/br>baulk7z - Baulk å‘è¡Œç‰ˆ&lt;/br>7z - ä½¿ç”¨ baulk install å®‰è£…çš„&lt;/br>7z - ç¯å¢ƒå˜é‡ä¸­çš„&lt;/td>
&lt;td>&lt;code>tar.*&lt;/code> ä¹‹ç±»æ ¼å¼è§£å‹ä¸èƒ½ä¸€æ¬¡å®Œæˆï¼Œå› æ­¤å»ºè®®ä½¿ç”¨ &lt;code>tar&lt;/code> è§£å‹ &lt;code>tar.*&lt;/code> å‹ç¼©åŒ…&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>tar&lt;/code>&lt;/td>
&lt;td>ä¼˜å…ˆçº§ï¼š&lt;/br>baulktar - BaulkTar bsdtar çš„ç°ä»£é‡æ„&lt;/br>bsdtar - Baulk æ„å»ºç‰ˆ&lt;/br>MSYS2 tar - Git for Windows æºå¸¦çš„&lt;/br>Windows tar&lt;/td>
&lt;td>Windows å†…ç½®çš„ tar ä¸æ”¯æŒ xzï¼ˆåŸºäº libarchive bsdtarï¼‰ï¼Œä½† baulk æ„å»ºçš„ bsdtar æ”¯æŒï¼Œè§£å‹ zip æ—¶å‡ä¸ä¸æ”¯æŒ deflate64&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>baulk çš„å“²å­¦æ˜¯ä¸è¦ä¿®æ”¹ç³»ç»Ÿå’Œç”¨æˆ·ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡çš„ç”Ÿæ•ˆåº”è¯¥æ˜¯å’Œç»ˆç«¯å…³è”æˆ–è€…å¯åŠ¨å™¨å…³è”ï¼Œå› æ­¤ï¼Œåœ¨ baulk ä¸­ï¼Œæˆ‘ç¼–å†™äº† baulkterminal å’Œ baulk-exec ä»¥åŠ baulk-dock ç¨‹åºï¼Œbaulkterminal ä¸»è¦ç”¨äºç”¨æˆ·é€šè¿‡åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼æˆ–è€…å°† baulkterminal æ·»åŠ åˆ°æ¡Œé¢ã€æ–‡ä»¶å¤¹å³é”®èœå•ï¼Œé€šè¿‡ç”¨æˆ·ç‚¹å‡»å¿«é€Ÿæ‰“å¼€åˆå§‹åŒ– Baulk ç¯å¢ƒçš„ Windows Terminalï¼ˆå¦‚æœæ²¡æœ‰å®‰è£… Windows Terminal åˆ™æ‰“å¼€ Windows æ§åˆ¶å°ï¼‰ï¼Œè€Œ baulk-exec åˆ™æ˜¯ä¸€ä¸ªå¯åŠ¨å™¨ï¼Œåœ¨è¿è¡Œ baulk-exec æ—¶ï¼Œæ ¹æ®è¾“å…¥çš„å‘½ä»¤è¡Œå‚æ•° baulk-exec åˆå§‹åŒ–ç¯å¢ƒå˜é‡ï¼Œç„¶åå¯åŠ¨ç›¸å…³çš„å­å‘½ä»¤ï¼Œæ¯”å¦‚ Windows æ“ä½œç³»ç»Ÿä¸­æ²¡æœ‰å®‰è£… cmakeï¼Œè€Œ baulk å®‰è£…äº† cmakeï¼Œä»¥ä¸‹å‘½ä»¤å°±èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># æ‰“å° cmake ç‰ˆæœ¬ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">baulk-exec&lt;/span> &lt;span style="color:#58a1dd">cmake&lt;/span> -&lt;span style="color:#58a1dd">-version&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºäº†é¿å…ç¯å¢ƒå˜é‡ä¸­ &lt;code>PATH&lt;/code> æ¡ç›®è¿‡å¤šï¼Œé™ä½ &lt;code>SearchPath&lt;/code> æœç´¢ç›¸å…³å‘½ä»¤çš„å‘½ä¸­ç‡ï¼Œbaulk ä½¿ç”¨äº† &lt;code>links&lt;/code> æœºåˆ¶ï¼Œå¯¹äºä¸€äº›ä¸ä¾èµ–è‡ªèº«ç›®å½•ä¸‹çš„ dll çš„å‘½ä»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ›å»ºç¬¦å·é“¾æ¥çš„æ–¹å¼å°†å…¶è½¯è¿æ¥åˆ° baulk æ ¹ç›®å½•çš„ &lt;code>bin\links&lt;/code> ç›®å½•ï¼Œå¦‚æœè‡ªèº«ä¾èµ–å‘è¡Œæºå¸¦çš„ dllï¼Œæˆ–è€…éœ€è¦å¤„ç† GetModuleFileName ä¸”æ²¡æœ‰æ­£ç¡®å¤„ç†ç¬¦å·é“¾æ¥è¡Œä¸ºçš„å‘½ä»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>launchers&lt;/code> æœºåˆ¶ï¼Œæ ¹æ®å‘½ä»¤çš„ç±»å‹è°ƒç”¨ MSVC ç”Ÿæˆç‰¹å®šçš„å¯åŠ¨å™¨ï¼Œå¯åŠ¨å™¨å¤§å° 5K å·¦å³ï¼Œä½“ç§¯èƒ½å¤Ÿæ¥å—ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰å®‰è£… Visual Studioï¼Œåˆ™ä½¿ç”¨ &lt;code>baulk-lnk&lt;/code> å®ç°ç›¸å…³é€»è¾‘ï¼ˆbaulk-lnk éœ€è¦è§£æ &lt;code>baulk.linkmeta.json&lt;/code>ï¼Œæ•ˆç‡æœ‰ä¸€ç‚¹ç‚¹æŸå¤±ï¼‰ã€‚baulk åœ¨ç¯å¢ƒå˜é‡å’Œå¯åŠ¨å™¨è¿™å—åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œéœ€è¦è§£æ PE å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯ï¼Œè¿˜éœ€è¦è·å¾— PE æ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œåœ¨ä¹‹å‰ä½¿ç”¨ PowerShell ç¼–å†™çš„ devi ä¸­ï¼ŒåŒæ ·æ˜¯è¿™æ ·åšçš„ï¼Œä½† PowerShell è„šæœ¬æ‰§è¡Œä¸å¤ªå¿«ï¼Œbaulk ç›¸æ¯”æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ•ˆç‡æå‡ã€‚&lt;/p>
&lt;p>baulk ä½¿ç”¨ WinHTTP å®ç° HTTP ä¸‹è½½åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†ä»£ç†çš„æƒ…å†µï¼Œå¦å¤–ï¼Œbaulk è¿˜ä¼šè§£æ &lt;code>HTTPS_PROXY&lt;/code> ç¯å¢ƒå˜é‡ï¼Œè¿˜æ”¯æŒ &lt;code>--https-proxy&lt;/code> è®¾ç½®ä»£ç†ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å»ºè®®åº”è¯¥ä¼˜å…ˆä½¿ç”¨æ”¯æŒè®¾ç½® Windows ç³»ç»Ÿä»£ç†çš„å·¥å…·ã€‚&lt;/p>
&lt;p>baulk åŸºäº minizip å†…ç½®äº† zip æå–èƒ½åŠ›ï¼Œæ”¯æŒä½¿ç”¨ ZSTD å‹ç¼©ç®—æ³•çš„ ZIP æ–‡ä»¶ï¼Œè¿™æ¯”å¸‚é¢ä¸Šå¾ˆå¤šå‹ç¼©è½¯ä»¶è¦å¿«ä¸€æ­¥ã€‚baulk è¿˜å†…ç½®äº† &lt;code>bela::hash&lt;/code> æ”¯æŒ SHA2(SHA224, SHA256, SHA384, SHA512) SHA3(SHA3-224, SHA3-256, SHA3-384, SHA3-512)ï¼Œä»¥åŠ BLAKE3ã€‚ç”±äºå®‰å…¨é—®é¢˜ä¸æ”¯æŒ MD5 å’Œ SHA1ï¼Œå› æ­¤åœ¨ bucket å­˜å‚¨åŒ…å“ˆå¸Œæ—¶åº”è¯¥é€‰æ‹©ä½¿ç”¨è¿™é‡Œåˆ—å‡ºçš„å“ˆå¸Œç®—æ³•ï¼Œå“ˆå¸Œå­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€åŒ¹é…ï¼Œé»˜è®¤å³æ— å‰ç¼€æ—¶ä¸º SHA256ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">HashPrefix&lt;/span> &lt;span style="color:#58a1dd">hnmaps&lt;/span>[] &lt;span style="color:#ff636f">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;BLAKE3&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">BLAKE3&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// BLAKE3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA224&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA224&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA224
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA256&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA256&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA256
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA384&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA384&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA384
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA512&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA512&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA512
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA3&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA3&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA3 alias for SHA3-256
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA3-224&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA3_224&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA3-224
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA3-256&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA3_256&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA3-256
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA3-384&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA3_384&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA3-384
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> {&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;SHA3-512&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">hash_t&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SHA3_512&lt;/span>}, &lt;span style="color:#828b96;font-style:italic">// SHA3-512
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> };
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="baulk-virtualenv-ä»‹ç»">Baulk VirtualEnv ä»‹ç»&lt;/h3>
&lt;p>è¿™é‡Œéœ€è¦é‡ç‚¹è¯´çš„æ—¶ Baulk VirtualEnvï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¼€å‘è€…ä¸å¾—ä¸å¹¶è¡Œå®‰è£…ä¸€ä¸ªè½¯ä»¶çš„å¤šä¸ªç‰ˆæœ¬ä»¥é€‚é…ä¸åŒçš„å¼€å‘éœ€æ±‚ï¼Œä½†è¿™äº›è½¯ä»¶åœ¨å¤„ç†ç¯å¢ƒå˜é‡çš„æ—¶å€™å¹¶æ²¡æœ‰åšçš„é‚£ä¹ˆå¥½ï¼Œå› æ­¤æœ‰äº† VirtualEnv è¿™æ ·çš„å·¥å…·ï¼Œæ¯”å¦‚ rbenv ã€‚baulk ç›®å‰èƒ½å¤Ÿå¾ˆå¥½çš„å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€å¼€å‘å·¥å…·çš„ VirtualEnvï¼Œä»¥ä¸‹æˆªå›¾æ˜¯åŠ è½½ Zulu14(Java JDK) å’Œ Go çš„æˆªå›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/UW1obq.png" alt="">&lt;/p>
&lt;p>ç›®å‰ baulkterminal å’Œ baulk-exec èƒ½å¤ŸåŠ è½½ä»»æ„çš„ venvï¼Œbaulk-dock ä»…æ”¯æŒä¸€ä¸ªã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>baulk èŠ±è´¹äº†æˆ‘å¾ˆå¤šçš„æ—¶é—´ï¼Œæˆ‘è‡ªå·±ç”¨è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œå¹¶ä¸” baulk æ²‰æ·€äº†æˆ‘è¿™äº›å¹´æ¥åœ¨ Windows ç³»ç»Ÿä¸Šçš„æŠ€æœ¯ç§¯ç´¯ï¼Œæ‰€ä»¥å†™ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹è¿˜æ˜¯æœ‰ä¸€äº›å¿…è¦çš„ï¼Œå¦‚æœæœ‰äººå¯¹ baulk é‡Œé¢çš„æŠ€æœ¯ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä¸æˆ‘æœ¬äººè”ç³»ã€‚&lt;/p>
- https://forcemz.net/posts/2020/2020-07-18-baulk/ - Copyright (c) 2009-2024 J23</description></item><item><title>èƒ¡è¯´å…«é“æ–‡ä»¶å‹ç¼©</title><link>https://forcemz.net/posts/2020/2020-06-30-nonsense-file-compression/</link><pubDate>Tue, 30 Jun 2020 20:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2020/2020-06-30-nonsense-file-compression/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2020/2020-06-30-nonsense-file-compression/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>åœ¨æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨è®¡ç®—æœºçš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°æˆ–è€…ä½¿ç”¨ä¸€äº›æ–‡ä»¶ï¼Œå®ƒä»¬é€šå¸¸ä»¥ &lt;code>.zip&lt;/code>ï¼Œ&lt;code>.rar&lt;/code>ï¼Œ&lt;code>.7z&lt;/code> ç»“å°¾ï¼Œè¿™äº›æ–‡ä»¶å°±æ˜¯æœ¬æ–‡æ‰€è¯´çš„å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èµ„æºç®¡ç†å™¨ï¼ŒWinRARï¼ŒWinZipï¼Œæˆ–è€… 7-zip å°†å…¶è§£å‹ï¼Œç„¶åæŸ¥çœ‹ï¼Œç¼–è¾‘ï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–æ“ä½œã€‚å‹ç¼©è½¯ä»¶è¢«å¹¿æ³›è¿ç”¨äºæ–‡ä»¶åˆ†äº«ï¼Œè½¯ä»¶åˆ†å‘ï¼Œæˆ–ä½œä¸ºä¸€ä¸ªå®¹å™¨æ‰¿è½½å…¶ä»–æ–‡ä»¶é›†åˆï¼Œæ¯”å¦‚æˆ‘ä»¬å¦‚æœä½¿ç”¨ Office 2007 ä»¥åŠæ›´é«˜çš„ç‰ˆæœ¬ä¿å­˜ Word/PPT/Excel æ–‡æ¡£æ—¶ï¼Œè¿™äº›æ–‡æ¡£å®é™…ä¸Šå°±æ˜¯ç‰¹æ®Šçš„ ZIP å‹ç¼©æ–‡ä»¶ï¼ŒWord/PPT/Excel çš„æ ¼å¼å®é™…ä¸Šå°±æ˜¯å°†æè¿°å…ƒç´ ï¼ˆæ–‡æœ¬æ¡†ï¼Œæ ‡é¢˜&amp;hellip;ï¼‰ ä¿¡æ¯çš„ XML æ–‡ä»¶ï¼Œä»¥åŠä¸€äº›èµ„æºæ–‡ä»¶ä½¿ç”¨ Deflate(Fastest) å‹ç¼©ç®—æ³•å‹ç¼©åˆ°ä¸€ä¸ª ZIP æ ¼å¼æ–‡ä»¶ä¸­ã€‚è¿˜æœ‰ Java ç¨‹åºå‘˜éœ€è¦ç»å¸¸è§åˆ°çš„ Jar åŒ…ï¼ŒAndroid å¼€å‘è€…æ‰“åŒ…çš„ APK æ–‡ä»¶ï¼Œä»¥åŠ Windows å¼€å‘è€…åˆ›å»ºçš„ Appx(ä»¥åŠ MSIX) å®‰è£…åŒ…ï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œå‡†ç¡®çš„è¯´ï¼Œè¿™å‡ ç§éƒ½æ˜¯ ZIP å‹ç¼©æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å‹ç¼©è½¯ä»¶çš„æ ¼å¼éå¸¸å¤šï¼Œæœ‰ ZIPï¼ŒRARï¼Œ7Zï¼ŒTARï¼ŒCAB ç­‰ç­‰ï¼Œå…¶ä¸­ ZIP æ˜¯è¿ç”¨æœ€å¹¿æ³›çš„å‹ç¼©æ–‡ä»¶æ ¼å¼ï¼Œè€Œåœ¨ Unix ä¸–ç•Œ TAR åˆ™æ›´å—æ¬¢è¿ã€‚æ¢è®¨æ–‡ä»¶çš„å‹ç¼©å®é™…ä¸Šæ˜¯ä¸ªæœ‰è¶£çš„è¿‡ç¨‹ï¼Œè€Œæœ¬æ–‡ä¹Ÿå°±æ˜¯å¯¹å‹ç¼©æ–‡ä»¶è¿›è¡Œä¸€ä¸ªèƒ¡ä¹±çš„åˆ†æã€‚&lt;/p>
&lt;h2 id="å¸¸è§çš„æ–‡ä»¶å‹ç¼©æ ¼å¼æ¯”è¾ƒ">å¸¸è§çš„æ–‡ä»¶å‹ç¼©æ ¼å¼æ¯”è¾ƒ&lt;/h2>
&lt;h3 id="zip-è½¶é—»å’Œç°çŠ¶">ZIP è½¶é—»å’Œç°çŠ¶&lt;/h3>
&lt;p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ VIM è‡ªå¸¦çš„åå…­è¿›åˆ¶æŸ¥çœ‹å·¥å…· xxdï¼ˆæˆ–è€… &lt;a href="https://github.com/sharkdp/hexyl">hexyl&lt;/a>ï¼Œä½ ä¹Ÿå°±å¯ä»¥ä½¿ç”¨ baulk å®‰è£… belautilsï¼Œç„¶åä½¿ç”¨ hastyhexï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ&lt;a href="https://en.wikipedia.org/wiki/Zip_(file_format)">ZIP&lt;/a> å‹ç¼©æ–‡ä»¶ä»¥ &lt;code>PK&lt;/code> å¼€å¤´ã€‚&lt;code>PK&lt;/code>
æ˜¯å·²æ•…è‘—åç¨‹åºå‘˜ &lt;em>Phil Katz&lt;/em> çš„è‹±æ–‡ç¼©å†™ã€‚å€¼å¾—ä¸€è¯´çš„æ˜¯ï¼Œè™½ç„¶ Phil Katz åˆ›é€ äº† ZIP æ ¼å¼ï¼Œä½†ä»–å´è´«å›°æ½¦å€’ï¼Œæ­»åœ¨äº†æ±½è½¦æ—…é¦†ï¼ˆ&lt;a href="http://www.bbsdocumentary.com/library/CONTROVERSY/LAWSUITS/SEA/katzbio.txt">Phil Katz çš„æ•…äº‹&lt;/a>ï¼‰ã€‚ç›®å‰ ZIP çš„è§„èŒƒç”± PKWARE å‘å¸ƒï¼ŒPKWARE æ˜¯ Phil Katz åˆ›ç«‹ï¼ŒPhil Katz æ­»åï¼Œå…¶å®¶äººå°† PKWARE å–å‡ºï¼Œç›®å‰ ZIP çš„æ ¼å¼è§„èŒƒç‰ˆæœ¬ä¸º &lt;a href="https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.3.9.TXT">APPNOTE-6.3.9.TXT&lt;/a>ï¼Œè§„èŒƒå¯ä»¥é˜…è¯»ä½†ä¸å¯åˆ†å‘ã€‚&lt;/p>
&lt;p>ZIP çš„æ ¼å¼å¯ä»¥å¤§è‡´æè¿°ä¸ºï¼š&lt;em>æ–‡ä»¶å¤´+æ–‡ä»¶å‹ç¼©å†…å®¹+æ–‡ä»¶å¤´+æ–‡ä»¶å‹ç¼©å†…å®¹&amp;hellip;&lt;/em>ï¼Œè¿™ç§å¸ƒå±€çš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦è§£å‹ç¼©å°±å¯ä»¥ç›´åˆ°å‹ç¼©æ–‡ä»¶çš„åŸå§‹å¤§å°ï¼Œå¯ä»¥è·å¾—å‹ç¼©åŒ…ä¸­æ‰€æœ‰çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨ 7z å¿«é€Ÿæ‰“å¼€å‹ç¼©åŒ…åï¼Œåªè§£å‹ç‰¹å®šçš„æ–‡ä»¶ã€‚(ä¸‹å›¾æ¥æºäº &lt;a href="https://en.wikipedia.org/wiki/Zip_(file_format)#/media/File:ZIP-64_Internal_Layout.svg">wikipedia&lt;/a>)&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/18/U28wXn.png" alt="">&lt;/p>
&lt;p>ZIP çš„ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ Microsoft Office 2007 åçš„ &lt;code>.pptx&lt;/code>ï¼Œ&lt;code>.docx&lt;/code>ï¼Œ&lt;code>.xslx&lt;/code> æ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨ 7z GUI æ‰“å¼€ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª ZIP å‹ç¼©æ–‡ä»¶ï¼ŒåŒæ ·çš„ï¼ŒJava çš„ Jar åŒ…ï¼ŒAndroid çš„ APKï¼ŒWindows UWP çš„ appx æ–‡ä»¶æ— ä¸€ä¸æ˜¯åŸºäº ZIP æ ¼å¼ã€‚&lt;/p>
&lt;p>åœ¨ 2006 å¹´ä¹‹å‰ï¼ŒZIP æ ¼å¼ä¸æ”¯æŒ Unicodeï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ï¼Œä¸‹è½½å…¶ä»– Windows ä¸Šå‹ç¼©çš„ ZIP æ–‡ä»¶å¯èƒ½å‡ºç°ä¹±ç ï¼Œè¿™æ˜¯å› ä¸ºäºŒè€…çš„ä»£ç é¡µä¸ç›¸åŒï¼Œä½¿ç”¨çš„æœ¬åœ°ç¼–ç ä¸åŒï¼Œ2006 å¹´çš„ APPNOTE-6.3.0.TXT è§„å®šäº†åœ¨ ZIP æ–‡ä»¶ä¸­æŒ‰ç…§ UTF-8 å­˜å‚¨æ–‡ä»¶åçš„æœºåˆ¶ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Minizip/&lt;code>archive/zip&lt;/code> ä¸­çš„ç›¸å…³å­—æ®µã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¦‚æœè¦å­˜å‚¨ UTF-8 çš„æ–‡ä»¶åï¼ŒInfoZip ä½¿ç”¨äº†é¢å¤–çš„å­—æ®µå°† UTF-8 æ–‡ä»¶åä¿å­˜åˆ°ä¸­å¤®ç›®å½•å¤´ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„å°¾éƒ¨ã€‚14 å¹´è¿‡å»äº†ï¼Œä¸€äº›è½¯ä»¶æ¯”å¦‚ 7z/Explorer åœ¨åˆ›å»º ZIP æ—¶ï¼Œä»ç„¶æ²¡æœ‰ä½¿ç”¨ UTF-8 å­˜å‚¨æ–‡ä»¶åï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ InfoZip çš„å…¼å®¹æœºåˆ¶ï¼Œåœ¨åˆ†äº«åŒ…å«é ASCII å­—ç¬¦æ–‡ä»¶åçš„å‹ç¼©åŒ…æ—¶ï¼Œä¸åŒçš„ä»£ç é¡µçš„ç³»ç»Ÿå°±ä¼šå‡ºç°ä¹±ç ã€‚è®¡ç®—æœºè½¯ä»¶åº”è¯¥ä¸æ—¶ä¿±è¿›ï¼Œä¸è¦ä¿æŒè€æ‰ç‰™çš„æƒ¯ä¾‹ã€‚minizip å†…éƒ¨ç¼–ç å…¨ä¸º UTF-8ï¼Œåˆ›å»ºå‹ç¼©æ–‡ä»¶æ—¶å°±ä½¿ç”¨äº† UTF-8ï¼Œè¿™å°±å¾ˆå¥½ã€‚åœ¨æˆ‘ç»´æŠ¤çš„ 7z ç‰ˆæœ¬ &lt;a href="https://github.com/baulk/baulk7z">baulk7z&lt;/a> ä¸­ï¼Œé»˜è®¤è®¾ç½® ZIP å‹ç¼©æ—¶é€‰æ‹© UTF-8ã€‚å¦å¤–ï¼Œgit åœ¨åˆ›å»º ZIP æ ¼å¼çš„ archive ä¹Ÿä¼šæ ‡è®°æ–‡ä»¶åç¼–ç ä¸º UTF-8ã€‚&lt;/p>
&lt;p>ZIP å‹ç¼©æ–‡ä»¶æ ¼å¼åœ¨æ–‡ä»¶å¤´ä¸­ä¼šä½¿ç”¨é­”æ•°æ ‡æ˜å‹ç¼©æ–‡ä»¶æ¡ç›®çš„å‹ç¼©ç®—æ³•ï¼Œå¸¸è§çš„é­”æ•°ï¼ˆå¸¸ç”¨ï¼‰å¦‚ä¸‹:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‹ç¼©ç®—æ³•&lt;/th>
&lt;th>é­”æ•°&lt;/th>
&lt;th>å¤‡æ³¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Store&lt;/td>
&lt;td>0&lt;/td>
&lt;td>å­˜å‚¨ç›®å½•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>8&lt;/td>
&lt;td>deflate&lt;/td>
&lt;td>é»˜è®¤æ ¼å¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>9&lt;/td>
&lt;td>deflate64&lt;/td>
&lt;td>ä¸ deflate ç±»ä¼¼ï¼Œä½†å­—å…¸è¦å¤§ä¸€äº›ï¼Œå¼€æº ZIP åŸºæœ¬ä¸æ”¯æŒ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>12&lt;/td>
&lt;td>bzip2&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>14&lt;/td>
&lt;td>lzma&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>20&lt;/td>
&lt;td>deprecated (use method 93 for zstd)&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>93&lt;/td>
&lt;td>Zstandard (zstd) Compression&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>94&lt;/td>
&lt;td>MP3 Compression&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>95&lt;/td>
&lt;td>XZ Compression&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>96&lt;/td>
&lt;td>JPEG variant&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>97&lt;/td>
&lt;td>WavPack&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>98&lt;/td>
&lt;td>PPMd verson I, Rev 1&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>99&lt;/td>
&lt;td>AE-x encryption marker&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Deflate å‹ç¼©ç®—æ³•ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨çš„ git ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶åœ¨å°†æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶æ—¶ï¼Œå°±ä¼šä½¿ç”¨ deflate ç®—æ³•å°†å…¶å‹ç¼©ï¼Œè¯´åˆ° deflateï¼Œå°±ä¸å¾—ä¸æ &lt;code>zlib&lt;/code>ï¼Œ&lt;code>zlib&lt;/code> æä¾›äº† deflate å‹ç¼©ç®—æ³•å®ç°ï¼Œæ“ä½œç³»ç»Ÿï¼Œæµè§ˆå™¨ï¼Œæ•°æ®åº“ï¼ŒIDEï¼ŒåŠå…¬è½¯ä»¶ï¼Œå¾ˆå¤šè½¯ä»¶éƒ½å¯èƒ½åœ¨ä½¿ç”¨ zlibã€‚deflate64 æ˜¯ deflate çš„å¤§å­—å…¸ç‰ˆæœ¬ï¼Œä½†å—é™äºä¸“åˆ©ï¼Œå¼€æºè½¯ä»¶æ”¯æŒ deflate64 çš„è¾ƒå°‘ï¼Œç›®å‰å·²çŸ¥çš„æ˜¯ 7zã€Windows èµ„æºç®¡ç†å™¨ï¼Œ.Net èƒ½å¤Ÿå‹ç¼©è§£å‹ deflate64 å‹ç¼©çš„ ZIP æ–‡ä»¶ï¼ŒLZMA å‹ç¼©ç®—æ³•å‹ç¼©çš„ ZIP æ–‡ä»¶é€šå¸¸æ˜¯ 7z åˆ›å»ºçš„ï¼Œä½† 7z çš„æœºåˆ¶æœ‰ç‚¹åå¸¸è§„ï¼Œå› æ­¤å…¶ä»– ZIP åº“å¯¹å…¶æ”¯æŒè¾ƒå·®ã€‚&lt;/p>
&lt;p>Zstandard æ˜¯ Facebook å¼€å‘çš„ä¸€ä¸ªæ–°çš„å‹ç¼©ç®—æ³•ï¼Œæ— è®ºåœ¨å‹ç¼©ç‡è¿˜æ˜¯é€Ÿåº¦éƒ½æœ‰ä¸€ä¸ªè¾ƒå¥½çš„å‡è¡¡ï¼ŒåŒæ ·çš„å‹ç¼©æ¯”ï¼Œè¦æ¯” deflate é€Ÿåº¦å¿«å¾ˆå¤šï¼Œè®¸å¯åè®®å‹å¥½ï¼Œå¾ˆå¤šå¼€æºè½¯ä»¶ä½¿ç”¨ï¼Œå°±è¿ Linux å†…æ ¸éƒ½åœ¨ä½¿ç”¨ï¼Œè€Œæ—©æœŸ WinZip å°†æ•°å­— 93 æ·»åŠ ä¸º Zstandard å‹ç¼©ç®—æ³•çš„é­”æ•°ï¼Œæä¾›äº† ZIPX å‹ç¼©æ ¼å¼ï¼Œè¿™ä¸ªäº‹æƒ…ä¸çŸ¥æ˜¯ä¸æ˜¯ PKWARE å¼€å‘è€…å¿½ç•¥äº†è¿˜æ˜¯æ€ä¹ˆçš„ï¼ŒPKWARE ä»Šå¹´åœ¨è§„èŒƒä¸­å°†æ•°å­— 20 ä½œä¸º ZSTD çš„é­”æ•°ï¼Œåæ¥æœ‰å¼€å‘è€…åœ¨ &lt;a href="https://github.com/mcmilk/7-Zip-zstd">7-Zip-zstd&lt;/a> ä¸Šå¯»æ±‚åœ¨ ZIP ä¸­æ·»åŠ  ZSTD å‹ç¼©ç®—æ³•çš„æ”¯æŒï¼Œé‡åˆ°è¿™ä¸ªæƒ…å†µï¼Œæˆ‘èµ¶ç´§ç»™ minizip æäº¤äº†å®ç°ä»£ç ï¼Œè¿˜ç»™ archiver è´¡çŒ®äº†å¯¹ ZSTD çš„æ”¯æŒã€‚ä½†åœ¨ 7-Zip-zstd ä½œè€…å‘é€é‚®ä»¶ç»™ PKWARE ä¹‹åï¼ŒPKWARE èµ¶ç´§åˆæ›´æ–°äº†è§„èŒƒï¼ŒæŠŠ 20 ç»™åºŸå¼ƒäº†ã€‚äºæ˜¯æˆ‘è´¡çŒ®çš„é¡¹ç›®åˆå¾—ä¸€ä¸€çš„å‘é€ PR å»æ›´æ–°å¯¹ ZSTD çš„æ”¯æŒã€‚&lt;/p>
&lt;p>åœ¨ &lt;a href="https://github.com/balibuild/bali">bali&lt;/a> &lt;a href="https://github.com/baulk/baulk">baulk&lt;/a> è¿™äº›æˆ‘è‡ªå·±å¼€å‘çš„è½¯ä»¶ä¸­ï¼Œæˆ‘éƒ½åœ¨å…¶å‹ç¼©ï¼ˆè§£å‹ï¼‰ZIP æ—¶å¢åŠ äº† ZSTD å‹ç¼©ç®—æ³•çš„æ”¯æŒã€‚å›é¡¾ç»™ &lt;a href="https://github.com/nmoinvaz/minizip/pulls?q=is%3Apr+author%3Afcharlie+is%3Aclosed">minizip&lt;/a>ï¼Œ&lt;a href="https://github.com/nih-at/libzip/pull/181">libzip&lt;/a>ï¼Œ&lt;a href="https://github.com/mcmilk/7-Zip-zstd/pull/140">7-zip-zstd&lt;/a>ï¼Œ&lt;a href="https://github.com/mholt/archiver/pulls?q=is%3Apr+is%3Aclosed+author%3Afcharlie">archiver&lt;/a>ï¼Œè¿™äº› ZIP å‹ç¼©åº“ï¼ˆå‹ç¼©è½¯ä»¶ï¼‰çš„ç»´æŠ¤éƒ½ååˆ†æœ‰é™ï¼ŒPR/Issue è§£å†³è¾ƒæ…¢ï¼Œæˆ–è€…æ ¹æœ¬ä¸ç†ï¼Œæœ‰ä¸€ç§åŠé€€æ„Ÿï¼Œå¼€å‘è½¯ä»¶çš„åŸºç¡€è®¾æ–½ç»´æŠ¤å’Œæ¼”è¿›ç¡®å®ä¸é‚£ä¹ˆç¾å¥½ã€‚&lt;/p>
&lt;p>è¯´åˆ° ZIP ä¸å¾—ä¸è¯´ä¸€ä¸‹ WinZipï¼Œæœ€åˆï¼ŒWinZip ä½¿ç”¨ PKZIP æä¾› ZIP å‹ç¼©è§£å‹èƒ½åŠ›ï¼Œ1993 å¹´ï¼ŒWinZip ä½¿ç”¨äº† Info-ZIP å‹ç¼©ä»£ç ï¼Œä¸å†ä½¿ç”¨ PKZIPï¼ŒInfo-ZIP æ˜¯è¢«ç§»æ¤æœ€å¤šçš„è½¯ä»¶ä¹‹ä¸€ï¼Œè‡³ä»Šåœ¨ POSIX å¹³å°ä½¿ç”¨çš„ zip/unzip å°±æ˜¯ Info-ZIPã€‚WinZip åœ¨ ZIP æ ¼å¼ä¸­çš„ä¿®æ”¹é€šå¸¸æ—¶å¢åŠ å‹ç¼©ç®—æ³•ï¼ŒWinZip ç§°ä¹‹ä¸º &lt;code>zipx&lt;/code>ï¼ŒWinZip åœ¨ ZIP æ ¼å¼ä¸­å…·æœ‰è¾ƒå¤§çš„å½±å“åŠ›ï¼Œä»¥è‡³äº PKWARE ä¸ºäº†å…¼å®¹ WinZip å¤šæ¬¡ä¿®æ”¹ ZIP è§„èŒƒã€‚å¦å¤– PKZIP è‡ª 2014 å¹´ä¹Ÿæœªè§åæ›´æ–°ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯è¯„ä¼°ç‰ˆæœ¬ï¼Œæ˜¯å¦æœ‰æ›´æ–°ä¸å¾—è€ŒçŸ¥ï¼‰ã€‚&lt;/p>
&lt;h3 id="tar-éœ€è¦å‹ç¼©ç®—æ³•">Tar éœ€è¦å‹ç¼©ç®—æ³•&lt;/h3>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Tar_(computing)">&lt;code>tar&lt;/code>&lt;/a> é€šå¸¸ç§°ä¸º &lt;code>tarball&lt;/code>ï¼Œæ˜¯ POSIX ä¸–ç•Œä½¿ç”¨æœ€å¹¿æ³›çš„å½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œä½†æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼ŒTAR æœ¬èº«å¹¶ä¸æä¾›å‹ç¼©åŠŸèƒ½ï¼Œè€Œéœ€è¦ GZIP/BZIP2/LZMA/ZSTD è¿™æ ·çš„å‹ç¼©ç®—æ³•ç»„åˆåˆ¶ä½œå‹ç¼©è½¯ä»¶ï¼ŒGNU Tar é€šå¸¸éœ€è¦å…¶ä»– xz, gzip è¿™æ ·çš„å‘½ä»¤æä¾›åˆ›å»ºç›¸å…³å‹ç¼©è½¯ä»¶çš„èƒ½åŠ›ï¼Œè€ŒåŸºäº libarchive çš„ bsdtar åˆ™è¦å¥½ä¸€äº›ï¼Œå¯ä»¥å°†å‹ç¼©èƒ½åŠ›é›†æˆåˆ°å†…ç½®çš„ filter ä¸­ï¼Œè¿™æ ·ä¸ç”¨è°ƒç”¨å¤–éƒ¨å‘½ä»¤å°±å¯ä»¥æ”¯æŒå¤šç§æ ¼å¼ã€‚&lt;/p>
&lt;p>tar ä¸å¸¸è§å‹ç¼©ç®—æ³•ç»„åˆå¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>åç¼€å&lt;/th>
&lt;th>å‹ç¼©ç®—æ³•&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>tgz, tar.gz&lt;/td>
&lt;td>GZIP (deflate)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tbz, tar.bz2&lt;/td>
&lt;td>bzip2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>txz, tar.xz&lt;/td>
&lt;td>lzma&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.sz&lt;/td>
&lt;td>snappy&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.br&lt;/td>
&lt;td>brotli&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tar.zst&lt;/td>
&lt;td>zstd&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä¸åŒçš„å‹ç¼©ç®—æ³•æä¾›äº†ä¸åŒçš„å‹ç¼©æ¯”ï¼Œå‹ç¼©è§£å‹çš„é€Ÿåº¦ä¹Ÿä¸ä¸€æ ·ï¼Œä¸‹å›¾æ˜¯ &lt;a href="https://github.com/facebook/zstd">zstd&lt;/a> Benchmark è·å¾—çš„ä¸€ä¸ªç»“æœï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Compressor name&lt;/th>
&lt;th>Ratio&lt;/th>
&lt;th>Compression&lt;/th>
&lt;th>Decompress.&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>zstd 1.4.5 -1&lt;/strong>&lt;/td>
&lt;td>2.884&lt;/td>
&lt;td>500 MB/s&lt;/td>
&lt;td>1660 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>zlib 1.2.11 -1&lt;/td>
&lt;td>2.743&lt;/td>
&lt;td>90 MB/s&lt;/td>
&lt;td>400 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>brotli 1.0.7 -0&lt;/td>
&lt;td>2.703&lt;/td>
&lt;td>400 MB/s&lt;/td>
&lt;td>450 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>zstd 1.4.5 &amp;ndash;fast=1&lt;/strong>&lt;/td>
&lt;td>2.434&lt;/td>
&lt;td>570 MB/s&lt;/td>
&lt;td>2200 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>zstd 1.4.5 &amp;ndash;fast=3&lt;/strong>&lt;/td>
&lt;td>2.312&lt;/td>
&lt;td>640 MB/s&lt;/td>
&lt;td>2300 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>quicklz 1.5.0 -1&lt;/td>
&lt;td>2.238&lt;/td>
&lt;td>560 MB/s&lt;/td>
&lt;td>710 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>zstd 1.4.5 &amp;ndash;fast=5&lt;/strong>&lt;/td>
&lt;td>2.178&lt;/td>
&lt;td>700 MB/s&lt;/td>
&lt;td>2420 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lzo1x 2.10 -1&lt;/td>
&lt;td>2.106&lt;/td>
&lt;td>690 MB/s&lt;/td>
&lt;td>820 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lz4 1.9.2&lt;/td>
&lt;td>2.101&lt;/td>
&lt;td>740 MB/s&lt;/td>
&lt;td>4530 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>zstd 1.4.5 &amp;ndash;fast=7&lt;/strong>&lt;/td>
&lt;td>2.096&lt;/td>
&lt;td>750 MB/s&lt;/td>
&lt;td>2480 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lzf 3.6 -1&lt;/td>
&lt;td>2.077&lt;/td>
&lt;td>410 MB/s&lt;/td>
&lt;td>860 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>snappy 1.1.8&lt;/td>
&lt;td>2.073&lt;/td>
&lt;td>560 MB/s&lt;/td>
&lt;td>1790 MB/s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ZSTD vs Deflate å‹ç¼©ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/URKpg1.png" alt="">&lt;/p>
&lt;p>ZSTD vs Deflate è§£å‹ç¼©ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/07/19/URKiDK.png" alt="">&lt;/p>
&lt;p>åœ¨ä½¿ç”¨ tar æ—¶ï¼Œæˆ‘ä»¬åˆ›å»º tar å½’æ¡£æ–‡ä»¶åï¼Œå†é€‰æ‹©åˆé€‚çš„å‹ç¼©ç®—æ³•ï¼Œå°±å¯ä»¥åˆ¶ä½œä¸€ä¸ªåˆé€‚çš„å‹ç¼©æ–‡ä»¶ï¼Œæ¯”å¦‚ XZ çš„å‹ç¼©æ¯”å¾ˆå¥½é«˜ï¼Œæ‰€ä»¥ç°åœ¨å¾ˆå¤šå¼€æºè½¯ä»¶ä½¿ç”¨ &lt;code>tar.xz&lt;/code> åˆ†å‘å‹ç¼©åŒ…ï¼Œä½† &lt;code>xz&lt;/code> çš„é€Ÿåº¦éå¸¸æ…¢ï¼Œè¿™å°±éœ€è¦å–èˆã€‚&lt;/p>
&lt;p>äº ZIP ä¸åŒçš„æ˜¯ï¼Œ&lt;code>tar.*&lt;/code> æ˜¯å…ˆå½’æ¡£å†å‹ç¼©ï¼Œå› æ­¤å¦‚æœéœ€è¦è¯»å– tar å®¶æ—å‹ç¼©åŒ…ï¼Œåˆ™éœ€è¦å…ˆè§£å‹ tar åŒ…æ‰èƒ½è¯»å–ç›¸å…³ä¿¡æ¯ï¼Œè¿™å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œæ— æ³•éšæœºè¯»å†™ &lt;code>tar.*&lt;/code> å‹ç¼©åŒ…ã€‚è€Œäº ZIP ä¸åŒçš„æ˜¯ï¼Œåœ¨ &lt;code>tar.*&lt;/code> å‹ç¼©åŒ…ä¸­ï¼Œæ‰€æœ‰çš„æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯å…ˆè¢«å½’æ¡£äº†ï¼Œå’Œæ–‡ä»¶å†…å®¹ä¸€èµ·è¢«å‹ç¼©ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æœ‰åºçš„æ•°æ®è½¬å˜ä¸ºæ— åºçš„æ•°æ®ï¼Œä¿¡æ¯é‡é«˜ï¼Œå‹ç¼©æ¯”é«˜ã€‚&lt;/p>
&lt;h3 id="7z-æè‡´çš„é»‘å®¢">7z æè‡´çš„é»‘å®¢&lt;/h3>
&lt;p>æˆ‘çš„ç¼–è¾‘å™¨ Visual Studio Code å’Œå…¬å¸ç”µè„‘ä¸Šçš„ Windows Terminal ä½¿ç”¨äº†å›½å†…å­—ä½“ç•Œå¤§ç‰›ï¼Œå¾®è½¯å¼€å‘è€… &lt;a href="https://github.com/be5invis">be5invis&lt;/a> çš„&lt;a href="https://github.com/be5invis/Sarasa-Gothic">æ›´çº±é»‘ä½“&lt;/a>ï¼Œåœ¨ Github ä¸‹è½½é¡µé¢ï¼Œå­—ä½“æ–‡ä»¶ä½¿ç”¨ 7z å‹ç¼©ï¼Œttf å­—ä½“å‹ç¼©åŒ…å¤§å°é€šå¸¸ä¸º 200 å¤š MBã€‚è§£å‹åè‡³å°‘ 1GBï¼ˆsarasa-gothic-ttf-0.12.10 è§£å‹å 10.2 GBï¼‰ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ 7z å‹ç¼©ç‡éå¸¸å¯è§‚ã€‚&lt;/p>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/7z">&lt;code>7z&lt;/code>&lt;/a> æ˜¯ &lt;a href="https://en.wikipedia.org/wiki/7-Zip">7-Zip&lt;/a> è‡ªå¸¦çš„å‹ç¼©æ–‡ä»¶æ ¼å¼ï¼Œç”±ä¿„ç½—æ–¯å¼€å‘è€… Igor Pavlov åˆ›å»ºã€‚7z æ ¼å¼æ˜¯ä¸€ç§é«˜å‹ç¼©æ¯”çš„å‹ç¼©æ–‡ä»¶æ ¼å¼ï¼Œåœ¨ 7z æ ¼å¼ä¸­éœ€è¦å»ºç«‹æµçš„æ¦‚å¿µï¼Œä¸å¦‚ ZIP/TAR æ ¼å¼æ¸…æ™°ï¼Œå®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œé™¤äº† 7-zip çš„å®˜æ–¹å®ç°å¤–ï¼Œ&lt;a href="https://github.com/libarchive">libarchive&lt;/a> ä¹Ÿæ”¯æŒ 7z çš„å‹ç¼©å’Œè§£å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>Archive structure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~~~~~~~~~~~~~~~~~
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SignatureHeader
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[PackedStreams]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[PackedStreamsForHeaders]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Header
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> or
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Packed Header
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HeaderInfo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>7z æ”¯æŒ Unicode ç¼–ç ï¼Œæ”¯æŒåŠ å¯†æ ‡å¤´ï¼Œè¿™å°±æ˜¯è¯´å¯ä»¥è¿æ–‡ä»¶åä¹ŸåŠ å¯†ï¼ŒZIP åˆ™åªåšåˆ°æ–‡ä»¶å†…å®¹åŠ å¯†ã€‚7z ä¸æ”¯æŒå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿæƒé™ä¿¡æ¯ï¼Œè¿™åŸºæœ¬ä¸Šé™åˆ¶äº†å®ƒåœ¨ POSIX ç³»ç»Ÿä¸­çš„ä½¿ç”¨ï¼Œ7z ä¸æ”¯æŒæå–æŸåçš„æ–‡ä»¶ï¼Œä¸æ”¯æŒéšæœºè¯»å–ã€‚&lt;/p>
&lt;p>7z çš„ç‰¹æ€§åšåˆ°äº†æè‡´ä¹Ÿé™åˆ¶äº†å®ƒåœ¨å…¶ä»–é¢†åŸŸçš„ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="rar-äº’è”ç½‘åˆ†äº«è€Œå…´èµ·">RAR äº’è”ç½‘åˆ†äº«è€Œå…´èµ·&lt;/h3>
&lt;p>è™½ç„¶ WinRAR æ˜¯ä¸“ä¸šè½¯ä»¶ï¼Œä½†ç›—ç‰ˆçš„é—¨æ§›éå¸¸ä½ï¼Œæ—©æœŸäº’è”ç½‘ä¸Šï¼Œå¾ˆå¤šäººä½¿ç”¨ &lt;code>RAR&lt;/code> æ ¼å¼åˆ†äº«æ–‡ä»¶ï¼ŒRAR æ ¼å¼ä¸€åº¦éå¸¸æµè¡Œï¼ŒRAR æ”¯æŒåˆ†å·å‹ç¼©ï¼Œæ”¯æŒæŒ‰ç…§ Unicode(UTF-16) å­˜å‚¨æ–‡ä»¶åï¼Œ2014 å¹´ï¼ŒRAR5 æ ¼å¼æ¨å‡ºï¼ŒæŸ¥çœ‹æŠ€æœ¯è§„èŒƒ &lt;a href="https://www.rarlab.com/technote.htm">RAR5 technode.html&lt;/a> ï¼Œé€šè¿‡åˆ†æ RAR5 æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸ ZIP æ ¼å¼æœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ï¼ŒRAR5 æ˜¯ä¸æ˜¯å€Ÿé‰´äº† ZIP æ ¼å¼ä¸å¾—è€ŒçŸ¥ã€‚RAR5 æ”¯æŒå­˜å‚¨ UTF-8 æ–‡ä»¶åï¼Œå¼ºåº¦æ›´é«˜çš„ AES åŠ å¯†ï¼Œæ”¯æŒ NTFS ç¬¦å·é“¾æ¥å’Œç¡¬é“¾æ¥ç­‰ç­‰ã€‚&lt;/p>
&lt;p>RAR/RAR5 æ ¼å¼å±äºä¸“æœ‰æ ¼å¼ï¼Œè™½ç„¶ RAR5 çš„æŠ€æœ¯è§„æ ¼å¼€æ”¾äº†ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€äººä»¬å¯ä»¥æŒ‰ç…§è§„èŒƒå®ç°å…¼å®¹çš„ RAR å‹ç¼©è½¯ä»¶ï¼Œæ ¹æ®åè®®ï¼Œåªèƒ½æä¾› RAR è§£å‹åŠŸèƒ½ï¼Œrarlab å¯ä»¥ç›´æ¥ä¸‹è½½ &lt;a href="https://www.rarlab.com/rar_add.htm">unrar&lt;/a> æºç æˆ–è€…å‘½ä»¤è¡Œï¼Œç”¨äºè§£å‹ RAR æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="zip-vs-tar-vs-7z-æŠ€æœ¯çš„æ®Šé€”">ZIP vs Tar vs 7z æŠ€æœ¯çš„æ®Šé€”&lt;/h3>
&lt;p>ZIP çš„æœºåˆ¶æœ‰åˆ©äºå…¶ä»–æ ¼å¼é‡‡ç”¨ï¼Œæ¯”å¦‚ Officeï¼ˆ2007+ï¼‰ æ–‡æ¡£æ ¼å¼ï¼ŒAndroid APKï¼ŒWindows APPXï¼ŒJava Jarï¼ŒiOS ipa ç­‰ç­‰ï¼Œéƒ½æ˜¯ä½¿ç”¨äº† ZIP æ ¼å¼ã€‚åœ¨ Linux ç­‰ POSIX ç³»ç»Ÿï¼Œé™¤äº† &lt;code>tar.*&lt;/code>ï¼Œå…¶ä»–æ ¼å¼ä¼¼ä¹éƒ½ä¸æ˜¯æœ€å¸¸è§„çš„é€‰æ‹©ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© ZIPï¼Œä½†ç³»ç»Ÿé»˜è®¤éƒ½å®‰è£…äº† tarï¼Œä¸ä¸€å®šå®‰è£…äº† Info-ZIPã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œè€Œä¸ºäº†æä¾›æ›´é«˜çš„å‹ç¼©ç‡ï¼ŒChrome å®‰è£…åŒ…åˆ™ä¼šå°†æ–‡ä»¶æ‰“åŒ…æˆ chrome.7zï¼Œå¹¶å†…ç½®ä¸€ä¸ª 7Z è§£å‹å®ƒï¼Œå®é™…ä¸Šè¿™ä¸ªæ€è·¯åœ¨ä¸€äº›å®‰è£…åŒ…åˆ¶ä½œè½¯ä»¶ä¸­ä¹Ÿæœ‰ä½¿ç”¨ã€‚ä¸‰ç§æ ¼å¼ä»£è¡¨ç€ä¸‰ç§ä¸åŒçš„æ–¹å‘ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è®¡ç®—æœºæŠ€æœ¯çš„åˆ†æ­§ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„çœ‹æ³•ã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>è¿™ç¯‡æ–‡ç« æ¯”è¾ƒçŸ­ï¼Œä¸»è¦æ˜¯æœ€è¿‘äº‹æƒ…æ¯”è¾ƒå¤šã€‚&lt;/p>
- https://forcemz.net/posts/2020/2020-06-30-nonsense-file-compression/ - Copyright (c) 2009-2024 J23</description></item><item><title>æ–‡ä»¶çš„çœŸå®è·¯å¾„</title><link>https://forcemz.net/posts/2020/2020-04-24-realpath/</link><pubDate>Fri, 24 Apr 2020 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2020/2020-04-24-realpath/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2020/2020-04-24-realpath/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>æœ€è¿‘æµè§ˆ Windows Terminal æäº¤ï¼Œå‘ç°å…¶æ–‡æ¡£ä¸­é“¾æ¥äº†ä¸€ä¸ª PowerShell çš„ Issueï¼š&lt;a href="https://github.com/PowerShell/PowerShell/issues/9970">Windows Store applications incorrectly assumed to be console applications &lt;/a>ï¼Œè¿™ä¸ªé—®é¢˜æè¿°èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ PowerShell ä¸­æ‰“å¼€ &lt;code>wt.exe&lt;/code>ï¼Œ PowerShell ä¼šä¸€ç›´ç­‰å¾… Windows Terminal çš„é€€å‡ºï¼Œä½†å®é™…ä¸Š Windows Terminal æ˜¯ä¸€ä¸ª GUI ç¨‹åºï¼ŒæŒ‰ç…§ Windows çš„é»˜è®¤è¡Œä¸ºï¼ŒPowerShell åœ¨åˆ›å»º Windows Terminal è¿›ç¨‹åï¼Œå°±åº”è¯¥è¿”å›ã€‚è¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œå…¶å®å¾ˆç®€å•ï¼Œ&lt;code>wt.exe&lt;/code> æ˜¯ Windows Terminal çš„ &lt;code>AppExecutionAlias&lt;/code>ï¼Œ&lt;code>AppExecutionAlias&lt;/code> æ˜¯ä¸€ç±»ç‰¹æ®Šçš„é‡è§£æç‚¹ï¼ŒWindows åœ¨åˆ›å»ºè¿›ç¨‹æ—¶ä¼šæ ¹æ® &lt;code>AppExecutionAlias&lt;/code> è®¾æ–½çš„ä¿¡æ¯å¯åŠ¨å¯¹åº”çš„ Store Appã€‚é‚£ä¹ˆ PowerShell åº”å½“è·å¾—ç›¸åº” Store App çš„ä¸»ç¨‹åºçš„ &lt;code>Subsystem&lt;/code> æ‰èƒ½æ­£ç¡®çš„å†³å®šæ˜¯å¦åº”è¯¥ç­‰å¾…è¿›ç¨‹é€€å‡ºã€‚å› æ­¤è¿™é‡Œè·å¾—å…¶çœŸå®è·¯å¾„æ˜¯å¿…ä¸å¯å°‘çš„ã€‚&lt;/p>
&lt;h2 id="æ–‡ä»¶çš„çœŸå®è·¯å¾„">æ–‡ä»¶çš„çœŸå®è·¯å¾„&lt;/h2>
&lt;p>åœ¨ POSIX ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>realpath&lt;/code> è·å¾—æ–‡ä»¶çš„çœŸå®è·¯å¾„ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯å¸¸è§„æ–‡ä»¶åˆ™è¿”å›å®ƒçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯ç¬¦å·é“¾æ¥ï¼Œåˆ™è¿”å›å®ƒæŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚å°±è¿™ä¹ˆç®€å•ã€‚åœ¨ Windows ä¸Šæˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ&lt;/p>
&lt;p>åœ¨ Windows ä¸­ï¼Œç¬¦å·é“¾æ¥æ˜¯ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/windows/win32/fileio/reparse-points">Reparse Point&lt;/a> æœºåˆ¶å®ç°çš„ï¼Œå…¶ &lt;code>ReparseTag&lt;/code> &lt;code>IO_REPARSE_TAG_SYMLINK&lt;/code> å€¼ä¸º &lt;code>0xA000000C&lt;/code>ï¼Œ&lt;a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/8ac44452-328c-4d7b-a784-d72afd19bd9f#gt_4fed0b53-5fc8-4818-886f-93d87f3035e1">æè¿°ä¿¡æ¯&lt;/a>å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>symbolic link: A symbolic link is a reparse point that points to another file system object. The object being pointed to is called the target. Symbolic links are transparent to users; the links appear as normal files or directories, and can be acted upon by the user or application in exactly the same manner. Symbolic links can be created using the FSCTL_SET_REPARSE_POINT request as specified in [MS-FSCC] section 2.3.61. They can be deleted using the FSCTL_DELETE_REPARSE_POINT request as specified in [MS-FSCC] section 2.3.5. Implementing symbolic links is optional for a file system.&lt;/p>
&lt;/blockquote>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è§£æé‡è§£æç‚¹è·å¾—ç¬¦å·é“¾æ¥çš„çœŸå®è·¯å¾„ã€‚ä½†æˆ‘ä»¬é€šå¸¸ä¸è¿™ä¹ˆåšï¼Œå› æ­¤ Windows æœ‰ä¸ª API å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä»¶äº‹ã€‚&lt;a href="https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfinalpathnamebyhandlew">GetFinalPathNameByHandleW&lt;/a> èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è·å¾—å·²æ‰“å¼€çš„æ–‡ä»¶çš„æœ€ç»ˆè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯çœŸå®è·¯å¾„ï¼Œè€Œæˆ‘ä»¬åœ¨æ‰“å¼€ç¬¦å·é“¾æ¥æ—¶ï¼Œ&lt;code>IoCreateFile&lt;/code> æœ€ç»ˆå°†æ‰“å¼€ç¬¦å·é“¾æ¥çš„ç›®æ ‡æ–‡ä»¶ï¼Œå› æ­¤ï¼Œé€šè¿‡ &lt;code>GetFinalPathNameByHandleW&lt;/code> æˆ‘ä»¬å°±å¯ä»¥è·å¾—å…¶çœŸå®è·¯å¾„ã€‚è¯ä¸å¤šè¯´ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">_Ty&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span> &lt;span style="color:#58a1dd">_Ty&lt;/span> &lt;span style="color:#58a1dd">_Unaligned_load&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">void&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">_Ptr&lt;/span>) { &lt;span style="color:#828b96;font-style:italic">// load a _Ty from _Ptr
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">static_assert&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">is_trivial_v&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">_Ty&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;Unaligned loads require trivial types&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_Ty&lt;/span> &lt;span style="color:#58a1dd">_Tmp&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">memcpy&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">_Tmp&lt;/span>, &lt;span style="color:#58a1dd">_Ptr&lt;/span>, &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">_Tmp&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">_Tmp&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span> &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">_Is_drive_prefix&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">_First&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// test if _First points to a prefix of the form X:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// pre: _First points to at least 2 wchar_t instances
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// pre: Little endian
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">_Value&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">_Unaligned_load&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">_First&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_Value&lt;/span> &lt;span style="color:#ff636f">&amp;amp;=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">0xFFFF&amp;#39;FFDFu&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// transform lowercase drive letters into uppercase ones
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">_Value&lt;/span> &lt;span style="color:#ff636f">-=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#ff636f">static_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;:&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">wchar_t&lt;/span>) &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">CHAR_BIT&lt;/span>)) &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;A&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">_Value&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">26&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">_Is_drive_prefix_with_slash_slash_question&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">text&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">text&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#a6be9d">6&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StartsWith&lt;/span>(&lt;span style="color:#58a1dd">text&lt;/span>, &lt;span style="color:#58a1dd">LR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;(&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">?\)&amp;#34;&lt;/span>) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_Is_drive_prefix&lt;/span>(&lt;span style="color:#58a1dd">text&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">4&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">RealPathByHandle&lt;/span>(&lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">FileHandle&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error_code&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ec&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">resize&lt;/span>(&lt;span style="color:#a6be9d">260&lt;/span>); &lt;span style="color:#828b96;font-style:italic">// opt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">DWORD&lt;/span> &lt;span style="color:#58a1dd">kind&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">VOLUME_NAME_DOS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (;;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">blen&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">GetFinalPathNameByHandleW&lt;/span>(&lt;span style="color:#58a1dd">FileHandle&lt;/span>, &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">static_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">DWORD&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">blen&lt;/span>), &lt;span style="color:#58a1dd">kind&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">e&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">GetLastError&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">e&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">ERROR_PATH_NOT_FOUND&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">kind&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">VOLUME_NAME_DOS&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">kind&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">VOLUME_NAME_NT&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">e&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">message&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">resolve_system_error_message&lt;/span>(&lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">resize&lt;/span>(&lt;span style="color:#58a1dd">len&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#ff636f">static_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">DWORD&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">blen&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">kind&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">VOLUME_NAME_DOS&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// result is in the NT namespace, so apply the DOS to NT namespace prefix
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">constexpr&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">ntprefix&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">LR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;(&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">?\GLOBALROOT)&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StringCat&lt;/span>(&lt;span style="color:#58a1dd">ntprefix&lt;/span>, &lt;span style="color:#58a1dd">buffer&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// &amp;#39;\\?\C:\Path&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">_Is_drive_prefix_with_slash_slash_question&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">4&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StartsWithIgnoreCase&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">LR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;(&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">?\UNC\)&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">sv&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">StringCat&lt;/span>(&lt;span style="color:#58a1dd">LR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;(&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">)&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">sv&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">6&lt;/span>)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">buffer&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">RealPath&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">src&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error_code&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ec&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">FileHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">CreateFileW&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">src&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">FILE_SHARE_READ&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_WRITE&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_DELETE&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#58a1dd">OPEN_EXISTING&lt;/span>, &lt;span style="color:#58a1dd">FILE_FLAG_BACKUP_SEMANTICS&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// FILE_FLAG_BACKUP_SEMANTICS open directory require
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">FileHandle&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_system_error_code&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">closer&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">finally&lt;/span>([&lt;span style="color:#ff636f">&amp;amp;&lt;/span>] { &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">FileHandle&lt;/span>); });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">RealPathByHandle&lt;/span>(&lt;span style="color:#58a1dd">FileHandle&lt;/span>, &lt;span style="color:#58a1dd">ec&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„ &lt;code>FILE_FLAG_BACKUP_SEMANTICS&lt;/code> ç”¨äºæ‰“å¼€ç›®å½•ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸éœ€è¦è¯»å†™ï¼Œå› æ­¤ç¬¬äºŒä¸ªå‚æ•° &lt;code>dwDesiredAccess&lt;/code> å€¼ä¸º &lt;code>0&lt;/code>ã€‚å¦‚æœä½¿ç”¨äº† &lt;code>FILE_FLAG_OPEN_REPARSE_POINT&lt;/code> æ ‡å¿—æ‰“å¼€ç¬¦å·é“¾æ¥ï¼Œåˆ™ä¸ä¼šæ‰“å¼€ç›®æ ‡æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä½†æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°å»æŸ¥è¯¢ &lt;code>AppExecutionAlias&lt;/code> çš„çœŸå®è·¯å¾„æ—¶ï¼Œç”±äºæ²¡æœ‰è®¾ç½® &lt;code>FILE_FLAG_OPEN_REPARSE_POINT&lt;/code> å› æ­¤æ— æ³•æ‰“å¼€æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="é€šè¿‡é‡è§£æç‚¹è·å¾—çœŸå®è·¯å¾„">é€šè¿‡é‡è§£æç‚¹è·å¾—çœŸå®è·¯å¾„&lt;/h2>
&lt;p>æˆ‘ä»¬å¦‚æœå»è§£æé‡è§£æç‚¹ï¼Œç„¶åç»è¿‡ç‰¹æ®Šå¤„ç†ï¼Œè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥è·å¾—æ–‡ä»¶çš„çœŸå®è·¯å¾„ã€‚è§£æé‡è§£æç‚¹ä¸»è¦çš„éš¾é¢˜åœ¨äºè·å¾—ä¸€äº›ä¸é€æ˜çš„ç»“æ„ï¼ŒåŒ…å« &lt;code>AppExecutionAlias&lt;/code> çš„ &lt;code>REPARSE_DATA_BUFFER&lt;/code> ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">_REPARSE_DATA_BUFFER&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">ReparseTag&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Reparse tag type
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">ReparseDataLength&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Length of the reparse data
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">Reserved&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Used internally by NTFS to store remaining length
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">union&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_SYMLINK
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Handled by nt!IoCompleteRequest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">SubstituteNameOffset&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">SubstituteNameLength&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">PrintNameOffset&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">PrintNameLength&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">Flags&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">WCHAR&lt;/span> &lt;span style="color:#58a1dd">PathBuffer&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Example of distinction between substitute and print names:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// mklink /d ldrive c:\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> // SubstituteName: c:\\??\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> // PrintName: c:\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"> } SymbolicLinkReparseBuffer;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_MOUNT_POINT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Handled by nt!IoCompleteRequest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">SubstituteNameOffset&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">SubstituteNameLength&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">PrintNameOffset&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">PrintNameLength&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">WCHAR&lt;/span> &lt;span style="color:#58a1dd">PathBuffer&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#58a1dd">MountPointReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_WIM
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Handled by wimmount!FPOpenReparseTarget-&amp;gt;wimserv.dll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// (wimsrv!ImageExtract)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GUID&lt;/span> &lt;span style="color:#58a1dd">ImageGuid&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// GUID of the mounted VIM image
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">BYTE&lt;/span> &lt;span style="color:#58a1dd">ImagePathHash&lt;/span>[&lt;span style="color:#a6be9d">0x14&lt;/span>]; &lt;span style="color:#828b96;font-style:italic">// Hash of the path to the file within the image
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> } &lt;span style="color:#58a1dd">WimImageReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_WOF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Handled by FSCTL_GET_EXTERNAL_BACKING, FSCTL_SET_EXTERNAL_BACKING in NTFS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// (Windows 10+)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//-- WOF_EXTERNAL_INFO --------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">Wof_Version&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Should be 1 (WOF_CURRENT_VERSION)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">Wof_Provider&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Should be 2 (WOF_PROVIDER_FILE)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//-- FILE_PROVIDER_EXTERNAL_INFO_V1 --------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">FileInfo_Version&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Should be 1 (FILE_PROVIDER_CURRENT_VERSION)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ULONG&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FileInfo_Algorithm&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Usually 0 (FILE_PROVIDER_COMPRESSION_XPRESS4K)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> } &lt;span style="color:#58a1dd">WofReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_APPEXECLINK
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">StringCount&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Number of the strings in the StringList, separated
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// by &amp;#39;\0&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">WCHAR&lt;/span> &lt;span style="color:#58a1dd">StringList&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>]; &lt;span style="color:#828b96;font-style:italic">// Multistring (strings separated by &amp;#39;\0&amp;#39;, terminated
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// by &amp;#39;\0\0&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> } &lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Structure for IO_REPARSE_TAG_WCI (0x80000018)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">Version&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Expected to be 1 by wcifs.sys
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">Reserved&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GUID&lt;/span> &lt;span style="color:#58a1dd">LookupGuid&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// GUID used for lookup in wcifs!WcLookupLayer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">WciNameLength&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Length of the WCI subname, in bytes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">WCHAR&lt;/span> &lt;span style="color:#58a1dd">WciName&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>]; &lt;span style="color:#828b96;font-style:italic">// The WCI subname (not zero terminated)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> } &lt;span style="color:#58a1dd">WcifsReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Handled by cldflt.sys!HsmpRpReadBuffer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">Flags&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Flags (0x8000 = not compressed)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">USHORT&lt;/span> &lt;span style="color:#58a1dd">Length&lt;/span>; &lt;span style="color:#828b96;font-style:italic">// Length of the data (uncompressed)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">BYTE&lt;/span> &lt;span style="color:#58a1dd">RawData&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>]; &lt;span style="color:#828b96;font-style:italic">// To be RtlDecompressBuffer-ed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> } &lt;span style="color:#58a1dd">HsmReparseBufferRaw&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Dummy structure
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">UCHAR&lt;/span> &lt;span style="color:#58a1dd">DataBuffer&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#58a1dd">GenericReparseBuffer&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#58a1dd">DUMMYUNIONNAME&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#58a1dd">REPARSE_DATA_BUFFER&lt;/span>, &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">PREPARSE_DATA_BUFFER&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çŸ¥é“è¿™ä¸ªç»“æ„ï¼Œæˆ‘ä»¬å°±èƒ½å¯¹å…¶è¿›è¡Œè§£æäº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/fcharlie/bela/blob/728a4b726f303e7c861823232991de7fdea4d992/src/belawin/reparsepoint.cc#L32
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">FileReparser&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">FileDeviceLookup&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">file&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error_code&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ec&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">buffer&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">reinterpret_cast&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">REPARSE_DATA_BUFFER&lt;/span> &lt;span style="color:#ff636f">*&amp;gt;&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HeapAlloc&lt;/span>(&lt;span style="color:#58a1dd">GetProcessHeap&lt;/span>(), &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">MAXIMUM_REPARSE_DATA_BUFFER_SIZE&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">buffer&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_system_error_code&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">FileHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">CreateFileW&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">file&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#a6be9d">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FILE_SHARE_READ&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_WRITE&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_SHARE_DELETE&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">OPEN_EXISTING&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FILE_FLAG_BACKUP_SEMANTICS&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">FILE_FLAG_OPEN_REPARSE_POINT&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FileHandle&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_system_error_code&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">DeviceIoControl&lt;/span>(&lt;span style="color:#58a1dd">FileHandle&lt;/span>, &lt;span style="color:#58a1dd">FSCTL_GET_REPARSE_POINT&lt;/span>, &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">buffer&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">MAXIMUM_REPARSE_DATA_BUFFER_SIZE&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">len&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">TRUE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">GetLastError&lt;/span>(); &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#58a1dd">ERROR_NOT_A_REPARSE_POINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">message&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">resolve_system_error_message&lt;/span>(&lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">DecodeAppLink&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">REPARSE_DATA_BUFFER&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">buffer&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">AppExecTarget&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">target&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">LPWSTR&lt;/span> &lt;span style="color:#58a1dd">szString&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> (&lt;span style="color:#58a1dd">LPWSTR&lt;/span>)&lt;span style="color:#58a1dd">buffer&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">StringList&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">strv&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">ULONG&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">buffer&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">AppExecLinkReparseBuffer&lt;/span>.&lt;span style="color:#58a1dd">StringCount&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">wcslen&lt;/span>(&lt;span style="color:#58a1dd">szString&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">strv&lt;/span>.&lt;span style="color:#58a1dd">emplace_back&lt;/span>(&lt;span style="color:#58a1dd">szString&lt;/span>, &lt;span style="color:#58a1dd">len&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">szString&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strv&lt;/span>.&lt;span style="color:#58a1dd">empty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">target&lt;/span>.&lt;span style="color:#58a1dd">pkid&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">strv&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strv&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">target&lt;/span>.&lt;span style="color:#58a1dd">appuserid&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">strv&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">strv&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">target&lt;/span>.&lt;span style="color:#58a1dd">target&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">strv&lt;/span>[&lt;span style="color:#a6be9d">2&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/fcharlie/bela/blob/728a4b726f303e7c861823232991de7fdea4d992/src/belawin/reparsepoint.cc#L278
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">RealPathEx&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span> &lt;span style="color:#58a1dd">src&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error_code&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ec&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">FileReparser&lt;/span> &lt;span style="color:#58a1dd">reparser&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">FileDeviceLookup&lt;/span>(&lt;span style="color:#58a1dd">src&lt;/span>, &lt;span style="color:#58a1dd">ec&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">ERROR_NOT_A_REPARSE_POINT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">code&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PathAbsolute&lt;/span>(&lt;span style="color:#58a1dd">src&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">switch&lt;/span> (&lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">buffer&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">ReparseTag&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_APPEXECLINK&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">AppExecTarget&lt;/span> &lt;span style="color:#58a1dd">target&lt;/span>; &lt;span style="color:#58a1dd">DecodeAppLink&lt;/span>(&lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">target&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">target&lt;/span>.&lt;span style="color:#58a1dd">target&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_error_code&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;BAD: unable decode AppLinkExec&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_SYMLINK&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">FileHandle&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">FileHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">INVALID_HANDLE_VALUE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">target&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">RealPath&lt;/span>(&lt;span style="color:#58a1dd">src&lt;/span>, &lt;span style="color:#58a1dd">ec&lt;/span>); &lt;span style="color:#58a1dd">target&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">target&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">case&lt;/span> &lt;span style="color:#58a1dd">IO_REPARSE_TAG_GLOBAL_REPARSE&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">target&lt;/span>; &lt;span style="color:#58a1dd">DecodeSymbolicLink&lt;/span>(&lt;span style="color:#58a1dd">reparser&lt;/span>.&lt;span style="color:#58a1dd">buffer&lt;/span>, &lt;span style="color:#58a1dd">target&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">target&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">bela&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_error_code&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;BAD: unable decode Global SymbolicLink&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">nullopt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">default&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">src&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äº &lt;code>AppExecutionAlias&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨ &lt;code>Target&lt;/code> ä½œä¸ºå…¶çœŸå®è·¯å¾„ï¼Œç„¶åå†å»è§£æ PE æ–‡ä»¶çš„å­ç³»ç»Ÿï¼Œè¿™æ ·å°±èƒ½é¿å… PowerShell çš„é‚£ä¸ªé—®é¢˜å‘ç”Ÿã€‚è§£æç¬¦å·é“¾æ¥æ—¶ï¼Œä¸ºäº†é¿å…éœ€è¦ç¹ççš„è§£æç›®æ ‡æ–‡ä»¶ï¼Œæˆ‘ä»¬é‡æ–°ä½¿ç”¨ &lt;code>bela::RealPath&lt;/code> è·å¾—çœŸå®è·¯å¾„ã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>åœ¨ Windows ä¸­ï¼Œæ¯”å¦‚ Git for VFSï¼ŒAzureï¼ŒOneDriveï¼ŒContainer ç­‰æœåŠ¡æˆ–è€…åŠŸèƒ½ä¹Ÿéƒ½ä½¿ç”¨äº†ç‰¹å®šçš„é‡è§£æç‚¹ã€‚æœ‰å…´è¶£å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚&lt;/p>
- https://forcemz.net/posts/2020/2020-04-24-realpath/ - Copyright (c) 2009-2024 J23</description></item><item><title>è°ˆåƒè‚‰</title><link>https://forcemz.net/posts/2020/2020-01-10-talking-about-eating-pork/</link><pubDate>Fri, 10 Jan 2020 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2020/2020-01-10-talking-about-eating-pork/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2020/2020-01-10-talking-about-eating-pork/ -&lt;p>2019 å¹´æ—©å·²è¿‡å»ï¼Œè¿™å¹´ä¸‹åŠå¹´æœ€æ˜¾è‘—çš„æ„Ÿå—æ˜¯è‚‰ä»·è…¾è´µï¼Œ11 æœˆåˆï¼Œå¬é—»å‡¯å“¥æ¥æ·±å‡ºå·®ï¼Œäºå‘¨æ—¥é‚€è¯·ä»–æ¥ä½æ‰€åšé¥­åƒã€‚æˆ–æ˜¯è®¸ä¹…æœªåƒè¿‡å›é”…è‚‰ï¼Œä¹°èœçš„æ—¶å€™ï¼Œå‡¯å“¥ç‰¹æ„è¦æ±‚ç§°äº†ä¸€å—ä»·å€¼ 16 å…ƒçš„çŒªè‚‰ï¼Œå•ä»· 40 ä¸€æ–¤ã€‚è‹¥åšå…¶å®ƒè‚‰èœï¼Œæœ¬ä»¥ä¸ºå¤Ÿå“¥ä¿©åƒä¸€é¡¿ï¼Œä½†å›é”…è‚‰å´æ˜¯éœ€è¦åˆ†é‡çš„ï¼Œé‚£ä¸€é¡¿åƒçš„é¢‡ä¸å°½å…´ã€‚ä¸€å‘¨ä¹‹åï¼Œåœ¨æµªåŸºä½å¤„åˆåšäº†ä¸€æ¬¡å›é”…è‚‰ï¼Œæ­¤æ—¶è´­ä¹°äº†ä¸¤å—å…±è®¡å››åå—çš„çŒªè‚‰ï¼Œæ­¤æ¬¡å›é”…è‚‰ä¾ç„¶æ²¡æœ‰åƒå°½å…´ï¼Œä¸è¿‡å¥½åœ¨è¿˜æœ‰æˆ‘å¸¦è¿‡å»çš„è…Šç‰›è‚‰ï¼Œå¹²è±†è§’ï¼Œå°å¹²é±¼ï¼Œä»¥åŠä¸»äººå®¶ä¹°çš„åŸºå›´è™¾ï¼Œç§‹è‘µï¼Œç‰›è‚‰åè€Œåƒå¾—å°½å…´ã€‚&lt;/p>
&lt;p>ä»è®°äº‹èµ·ï¼Œä»æœªè§è¿‡æ™®æ™®é€šé€šçš„çŒªè‚‰è¾¾ 40 å…ƒä¸€æ–¤ï¼ŒæŒ‰ç…§æ¯äº²æ‰€è¯´ï¼Œå›é”…è‚‰è‡³å°‘éœ€è¦ä¸€æ–¤åŠæ‰èƒ½åƒé¡¿å¥½çš„ï¼ŒèŠ± 60 å…ƒçš„çŒªè‚‰åšä¸€ä»½å›é”…è‚‰ä¹Ÿå¿’è´µäº†ï¼Œåƒè‚‰æ ¼å¤–ä¸æ˜“å•Šã€‚&lt;/p>
&lt;p>è¯´èµ·åƒè‚‰ï¼Œä¾¿å£æ°´ä¸æ­¢ã€‚çŒªå¤´è‚‰å¥½åƒï¼Œä¾¿æœ‰â€œå‡‰æ‹ŒçŒªè€³æŒ¤çŒªå¤´ï¼Œä¸é¦™è’œæ³¥è…Šå¤ç…®â€ã€‚çŒªéª¨æ›´èƒ½åšå‡ºç¾å‘³ï¼Œé¦™ç…æ’éª¨ï¼Œé¾™éª¨ç…²æ±¤ï¼Œæ‹†éª¨å‰ƒè‚‰å¯ä¸Šé…’ï¼›çº¢çƒ§é…±é¦™å¤ï¼Œéš†æ±Ÿæ½®æ±•çŒªè„šé¥­ã€‚çŒªçš„å†…è„ä¹Ÿæ˜¯ä¸å¯å¤šå¾—çš„ç¾å‘³ï¼ŒçŒªè‚šé¸¡ï¼Œç†˜è‚å°–ï¼Œå¤å£æ¡ï¼Œå°ç‚’è…°èŠ±ï¼Œå¹²ç…¸è‚¥è‚ ï¼Œé’æ¤’ç‚’çŒªå¿ƒï¼Œå°è‚ çŒè…Šè‚ ï¼Œè…Šå‘³å–·é¦™ç…²ä»”é¥­ã€‚é‡Œè„ŠäºŒåˆ€äº”èŠ±è‚‰ï¼Œå°ç‚’å†œå®¶ä¸€ç¢—é¦™ï¼Œçº¢çƒ§ç‹®å­ç‚–ç²‰æ¡ï¼Œè‚‰ç³œè’¸è›‹ä½•ä¸é£Ÿï¼Œå°ç‚’ç…ç‚¸ç‚–ç…®è’¸ã€‚&lt;/p>
&lt;p>ä¸­å›½äººå¤§æŠµæ˜¯çˆ±åƒçŒªè‚‰çš„ï¼Œ2018 å¹´ä¸­å›½çš„çŒªè‚‰æ¶ˆè´¹æ€»é‡æ˜¯ 5590 ä¸‡å¨ï¼Œäººå‡ 40 KGã€‚å…¨çƒ 1.13 çº¦äº¿å¨ï¼ˆæ¥æºï¼šä¸­å›½äº§ä¸šä¿¡æ¯ç½‘ï¼‰ï¼Œä¸åˆ°å…¨çƒ 20% çš„äººå£æ¶ˆè´¹äº†å…¨çƒ 50% çš„çŒªã€‚&lt;/p>
&lt;p>ä½† 2019 å¹´å´åƒä¸èµ·çŒªè‚‰äº†ï¼Œéæ´²çŒªç˜Ÿæ¥åŠ¿æ±¹æ±¹ï¼Œ2018 å¹´ 8 æœˆåœ¨å›½å†…ç¡®è¯Šé¦–ä¾‹éæ´²çŒªç˜Ÿï¼Œæˆªè‡³ 2019 å¹´ 10 æœˆ 12 æ—¥ï¼Œå…¨å›½ 31 ä¸ªçœä»½å‘ç”Ÿ 154 èµ·çŒªç˜Ÿï¼Œç´¯è®¡æ‰‘æ€ 120 ä½™ä¸‡å¤´ï¼Œå‡ºç°éæ´²çŒªç˜Ÿçš„å…»æ®–åœºå¤å…»ä¹‹è·¯æ¼«é•¿ï¼Œ2018 å¹´å¤„äºç”ŸçŒªä»·æ ¼å‘¨æœŸçš„ä½æ½®ï¼ŒæŒ‰ç…§ç»æµè§„å¾‹ï¼Œä»·æ ¼ä½æ—¶ç”¨æˆ·ä¼šå‡å°‘å…»æ®–ï¼Œä½†ç”ŸçŒªçš„å…»æ®–æ˜¯å­˜åœ¨å‘¨æœŸçš„ï¼Œéæ´²çŒªç˜Ÿå’Œç”ŸçŒªä»·æ ¼å‘¨æœŸå åŠ é€ æˆäº†çŒªè‚‰çš„çŸ­ç¼ºå’Œä»·æ ¼è¿…é€Ÿä¸Šæ‰¬ï¼Œä¸€äº›åœ°æ–¹çš„ç¦å…»é™å…»æ›´åŠ å‰§äº†è¿™ä¸€æƒ…å†µã€‚ä¸­å›½äººé€¢å¹´è¿‡èŠ‚çŒªè‚‰çš„æ¶ˆè´¹éƒ½è¦å¢åŠ ï¼Œæ¯”å¦‚ä¸­ç§‹å›½åº†ï¼Œå®¶äººå›¢èšå©šåº†é…’å¸­å°‘ä¸äº†å¤§é±¼å¤§è‚‰ã€‚å†¬è‡³è¿‡åï¼Œå¾ˆå¤šäººå®¶ä¼šè…Œåˆ¶è…Šè‚‰ï¼Œéœ€æ±‚æ—ºç››ï¼ŒçŒªè‚‰ä»·æ ¼ä¹Ÿå§‹ç»ˆç»´æŒé«˜ä½ã€‚&lt;/p>
&lt;p>è„Šç´¢åŠ¨ç‰©é—¨è„Šæ¤åŠ¨ç‰©äºšé—¨å“ºä¹³çº²çœŸå…½äºšçº²å¶è¹„ç›®çŒªå½¢äºšç›®çŒªç§‘çŒªå±çš„çŒªå…¶æŸ“è‰²ä½“ 2n æ˜¯ 36~38ï¼Œäºšç§æœ‰14ä¸ªï¼Œè™½ç„¶æŸ“è‰²ä½“æ•°ç›®ä¸åŒï¼Œä½†æ˜¯æ²¡æœ‰ç”Ÿæ®–éš”ç¦»ã€‚çŒªçš„é©¯åŒ–å†å²å¯èƒ½æ¥è¿‘ä¸€ä¸‡å¹´ï¼Œè·ä»Š9000å¹´å‰å‡ºåœŸäºæ²³å—çœèˆé˜³å¿è´¾æ¹–é—å€çš„çŒªéª¨å·²ç»å±äºå®¶çŒªï¼ˆ&lt;a href="https://new.qq.com/omn/20190124/20190124B19OOP.html">çŒªå¹´è¯´çŒªï¼šå®¶çŒªçš„èµ·æºä¸é©¯åŒ–ï¼Œä»¥åŠæˆ‘ä»¬çš„çŒªæ–‡åŒ–&lt;/a>ï¼‰ï¼Œå‡ åƒå¹´é—´ï¼Œä¸­å›½äººåŸ¹è‚²äº† 100 å¤šç§åœ°æ–¹çŒªç§ï¼Œå…¶ä¸­ä»¥&lt;strong>è£æ˜ŒçŒª&lt;/strong>ã€&lt;strong>å¤ªæ¹–çŒª&lt;/strong>ã€&lt;strong>é‡‘åçŒª&lt;/strong>ã€&lt;strong>å®ä¹¡çŒª&lt;/strong>æœ€ä¸ºè‘—åï¼Œå¹¼æ—¶å¤–æ›¾ç¥–æ¯å®¶é‚»å±…å¢™å£ä¸Šä¾¿å†™äº†&lt;strong>ä¾›åº”å®ä¹¡ä»”çŒª&lt;/strong>å‡ ä¸ªå¤§å­—ã€‚æˆ–è®¸æ˜¯ä¸­å›½å¤äººå†ç»é¥¥é¥¿ï¼Œè¿™äº›ç§ç±»çš„çŒªç˜¦è‚‰å æ¯”è¾ƒå°‘ï¼Œè‚¥è‚‰è¾ƒå¤šï¼›è¿™äº›çŒªç§å¤§å¤šç”Ÿé•¿è¾ƒæ…¢ï¼Œå‡ºæ æ—¶é—´é•¿ã€‚å»ºå›½åï¼Œç”ŸçŒªå…»æ®–å“ç§ä¸»è¦è½¬å˜ä¸ºæœæ´›å…‹ï¼Œå¤§çº¦å…‹ï¼Œçº¦å…‹å¤ç­‰ï¼Œè¿™äº›å“ç§çš„çŒªè‚‰ç˜¦è‚‰ç‡è¾ƒé«˜ï¼Œå‡ºæ å¿«ï¼Œä½†é£å‘³ä¸å¦‚åœ°æ–¹çŒªç§ã€‚è¿‘äº›å¹´ï¼Œéšç€æ¶ˆè´¹ä¹ æƒ¯çš„å¤šæ ·åŒ–ï¼Œåœ°æ–¹çŒªç§çš„å…»æ®–å†åº¦å¤å…´ï¼Œè¿˜æœ‰ä¸€äº›å…»æ®–è€…å°†é‡çŒªä¸å®¶çŒªæ‚äº¤ï¼ŒåŸ¹è‚²çš„å­ä¸‰ä»£ï¼ˆ+ï¼‰ä¸Šå¸‚é”€å”®ï¼Œå—åˆ°äº†çƒ­æ§ã€‚&lt;/p>
&lt;p>åœ¨ä¸­å›½çš„å¹¿å¤§å†œæ‘ï¼Œè¿˜æœ‰ä¸€äº›å†œæˆ·ä¼šè‡ªå®¶å…»æ®–ä¸€äº›é¸¡é¸­ï¼Œè¿˜æœ‰çŒªï¼Œå°¤å…¶æ˜¯å±±åŒºï¼Œ1998 å¹´å‰ï¼Œæ—§æˆ¿å­çŒªåœˆé‡Œå…»è¿‡çŒªï¼Œé‚£æ—¶å¹´å¹¼æˆ‘çœ‹åˆ°é‚»å±…å®¶æ€çŒªï¼Œä¾¿è·‘è¿‡å»è¹­é¥­åƒï¼Œè¿˜å¤§å£°çš„è¯´ï¼šâ€œæˆ‘ä»¬æ€äº†çŒªè¯·ä½ ä»¬å»åƒæ³•ï¼â€ï¼Œæ‹†æ‰æ—§æˆ¿å­å»ºæ¥¼æˆ¿åå†æœªå…»è¿‡çŒªï¼Œå¦‚ä»Šè‹¥ä¸æ˜¯è´¢æ”¿æ‰¹æ¬¾å»ºäº†é¸¡èˆï¼Œæˆ‘å¦ˆè¿˜ä¸è§çš„ä¼šå…»é¸¡é¸­ã€‚çœ‹çœ‹æˆ‘ä»¬æ‘ï¼Œæ¸æ¸çš„é™¤äº†å»ºå…»æ®–åœºå…»çŒªçš„å†œæˆ·å‡ ä¹æ²¡æœ‰äººå®¶å…»çŒªäº†ã€‚å‰å¹´å—å“¥ç»“å©šï¼Œæ‘©æ‰˜è½¦ç¿»è¿‡ 1000 ç±³çš„æ–°åŒ–å’Œå™æµ¦äº¤ç•Œå±±å³°ï¼Œå¼¯å¼¯æ›²æ›²çš„åˆ°è¾¾å—å“¥çš„è€å®¶ï¼Œä¾¿çœ‹åˆ°äº†ä¸»äººå®¶æ­£åœ¨å‰ƒéª¨åˆ†è‚‰ï¼ŒçŒªæ˜¯è‡ªå®¶å…»çš„ï¼ŒçŒªåœˆé‡Œè¿˜æœ‰å‡ å¤´ã€‚æ‘é‡Œäººéƒ½å¤–å‡ºäº†ï¼Œæ…¢æ…¢çš„æ²¡å‡ ä¸ªäººäº†ï¼Œå…»çŒªçš„è¿˜æœ‰å¤šå°‘å‘¢ï¼Ÿ&lt;/p>
&lt;p>éæ´²çŒªç˜Ÿå¯¹æ•£æˆ·çš„å½±å“æ˜¯å·¨å¤§çš„ï¼Œä¸€æ—¦å‘ç”Ÿç–«æƒ…ï¼Œæ•´å¹´çš„è¾›å‹¤åŠ³åŠ¨ä¸€ä¸‹å­åŒ–ä¸ºä¹Œæœ‰ï¼Œè€Œä¼ä¸šè™½ç„¶ä¹Ÿä¼šå‡ºç°å·¨å¤§äºæŸï¼Œä½†ä¼ä¸šå…»çŒªåœ¨å…»æ®–ç®¡ç†ï¼Œèèµ„èƒ½åŠ›è¦è¿œè¿œçš„å¼ºäºæ•£æˆ·ï¼Œæˆ‘æƒ³ä»¥åå…»çŒªçš„æ•£æˆ·è¶Šæ¥è¶Šå°‘å§ã€‚&lt;/p>
&lt;p>çˆ¶äº²æ›¾è¯´è¿‡åœ¨ä»–å°æ—¶å€™åªæœ‰åœ¨å®¶é‡Œæ¥äº†å®¢äººåæ‰ä¼šç«¯ä¸ŠçŒªè‚‰ï¼Œå¾…å®¢äººç¦»å¼€ï¼Œå¥¶å¥¶ä¾¿å°†çŒªè‚‰æ”¶å…¥ç¢—æŸœï¼Œçˆ¶äº²å·é£Ÿä¾¿ä¼šè¢«ç­·å­æ‰“æ‰‹ã€‚2018 å¹´äººå‡ 40 KGï¼Œä¼¼ä¹å†ä¹Ÿä¸æ„è‚‰åƒäº†ï¼Œå°±ç®—è‚‰ä»·è…¾è´µï¼Œæ€»è¿˜æœ‰é¸¡è‚‰ï¼Œé¸­è‚‰ï¼Œç‰›è‚‰å¯ä»¥æ›¿ä»£ã€‚ä½†ä¸–ä¸Šè¿˜æœ‰å¾ˆå¤šäººæ²¡é‚£ä¹ˆå¤šè‚‰é£Ÿï¼Œéæ´²è¿˜å¾ˆå¤šäººæ— æ³•å¡«é¥±è‚šå­ï¼Œå€˜è‹¥è¿™äº›äººéƒ½è¦åƒå¾—è¿™ä¹ˆå¤šè‚‰ï¼Œåœ°çƒå—çš„èµ·å—ï¼Ÿä»¥ 2.4 ï¼ˆè¿™æ˜¯éå¸¸é«˜çš„æ–™è‚‰æ¯”ï¼‰çš„æ–™è‚‰æ¯”è®¡ç®—ï¼Œ5590 ä¸‡å¨çš„çŒªè‚‰éœ€è¦ 13416 ä¸‡å¨é¥²æ–™ï¼Œä¸­å›½ 2019 å¹´ç²®é£Ÿäº§é‡ä¸º 66384 ä¸‡å¨ã€‚å¤¸å¼ çš„è¯´ï¼Œéœ€è¦ 1/5 çš„ç²®é£Ÿæ¥å…»çŒªã€‚å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªä¸ç²¾ç¡®çš„è®¡ç®—ï¼Œå®é™…æƒ…å†µå¤æ‚å¾ˆå¤šï¼Œå¦å¤–ä¸­å›½è¿˜è¦è¿›å£å¤§é‡çš„ç²®é£Ÿï¼Œç‰¹åˆ«æ˜¯ç»å¤§å¤šæ•°å¤§è±†éƒ½æ˜¯è¿›å£çš„ã€‚&lt;/p>
&lt;p>è¿‘å‡ å¹´ï¼Œäººé€ è‚‰åœ¨å›½å¤–ç«äº†èµ·æ¥ï¼Œäººé€ è‚‰æœ‰ä¸¤ä¸ªæµæ´¾ï¼Œä¸€ä¸ªæ˜¯æ¤ç‰©è›‹ç™½åˆæˆäººé€ è‚‰ï¼Œä¸€ä¸ªæ˜¯ç»„ç»‡åŸ¹å…»äººé€ è‚‰ï¼Œå‰è€…éœ€è¦æ·»åŠ è¡€çº¢è›‹ç™½å®é™…æ„Ÿå—è¾ƒå·®ï¼Œåè€…ç¼ºä¹é£å‘³ç‰©è´¨ï¼Œå¥½åƒçš„äººé€ è‚‰ä¹‹è·¯æ¼«é•¿ã€‚ä»¥åä¼šä¸ä¼šæœ‰äººé€ çŒªè‚‰å‘¢ï¼Ÿå¯èƒ½æ˜¯æœ‰çš„ï¼ŒåŸ¹å…»çŒªç»„ç»‡ç»†èƒè‹¥è„‚è‚ªç»†èƒèƒ½æœ‰ä¸€å®šå æ¯”ï¼Œæˆ–è®¸äººé€ è‚‰çš„é£å‘³ä¸å·®ã€‚å¦‚æœèƒ½å¤Ÿå®ç°æ–°èƒ½æºäººå·¥åˆæˆè‘¡è„ç³–ï¼Œäººå·¥åˆæˆæœ‰æœºç‰©ï¼Œæœ‰æœºç‰©åŸ¹å…»äººé€ è‚‰ï¼Œé‚£ä¹ˆäººç±»çš„æœªæ¥è¿˜æ˜¯å¾ˆå¥½çš„ã€‚&lt;/p>
&lt;p>è„‘å­é‡Œæ„æ€åƒè‚‰è¿™ç¯‡æ–‡ç« å¾ˆä¹…ï¼Œä½†çœŸæ­£å†™ä½œæ—¶æ‰å‘ç°è¯­å™è¯ç©·ï¼Œè¿‘äº›æ—¥å­ï¼Œå¤©å¤©è§‚çœ‹å„ç§ç¾é£ŸèŠ‚ç›®ï¼ŒçŒªå¹´å·²å…¥å°¾å£°ï¼Œå¹´å…³å°†è¿‘ï¼Œæ„¿å½’ä¹¡åèƒ½åšé¡¿å¥½çš„ä»¥è°¢çˆ¶æ¯ã€‚&lt;/p>
- https://forcemz.net/posts/2020/2020-01-10-talking-about-eating-pork/ - Copyright (c) 2009-2024 J23</description></item><item><title>æ¢è®¨ Git ä»£ç æ‰˜ç®¡å¹³å°çš„è‹¥å¹²é—®é¢˜ - 2019 ç‰ˆ</title><link>https://forcemz.net/posts/2019/2019-10-01-explore-some-issues-with-git-host/</link><pubDate>Tue, 01 Oct 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-10-01-explore-some-issues-with-git-host/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-10-01-explore-some-issues-with-git-host/ -&lt;h2 id="å…³äº-git">å…³äº Git&lt;/h2>
&lt;p>ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ç§ç±»ç¹å¤šï¼Œç»´åŸºç™¾ç§‘æ”¶å½•çš„æœ€æ—©çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯ 1972 å¹´è´å°”å®éªŒå®¤å¼€å‘çš„ &lt;a href="https://en.wikipedia.org/wiki/Source_Code_Control_System">Source Code Control System&lt;/a>ã€‚1986 å¹´ &lt;a href="https://en.wikipedia.org/wiki/Concurrent_Versions_System">Concurrent Versions System(CVS)&lt;/a> è¯ç”Ÿï¼ŒCVS æ›¾éå¸¸æµè¡Œï¼Œä½†ä»Šæ—¶ç”¨ä¹‹å¯¥å¯¥æ— å‡ ï¼Œä¸è¿‡ OpenBSD ä»åœ¨ä½¿ç”¨ CVSã€‚2000 å¹´ CollabNet åˆ›å»ºäº† Subversion é¡¹ç›®ï¼Œ2009å¹´ï¼ŒSubversion è¢« Apache åŸºé‡‘ä¼šæ¥å—æˆä¸ºé¡¶çº§é¡¹ç›®å¹¶è¢«å‘½åä¸º &lt;a href="https://en.wikipedia.org/wiki/Apache_Subversion">Apache Subversion&lt;/a>ã€‚2005 å¹´ &lt;a href="https://en.wikipedia.org/wiki/Git">Linus Torvalds&lt;/a> åˆ›å»ºäº† Gitï¼Œ2007 Github è¯ç”Ÿåï¼ŒGit éšç€ Github çš„å‘å±•æ„ˆå‘æµè¡Œï¼Œ14 å¹´é—´ï¼ŒGit æˆä¸ºäº†æœ€æµè¡Œçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ— è®ºæ˜¯ Windows è¿˜æ˜¯ Linux æˆ–æ˜¯ Androidï¼ŒMySQL ç­‰ç­‰å¤§å‹è½¯ä»¶éƒ½ä½¿ç”¨ git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚çºµè§‚ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæµè¡Œå²ï¼Œå‰æœ‰ CVS åæœ‰ SVNï¼Œä»Šæ—¥ Git æ›´é£æµã€‚ä¿±å¾€çŸ£ï¼Œæ•°é£æµäººç‰©ï¼Œè¿˜çœ‹ä»Šæœï¼Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè«ä¸å¦‚æ–¯ã€‚&lt;/p>
&lt;p>ä¸ CVS/Subversion è¿™ç§é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼ŒGit çš„å­˜å‚¨åº“æ•°æ®ä¼šè¢«å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæäº¤ä¹Ÿæ˜¯å‘ç”Ÿåœ¨æœ¬åœ°ï¼Œè¿œç¨‹å¯ä»¥çœ‹ä½œæ˜¯æœ¬åœ°å­˜å‚¨åº“çš„ä¸€ä¸ªé•œåƒã€‚è€Œ CVS/Subversion çš„æäº¤éƒ½æ˜¯åœ¨çº¿çš„ã€‚è¿™å°±æ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ ¸å¿ƒç‰¹å¾ã€‚ï¼ˆç†è§£è¿™ä¸€é—®é¢˜çš„å…³è”åœ¨äºåŒºåˆ†å·¥ä½œæ ‘ &lt;code>worktree&lt;/code> å’Œå­˜å‚¨åº“ &lt;code>repository&lt;/code>ã€‚ï¼‰&lt;/p>
&lt;p>Git çš„æºç æ‰˜ç®¡åœ¨ &lt;a href="https://git.kernel.org/pub/scm/git/git.git/">git.kernel.org&lt;/a> ä¸Šï¼ŒGithub ä¸Šä¹Ÿæœ‰åªè¯»é•œåƒ &lt;a href="https://github.com/git/git">github.com/git/git&lt;/a>ã€‚Git ä¸»é¡µ &lt;a href="https://git-scm.com">https://git-scm.com&lt;/a> çš„ç½‘é¡µæºç åˆ™æ‰˜ç®¡åœ¨ Github ä¸Šã€‚é€šå¸¸ç»™ git æäº¤ PR éœ€è¦æ³¨å†Œ &lt;a href="https://public-inbox.org">public-inbox.org&lt;/a> é‚®ä»¶åˆ—è¡¨ï¼Œç„¶åå‘é€è¡¥ä¸ã€‚è€…é€šå¸¸æ¯”è¾ƒéº»çƒ¦ï¼Œå¥½åœ¨æœ‰å¾®è½¯å¼€å‘è€…&lt;a href="https://github.com/dscho">Johannes Schindelin&lt;/a> ä½¿ç”¨ TypeScript å¼€å‘ &lt;a href="https://github.com/gitgitgadget/gitgitgadget">gitgitgadget&lt;/a> ï¼Œå½“ä½ åœ¨ Github ä¸Šåƒ &lt;a href="https://github.com/gitgitgadget/git">gitgitgadget/git&lt;/a> æäº¤ PR æ—¶ï¼Œgitgitgadget ä¼šå°†ä½ çš„ PR å‘é€åˆ° public-inboxï¼Œä¸€æ—¦è¡¥ä¸è¢« git ç»´æŠ¤è€…æ¥å—ï¼Œgitgitgadget åˆ™ä¼šå…³é—­é‚£ä¸ª PRã€‚gitgitgadget ç®€åŒ–äº†ç»™ git è´¡çŒ®ä»£ç çš„éš¾åº¦ï¼Œçœå»äº†æ³¨å†Œ Inbox çš„éº»çƒ¦ï¼Œè¿™å¹´å¤´å¼€å‘è€…å¤§å¤šéƒ½æœ‰ Github å¸å·ã€‚æˆ‘å°±ä½¿ç”¨ gitgitgadget ç»™ git æäº¤äº†ä¸€ä¸ª&lt;a href="https://github.com/gitgitgadget/git/pull/69">è¡¥ä¸&lt;/a>ç”¨äºæ”¯æŒ HTTP/2ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/dscho">Johannes Schindelin&lt;/a> æ­¤äººä¹Ÿæ˜¯ &lt;a href="https://github.com/git-for-windows/git">git-for-windows&lt;/a> çš„ç»´æŠ¤è€…ã€‚
Git çš„ç»´æŠ¤è€…åˆ™æ˜¯ Google çš„å¼€å‘è€… &lt;a href="https://github.com/gitster">Junio C Hamano&lt;/a>ã€‚å¤§å¤šæ•° Git å¼€å‘è€…æ¥è‡ªäº Google/Microsoftï¼ˆåŒ…æ‹¬ Githubï¼‰ã€‚libgit2 çš„å¼€å‘è€…ä¸»è¦æ¥è‡ª Microsoftï¼ˆåŒ…æ‹¬ Githubï¼‰ã€‚è€Œ JGit çš„å¼€å‘è€…åˆ™ä¸»è¦æ¥è‡ª Googleã€‚å·²æ•… JGit çš„åˆ›å§‹äºº Shawn Pearce è¿˜å¼€å‘äº†è‘—åçš„ &lt;a href="https://www.gerritcodereview.com/">Gerrit Code Review&lt;/a>ã€‚è¿™äº›å¼€å‘è€…çš„æ— ç§å¥‰çŒ®æ‰èƒ½ä½¿æˆ‘ä»¬ç”¨ä¸Šè¿™ä¹ˆä¼˜ç§€çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ„Ÿè°¢ä»–ä»¬çš„ä»˜å‡ºã€‚&lt;/p>
&lt;p>Git ä¸è¿œç¨‹å­˜å‚¨åº“ä¹‹é—´çš„ä¼ è¾“åè®®æœ‰ HTTP, GIT(&lt;code>git://&lt;/code>)ï¼ŒSSH. åœ¨ &lt;a href="https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols">ã€ŠPro Git - 2nd Editionã€‹4.1 Git on the Server - The Protocols&lt;/a> ä¸­æœ‰ä»‹ç»ã€‚å…¶ä¸­ HTTP åè®®åŒ…æ‹¬å“‘åè®®å’Œæ™ºèƒ½åè®®ï¼Œç”±äºå“‘åè®®æ˜¯åªè¯»åè®®ï¼Œç›®å‰å¤§å¤šæ•°ä»£ç æ‰˜ç®¡å¹³å°å‡ä¸å†æä¾›æ”¯æŒã€‚HTTP æ™ºèƒ½åè®®å’Œ GIT åè®®ï¼ŒSSH åè®®ç±»ä¼¼ï¼Œéƒ½æ˜¯ç‰¹å®šå‡ ç»„ å®¢æˆ·ç«¯/æœåŠ¡ç«¯ git å‘½ä»¤ä¹‹é—´çš„è¾“å…¥è¾“å‡ºæ•°æ®ä¼ è¾“å’Œäº¤æ¢ã€‚Git ä¼ è¾“åè®®è¾ƒä¸ºç®€å•ï¼Œä»¥æ™ºèƒ½ä¼ è¾“åè®® v1 ä¸ºä¾‹ï¼ŒåŸºæœ¬çš„ &lt;code>fetch/push&lt;/code> æµç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Git æ‹‰å–æµç¨‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/09/20/w7i84e.png" alt="Fetch Flow">&lt;/p>
&lt;p>Git æ¨é€æµç¨‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/09/20/w7iaut.png" alt="Push Flow">&lt;/p>
&lt;p>è™½ç„¶åœ¨ 2018 å¹´ 5 æœˆï¼Œgit æ¨å‡ºäº† &lt;a href="https://opensource.googleblog.com/2018/05/introducing-git-protocol-version-2.html">&lt;code>Wire Protocol&lt;/code>&lt;/a>ï¼ˆå³ Git v2 åè®®ï¼‰ï¼Œå¢åŠ äº† Git åè®®çš„å¤æ‚æ€§ï¼Œä½†åœ¨æœåŠ¡å™¨ä¸Šæ”¯æŒ git åè®®ï¼ˆåŒ…æ‹¬ v2 åè®®ï¼‰ä»ç„¶åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ git-upload-pack/git-receive-packã€‚è¿™ä½¿å¾—å¼€å‘è€…å¾ˆå®¹æ˜“å®ç°å¯¹ git åè®®çš„æ”¯æŒã€‚æ­£å› ä¸º Git åè®®è¡¨å¾çš„ç®€å•ï¼Œæ‰€ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·å’Œå­˜å‚¨åº“æ•°é‡è§„æ¨¡ï¼ŒGit ä¹Ÿéƒ½æ¯” Subversionï¼ŒMercurial æœ‰æ›´å¤šçš„é€‰æ‹©ã€‚&lt;/p>
&lt;p>Git ä½¿ç”¨æ–‡ä»¶å¿«ç…§è®°å½•æ–‡ä»¶å˜æ›´ï¼Œå½“å¯¹è±¡å­˜å‚¨åˆ°æ¾æ•£æ–‡ä»¶ç›®å½•æ—¶ï¼Œæ¯ä¸€æ¬¡å¤§å°ä¸å˜çš„æ–‡ä»¶ä¿®æ”¹ç›¸å½“äºå­˜å‚¨åº“ä¸­å¢åŠ ç‰¹å®šæ–‡ä»¶çš„å¤§å°ï¼ŒGit ä½¿ç”¨ zlib &lt;a href="https://en.wikipedia.org/wiki/DEFLATE">deflate&lt;/a> å‹ç¼©å¯¹è±¡ï¼Œå¯¹è±¡å¤´åŒ…æ‹¬å¯¹è±¡ç±»å‹ï¼ŒåŸå§‹å¤§å°ã€‚åŸºäºå¿«ç…§çš„æ–¹å¼ä½¿å¾— Git åœ¨æäº¤ä»£ç ï¼Œæ£€å‡ºæ–‡ä»¶æ—¶éƒ½æ¯”è¾ƒé«˜æ•ˆï¼Œä½†å­˜å‚¨åº“çš„å ç”¨ç¼ºæ¯”è¾ƒé«˜ã€‚ä½†è¿è¡Œ &lt;code>git gc&lt;/code> æ—¶ï¼ŒGit ä¼šå°†æ¾æ•£çš„å¯¹è±¡æ‰“åŒ…åˆ° pack æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä½¿ç”¨ç‰¹å®šçš„æœºåˆ¶å­˜å‚¨ä¸€éƒ¨åˆ†æ–‡ä»¶çš„ &lt;code>OFS_DELTA&lt;/code>ï¼Œè¿™æ ·å°±èƒ½èŠ‚çœä¸€éƒ¨åˆ†ç©ºé—´ã€‚&lt;/p>
&lt;p>zlibï¼ˆdeflateï¼‰ å‹ç¼©ç®—æ³•é€šå¸¸æ¥è¯´é™¤äº†æ²¡æœ‰ç‰ˆæƒé™åˆ¶ï¼Œæ— è®ºæ˜¯å‹ç¼©æ¯”è¿˜æ˜¯é€Ÿåº¦ï¼ŒCPU ä½¿ç”¨ç‡éƒ½ä¸æ˜¯ä¸€ä¸ªæœ€ä½³çš„é€‰æ‹©ï¼Œå¼•ç”¨æ¥è‡ªçš„ &lt;a href="https://github.com/facebook/zstd/tree/2164a130f353e64a1e89c8e60f36cf2498ab1eea#benchmarks">https://github.com/facebook/zstd&lt;/a> åŸºå‡†æµ‹è¯•ï¼Œzlib çœ‹èµ·æ¥å¿…åèµ·ä¹‹ç§€ &lt;code>brotli&lt;/code>/&lt;code>zstd&lt;/code> å·®å¤šäº†ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Compressor name&lt;/th>
&lt;th>Ratio&lt;/th>
&lt;th>Compression&lt;/th>
&lt;th>Decompress.&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>zstd 1.4.0 -1&lt;/td>
&lt;td>2.884&lt;/td>
&lt;td>530 MB/s&lt;/td>
&lt;td>1360 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>zlib 1.2.11 -1&lt;/strong>&lt;/td>
&lt;td>2.743&lt;/td>
&lt;td>110 MB/s&lt;/td>
&lt;td>440 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>brotli 1.0.7 -0&lt;/td>
&lt;td>2.701&lt;/td>
&lt;td>430 MB/s&lt;/td>
&lt;td>470 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>quicklz 1.5.0 -1&lt;/td>
&lt;td>2.238&lt;/td>
&lt;td>600 MB/s&lt;/td>
&lt;td>800 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lzo1x 2.09 -1&lt;/td>
&lt;td>2.106&lt;/td>
&lt;td>680 MB/s&lt;/td>
&lt;td>950 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lz4 1.8.3&lt;/td>
&lt;td>2.101&lt;/td>
&lt;td>800 MB/s&lt;/td>
&lt;td>4220 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>snappy 1.1.4&lt;/td>
&lt;td>2.073&lt;/td>
&lt;td>580 MB/s&lt;/td>
&lt;td>2020 MB/s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lzf 3.6 -1&lt;/td>
&lt;td>2.077&lt;/td>
&lt;td>440 MB/s&lt;/td>
&lt;td>930 MB/s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å½“å¼€å‘è€…è¦å°† git é›†æˆåˆ°å…¶ä»–è½¯ä»¶æˆ–è€…ç³»ç»Ÿä¸­æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨ git å‘½ä»¤æ•è·è¾“å‡ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ libgit2/JGit ç­‰åº“ã€‚&lt;/p>
&lt;p>libgit2 æœ€åˆæ˜¯ç”± Shawn Pearce åˆ›å»ºäº†&lt;a href="https://github.com/libgit2/libgit2/tree/c15648cbd059b92c177586ab1701a167222c7681">åˆå§‹ commit&lt;/a>ã€‚ç›®å‰ä¸»è¦ç»´æŠ¤è€…æ¥è‡ªå¾®è½¯ã€‚libgit2 æä¾›ä¸€äº›åŸºç¡€çš„ APIï¼ŒåŠŸèƒ½åŸºæœ¬ä¸Šæ˜¯å®Œæ•´çš„ï¼Œé™¤äº†ä¸€éƒ¨åˆ†å®ç°æ€§èƒ½æ²¡æœ‰ git é‚£ä¹ˆå¥½ï¼Œå…¶ä»–æ–¹é¢ä»¤äººæ»¡æ„ï¼Œå¹¶ä¸”æœ‰å¤šç§è¯­è¨€ç»‘å®šï¼ŒåŒ…æ‹¬ C++/D/Golang/Ruby/.NET/Node.js/Perl/Perl6/Ruby/Rust ç­‰ç­‰ã€‚Gitee åŸç”Ÿé’©å­å°±ä½¿ç”¨äº† libgit2ï¼ŒGitee-gitlab é¡¹ç›®ä½¿ç”¨äº† ruggedã€‚&lt;/p>
&lt;p>JGit ä¹Ÿæ˜¯æœ‰ Shawn Pearce åˆ›å»ºçš„ï¼Œç›®å‰å±äº Eclipse åŸºé‡‘ä¼šï¼Œè¿è¡Œåœ¨ JVM ä¸Šï¼Œå›½å†…è…¾è®¯çš„å·¥å³°çš„ TGit ä¹Ÿæ˜¯ä½¿ç”¨çš„ JGitã€‚&lt;/p>
&lt;p>åœ¨ &lt;a href="https://git.github.io/rev_news/2019/02/27/edition-48/">Git Rev News ç¬¬48æœŸ&lt;/a>ï¼Œç¼–è¾‘æ¨èäº† &lt;a href="https://github.com/src-d/gitbase">gitbase&lt;/a> é€šè¿‡ SQL çš„æ–¹å¼æŸ¥è¯¢ git å­˜å‚¨åº“ï¼Œè¿™ä¸ªå·¥å…·åŸºäº &lt;a href="https://github.com/src-d/go-git">src-d/go-git&lt;/a>ï¼Œgo-git æ˜¯çº¯ Golang å®ç°çš„ï¼Œå¦‚æœåŸºäº Golang çš„é¡¹ç›®éœ€è¦ç®€å•çš„è¯»å†™å­˜å‚¨åº“ï¼Œå¯ä»¥ä½¿ç”¨ go-gitã€‚ä¸ libgit2 çš„ Golang ç»‘å®š git2go ç›¸æ¯”ï¼Œä¸éœ€è¦ä½¿ç”¨ CGOã€‚&lt;/p>
&lt;p>å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ git å®ç°ï¼Œå¤§å¤šæ˜¯å®éªŒæ€§çš„ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œæ¯”å¦‚åŸºäº Rust çš„ &lt;a href="https://github.com/chrisdickinson/git-rs">git-rs&lt;/a>ã€‚&lt;/p>
&lt;h2 id="ä¸åŒä¼¸ç¼©æ€§çš„-git-ä»£ç æ‰˜ç®¡å¹³å°">ä¸åŒä¼¸ç¼©æ€§çš„ Git ä»£ç æ‰˜ç®¡å¹³å°&lt;/h2>
&lt;h3 id="åŸºäºå†…ç½®å·¥å…·æ­å»º-git-ä»£ç æ‰˜ç®¡æœåŠ¡">åŸºäºå†…ç½®å·¥å…·æ­å»º Git ä»£ç æ‰˜ç®¡æœåŠ¡&lt;/h3>
&lt;p>Git æœ€åˆç”± Linus Torvalds å¼€å‘ç”¨æ¥å–ä»£ BitKeeper ä½œä¸º Linux å†…æ ¸æºç çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œæ‰€ä»¥ Git ä¸€ç›´å’Œ Linux å†…æ ¸æºç æ‰˜ç®¡åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚å®˜æ–¹åœ°å€æ˜¯ï¼š&lt;a href="https://git.kernel.org/">https://git.kernel.org/&lt;/a>ã€‚åœ¨ git.kernel.org ä¸Šï¼ŒGit ä»£ç æ‰˜ç®¡åŠŸèƒ½æ˜¯ç”± git å†…ç½®çš„å·¥å…·å®ç°çš„ã€‚ç”¨æˆ·ä½¿ç”¨ HTTPS åè®®è®¿é—® &lt;a href="https://git.kernel.org/">https://git.kernel.org/&lt;/a> æ—¶ï¼ŒNginx ä¼šä»¥ CGI çš„æ–¹å¼å°†æµè§ˆå™¨çš„è¯·æ±‚è½¬å‘åˆ° &lt;a href="https://git.wiki.kernel.org/index.php/Gitweb">GitWeb&lt;/a>ã€‚GitWeb æ˜¯ä¸€ä¸ªä½¿ç”¨ Perl ç¼–å†™çš„ CGI ç¨‹åºï¼Œä¸ºç”¨æˆ·æä¾›ç®€å•çš„ git åœ¨çº¿äº¤äº’å›¾å½¢ç•Œé¢ã€‚GitWeb çš„æºç åœ°å€å¯ä»¥åœ¨ &lt;a href="https://github.com/git/git/blob/master/gitweb/gitweb.perl">Github Git é•œåƒ&lt;/a> ä¸­æŸ¥çœ‹ã€‚GitWeb ç•Œé¢æ¯”è¾ƒä¸å¤Ÿç²¾ç¾ï¼Œç›¸æ¯”äº Github è¿™æ ·çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼ŒåŠŸèƒ½å¯¥å¯¥æ— å‡ ã€‚å½“ç”¨æˆ·éœ€è¦ä½¿ç”¨ HTTP/HTTPS åè®®æ‹‰å–æ¨é€æºç æ—¶ï¼ŒNginx ä¼šä»¥ CGIçš„æ–¹å¼å°†è¯·æ±‚è½¬å‘ç»™ &lt;a href="https://git-scm.com/docs/git-http-backend">git-http-backend&lt;/a> å¤„ç†ã€‚git-http-backend æ˜¯ &lt;strong>Git Over HTTP&lt;/strong> çš„æœåŠ¡ç«¯å®ç°ã€‚å½“ç”¨æˆ· GIT åè®® (&lt;code>git://&lt;/code>) åœ¨ git.kernel.org ä¸Šæ‹‰å–æºç æ˜¯ï¼Œè¯·æ±‚ä¼šè¢« &lt;a href="https://git-scm.com/docs/git-daemon">git-daemon&lt;/a> å¤„ç†ã€‚&lt;a href="https://git-scm.com/docs/git-daemon">git-daemon&lt;/a> é»˜é»˜çš„ç›‘å¬ 9418 ç«¯å£ï¼Œé™é™çš„ç­‰å¾… git å®¢æˆ·ç«¯çš„è®¿é—®ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ Git å†…ç½®çš„ GitWeb/git-http-backend/git-daemonï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ­å»ºä¸€ä¸ªç®€æ˜“çš„ Git ä»£ç æ‰˜ç®¡æœåŠ¡å™¨ï¼Œä½†è¿™é‡Œæ²¡æœ‰ SSH åè®®æ”¯æŒã€‚è€Œå®ç° SSH åè®®æ”¯æŒä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ &lt;code>sshd&lt;/code> (OpenSSH)ï¼Œå¹¶å…è®¸å‘½ä»¤ &lt;code>git-upload-pack/git-receive-pack/git-upload-archive&lt;/code> å‘½ä»¤çš„è¿è¡Œï¼Œå¯¹äº SSH åè®®çš„éªŒè¯ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨ &lt;code>authorized_keys&lt;/code> æœºåˆ¶ï¼Œå°†éœ€è¦å…è®¸çš„ç”¨æˆ·çš„ SSH å…¬é’¥æ·»åŠ åˆ° &lt;code>authorized_keys&lt;/code> æ–‡ä»¶ã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹æ¡ˆé€šå¸¸ä½¿ç”¨ &lt;a href="https://gitolite.com/gitolite/">Gitolite&lt;/a> å¢å¼ºè®¿é—®æ§åˆ¶ï¼ŒGitolite ä¸»è¦ä½¿ç”¨ Perl ç¼–å†™ï¼Œè¿™å’Œ GitWeb ä¸€è‡´ï¼Œssh çš„éªŒè¯æ˜¯å°† &lt;a href="https://github.com/sitaramc/gitolite/blob/master/src/gitolite-shell">gitolite-shell&lt;/a> æ·»åŠ åˆ° &lt;code> ~/.ssh/authorized_keys&lt;/code> ä¸­è¢« sshd è°ƒç”¨å®ç°çš„ã€‚git.kernenl.org æ­£æ˜¯ä½¿ç”¨ Gitolite å®ç° Git Over SSH è®¿é—®æ§åˆ¶ã€‚&lt;/p>
&lt;p>&lt;a href="https://git.kernel.org/">https://git.kernel.org/&lt;/a> ç½‘ç«™æ‰˜ç®¡äº† Linux å†…æ ¸æºç ï¼Œé©±åŠ¨ï¼Œæ–‡æ¡£ç­‰å¤§æ¦‚æœ‰ 1000 å¤šä¸ªå­˜å‚¨åº“ï¼Œè¾ƒå¤§çš„å­˜å‚¨åº“æ¯”å¦‚ Linux å†…æ ¸æºç ç£ç›˜å ç”¨å¤§æ¦‚æ˜¯ 2GBï¼Œå› æ­¤åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€å— 2TB ç£ç›˜çš„æœåŠ¡å™¨ä¾¿å¯æ”¯æ’‘ &lt;a href="https://git.kernel.org/">https://git.kernel.org/&lt;/a> è¿™ä¸ªç½‘ç«™çš„è¿è¡Œï¼ˆå®é™…æƒ…å†µåˆ™å¹¶ä¸æ˜¯å¦‚æ­¤ï¼Œç”±äº Linux å†…æ ¸çš„æµè¡Œï¼Œgit.kernel.org çš„è¯·æ±‚å°†æ¯”è¾ƒå¤šï¼Œå¯¹ç¡¬ä»¶çš„éœ€æ±‚å°†æ›´é«˜ä¸€ç‚¹ï¼‰ã€‚åŸºäº Git å†…ç½®åŠŸèƒ½æ­å»ºçš„ä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œéº»é›€è™½å°äº”è„ä¿±å…¨ï¼Œä¸è¿‡å›è¿‡å¤´æ¥è¯´ï¼Œè¿™æ ·çš„ä»£ç æ‰˜ç®¡æœåŠ¡åŠŸèƒ½æœ‰é™ï¼Œå¯ä¼¸ç¼©æ€§å’Œæ‰©å±•æ€§ä¸ä½³ã€‚&lt;/p>
&lt;h3 id="å°å‹çš„-git-ä»£ç æ‰˜ç®¡å¹³å°">å°å‹çš„ Git ä»£ç æ‰˜ç®¡å¹³å°&lt;/h3>
&lt;p>å½“ç”¨æˆ·éœ€è¦æ­å»ºä¸€ä¸ªå‡ äººåˆ°å‡ åå‡ ç™¾äººè§„æ¨¡çš„ Git ä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œé€šå¸¸æœ‰éå¸¸å¤šçš„é€‰æ‹©ï¼Œä¸‹é¢æ˜¯å‡ ä¸ªç›®å‰ä»ç„¶æ¯”è¾ƒæ´»è·ƒçš„å°å‹ Git ä»£ç æ‰˜ç®¡å¹³å°ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>åç§°&lt;/th>
&lt;th>å¹³å°&lt;/th>
&lt;th>è¯­è¨€&lt;/th>
&lt;th>æŠ€æœ¯æ¦‚è¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://github.com/jakubgarfield/Bonobo-Git-Server">Bonobo Git Server&lt;/a>&lt;/td>
&lt;td>Windows Only&lt;/td>
&lt;td>C#&lt;/td>
&lt;td>åŸºäº .Net Famework 4.6ï¼ˆè¿ç§»åˆ° .Net Core çš„å»ºè®®åœ¨ 2017 å¹´ä¾¿è¢«æå‡ºï¼Œä½†æˆªè‡³ç›®å‰ä»ä¸ºè¿ç§»åˆ° .Net Coreï¼‰ã€‚ä½¿ç”¨ &lt;a href="https://github.com/libgit2/libgit2sharp/">LibGit2Sharp&lt;/a> æ“ä½œå­˜å‚¨åº“ï¼Œä½†ç‰ˆæœ¬è¾ƒè€ï¼Œä¸æ”¯æŒ SSH åè®®è®¿é—®ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/gogs/gogs">Gogs&lt;/a>&lt;/td>
&lt;td>Cross Platform&lt;/td>
&lt;td>Golang&lt;/td>
&lt;td>åŸºäº Golang ç¼–å†™ï¼ŒWeb è¯»å†™ Git å­˜å‚¨åº“ç”± &lt;a href="https://github.com/gogs/git-module">git-module&lt;/a> å°è£… Git å‘½ä»¤å®ç°ï¼ŒSSH ç”± Golang &lt;a href="https://github.com/golang/crypto/tree/master/ssh">crypto/ssh&lt;/a> æä¾›ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªæç®€çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œå¯ä»¥åœ¨ Raspberry Pi ä¸Šè¿è¡Œ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/go-gitea/gitea">Gitea&lt;/a>&lt;/td>
&lt;td>Cross Platform&lt;/td>
&lt;td>Golang&lt;/td>
&lt;td>æ˜¯ Gogs çš„å¼€æºåˆ†å‰ï¼ŒWeb è¯»å†™ Git å­˜å‚¨åº“ä½¿ç”¨äº† &lt;a href="https://github.com/src-d/go-git">src-d/go-git&lt;/a>ï¼Œä½¿ç”¨ &lt;a href="https://github.com/gliderlabs/ssh">gliderlabs/ssh&lt;/a> æä¾› SSH æ¥å…¥åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ï¼Œå¯ä»¥åœ¨ Raspberry Pi ä¸Šè¿è¡Œã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/gitbucket/gitbucket">GitBucket&lt;/a>&lt;/td>
&lt;td>Cross Platform&lt;/td>
&lt;td>Scala/Java&lt;/td>
&lt;td>ä½¿ç”¨ &lt;a href="https://github.com/apache/mina-sshd">Apache Mina SSHD&lt;/a> å®ç° SSH åŠŸèƒ½ã€‚Mina SSHD è¿˜ä¸“é—¨é’ˆå¯¹ JGit å®ç°äº†ä¸€ä¸ª &lt;a href="https://github.com/apache/mina-sshd/tree/master/sshd-git">sshd-git&lt;/a> æ¨¡å—ï¼Œä½† GitBucket æ˜¯ç›´æ¥ä½¿ç”¨ JGit çš„ &lt;a href="https://github.com/eclipse/jgit/blob/master/org.eclipse.jgit/src/org/eclipse/jgit/transport">&lt;code>transport&lt;/code>&lt;/a> ç›¸å…³ç±»ã€‚Eclipse JGit ä¸»è¦ç”± Google å¼€å‘è€…å‚ä¸è´¡çŒ®ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>é™¤äº†ä¸Šè¿°å®šä½ä¸ºä»£ç æ‰˜ç®¡å¹³å°çš„æœåŠ¡ï¼Œè¿˜æœ‰åƒ &lt;a href="https://www.phacility.com/">Phabricator&lt;/a> è¿™æ ·çš„ Web è½¯ä»¶ä¹Ÿæä¾› Git ä»£ç æ‰˜ç®¡åŠŸèƒ½ï¼Œä½† Phabricator çš„é‡ç‚¹æ›´å¤šæ˜¯ç¼ºé™·è¿½è¸ªï¼Œä»£ç å®¡æ ¸ã€‚LLVM &lt;a href="https://reviews.llvm.org/">https://reviews.llvm.org/&lt;/a> å’Œ libssh &lt;a href="https://bugs.libssh.org/">https://bugs.libssh.org/&lt;/a> å°±æ˜¯åŸºäº Phabricatorã€‚&lt;/p>
&lt;h3 id="äº‘æœåŠ¡çº§åˆ«çš„-git-ä»£ç æ‰˜ç®¡å¹³å°">äº‘æœåŠ¡çº§åˆ«çš„ Git ä»£ç æ‰˜ç®¡å¹³å°&lt;/h3>
&lt;p>éšç€ç”¨æˆ·è§„æ¨¡å’Œå­˜å‚¨åº“è§„æ¨¡çš„å¢é•¿ï¼Œè¾¾åˆ°ä¸€å®šçº§åˆ«åï¼Œä¸Šè¿°ä»£ç æ‰˜ç®¡å¹³å°å¾€å¾€å˜å¾—åŠ›ä¸ä»å¿ƒï¼Œè€Œä¸‹é¢çš„ä»£ç æ‰˜ç®¡å¹³å°å´æ·±è€•äºæ­¤ï¼Œèƒ½å¤Ÿæ”¯æ’‘å·¨å¤§è§„æ¨¡çš„ç”¨æˆ·é‡å’Œå­˜å‚¨åº“æ•°é‡ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com">Github&lt;/a> æ˜¯å…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œç›®å‰ Github &lt;a href="https://github.com/about">å®˜æ–¹æ•°æ®&lt;/a>æ˜¾ç¤ºæ³¨å†Œç”¨æˆ·æ•°é‡ä¸º 4000ä¸‡ï¼Œé¡¹ç›®æ•°é‡ä¸º 1äº¿ã€‚Github ç½‘ç«™ä¸»è¦çš„æŠ€æœ¯æ˜¯ &lt;a href="https://rubyonrails.org/">Ruby on Rails&lt;/a> å†…éƒ¨è¿›ç¨‹åä¸º &lt;code>github-unicorn&lt;/code>ï¼Œæœ€è¿‘ä»–ä»¬å°†å…¶å‡çº§åˆ°äº† &lt;a href="https://github.blog/2019-09-09-running-github-on-rails-6-0/">Rails 6.0&lt;/a>ã€‚Github ä½¿ç”¨ Spokes è´Ÿè´£æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜å‚¨åº“çš„å¤åˆ¶ï¼ŒåŒæ­¥å’Œå¤‡ä»½ã€‚Github ä¹‹å‰ä½¿ç”¨ libssh å¼€å‘ Git SSH æœåŠ¡å™¨ï¼Œç›®å‰çš„ SSH æœåŠ¡å™¨çš„æ ‡è¯†ä¸º &lt;code>babeld-*&lt;/code>ï¼Œä½†ä¸ç¡®å®š babeld æ˜¯å¦ä¾ç„¶åŸºäº libsshã€‚Git éªŒè¯æœåŠ¡ä¸º &lt;code>github-gitauth&lt;/code>ã€‚Github çš„å¤§å¤šæ•°æœåŠ¡éƒ½æ˜¯é—­æºçš„ï¼Œå› æ­¤åˆ†æ Github çš„æŠ€æœ¯å†…å¹•é€šå¸¸æ˜¯ Github å®˜æ–¹çš„ä¸€äº›æŠ€æœ¯åšå®¢ï¼Œ å½“ç„¶ä¹Ÿå¯ä»¥åˆ†æ &lt;code>Github Enterprise&lt;/code> å»çª¥æµ‹ Github å†…å¹•ã€‚&lt;/p>
&lt;p>å…³äº Github Spokes çš„å¤§è‡´åŸç†å¯ä»¥é˜…è¯» &lt;a href="https://githubengineering.com/introducing-dgit/">Introducing DGit&lt;/a> å’Œ &lt;a href="https://github.blog/2016-09-07-building-resilience-in-spokes/">Building resilience in Spokes&lt;/a>ã€‚&lt;/p>
&lt;p>åœ¨å¼€å‘ &lt;a href="https://gitlab.com/gitlab-org/gitaly">Gitaly&lt;/a> ä¹‹åï¼Œ &lt;a href="https://gitlab.com">Gitlab&lt;/a> æ‘†è„±äº† NFS çš„ç¦é”¢ï¼Œåœ¨å¹³å°çš„ä¼¸ç¼©æ€§æ–¹é¢å¾—åˆ°äº†å·¨å¤§çš„æå‡ã€‚è¦çŸ¥é“ Gitlab ä½¿ç”¨ Gitaly çš„åŸå› å¯ä»¥é˜…è¯» &lt;a href="https://about.gitlab.com/2018/09/12/the-road-to-gitaly-1-0/">The road to Gitaly v1.0&lt;/a>ã€‚Gitaly ä½¿ç”¨ RPC å°†å­˜å‚¨æœåŠ¡å™¨ä¸Šçš„ git å‘½ä»¤åŒ…è½¬æˆå‰ç«¯æœåŠ¡æœºå™¨ä¸Šçš„ git å‘½ä»¤ï¼Œå¹¶ä¸º gitlab æœåŠ¡æä¾›å­˜å‚¨åº“çš„è¯»å†™ã€‚ Gitlab çš„ SSH åŠŸèƒ½ä»ç„¶ç”± OpenSSH æä¾›ï¼Œè€Œä¸€äº›é™æ€èµ„æºï¼Œæ–‡ä»¶ä¸‹è½½ï¼Œé™„ä»¶ç­‰åŠŸèƒ½åˆ™ç”± Golang ç¼–å†™çš„ &lt;a href="https://gitlab.com/gitlab-org/gitlab-workhorse">gitlab-workhorse&lt;/a> å®ç°ï¼Œgitlab-workhorse éœ€è¦ä¸ Gitaly é€šä¿¡ã€‚&lt;/p>
&lt;p>&lt;a href="https://bitbucket.org">Bitbucket&lt;/a> æ˜¯ &lt;a href="https://www.atlassian.com">Atlassian&lt;/a> å¼€å‘çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œä¸ Github/Gitlab ä¸åŒï¼ŒBitbucket è¿˜æä¾›äº†åŸç”Ÿ Mercurial æ”¯æŒï¼Œä¸è¿‡æœ€è¿‘ï¼ŒBitbucket å®£å¸ƒè¦é€æ­¥å…³é—­ Mercurial çš„æ”¯æŒã€‚Atlassian è¿˜å¼€å‘äº† Jira/Sourcetree è¿™æ ·è‘—åçš„è½¯ä»¶ï¼ŒBitbucket æºç æ²¡æœ‰å¼€å‘ï¼Œæ¨æµ‹ä¸»è¦ä½¿ç”¨ Java æŠ€æœ¯æ ˆï¼ˆè¿™ä¸ªä»ä¸€æ¬¡ Bitbucket VFSForGit å®‰è£…åŒ…åˆ†æå¯å¾—ï¼‰ã€‚&lt;/p>
&lt;p>&lt;a href="https://gitee.com">Gitee&lt;/a> æ˜¯ç›®å‰å›½å†…æœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ä¹‹ä¸€ï¼Œæ—©åœ¨ 2015 å¹´ä¾¿å¼€å§‹äº†åˆ†å¸ƒå¼æ”¹é€ ï¼Œå¹¶ç¼–å†™äº†ä¸€ç³»åˆ—æœåŠ¡å®ç°åˆ†å¸ƒå¼æ¶æ„ï¼Œç¼–å†™äº† Nginx è·¯ç”±æ¨¡å—å®ç°åŠ¨æ€è·¯ç”±ï¼ŒåŸºäº libssh å¼€å‘äº† Basalt v1 SSH æœåŠ¡å™¨ï¼ŒåŸºäº Golang å¼€å‘äº† Basalt v2 SSH æœåŠ¡å™¨ï¼Œè¿˜å¼€å‘äº† git-srv æ™ºèƒ½æœåŠ¡åç«¯ï¼Œbrzox Git HTTP/Archive æœåŠ¡ã€‚ä»¥åŠ git-diamond git åè®®å†…éƒ¨ä¼ è¾“æœåŠ¡ç­‰ç­‰ã€‚Gitee æœ€åˆä»£ç åŸºäº Gitlabï¼Œå‡ å¹´ä¹‹é—´å·²ç»ä¸ Gitlab æœ‰äº†å¾ˆå¤§çš„å·®å¼‚ï¼Œç°åœ¨ Gitee å·²ç»é€æ­¥å°†ä¸€äº›åŠŸèƒ½ä» gitlab ä¸­å‰¥ç¦»ï¼Œå®ç°äº‘å¹³å°çš„å¾®æœåŠ¡ï¼Œæ¯”å¦‚ç›®å‰çš„ git/svn/hook éªŒè¯æœåŠ¡æ˜¯åŸºäº Golang ç¼–å†™çš„ banjoã€‚Gitee éœ€è¦ä»¥æœ‰é™çš„ç¡¬ä»¶å®ç°æ›´å¤šçš„ç”¨æˆ·æ¥å…¥ï¼Œæ‰€ä»¥åœ¨æœåŠ¡çš„è®¾è®¡ä¸Šæ›´å€¾å‘äºæä¾›èµ„æºä½¿ç”¨ç‡ï¼Œå¯¹ä¸€äº›æ¯”è¾ƒå®¹æ˜“é€ æˆè®¡ç®—èµ„æºç´§å¼ çš„æœåŠ¡è¿›è¡Œé™çº§ã€‚&lt;/p>
&lt;h2 id="git-ä»£ç æ‰˜ç®¡å¹³å°æœåŠ¡å®ç°">Git ä»£ç æ‰˜ç®¡å¹³å°æœåŠ¡å®ç°&lt;/h2>
&lt;!--SSH/HTTP/GIT, LFS, GitVFS....-->
&lt;p>Git ä»£ç æ‰˜ç®¡å¹³å°çš„åŸºæœ¬æœåŠ¡åº”è¯¥åŒ…æ‹¬æµè§ˆå™¨æ¥å…¥æ”¯æŒå’Œ git å®¢æˆ·ç«¯æ¥å…¥æ”¯æŒï¼Œå‰è€…éœ€è¦å¹³å°å¼€å‘ç½‘é¡µæä¾›è‹¥å¹²æœåŠ¡ä¾›ç”¨æˆ·è®¿é—®ã€‚åè€…éœ€è¦æ”¯æŒ git å®¢æˆ·ç«¯æ¨æ‹‰ä»£ç ã€‚é€šè¿‡ç½‘ç«™è®¿é—®å­˜å‚¨åº“æ„å‘³ç€ HTTP æœåŠ¡éœ€è¦é€šè¿‡ä¸€å®šçš„é€”å¾„è¯»å†™å­˜å‚¨åº“ï¼Œåœ¨ GitWeb ä¸­ï¼Œè¿™é€šå¸¸ä½¿ç”¨ git å‘½ä»¤å®ç°ï¼Œæ¯”å¦‚ä½¿ç”¨ &lt;code>git tree&lt;/code> æŸ¥çœ‹ &lt;code>tree&lt;/code>ï¼Œä½¿ç”¨ &lt;code>git archive&lt;/code> æ‰“åŒ…æ–‡ä»¶ç­‰ç­‰ã€‚åœ¨ Gogs ä¸­ï¼Œä½¿ç”¨çš„ &lt;a href="https://github.com/gogs/git-module">git-module&lt;/a> åŒæ ·ä½¿ç”¨äº†å‘½ä»¤è¯»å†™å­˜å‚¨åº“ã€‚è€Œ Gogs çš„åˆ†å‰ Gitea åˆ™ä½¿ç”¨çš„æ˜¯ &lt;a href="https://github.com/src-d/go-git">src-d/go-git&lt;/a> è¯»å†™å­˜å‚¨åº“ã€‚å®é™…ä¸Šæˆ‘ä»¬å¸¸å¸¸æœ‰é‚£ç§æ„Ÿè§‰ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå¯èƒ½ä¼šæ¯”ç›´æ¥è°ƒç”¨ API æ…¢ï¼Œå¹¶ä¸”é”™è¯¯éš¾ä»¥å¤„ç†ï¼Œè¿™é€šå¸¸æ˜¯å¯¹çš„ã€‚æ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹ &lt;code>HEAD&lt;/code> å¯¹åº”çš„å¼•ç”¨ï¼Œä½¿ç”¨å‘½ä»¤æˆ‘ä»¬å¯ä»¥è¿è¡Œ &lt;code>git symbolic-ref HEAD&lt;/code>ï¼Œè¿è¡Œè¿™ä¸ªå‘½ä»¤æˆ‘ä»¬éœ€è¦ fork å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œfork æˆåŠŸåé©¬ä¸Šåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œ exec git symbolic-refï¼Œä¸ºäº†è¯»å– git symbolic-ref çš„è¾“å‡ºï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºå‡ å¯¹ Pipeï¼Œå¹¶æ£€æµ‹ git symbolic-ref çš„é€€å‡ºå€¼ã€‚è€Œä½¿ç”¨ libgit2 API æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ &lt;code>git_repository_open&lt;/code>,&lt;code>git_reference_open&lt;/code>,&lt;code>git_reference_symbolic_target&lt;/code> å³å¯æ‹¿åˆ°å¯¹åº”çš„å¼•ç”¨ã€‚è€Œå¯¹äºæœåŠ¡ç¨‹åºè€Œè¨€ï¼Œfork-exec çš„ä»£ä»·å¯èƒ½ä¸å°ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>open(&amp;quot;/path/to/.git/HEAD&amp;quot;)&lt;/code> ç„¶åè§£æ HEAD å¯¹åº”çš„å¼•ç”¨ã€‚GitBucket ä½¿ç”¨ JGit è¯»å†™å­˜å‚¨åº“ï¼ŒGitlab æ›¾ç»å†äº† Grit (Grit éƒ¨åˆ†å‘½ä»¤éƒ¨åˆ† Git çº¯ Ruby å®ç°ï¼ŒGithub æ›¾ç»ä½¿ç”¨)ã€‚åæ¥çš„ Ruggedï¼Œåˆ°ç°åœ¨ Gitaly çš„çº¯å‘½ä»¤ + Ruby Repositoryï¼ˆGitlab ç°åœ¨çš„æ¶æ„æˆ‘å¯¹å…¶ä¿ç•™æ„è§ï¼Œè‡³å°‘ IO å¤åˆ¶å°†å¢åŠ å¤šæ¬¡ï¼‰ã€‚Github ç›®å‰ä½¿ç”¨ Rugged è¯»å†™å­˜å‚¨åº“ï¼Œå½“ç„¶ä¸€äº›æ›´å¤šçš„ç»†èŠ‚å› ä¸ºæ²¡æœ‰æºç ä¸å¾—è€ŒçŸ¥ã€‚Gitee ç›®å‰ä½¿ç”¨ Ruggedï¼Œä½†ä¸€éƒ¨åˆ† libgit2 å®ç°ä¸ä½³çš„åˆ™ç›´æ¥é‡‡ç”¨ git å‘½ä»¤å®ç°ã€‚&lt;/p>
&lt;p>å®ç° Git Over HTTPï¼ŒGitlab æœ€åˆé‡‡ç”¨äº† Grack, è¿è¡Œåœ¨ &lt;code>unicorn&lt;/code> ä¸­çš„ Grack å¹¶å‘æœ‰é™ä¸”å®¹æ˜“å½±å“ Web è®¿é—®ï¼ˆå³ Git è¯·æ±‚è¾ƒå¤šæ—¶ï¼ŒWeb æ‹’ç»æœåŠ¡ï¼‰ï¼Œè€ŒåŸºäº Golang å¼€å‘çš„ Gogsï¼ŒGitea ä½¿ç”¨ Golang åŸç”Ÿ HTTP åº“ç¼–å†™ Git HTTP Server åŠŸèƒ½ï¼Œè¿™è¦æ¯” Grack å¥½è¦å¥½å¾ˆå¤šï¼ŒGolang HTTP æ¨¡å‹èƒ½å¤Ÿæ”¯æ’‘æ›´å¤šçš„å¹¶å‘ã€‚ç›®å‰ Gitee çš„ Git HTTP Server Brzox ä¹Ÿæ˜¯ä½¿ç”¨ Golang ç¼–å†™ã€‚&lt;/p>
&lt;p>å®ç° Git Over SSHï¼ŒGitlab ç›®å‰ä¾ç„¶ä½¿ç”¨çš„æ˜¯ OpenSSHï¼Œè€Œä¸åƒ Github/BitBucket/Gitee ç›´æ¥ç¼–å†™ SSH æœåŠ¡å™¨ï¼Œç›´æ¥ç¼–å†™ SSH æœåŠ¡å™¨å¯ä»¥ç¦ç”¨ SSH ç™»å½•ï¼Œè‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ï¼Œç®€åŒ–éªŒè¯æµç¨‹ï¼Œå‡å°‘æ•°æ®æ‹·è´ã€‚Github æ—©å…ˆæ˜¯åŸºäº libssh ç¼–å†™çš„ SSH Server, ç›®å‰ä¸å¾—è€ŒçŸ¥ã€‚BitBucket æŠ€æœ¯ä¸Šåå‘ Java, åˆ™æœ‰å¯èƒ½ä½¿ç”¨ Apache Mina SSHD, GitBucket ä½¿ç”¨ Apache Mina SSHD + JGit å®ç° Git Over SSH åŠŸèƒ½ã€‚è€Œ Gogs/Gitea åœ¨è™½ç„¶ä½¿ç”¨ Golang crypto/ssh ç¼–å†™äº† SSH æœåŠ¡ï¼Œä½†åœ¨å®ç°æ—¶ä»ç„¶ä½¿ç”¨äº†ä¸­é—´å‘½ä»¤ï¼Œè¿™å°±å¯¼è‡´æ•°æ®æ‹·è´æ¬¡æ•°çš„å¢åŠ ï¼Œè§‚æµ‹ Gogs/Gitea çš„å„ç§æœåŠ¡å®ç°ï¼Œè¿™å¯èƒ½æ˜¯è®¾è®¡ä¸è¶³çš„å¦¥åå§ã€‚&lt;/p>
&lt;p>å®ç° Git Over TCP ï¼ˆgit:// åè®®ï¼‰ä¹Ÿéå¸¸ç®€å•ï¼Œä½† Git åè®®å¹¶ä¸æä¾›éªŒè¯æœºåˆ¶ï¼ŒGit ä»£ç æ‰˜ç®¡å¹³å°æä¸æä¾› Git åè®®æ”¯æŒä¹Ÿæ— å…³ç´§è¦ï¼Œä½† Git åè®®æ— éœ€åŠ å¯†ï¼Œåè®®ç®€å•ï¼Œä½œä¸ºå¹³å°å†…éƒ¨ä¼ è¾“æœåŠ¡å€’æ˜¯å¯ä»¥ï¼Œç›®å‰ Gitee ä½¿ç”¨ C++ Asio ç¼–å†™ git-diamond æ”¯æŒå†…éƒ¨åŒæ­¥ï¼Œä¼ä¸šå­˜å‚¨åº“å¤‡ä»½ç­‰åŠŸèƒ½ã€‚&lt;/p>
&lt;h2 id="git-ä»£ç æ‰˜ç®¡å¹³å°çš„ä¼¸ç¼©æ€§">Git ä»£ç æ‰˜ç®¡å¹³å°çš„ä¼¸ç¼©æ€§&lt;/h2>
&lt;!--å­˜å‚¨åº“åˆ†ç‰‡ï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ-->
&lt;p>ä¼¸ç¼©æ€§æ˜¯ Git ä»£ç æ‰˜ç®¡èƒ½å¦æ”¯æ’‘æˆåƒä¸Šä¸‡ç”¨æˆ·/å­˜å‚¨åº“çš„é‡è¦æŒ‡æ ‡ã€‚åƒ Gogs/Gitea è¿™æ ·çš„ä»£ç æ‰˜ç®¡ç³»ç»Ÿå°½é‡è®¤ä¸ºè‡ªèº«è¿è¡Œåœ¨å•ä¸€æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤è¿™ç±» Git ä»£ç æ‰˜ç®¡å¹³å°ä¼¸ç¼©æ€§éå¸¸æœ‰é™ï¼Œå½“ç„¶å¦‚æœä½¿ç”¨ NFS/Ceph è¿™ç±»åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿåœ¨å•ä¸€æœåŠ¡å™¨ä¸Šæ”¯æŒæ›´å¤šçš„å­˜å‚¨åº“ï¼Œä½† NFS/Ceph è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿçš„åšä¸º Git ä»£ç æ‰˜ç®¡ç³»ç»Ÿçš„å­˜å‚¨å±‚ï¼Œé™¤äº†åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå¸¦æ¥çš„æ€§èƒ½ä¸‹é™ï¼Œè¿˜ä¼šå¸¦æ¥å†…ç½‘å¸¦å®½è¿‡é«˜ç­‰æ›´å¤šçš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä»¥ä½¿ç”¨ NFS æŒ‚è½½å®ç°ä¼¸ç¼©æ€§çš„å¹³å°å’Œ Gitee åˆ†å¸ƒå¼æ¨¡å‹ git è¯·æ±‚ å¯¹æ¯”ï¼ŒI/O ç»†èŠ‚ç®€åŒ–å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>NFS I/O ç»†èŠ‚ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/09/20/w7idDP.png" alt="NFS">&lt;/p>
&lt;p>Gitee Basalt I/O ç»†èŠ‚ï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/09/20/w7iDUS.png" alt="Basalt">&lt;/p>
&lt;p>è®¡ç®—æœºæ˜¯è´¨æœ´çš„ï¼Œæµç¨‹çš„å¢åŠ å¾€å¾€éœ€è¦æ›´å¤šçš„è®¡ç®—èµ„æºï¼Œä¸ Basalt-GitSrv ç›¸æ¯”ï¼ŒNFS çš„ I/O æ‹·è´è¦å¤šä¸€äº›ï¼Œæ’é™¤ Git åè®®å½±å“æˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸º Basalt çš„æœºåˆ¶è¦æ¯” NFS æ›´èŠ‚çœ I/Oã€‚å¦‚æœè€ƒè™‘åˆ° Git åè®®çš„å½±å“ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿¡å¦‚æ­¤ï¼Œgit æ¨é€æˆ–è€…æ‹‰å–éƒ½éœ€è¦è€—è´¹å¤§é‡çš„ CPU è®¡ç®—èµ„æºï¼Œè€Œåœ¨ NFS æ¨¡å‹ä¸­ï¼Œè®¡ç®—å…¨éƒ¨éƒ½æ˜¯å‘ç”Ÿåœ¨å‰ç«¯æœåŠ¡å™¨ï¼Œå½“è¯·æ±‚æ•°é‡è¾ƒå¤šæ—¶ï¼Œå‰ç«¯æœåŠ¡å™¨åˆ™å®¹æ˜“å‡ºç° CPU ç«äº‰çš„å±€é¢ï¼Œè¿™å°†éå¸¸å½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œå¦å¤–ï¼Œå¯¹äº NFS è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¯»å†™ Git æ¾æ•£å¯¹è±¡éƒ½æ˜¯ä¸å¾—åŠ›çš„ã€‚å¦å¤–ï¼Œç”±äº NFS çš„ç¼“å­˜æœºåˆ¶ï¼Œè´Ÿè½½è¾ƒé«˜æ—¶ä¼šå‡ºç° &lt;code>master.lock&lt;/code> è¿™æ ·çš„é”å®šæƒ…å†µï¼Œå¯¼è‡´ç”¨æˆ·ä½¿ç”¨å¼‚å¸¸ã€‚è€Œå¯¹äº Basaltï¼Œgit åˆ™æ˜¯åœ¨å­˜å‚¨æœåŠ¡å™¨ä¸Šç›´æ¥æ“ä½œå­˜å‚¨åº“ï¼Œæ‰“åŒ…å‹ç¼©ï¼Œè§£å‹ç­‰å¯¹ CPU éœ€æ±‚è¾ƒé«˜çš„æ´»åŠ¨ä¹Ÿåœ¨å­˜å‚¨æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ„å‘³ç€ï¼ŒCPU è®¡ç®—è¢«æ‘Šè–„åˆ°å­˜å‚¨æœåŠ¡å™¨ä¸Šäº†ï¼Œå¦å¤– basalt-gitsrv ä¸­é—´ä¼ è¾“çš„æ˜¯æ‰“åŒ…åçš„æ•°æ®ï¼Œè¿™ä¸ NFS è¯»å†™å¤šä¸ªæ–‡ä»¶ç›¸æ¯”ï¼Œç½‘ç»œæ•°æ®é‡å®é™…ä¸Šæ˜¯ä¸‹é™çš„ã€‚&lt;/p>
&lt;p>Gitee ä½œä¸ºå›½å†…æœ€æ—©çš„ Git ä»£ç æ‰˜ç®¡å¹³å°ä¹‹ä¸€ï¼Œæœ€å¼€å§‹ä½¿ç”¨ NFS å®ç°ä¼¸ç¼©æ€§ï¼Œéšç€ç”¨æˆ·è§„æ¨¡å¢é•¿å¾ˆå¿«å‡ºç°äº†ä¸Šè¿°æ‰€æœ‰ NFS å®¹æ˜“é‡åˆ°çš„é—®é¢˜ï¼Œåæ¥å°è¯•åˆ‡æ¢åˆ° Cephï¼Œgit æ¾æ•£å¯¹è±¡ç»™å…¶è‡´å‘½ä¸€å‡»ï¼Œä¸Šçº¿ä¾¿å®£å‘Šå¤±è´¥ï¼Œå‡ºç°äº†ä¸¥é‡çš„å®•æœºäº‹æ•…ï¼Œæ•°æ®è¢«æ¯ï¼Œåªèƒ½ä»å¤‡ä»½æ¢å¤ã€‚åæ¥è¿ç§»åˆ°åˆ†å¸ƒå¼æ¶æ„ååŸºæœ¬ç¨³å®šè¿è¡Œè‡³ä»Šï¼ˆè¿™ç§æ–¹æ¡ˆåŸºæœ¬ä¸Šå¢åŠ æœºå™¨å³å¯ï¼Œå‰ç«¯è´Ÿè½½é«˜åŠ å‰ç«¯ï¼Œå­˜å‚¨æ»¡äº†åŠ å­˜å‚¨ï¼‰ã€‚&lt;/p>
&lt;p>Github ç›®å‰æœ‰å¤§çº¦ 1äº¿ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å‡è®¾ Github ä¸Šå­˜å‚¨åº“å¤§å°å¹³å‡ä¸º 10MBï¼Œç›®å‰ Github å­˜å‚¨åº“ä½¿ç”¨ä¸‰å‰¯æœ¬æœºåˆ¶ï¼Œå¤§æ¦‚éœ€è¦çš„ç£ç›˜å®¹é‡ä¸º 2861 TBï¼ŒæŒ‰ç…§ç¡¬ç›˜å‡ºå‚çš„è§„åˆ™ï¼ˆ1000GB=1TBï¼‰,åˆ™æ˜¯éœ€è¦æœ€å° 3PBã€‚è¿™ä¹ˆå¤§çš„ç£ç›˜å®¹é‡å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†æœåŠ¡å™¨èƒ½å¤Ÿæä¾›çš„ï¼ŒæŒ‰ç…§ç›®å‰ä¼ä¸šçº§ç¡¬ç›˜å®¹é‡è¾ƒå¤§çš„æ¯ä¸ª 16TB, åˆ™éœ€è¦ç¡¬ç›˜å¤§æ¦‚ 188 å—ã€‚ä½ èƒ½æƒ³è±¡åˆ°è¿™æ ·å¤§çš„è§„æ¨¡èƒ½å¤Ÿç®€å•çš„è¿è¡Œåœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šå—ï¼Ÿç›®å‰çš„æŠ€æœ¯åŸºæœ¬ä¸Šä¸å¤ªç°å®ã€‚&lt;/p>
&lt;p>å®ç° Git ä»£ç æ‰˜ç®¡å¹³å°çš„å¯ä¼¸ç¼©æ€§é‡è¦çš„æ˜¯å®ç°èµ„æºçš„åˆ†ç‰‡ï¼Œæœ€å¼€å§‹ Gitee åˆ†å¸ƒå¼æ—¶ä½¿ç”¨çš„æ˜¯åŸºäºç”¨æˆ·ï¼ˆnamespaceï¼‰çš„èµ„æºåˆ†ç‰‡ï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨åº“æ‰€åœ¨çš„æœºå™¨ä¸ namespace æ‰€å±çš„æœºå™¨åƒåŒ¹é…ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§å…ˆå…¥ä¸ºä¸»çš„è®¾è®¡ï¼Œåœ¨ä½¿ç”¨ NFS æŒ‚è½½çš„æ—¶ä»£ï¼ŒGitee çš„å­˜å‚¨åº“å°±æ˜¯æŒ‰ç…§ namespace çš„å‰ä¸¤ä¸ªå­—æ¯åˆ†ç‰‡å­˜å‚¨åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼ŒæŒ‚è½½åˆ°å‰ç«¯æœåŠ¡å™¨ä¸Šã€‚å› æ­¤ï¼ŒåŸºäº namespace çš„åˆ†ç‰‡å¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç”¨æˆ·è½¬ç§»å­˜å‚¨åº“å¯èƒ½éœ€è¦è·¨æœºå™¨ï¼Œfork å­˜å‚¨åº“ä¹Ÿå¯èƒ½éœ€è¦è·¨æœºå™¨ï¼Œè¿™å°±æ— æ³•å®ç°é«˜æ•ˆçš„è½»é‡çº§ fork åŠŸèƒ½ã€‚ä»å»å¹´å¼€å§‹è¿ç§»åˆ°åŸºäºå­˜å‚¨åº“çš„åˆ†ç‰‡ï¼ŒåŸºäºå­˜å‚¨åº“åˆ†ç‰‡åŸºæœ¬ä¸Šå¯ä»¥è§£å†³è¿™äº›é—®é¢˜ï¼Œä½†ç”±äºå†å²åŸå› ï¼Œè½»é‡çº§ fork ç­‰åŠŸèƒ½é“é˜»ä¸”é•¿ã€‚&lt;/p>
&lt;p>èµ„æºçš„åˆ†ç‰‡å’Œè¯·æ±‚çš„è·¯ç”±ç›¸ä¼´è€Œç”Ÿï¼Œå°†å­˜å‚¨åº“å­˜å‚¨åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šåï¼Œåˆ™éœ€è¦åœ¨è¿™äº›æœåŠ¡å™¨ä¸Šå®ç°å¯¹åº”çš„æœåŠ¡æ”¯æŒå‰ç«¯çš„è¯·æ±‚ï¼Œè€Œå‰ç«¯ä¹Ÿéœ€è¦å®ç°ç‰¹å®šçš„è·¯ç”±æœºåˆ¶ï¼Œå…³äº Gitee çš„è·¯ç”±æœºåˆ¶æ¶æ„ï¼Œå¯ä»¥å‚è€ƒç›¸å…³æ¼”è®²æˆ–è€…åšå®¢ã€‚Gitee å­˜å‚¨æœåŠ¡å™¨ä¸Šä½¿ç”¨äº† git-srv ä½œä¸º Git ä¼ è¾“åè®®åç«¯æœåŠ¡ï¼Œè€Œ Github åˆ™ä½¿ç”¨äº† DGit/Spokesï¼ŒGitlab ä½¿ç”¨äº† Gitalyã€‚ä¸åŒå¹³å°çš„æŠ€æœ¯å„æœ‰ä¾§é‡ï¼Œæ¯”å¦‚ Gitlab Gitaly ä¾§é‡å…¼å®¹æ—§çš„ OpenSSHï¼Œè€Œ Gitee çš„ Basalt-GitSrv é’ˆå¯¹å®é™…æƒ…å†µä¼˜åŒ–ï¼Œä¸ Gitaly ç›¸æ¯”è¦å°‘ä¸€æ¬¡ I/O æ‹·è´ã€‚ Gitee ç›®å‰ä¸è¶³ä¹‹å¤„æ˜¯å­˜æ²¡æœ‰å®Œå…¨å‰¥ç¦» Web(åŸºäºæ—©æœŸ Gitlab å‘å±•è€Œæ¥)ï¼Œè€Œ Gitaly ä¹Ÿæœ‰ Ruby ä»£ç å®ç°å­˜å‚¨åº“è¯»å†™ï¼ˆè¿™å—ä»£ç ç”¨ Golang å°è£… I/O å¤šäº†ä¸€æ¬¡æ‹·è´ï¼‰ã€‚ä¸ Gitee ç±»ä¼¼ï¼ŒGitea è¿˜æœ‰å¦ä¸€ç§æ–¹æ¡ˆï¼Œå³å°† Gitea éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šå…±ç”¨ DB æ”¯æŒåˆ†ç‰‡ï¼Œæ¯”å¦‚ &lt;a href="https://gitea.com">gitea.com&lt;/a> ä¾¿æ˜¯è¿™æ ·çš„å¹³å°ï¼Œä½† gitea.com ä¼¼ä¹å¹¶ä¸æ”¯æŒ SSHï¼Œå› æ­¤å¹¶ä¸èƒ½ç®—æœ‰æ•ˆçš„åˆ†ç‰‡ã€‚&lt;/p>
&lt;p>å‰ç«¯æœåŠ¡å™¨çš„æ‰©å±•æ€§å®é™…ä¸Šè¦æ¯”å­˜å‚¨æœåŠ¡å™¨å¥½ï¼Œå‰ç«¯æœåŠ¡å™¨çš„è¿ç§»ä¸€èˆ¬ä¸éœ€è¦åƒå­˜å‚¨æœåŠ¡å™¨é‚£æ ·è½¬ç§»å­˜å‚¨åº“ï¼ŒæœåŠ¡ä¹Ÿä¸€èˆ¬æ›´ç®€å•ã€‚&lt;/p>
&lt;p>å­˜å‚¨åº“åˆ†ç‰‡ä¹‹åè¿˜æ˜¯æ— æ³•é¿å…ç‰¹å®šå­˜å‚¨åº“è¯·æ±‚è¿‡å¤šçš„é—®é¢˜ï¼ŒGithub çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸‰å‰¯æœ¬è¯»å†™åˆ†ç¦»çš„ Spokes æœºåˆ¶ï¼Œè¿™ä¸€æ–¹æ¡ˆæœ€å¤šèƒ½å¤Ÿæä¾› 3å€äºå•ä¸€æœåŠ¡å™¨çš„å¹¶å‘è¯»å–èƒ½åŠ›ï¼Œä½†ä¸æ”¯æŒå¹¶å‘å†™å…¥å­˜å‚¨åº“ã€‚ä¸‰å‰¯æœ¬æœºåˆ¶éœ€è¦è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå¼•å…¥å¹¶å‘å†™å…¥å¯èƒ½ä¼šå¸¦æ¥æ›´å¤šçš„æ•°æ®å†²çªï¼Œç ´åä¸€è‡´æ€§ï¼Œå› æ­¤ Github å®Œå…¨ç¦æ­¢å¹¶å‘å†™å…¥å­˜å‚¨åº“å‰¯æœ¬ï¼ˆå³åŒæ—¶æœ‰ä¸åŒçš„å†™å­˜å‚¨åº“è¯·æ±‚ï¼‰ã€‚Gitlab æ²¡æœ‰å®ç°è¿™æ ·çš„æŠ€æœ¯ï¼ŒBitBucket åˆ™æ²¡æœ‰æŠ«éœ²ç›¸å…³èµ„è®¯ï¼ŒGitee å—é™ä¸ç¡¬ä»¶é™åˆ¶å’Œå¼€å‘èµ„æºé™åˆ¶ï¼Œä¹Ÿæ²¡æœ‰å®æ–½ã€‚&lt;/p>
&lt;p>github-dfsï¼š&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/09/20/w7i63j.png" alt="DGIT">&lt;/p>
&lt;p>é™¤äº†å­˜å‚¨åº“çš„åˆ†ç‰‡ï¼Œä»£ç æ‰˜ç®¡å¹³å°è¿˜éœ€è¦è€ƒè™‘æ•°æ®åº“ SQL/NoSQL èƒ½å¦æ”¯æ’‘å¤§è§„æ¨¡å¹¶å‘ï¼Œæ•°æ®åº“çš„åˆ†å¸ƒå¼é›†ç¾¤æ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆï¼Œè€Œ Redis æœ€æ–°çš„ç‰ˆæœ¬ä¹Ÿæ”¯æŒé›†ç¾¤ï¼Œå› æ­¤æ•°æ®åº“çš„ä¼¸ç¼©æ€§ä¸€èˆ¬ä¸ä¼šå­˜åœ¨å¤ªå¤§é—®é¢˜ï¼Œå¢åŠ æœºå™¨æ­å»ºé›†ç¾¤å³å¯ã€‚é€‰æ‹©å…³ç³»æ€§æ•°æ®åº“æ—¶è¿˜éœ€è¦è€ƒè™‘è®¸å¯è¯ï¼Œæ•°æ®åº“è‡ªèº«çš„åŠŸèƒ½ç­‰ï¼Œæ¯”å¦‚ Gitlab ç›®å‰å·²ç»æ”¾å¼ƒå¯¹ MySQL çš„æ”¯æŒï¼Œè€Œæ˜¯é€‰æ‹©äº† PostgreSQLï¼Œä¸è¿‡ Gitlab çš„é€‰æ‹©å¯¹äºå…¶ä»–ä»£ç æ‰˜ç®¡å¹³å°æ¥è¯´ï¼Œä¹Ÿåªèƒ½ç®—ä½œ&lt;strong>ä»…ä½œå‚è€ƒ&lt;/strong>ã€‚MariaDB æ˜¯ MySQL çš„åˆ†æ”¯ç‰ˆæœ¬ï¼Œéšç€ MySQL è¢« Oracle æ”¶è´­ï¼Œå¼€æºç¤¾åŒºæ¸æ¸ä¸§å¤±äº†å¯¹ MySQL çš„å…´è¶£ï¼Œè™½ç„¶ MySQL 8.0 å‘å¸ƒå·²ç»å¾ˆä¹…ï¼Œä½†é‡‡ç”¨ MySQL 8.0 çš„å‘è¡Œç‰ˆæœ¬å¯¥å¯¥æ— å‡ ï¼Œå¾ˆå¤šè¿˜åœç•™åœ¨ MySQL 5.Xï¼Œæœ‰äº›å‘è¡Œç‰ˆè¿˜ä½¿ç”¨ &lt;a href="https://github.com/MariaDB/mariadb-connector-c">mariadb-connector-c&lt;/a> æ›¿ä»£ &lt;code>libmysqlclient&lt;/code> ä½œä¸ºæ•°æ®åº“è¿æ¥å™¨ï¼Œä½¿ç”¨ MySQL çš„å¹³å°å¾ˆå®¹æ˜“è¿ç§»åˆ° MariaDB è€Œä¸ç”¨ä¿®æ”¹å®¢æˆ·ç«¯æ•°æ®åº“è¿æ¥ä»£ç  ï¼ŒMariaDB æ”¯æŒçº¿ç¨‹æ± ï¼Œè€Œ MySQL ä»…åœ¨ä¼ä¸šç‰ˆä¸­æ”¯æŒçº¿ç¨‹æ± ã€‚ä¸€äº› MariaDB ä¸ MySQL çš„å¯¹æ¯”è¿™é‡Œä¸èµ˜è¿°äº†ã€‚Gogs/Gitea è¿˜æ”¯æŒä½¿ç”¨ SQLiteï¼Œä½†å…¶ä½¿ç”¨ SQLite æ—¶ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ”¾å¼ƒäº†ä¼¸ç¼©æ€§ï¼Œä¸è¿‡ç›®å‰æœ‰ä¸€ä¸ªä½¿ç”¨ Raft+libuv å®ç°çš„åˆ†å¸ƒå¼ SQLite &lt;a href="https://github.com/canonical/dqlite">canonical/dqlite&lt;/a>ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚Redis ä¸€èˆ¬å¯ä»¥ä½œä¸º Web ç¼“å­˜æˆ–è€…ä»»åŠ¡é˜Ÿåˆ—çš„ä¸­é—´ä»¶ï¼Œç›®å‰ Redis è™½ç„¶æ”¯æŒé›†ç¾¤ï¼Œä½†å°±å•æœº Redis è€Œè¨€ï¼Œç”±äºå®ƒæ˜¯å•çº¿ç¨‹çš„æœåŠ¡ï¼Œåœ¨å°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜æ˜¯è¿˜æ˜¯å¯èƒ½å‡ºç°è¶…æ—¶ï¼Œå¹¶ä¸”å•çº¿ç¨‹æœåŠ¡æ€§èƒ½ç»ˆç©¶æœ‰é™ï¼Œåœ¨ Github ä¸Šï¼Œ&lt;a href="https://github.com/JohnSully/KeyDB">KeyDB&lt;/a> æ˜¯å®˜æ–¹ Redis çš„å¦ä¸€ä¸ªé€‰æ‹©ï¼ŒKeyDB æ˜¯ Redis çš„åˆ†æ”¯ï¼Œå®Œå…¨å…¼å®¹ Redis åè®®ï¼ŒKeyDB æ”¯æŒå¤šçº¿ç¨‹ï¼Œæœ‰æ›´å¥½çš„å†…å­˜æ•ˆç‡å’Œé«˜ååé‡ã€‚&lt;/p>
&lt;h2 id="git-ä»£ç æ‰˜ç®¡å¹³å°çš„å¢å¼ºåŠŸèƒ½">Git ä»£ç æ‰˜ç®¡å¹³å°çš„å¢å¼ºåŠŸèƒ½&lt;/h2>
&lt;!--å¤§å­˜å‚¨åº“ï¼Œå¤§æ–‡ä»¶ï¼Œä¿æŠ¤åˆ†æ”¯ï¼Œåªè¯»ç›®å½•ï¼Œå®‰å…¨ï¼Œä¸¤æ­¥éªŒè¯/WebAuthn (https://github.com/duo-labs/webauthn)...-->
&lt;p>é™¤äº†æ”¯æŒç”¨æˆ·é€šè¿‡ Git åè®®æˆ–è€…é€šè¿‡ç½‘é¡µæ–¹å¼è¯»å†™è¿œç¨‹å­˜å‚¨åº“ï¼Œä»£ç æ‰˜ç®¡å¹³å°ä¸€èˆ¬è¿˜éœ€è¦æä¾›ä¸€äº›ä¸å¼€å‘ç›¸å…³çš„åŠŸèƒ½å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œè¿™äº›åŠŸèƒ½åœ¨ä¸åŒå¹³å°ä¹‹é—´çš„å¯¹æ¯”æ—¶æ˜¾å¾—éå¸¸é‡è¦ã€‚&lt;/p>
&lt;h3 id="ç¼ºé™·è¿½è¸ª">ç¼ºé™·è¿½è¸ª&lt;/h3>
&lt;p>&lt;a href="https://www.sqlite.org">SQLite3&lt;/a> ä½¿ç”¨ 2007 å¹´è¯ç”Ÿçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ &lt;a href="https://fossil-scm.org">Fossil&lt;/a> æ‰˜ç®¡å…¶æºç ï¼Œä¸å‰è¾ˆ Git ç›¸æ¯”ï¼Œå®ƒé›†æˆäº† Bug è¿½è¸ªï¼ŒWikiï¼Œè®ºå›å’ŒæŠ€æœ¯æŠ¥å‘Šã€‚è€Œå¯¹äº Git æ¥è¯´ï¼Œè¿™äº›åˆ™éœ€è¦ Git ä»£ç æ‰˜ç®¡å¹³å°è‡ªå·±å®ç°ï¼Œå½“ç„¶ç°åœ¨æ— è®ºæ˜¯ Github/Gitee/Gitlab/BitBucket è¿˜æ˜¯ Gogs/Gitea éƒ½æä¾›äº† &lt;code>Issues&lt;/code>è¿™æ ·çš„æœºåˆ¶æ–¹ä¾¿å¼€å‘è€…ç¬¬ä¸€æ—¶é—´æŠ¥å‘Šè½¯ä»¶ç¼ºé™·æˆ–è€…æå‡ºåŠŸèƒ½å»ºè®®ã€‚&lt;code>Issues&lt;/code> è¿™æ ·çš„åŠŸèƒ½å®ç°ä¸»è¦åœ¨äºè®©ç”¨æˆ·å‚ä¸å…¶ä¸­ï¼Œä¹Ÿå°±æ˜¯ç”¨çš„äººå¤šäº†ï¼Œæ‰æœ‰äººæ°”ã€‚è€Œ Github çš„ &lt;code>Issues&lt;/code> ç›¸æ¯”å…¶ä»–å¹³å°æ˜¯æœ€æ´»è·ƒçš„ã€‚å¦å¤– Github è¿˜æä¾›ä¾èµ–è­¦æŠ¥åŠŸèƒ½ï¼ˆè¯¦æƒ…å¯ä»¥é˜…è¯» &lt;a href="https://github.blog/2017-11-16-introducing-security-alerts-on-github/">Introducing security alerts on GitHub&lt;/a>ï¼‰ï¼Œå¦å¤– Github è¿˜æ”¶è´­äº† Semmle ä»£ç åˆ†æç”¨äºè¿ç»­æ¼æ´æ£€æµ‹ (å‚è€ƒï¼š&lt;a href="https://github.blog/2019-09-18-securing-software-together/">Securing software, together&lt;/a>ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å…¶ä»– Git ä»£ç æ‰˜ç®¡å¹³å°å¯ä»¥å€Ÿé‰´çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;h3 id="æŒç»­é›†æˆ">æŒç»­é›†æˆ&lt;/h3>
&lt;p>åœ¨å¾®è½¯æ”¶è´­ Githubä¹‹åï¼ŒGithub æœ‰äº†æ›´å……è¶³çš„è´¢åŠ›åœ¨ç»™ç”¨æˆ·æä¾›æŒç»­é›†æˆåŠŸèƒ½ï¼Œä»Šå¹´ä»¥æ¥ Github æ¨å‡ºäº† &lt;a href="https://github.com/features/package-registry">GitHub Package Registry&lt;/a> å’Œ &lt;a href="https://github.com/features/actions">Github Actions&lt;/a> ï¼ˆç›¸å…³æ–‡ç« ï¼š&lt;a href="https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/">GitHub Actions now supports CI/CD, free for public repositories&lt;/a>ï¼Œ&lt;a href="https://github.blog/2019-05-10-introducing-github-package-registry/">Introducing GitHub Package Registry&lt;/a>ï¼‰ï¼Œåœ¨æ¨å‡º Github Actions ä¹‹å‰ï¼Œå¼€å‘è€…åœ¨ Github ä¸Šå¤§å¤šæ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹è½¯ä»¶å®ç° CI/CD åŠŸèƒ½ï¼Œæ¯”å¦‚æˆ‘çš„ &lt;a href="https://github.com/M2Team/Privexec">M2Team/Privexec&lt;/a> å°±ä½¿ç”¨ Appveroyã€‚Windows Terminal åˆ™ä½¿ç”¨ Azure Pipelineã€‚å¹³å°çš„ç”Ÿæ€ç¹è£å¾—ç›Šäºç¬¬ä¸‰æ–¹çš„æ”¯æŒï¼Œè€Œå¯¹äºå…¶ä»–å¹³å°ï¼Œè¿™äº› CI/CD æ”¯æŒå°±æ²¡æœ‰è¿™ä¹ˆå¤§çš„åŠ›åº¦äº†ï¼Œè¿™ä¹Ÿä¿ƒä½¿å…¶ä»–ä»£ç æ‰˜ç®¡å¹³å°çš„ API è¶‹å‘ Github åŒ–ï¼ŒWebHook ä¹Ÿé€æ­¥è¶‹åŒï¼ŒGithub å½¢æˆäº†äº‹å®ä¸Šçš„æ ‡å‡†ã€‚æ¯”å¦‚ Gitee çš„ APIv5 å°±ä¿æŒäº†å¯¹ Github çš„å…¼å®¹ã€‚&lt;/p>
&lt;p>&lt;strong>2020-09-20 æ›´æ–°&lt;/strong> Github çš„ Actions å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æŒç»­é›†æˆæµæ°´çº¿ï¼Œç›®å‰ &lt;a href="https://github.com/M2Team/Privexec">M2Team/Privexec&lt;/a> å·²ç»è¿ç§»åˆ° Github Actionsï¼Œå¦å¤–æˆ‘å¼€å‘çš„ Windows åŒ…ç®¡ç†å·¥å…· &lt;a href="https://github.com/baulk/baulk">baulk&lt;/a> ä¹Ÿä½¿ç”¨äº† Github Actionsã€‚é€šè¿‡ç¼–å†™ Github Actions æ’ä»¶ï¼Œå¯ä»¥å®Œæˆç¼–è¯‘æµ‹è¯•éƒ¨ç½²ç­‰å·¥ä½œï¼Œä¸èƒ½è®¤ä¸ºå…¶æ˜¯å•ä¸€çš„æŒç»­é›†æˆå·¥å…·ã€‚&lt;/p>
&lt;h3 id="ä¿æŠ¤åˆ†æ”¯å’Œåªè¯»ç›®å½•">ä¿æŠ¤åˆ†æ”¯å’Œåªè¯»ç›®å½•&lt;/h3>
&lt;p>Gitee å¾ˆæ—©å°±å®ç°äº†ç±»ä¼¼ SVN çš„ä¿æŠ¤åˆ†æ”¯åŠŸèƒ½ï¼Œè€Œ Github ç›®å‰ä¹ŸåŒæ ·æ”¯æŒä¿æŠ¤åˆ†æ”¯ã€‚å®ç°ä¿æŠ¤åˆ†æ”¯çš„é€”å¾„å¾ˆå¾ˆå¤šæ¡ï¼Œé€šå¸¸é€šè¿‡æœåŠ¡ç«¯ Git é’©å­å®ç°ï¼Œæˆ‘æ›¾å†™è¿‡ &lt;a href="https://forcemz.net/git/2019/07/31/GNKServerSide/">ã€ŠæœåŠ¡ç«¯ Git é’©å­çš„å¦™ç”¨ã€‹&lt;/a> ä»‹ç»äº†å¦‚ä½•é€šè¿‡é’©å­å®ç°ä¿æŠ¤åˆ†æ”¯åŠŸèƒ½ã€‚&lt;/p>
&lt;p>åªè¯»ç›®å½•åŠŸèƒ½åŒæ ·å¯ä»¥é€šè¿‡é’©å­å®ç°ï¼Œå¦‚æœä¸é€šè¿‡é’©å­ï¼Œè€Œæ˜¯åœ¨ git å‘½ä»¤ä¸­å®ç°ï¼Œåˆ™è¦é¢ä¸´ä¿®æ”¹ git æºç ï¼Œéœ€è¦æŠ•å…¥å¤§é‡äººåŠ›ç»´æŠ¤çš„æƒ…å†µã€‚ã€ŠæœåŠ¡ç«¯ Git é’©å­çš„å¦™ç”¨ã€‹å’Œ &lt;a href="https://forcemz.net/git/2019/04/01/ImplementGitDirPermissionControl/">ã€Šå®ç° Git ç›®å½•æƒé™æ§åˆ¶ã€‹&lt;/a>å¯¹å®ç°ç›®å½•æƒé™æ§åˆ¶æœ‰è¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;h3 id="å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥å…¥">å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥å…¥&lt;/h3>
&lt;p>å°†ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„å­˜å‚¨åº“è½¬ä¸º Git éå¸¸ç®€å•ï¼Œgit è‡ªèº«æä¾›äº† &lt;code>git svn&lt;/code> å‘½ä»¤ï¼Œå¯ä»¥å°†è¿œç¨‹ svn å­˜å‚¨åº“ä¸€ä¸ªä¸ªç‰ˆæœ¬é€’å½’çš„è½¬å˜ä¸º Git å­˜å‚¨åº“ï¼Œè¯¦ç»†çš„æ“ä½œå¯ä»¥å‚è€ƒ &lt;a href="https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git">ã€ŠPro Git 2nd Editionã€‹9.2 Git and Other Systems - Migrating to Git&lt;/a>ï¼Œè¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹æ¯”è¾ƒæ˜¯æ¯”è¾ƒè€—æ—¶ï¼ŒGitee å¼€å‘è€…æ›¾ç»å¸®åŠ©å›½å†…æŸæ±½è½¦åˆ¶é€ ä¼ä¸šå°† Subversion å­˜å‚¨åº“è¿ç§»åˆ° Gitï¼Œä¸€å¼€å§‹ä½¿ç”¨ &lt;code>git svn&lt;/code>ï¼Œå‘ç°è€—è´¹æ—¶é—´å¤ªé•¿ï¼Œäºæ˜¯æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªå¼€æºå·¥å…·ï¼š &lt;a href="https://github.com/satori/git-svn-fast-import">git-svn-fast-import&lt;/a>ï¼Œå°†å…¶ç¼–è¯‘å¥½å¹¶ä¿®å¤ç‰¹å®š BUG äº¤ç»™ç›¸å…³åŒäº‹ï¼Œåæ¥è¯¥ä¼ä¸šçš„è¿ç§»å·¥ä½œé¡ºåˆ©å®Œæˆã€‚è¿™ä¸ªå·¥å…·ç›´æ¥è§£æå­˜å‚¨åº“å°†å…¶è½¬æ¢ä¸º git å­˜å‚¨åº“ï¼Œçœå»äº†ç½‘ç»œä¼ è¾“çš„æ¶ˆè€—ã€‚&lt;/p>
&lt;p>é™¤äº†æ”¯æŒä»å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¯¼å…¥å¤–ï¼Œä¸€äº›ä»£ç  Git ä»£ç æ‰˜ç®¡å¹³å°ä¹Ÿæ”¯æŒå…¶ä»–åè®®æ¥å…¥ï¼ŒGithub/Gitee éƒ½æ”¯æŒ Subversion æ¥å…¥ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªå­˜å‚¨åº“åŒæ—¶æ”¯æŒ git å®¢æˆ·ç«¯å’Œ svn å®¢æˆ·ç«¯æ¥å…¥ï¼ˆåƒ BitBucket æ”¯æŒ Mercurial çš„å®ç°å®é™…ä¸Šæ˜¯å•ç‹¬æ­å»º Mercurial å­˜å‚¨åº“ï¼Œä¸å±äºæ­¤ç±»æƒ…å†µï¼‰ã€‚å®ç° Subversion çš„æ¥å…¥å‡ ä¸ªéš¾ç‚¹ï¼Œä¸€æ˜¯ Subversion å„ç§ä¼ è¾“åè®®ç»†èŠ‚å®Œå…¨ä¸åŒï¼ŒHTTP åŸºäº WebDAVï¼Œè€Œ SVN åè®®åˆæ˜¯ä¸€ç§è‡ªå®šä¹‰çš„ &lt;a href="https://github.com/apache/subversion/blob/trunk/subversion/libsvn_ra_svn/protocol">ABNF æ ¼å¼åè®®&lt;/a>ï¼Œå¦‚æœåœ¨è€ƒè™‘æ”¯æŒ Subversion æ¥å…¥æ—¶è¿˜éœ€è¦è€ƒè™‘é€‰æ‹©å“ªç§åè®®ï¼Œä¸¤ç±»åè®®éƒ½æ”¯æŒé€šå¸¸æ˜¯ä¸ç°å®çš„ï¼Œè´¹æ—¶è´¹åŠ›ã€‚äºŒæ˜¯ Subversion è‡ªèº«ä¹Ÿåœ¨ä¸æ–­å‘å±•ï¼Œä½†å®é™…ä¸Šåœ¨æ„¿æ„åœ¨ Git ä»£ç æ‰˜ç®¡å¹³å°ä½¿ç”¨ svn çš„æ¯•ç«Ÿè¿˜æ˜¯å°‘æ•°ï¼Œå®ç° Subversion æ¥å…¥é€šå¸¸æ˜¯è´¹åŠ›ä¸è®¨å¥½ï¼ŒæŠ•å…¥ä¸äº§å‡ºä¸æˆæ­£æ¯”ã€‚&lt;/p>
&lt;p>Github å®ç°çš„æ˜¯ svn HTTP åè®®ï¼Œå°† git å­˜å‚¨åº“çš„ commit æ˜ å°„åˆ° svn çš„ revsã€‚Github çš„å®ç°å¹¶ä¸å®Œç¾ï¼Œç”±äºéœ€è¦é€šè¿‡ commit è®¡ç®— svn ç‰ˆæœ¬ä¿¡æ¯ï¼Œç¬¬ä¸€æ¬¡é€šè¿‡ svn åè®®è®¿é—®å­˜å‚¨åº“æ—¶ä¼šæ¯”è¾ƒæ…¢ï¼Œå¦‚æœå½“å­˜å‚¨åº“è¾ƒå¤§æ—¶ï¼Œæ£€å‡ºè¿˜å¾ˆå®¹æ˜“å¤±è´¥ï¼Œå¹¶ä¸”ä¸€æ¬¡æ£€å‡ºæ“ä½œå¯èƒ½éœ€è¦å‘é€çš„éå¸¸å¤šçš„è¯·æ±‚ï¼Œå¤§æ¦‚æ˜¯æ‰€æœ‰ç›®å½•æ‰€æœ‰æ–‡ä»¶æ•°ç›®ä¹‹å’Œã€‚&lt;/p>
&lt;p>Gitee ä½¿ç”¨äº† &lt;a href="https://github.com/bozaro/git-as-svn">git-as-svn&lt;/a> å®ç°å¯¹ svn çš„æ”¯æŒï¼Œæ”¯æŒçš„åè®®æœ‰ &lt;code>svn://&lt;/code> å’Œ &lt;code>svn+ssh://&lt;/code>ï¼Œ&lt;code>svn+ssh://&lt;/code> å®é™…ä¸Šæ˜¯ &lt;code>svn://&lt;/code> åè®®é€šè¿‡ SSH éš§é“ä¼ è¾“ï¼Œåœ¨ Gitee ä¸­ï¼Œå½“ Basalt æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œ &lt;code>svnserve -t&lt;/code> å‘½ä»¤ï¼Œåˆ™ä¼šå°†è¯·æ±‚è½¬å‘åˆ° git-as-svnã€‚åœ¨ Gitea å¼€å‘è€…çš„è´¡çŒ®ä¸‹ï¼Œgit-as-svn å¢åŠ äº† &lt;code>svnserve&lt;/code> å‘½ä»¤åŒ…è£…ï¼Œå³å½“ Gitea æ¥æ”¶åˆ° &lt;code>svn+ssh://&lt;/code> åè®®è¯·æ±‚æ—¶ï¼Œåˆ™æ˜¯å¯åŠ¨åŒ…è£…çš„å‘½ä»¤ï¼Œè¿›è¡Œä¸€äº›åˆ—æˆæƒåç„¶ååœ¨ shell ä¸­ä¸ä½¿ç”¨å‘½ä»¤ &lt;code>exec 3&amp;lt;&amp;gt;/dev/tcp/localhost/3690&lt;/code> ä¸ git-as-svn é€šä¿¡ï¼ŒGitee çš„è®¾è®¡ç®€åŒ–äº†éªŒè¯æµç¨‹ï¼Œèƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼æ¶æ„ï¼ŒGitea ç›®å‰è¿˜ä¸èƒ½åšåˆ°ã€‚git-as-svn çš„åŸºäº Java å¼€å‘ï¼Œæ—©æœŸï¼Œå¼€å‘è€…ä¼¼ä¹å¯¹ git çš„ç†å¿µç ”ç©¶ä¸å¤Ÿé€å½»ï¼Œgit-as-svn çš„å†…éƒ¨å®ç°ç»†èŠ‚å˜åŠ¨éå¸¸å¤§ï¼Œæ—©å‰çš„å®ç°æœºåˆ¶ä¸å¤ªç†æƒ³ï¼Œæ€§èƒ½ä¸ä½³ã€‚åœ¨ Gitee ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†é¿å…å­˜å‚¨åº“è¾ƒå¤§æ—¶å¼€å¯ svn æ”¯æŒå¸¦æ¥çš„æ€§èƒ½ä¸‹é™ï¼Œé¢å¤–å¢åŠ äº†å¯¹é€šè¿‡ svn åè®®è®¿é—®å­˜å‚¨åº“çš„é™åˆ¶ï¼Œç›®å‰æ˜¯é€šè¿‡ svn åè®®è®¿é—®å­˜å‚¨åº“æ—¶ï¼Œå­˜å‚¨åº“çš„å¤§å°é™åˆ¶ä¸º 400MBã€‚&lt;/p>
&lt;p>åœ¨æ—©æœŸï¼Œå…¼å®¹å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¯èƒ½æ˜¯å¸å¼•ç”¨æˆ·çš„ä¸€å¤§æ³•å®ï¼Œä½†éšç€ Git çš„è¶Šæ¥è¶Šæµè¡Œï¼Œæ”¯æŒå…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥å…¥é€æ¸æˆäº†é¸¡è‚‹ï¼Œå‰äººæœ‰è¨€ï¼šâ€œé£Ÿä¹‹æ— è‚‰ï¼Œå¼ƒä¹‹å¯æƒœâ€ï¼Œæ­£æ˜¯å¦‚æ­¤ã€‚åƒ Github/Gitee è¿™æ ·çš„å¹³å°è™½ç„¶æ”¯æŒ svnï¼Œä½† svn è®¿é—®çš„è¿˜æ˜¯æå°‘æ•°ï¼Œè€Œæ”¯æŒ svn åˆ™éœ€è¦èŠ±è´¹ä¸€äº›äººåŠ›ç‰©åŠ›ï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿæ¶æ„è®¾è®¡æ—¶å¢åŠ äº†å¤æ‚åº¦ã€‚å¦‚æœç°åœ¨å¼€å‘ä¸€ä¸ª Git ä»£ç æ‰˜ç®¡å¹³å°åˆ™æ²¡æœ‰å¿…è¦æ”¯æŒ svnã€‚Gitee è™½ç„¶æ”¯æŒ svnï¼Œä½† svn æ¯æ—¥çš„è¯·æ±‚æ•°ä¸è¶³ 1%ï¼Œåœ¨è¿™ 1% ä¸­ï¼Œåˆæœ‰ 50% ä»¥ä¸Šçš„è¯·æ±‚æ˜¯ç‰¹å®šçš„ç”¨æˆ·ä½¿ç”¨å®šæ—¶å‘½ä»¤å‘é€çš„ã€‚&lt;/p>
&lt;h3 id="å¤§æ–‡ä»¶å¤§å­˜å‚¨åº“">å¤§æ–‡ä»¶å¤§å­˜å‚¨åº“&lt;/h3>
&lt;p>å…¬å…± Git ä»£ç æ‰˜ç®¡å¹³å°å¾ˆå¤šæ—¶å€™å®é™…ä¸Šæ˜¯ç»™ç”¨æˆ·æä¾›å…è´¹æœåŠ¡ï¼Œä¸ºäº†è¿‡å¤šé¿å…å¤§æ–‡ä»¶å¤§å­˜å‚¨åº“å ç”¨å¹³å°èµ„æºï¼Œå¯¹å…¶ä½œå‡ºé™åˆ¶å¿…ä¸å¯å°‘ï¼Œé€šå¸¸æ˜¯å¤§æ–‡ä»¶é™åˆ¶ 100MB, å­˜å‚¨åº“é™åˆ¶ 1GB. å­˜å‚¨åº“çš„æ£€æµ‹ç®€å•çš„éå†å­˜å‚¨åº“ objects ç›®å½•å³å¯ï¼Œè€Œå¤§æ–‡ä»¶çš„æ£€æµ‹åˆ™å¤æ‚ä¸€äº›ã€‚Gitee æœ€åˆä½¿ç”¨ Grit æ£€æµ‹ commit æ˜¯å¦å¼•å…¥äº† blob åŸå§‹å¤§å°å¤§äºé™åˆ¶çš„æ–‡ä»¶ï¼Œä½†è¿™ç§æœºåˆ¶éœ€è¦è§£æ Git å¯¹è±¡ï¼Œæ£€æµ‹å®¹æ˜“åå¡Œï¼ˆä¸€æ˜¯æ£€æµ‹è¶…æ—¶ï¼ŒäºŒæ˜¯æ£€æµ‹é€ƒé€¸ï¼Œä¸‰æ˜¯å­˜å‚¨åº“ä½“ç§¯è†¨èƒ€ï¼‰ï¼Œåå¼€ä½¿ç”¨åŸç”Ÿé’©å­ï¼Œæ”¹å˜äº†æ£€æµ‹æœºåˆ¶ï¼Œåˆ™é¿å…äº†è¿™äº›é—®é¢˜ã€‚è¯¦ç»†æƒ…å†µå¯ä»¥é˜…è¯»&lt;a href="https://forcemz.net/git/2019/07/31/GNKServerSide/">ã€ŠæœåŠ¡ç«¯ Git é’©å­çš„å¦™ç”¨ã€‹&lt;/a>ã€‚&lt;/p>
&lt;p>ç¦æ­¢å¤§æ–‡ä»¶æ¨é€è¿™åªæ˜¯å µï¼Œé‚£ä¹ˆå¤§æ–‡ä»¶åº”è¯¥å¦‚ä½•å­˜æ”¾å‘¢ï¼ŸGithub æ¨å‡ºäº† LFS æ–¹æ¡ˆï¼Œç›®å‰ LFS åŠŸèƒ½å·²ç»è¢«å¤§å¤šæ•°å¹³å°æ”¯æŒï¼ŒGithub å°† LFS å­˜å‚¨åˆ° AWS ä¸Šï¼Œè€Œ Gitee/Gitlab/Gogs/Gitea å¤§å¤šä½¿ç”¨è‡ªå»ºçš„ LFS æœåŠ¡å™¨ï¼Œå­˜å‚¨åœ¨ç‰¹å®šæœåŠ¡å™¨ä¸Šã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªå­˜å‚¨åº“è‡ªèº«å°±å·²ç»éå¸¸å¤§äº†ï¼Œå¦‚ä½•å»è§£å†³ç”¨æˆ·çš„è®¿é—®éš¾é¢˜å‘¢ï¼Ÿæ¯”å¦‚ Windows æºç è¶…è¿‡ &lt;code>300GB&lt;/code>ï¼Œå¦‚æœç”¨æˆ·å…‹éš†å­˜å‚¨åº“ï¼ŒæŒ‰ç…§æ¯ç§’ 1MB/s çš„é€Ÿåº¦ï¼Œéœ€è¦ 85 å°æ—¶ï¼Œè¿™åœ¨ä»»ä½•ä»£ç æ‰˜ç®¡å¹³å°éƒ½æ˜¯ä¸å¤ªç°å®çš„ï¼Œå¥½åœ¨å¾®è½¯ 2017 å¹´å‘å¸ƒäº† GVFSï¼ˆç°åœ¨å« &lt;a href="https://github.com/microsoft/VFSForGit">VFSforGit&lt;/a>ï¼‰,åœ¨ä½¿ç”¨ VFSforGit è·å–è¿œç¨‹å­˜å‚¨åº“æ—¶ï¼Œå¯ä»¥åªè·å¾—ç›®å½•ç»“æ„ï¼Œå¹¶åœ¨æœ¬åœ°åˆ›å»ºå ä½æ–‡ä»¶ï¼Œä½†ç”¨æˆ·æ“ä½œè¿™äº›å ä½æ–‡ä»¶æ—¶ï¼ŒVFSforGit å®¢æˆ·ç«¯æ‰ä¼šå»è¯·æ±‚æœåŠ¡å™¨ä¸‹è½½å¯¹åº”çš„å¯¹è±¡ï¼Œè¿™å¤§å¤§æ”¹å–„äº†å·¨å‹å­˜å‚¨åº“çš„æ“ä½œä½“éªŒã€‚VFSforGit æœ¬åœ°æ¶‰åŠåˆ°çš„ä¸»è¦æŠ€æœ¯æ˜¯ &lt;a href="https://docs.microsoft.com/en-us/windows/win32/projfs/projected-file-system">ProjFS&lt;/a>ï¼Œåœ¨ Windows ä¸Šï¼ŒVFSforGit ä¼šåˆ›å»º &lt;code>IO_REPARSE_TAG_PROJFS&lt;/code> ç±»å‹çš„ ReparsePointï¼ˆNTFS é‡è§£æç‚¹ï¼‰ï¼Œè¯»å†™åˆ°è¿™äº›é‡è§£æç‚¹æ—¶ï¼ŒProjFS é©±åŠ¨ä¼šè½¬å‘åˆ° VFSForGit å®¢æˆ·ç«¯ä¸‹è½½ç›¸åº”çš„å¯¹è±¡ã€‚å¾®è½¯å¾ˆå¤šå¼€å‘è€…åœ¨ macOS ä¸Šå¼€å‘ï¼Œæ‰€ä»¥å®˜æ–¹å¢åŠ äº†å¯¹ macOS çš„æ”¯æŒï¼Œè€Œ &lt;a href="https://github.com/github/VFSForGit">Github çš„ VFSForGit fork&lt;/a> åˆ™å¢åŠ äº†å¯¹ Linux çš„æ”¯æŒï¼Œä¸è¿‡ç¦»å®ç”¨è¿˜æœ‰ä¸€äº›æ—¶æ—¥ï¼ŒGithub ProjFS å®ç°åº“æ˜¯ &lt;a href="https://github.com/github/libprojfs">libprojfs&lt;/a>ã€‚&lt;/p>
&lt;p>Git ä»£ç æ‰˜ç®¡å¹³å°æ”¯æŒ VFSforGit å®¢æˆ·ç«¯æ¯”è¾ƒå®¹æ˜“ï¼Œç›®å‰é™¤äº† Visual Studio Onlineï¼Œè¿˜æœ‰ BitBucket ä¹Ÿå¢åŠ äº†å¯¹ VFSforGit çš„æ”¯æŒã€‚æˆ‘æ›¾ç”¨ libgit2 å¼€å‘äº†ä¸€ä¸ª &lt;code>git-vfs-serve&lt;/code> å‘½ä»¤ï¼Œç”¨æˆ·è®¿é—® brzox æ—¶ï¼Œbrzox è¯·æ±‚ git-srvï¼Œgit-srv æ‰§è¡Œ git-vfs-serve ä¾¿å¯ä»¥æ”¯æŒ VFSforGit å®¢æˆ·ç«¯çš„è®¿é—®ï¼Œä¸è¿‡å¹¶æœªä¸Šçº¿ã€‚&lt;/p>
&lt;h3 id="å®‰å…¨æ€§å¢å¼º">å®‰å…¨æ€§å¢å¼º&lt;/h3>
&lt;p>Github æœ€è¿‘å®£å¸ƒäº†æ”¯æŒ WebAuthn: &lt;a href="https://github.blog/2019-08-21-github-supports-webauthn-for-security-keys/">GitHub supports Web Authentication (WebAuthn) for security keys&lt;/a>ï¼Œè¿™ç§æœºåˆ¶å¯ä»¥ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«ä»è€Œé¿å…è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œéšç€ä¿¡æ¯æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œä¸€æ–¹é¢ï¼Œå®‰å…¨æœºåˆ¶ä¸æ–­å®Œå–„ï¼Œå¦ä¸€æ–¹é¢ï¼Œç”¨æˆ·é¢ä¸´çš„é£é™©ä¹Ÿä¼šå¤šæ ·åŒ–ï¼Œå¤æ‚åŒ–ã€‚ä»£ç æ‰˜ç®¡å¹³å°ç®¡ç†äº†å¼€å‘è€…çš„æ ¸å¿ƒèµ„äº§ï¼Œå› æ­¤åœ¨å®‰å…¨ä¸Šç»ä¸èƒ½æ‰ä»¥è½»å¿ƒã€‚å½“ç„¶éœ€è¦åšçš„ä¸ä»…ä»…æ˜¯åŠæ—¶è·Ÿè¿›æ–°çš„å®‰å…¨æœºåˆ¶ï¼Œè¿˜éœ€è¦å¯¹æ•´ä¸ªç³»ç»ŸåŠæ—¶è¿›è¡Œå®‰å…¨å‡çº§ï¼Œæ·˜æ±°æ—§çš„åè®®ï¼ˆæ¯”å¦‚ SSL3/TLS1.1ï¼‰ï¼Œæ—§çš„åŠ å¯†ï¼Œå“ˆå¸Œç®—æ³•ï¼ˆDSAï¼ŒMD5/SHA1ï¼‰ï¼ŒåŠæ—¶é‡‡ç”¨æ–°çš„åè®®ï¼ˆTLS1.3ï¼‰,æ–°çš„åŠ å¯†ï¼Œå“ˆå¸Œç®—æ³•ï¼ˆED25519ï¼ŒSHA3ï¼‰ç­‰ç­‰ã€‚&lt;/p>
&lt;h2 id="æ–‡ä»¶æœåŠ¡">æ–‡ä»¶æœåŠ¡&lt;/h2>
&lt;!--é™„ä»¶ä¸‹è½½ï¼Œå‘å¸ƒæ–‡ä»¶ï¼ŒArchive ä¸‹è½½-->
&lt;p>ä¸€ä¸ªä¼˜ç§€çš„ Git ä»£ç æ‰˜ç®¡å¹³å°ï¼Œåº”è¯¥åœ¨è½¯ä»¶çš„å¼€å‘æ•´ä¸ªå‘¨æœŸéƒ½ç»™ç”¨æˆ·æä¾›å¸®åŠ©ï¼Œæ¯”å¦‚ä¸‹è½½æºç ï¼Œè½¯ä»¶å‘å¸ƒã€‚æºç ä¸‹è½½ä¸»è¦æŒ‡ Archive åŠŸèƒ½ï¼Œè½¯ä»¶çš„å‘å¸ƒåˆ™éœ€è¦å¹³å°æä¾› Release/é™„ä»¶ä¸‹è½½åŠŸèƒ½ã€‚&lt;/p>
&lt;h3 id="archive">Archive&lt;/h3>
&lt;p>æˆ‘ä»¬çŸ¥é“ git-archive å‘½ä»¤å¯ä»¥å°†å­˜å‚¨åº“ç‰¹å®šçš„ commit/branch æ‰“åŒ…æˆä¸€ä¸ª zip/tar æ–‡ä»¶ï¼Œè€Œåœ¨ Git Over SSHï¼ˆGit Over TCPï¼‰ å®ç°ä¸­ï¼Œåªè¦æˆ‘ä»¬å…è®¸ &lt;code>git-upload-archive&lt;/code> å‘½ä»¤åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå°±æ‰“åŒ…è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨åº“çš„ç‰¹å®šåˆ†æ”¯ã€‚ä½†ç”±äº git-upload-archive ä¸ git-upload-pack/git-receive-pack å­˜åœ¨ä¸€äº›ä¸åŒï¼Œæ˜¯çš„ HTTP åè®®æ— æ³•å®ç° archive åå•†ã€‚æä¾› archive ä¸‹è½½åˆ™éœ€è¦å¦è¾Ÿè¹Šå¾„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œ git-archive å°†å…¶è¾“å‡ºä½œä¸ºå“åº”ä½“çš„å†…å®¹è¿”å›ç»™ HTTP Client ä¾¿å¯å®ç° archive ä¸‹è½½åŠŸèƒ½ï¼Œç”±äº archive ä¸‹è½½å®é™…ä¸Šæ˜¯å°† git tree/blob éå†ç„¶åå†™å…¥åˆ°å½’æ¡£æ–‡ä»¶åå‹ç¼©ï¼ˆtar.gz/tar.bz2 &amp;hellip;ï¼‰æˆ–è€…æ˜¯å‹ç¼©åå†™å…¥æ–‡ä»¶ï¼ˆzipï¼‰ï¼ŒäºŒè€…éƒ½éå¸¸æ¶ˆè€— CPU èµ„æºï¼Œå› æ­¤æˆ‘ä»¬åœ¨å®ç° archive ä¸‹è½½åŠŸèƒ½çš„åŒæ—¶åº”è¯¥è®¾è®¡ archive çš„ç¼“å­˜åŠŸèƒ½ï¼ˆå½“ç„¶ç¼“å­˜åº”è¯¥æ”¯æŒè¿‡æœŸï¼‰ã€‚gitlab-workhorse å®ç°çš„ archive ä¸‹è½½åŠŸèƒ½ä¾¿æ˜¯å…ˆå°è¯•å‘½ä¸­ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™è°ƒç”¨ git å‘½ä»¤ç„¶åç”Ÿæˆå†™å…¥åˆ°ç¼“å­˜æ–‡ä»¶ã€‚Gitee æœ€è¿‘å®ç°çš„ blaze-archive ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„æœºåˆ¶ï¼Œä½† blaze-archive æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯è¢« git-srv è°ƒç”¨ï¼Œbrzox ä¸ git-srv é€šä¿¡ï¼Œbrzox å°† archive è¿”å›ç»™ HTTP Clientï¼Œè€Œç¼“å­˜çš„åˆ é™¤åˆ™æ˜¯ blaze è´Ÿè´£çš„ã€‚&lt;/p>
&lt;h3 id="é™„ä»¶release">é™„ä»¶ï¼ŒRelease&lt;/h3>
&lt;p>é™„ä»¶ï¼ŒRelease å¯ä»¥é€‰æ‹©äº‘æ–¹æ¡ˆï¼Œå¦‚æœè¦å°†é™„ä»¶å’Œ LFS ç»Ÿä¸€ç®¡ç†ï¼Œå®é™…ä¸Šå›½å†…çš„é˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ä¹‹ç±»çš„å¹¶ä¸åˆé€‚ï¼Œè¿™äº›å¹³å°å¯¹å¹¶ä¸æ”¯æŒç±»ä¼¼ AWS &lt;code>x-amz-content-sha256&lt;/code> è¿™æ ·çš„å¤´éƒ¨ï¼Œè€Œæ˜¯ &lt;code>Content-MD5&lt;/code> å› æ­¤è¿™äº›äº‘å¹³å°è¦æ”¯æŒ LFS åˆ™è¦èŠ±è´¹å¤šä¸€äº›åŠŸå¤«ã€‚é€‰æ‹©å›½å¤–çš„ AWS, Azure åˆ™éœ€è¦è€ƒè™‘ç»æµï¼Œç½‘ç»œç­‰é—®é¢˜ã€‚å½“ç„¶æ— è®ºå¦‚ä½•ä½¿ç”¨äº‘å¹³å°éƒ½éœ€è¦è€ƒè™‘ç»æµé—®é¢˜ã€‚&lt;/p>
&lt;p>å¹³å°è‡ªå»ºé™„ä»¶ï¼ŒRelease åŠŸèƒ½å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ FastDFS, ä½† FastFDS å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œå†å²æ¯”è¾ƒä¹…ï¼Œå­˜å‚¨æœºåˆ¶å®‰å…¨æœºåˆ¶ç°åœ¨æ¥è¯´éƒ½ä¸æ˜¯å¾ˆä¼˜ç§€ã€‚æœ‰ä¸ªæ›´å¥½çš„é€‰æ‹©æ˜¯ &lt;a href="https://github.com/minio/minio">Minio&lt;/a>, minio ä½¿ç”¨ Golang å¼€å‘ï¼Œæ”¯æŒ AWS APIã€‚è®¸å¯åè®®æ˜¯ &lt;code>Apache 2.0&lt;/code>ï¼Œå•†ç”¨æ²¡æœ‰é˜»ç¢ï¼Œå› æ­¤æ˜¯ç”¨æ¥æ­å»ºé™„ä»¶ï¼ŒRelease ä»¥åŠ LFS å­˜å‚¨æœåŠ¡å™¨çš„ä¸äºŒé€‰æ‹©ã€‚&lt;/p>
&lt;h2 id="git-çš„æœªæ¥">Git çš„æœªæ¥&lt;/h2>
&lt;p>Git è™½ç„¶æ˜¯å½“å‰æœ€å—æ¬¢è¿çš„ä»£ç æ‰˜ç®¡ç³»ç»Ÿï¼Œä½† Git ä¹Ÿé¢ä¸´äº†ä¸€äº›éš¾é¢˜ï¼Œä¸€ç±»æ˜¯å¦‚ä½•æ”¯æŒå¤§æ–‡ä»¶å¤§å­˜å‚¨åº“ï¼Œè¿™äº›é—®é¢˜æœ‰ Git LFS, VFSforGit è¿™æ ·çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæœ‰å¾®è½¯ï¼ŒGoogle å¼€å‘è€…å‚ä¸çš„å®˜æ–¹ &lt;a href="https://git-scm.com/docs/partial-clone/en">Partial Clone&lt;/a>ï¼Œéƒ¨åˆ†å…‹éš†éœ€è¦ Wire åè®®æ”¯æŒï¼Œç¦»å¯ç”¨è¿˜ä¸ºæ—¶å°šæ—©ã€‚&lt;/p>
&lt;p>2017å¹´2æœˆï¼ŒGoogle å¼€å‘è€…å®£å¸ƒæ”»ç ´ SHA1ï¼Œè¿™æ›¾ç»ç»™ä¸€äº› git ç”¨æˆ·å¸¦æ¥äº†æ‹…å¿§ï¼Œå› ä¸º git ä½¿ç”¨ SHA1 è®¡ç®—å¯¹è±¡ IDï¼Œä½† git ä½¿ç”¨çš„å®é™…ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ SHA1ï¼Œå°†å¯¹è±¡ç±»å‹å¯¹è±¡é•¿åº¦ä»¥åŠå¯¹è±¡å†…å®¹åˆå¹¶åœ¨ä¸€èµ·è®¡ç®— SHA1ï¼Œç”±äºæœ‰é•¿åº¦æ ¡éªŒï¼Œè¿™ä½¿å¾— SHA1 çš„å†²çªå¯èƒ½è¢«é™ä½äº†ï¼Œä½†æ— è®ºå¦‚ä½•ï¼ŒSHA1 ä¹Ÿä¸å†æ˜¯å®‰å…¨çš„ï¼ŒGit åœ¨æºç ä¸­å¢åŠ äº† &lt;a href="https://github.com/cr-marcstevens/sha1collisiondetection">sha1collisiondetection&lt;/a> æ¥é¿å… SHA1 å†²çªï¼Œå¹¶ä¸”å¢åŠ äº†è®¡åˆ’è¿ç§»åˆ° SHA-256ï¼Œå¹¶ä¸”å°†ä¸€äº›æ¶‰åŠåˆ° Hash çš„ä»£ç ä»å•ä¸€çš„ SHA1 è½¬å˜æˆ &lt;code>object_id&lt;/code>ã€‚ å…³äº Hash è½¬æ¢ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡æ¡£ &lt;a href="https://github.com/git/git/blob/master/Documentation/technical/hash-function-transition.txt">Git hash function transition&lt;/a>ã€‚&lt;/p>
&lt;p>Git ä» SHA1 è¿ç§»åˆ° SHA-256 å›°éš¾é‡é‡ï¼Œä»&lt;a href="https://github.com/git/git/commit/752414ae4310cd304f5e31649aaab2dcf307057c">é¦–æ¬¡å¢åŠ æ–‡æ¡£&lt;/a>è·ä»Šå·²ç»æœ‰ä¸¤å¹´æ—¶é—´ï¼Œè€Œ SHA-256 çš„å®ç°è¿˜ä¸è§å…¨è²Œã€‚ä¸ Hash è¿ç§»ç›¸æ¯”ï¼Œå‹ç¼©ç®—æ³•çš„æ¼”è¿›ä¸é‡è¦æ›´éš¾å®æ–½ï¼Œæ—¶è‡³ä»Šæ—¥ï¼Œzlib å‹ç¼©å·²ç»ä¸å†ä¼˜ç§€ï¼Œä½† Git å¯èƒ½è¿˜è¦è´Ÿé‡å‰è¡Œã€‚&lt;/p>
&lt;h2 id="é“è·¯æ¼«æ¼«">é“è·¯æ¼«æ¼«&lt;/h2>
&lt;p>è½¯ä»¶å¼€å‘ä¸€ç›´æ˜¯ä¸€ä¸ªé£é€Ÿå˜åŒ–çš„é¢†åŸŸï¼Œè€Œä»£ç æ‰˜ç®¡ä¹Ÿè¦ä¸æ–­é¢ä¸´æ–°çš„æŒ‘æˆ˜ï¼Œé“è·¯æ¼«æ¼«ï¼Œå¾è¾ˆä¸ä¼‘ã€‚&lt;/p>
&lt;h2 id="æ›´æ–°">æ›´æ–°&lt;/h2>
&lt;ol>
&lt;li>2020-03-17 ç”±äº src-d å·²ç»ç ´äº§ï¼Œç›®å‰ go-git å·²ç» Hard fork åˆ° [https://github.com/go-git/go-git]&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2019/2019-10-01-explore-some-issues-with-git-host/ - Copyright (c) 2009-2024 J23</description></item><item><title>åœ¨ Windows ä¸­å®ç° sudo</title><link>https://forcemz.net/posts/2019/2019-08-07-implement-sudo-in-windows/</link><pubDate>Wed, 07 Aug 2019 12:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-08-07-implement-sudo-in-windows/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-08-07-implement-sudo-in-windows/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>&lt;em>è¿™ç¯‡æ–‡ç« çš„æƒ³æ³•æ¥æºäºæˆ‘åœ¨ &lt;a href="https://github.com/microsoft/terminal/issues/146">Windows Terminal Issue#146&lt;/a> çš„&lt;a href="https://github.com/microsoft/terminal/issues/146#issuecomment-515812461">è¯„è®º&lt;/a>ã€‚&lt;/em>&lt;/p>
&lt;p>&lt;a href="https://linux.die.net/man/8/sudo">sudo&lt;/a> ä»¥å¦ä¸€ä¸ªç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸æ˜¯ &lt;code>root&lt;/code>ã€‚å½“æ™®é€šç”¨æˆ·éœ€è¦ä»¥å…¶ä»–æƒé™æ‰§è¡ŒæŸé¡¹å·¥ä½œæ—¶ï¼Œé€šå¸¸éœ€è¦è·å¾—æŒ‡å®šç”¨æˆ·çš„æƒé™ï¼Œä»¥ç›®æ ‡æƒé™ &lt;code>root&lt;/code> ä¸ºä¾‹ï¼Œæˆ‘ä»¬æœŸæœ›ä»¥ root æƒé™è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>su&lt;/code> ç™»å½•åˆ° &lt;code>root&lt;/code> ç”¨æˆ·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ç›´åˆ°é€€å‡º &lt;code>root&lt;/code>ã€‚éƒ½ä½¿ç”¨çš„æ˜¯ &lt;code>root&lt;/code> æƒé™ï¼Œè¿™å®é™…ä¸Šå¹¶ä¸æ˜¯å®‰å…¨çš„ï¼Œå¤„äºé«˜çº§åˆ«æƒé™çš„æ—¶é—´åº”å½“å°½é‡çš„çŸ­ã€‚è€Œä½¿ç”¨ &lt;code>sudo&lt;/code> è·å¾— root æƒé™è¦å®‰å…¨çš„å¤šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç‰¹å®šçš„å‘½ä»¤æ‰ä¼šè·å¾— root æƒé™ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç”¨æˆ·å’Œ shell. è¯åˆè¯´å›æ¥ï¼Œsudo æ˜¯å¦‚ä½•è·å¾— root æƒé™çš„ï¼Ÿåœ¨ Windows ä¸­çš„ sudo åˆæ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œå¦‚ä½•åœ¨ Windows ä¸­å®ç°ç±»ä¼¼çš„ sudo.&lt;/p>
&lt;h2 id="linux-çš„-sudo-å†…å¹•">Linux çš„ sudo å†…å¹•&lt;/h2>
&lt;p>Linux çš„æƒé™æœºåˆ¶å¤§è‡´æ¦‚æ‹¬ä¸º &lt;code>UGO&lt;/code> å’Œ &lt;code>RWX&lt;/code>ï¼Œæ–‡ä»¶æƒé™ä¸º &lt;code>R&lt;/code> è¯»æƒé™ï¼Œ&lt;code>W&lt;/code> å†™æƒé™ï¼Œ&lt;code>X&lt;/code> å¯æ‰§è¡Œæƒé™ã€‚åŸºäº UGO æ¨¡å‹è®¾ç½®ã€‚&lt;code>U&lt;/code> ä»£è¡¨ç”¨æˆ·ï¼Œ &lt;code>G&lt;/code> ä»£è¡¨ç»„ï¼Œ&lt;code>O&lt;/code> ä»£è¡¨å…¶ä»–ç”¨æˆ·ã€‚&lt;/p>
&lt;p>äº†è§£ Linux sudo çš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£æ–‡ä»¶çš„å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>stat&lt;/code> å‘½ä»¤æˆ–è€… &lt;code>stat&lt;/code> ç³»ç»Ÿè°ƒç”¨æŸ¥çœ‹æ–‡ä»¶çš„å±æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ &lt;a href="https://github.com/bminor/musl/blob/master/arch/x86_64/bits/stat.h">musl: arch/x86_64/bits/stat.h&lt;/a> ä¸ºå‚è€ƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#ifndef S_IRUSR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_ISUID 04000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_ISGID 02000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_ISVTX 01000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IRUSR 0400
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IWUSR 0200
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IXUSR 0100
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IRWXU 0700
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IRGRP 0040
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IWGRP 0020
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IXGRP 0010
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IRWXG 0070
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IROTH 0004
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IWOTH 0002
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IXOTH 0001
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define S_IRWXO 0007
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">stat&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">dev_t&lt;/span> &lt;span style="color:#58a1dd">st_dev&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">ino_t&lt;/span> &lt;span style="color:#58a1dd">st_ino&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nlink_t&lt;/span> &lt;span style="color:#58a1dd">st_nlink&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">mode_t&lt;/span> &lt;span style="color:#58a1dd">st_mode&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">uid_t&lt;/span> &lt;span style="color:#58a1dd">st_uid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">gid_t&lt;/span> &lt;span style="color:#58a1dd">st_gid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">__pad0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">dev_t&lt;/span> &lt;span style="color:#58a1dd">st_rdev&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">off_t&lt;/span> &lt;span style="color:#58a1dd">st_size&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">blksize_t&lt;/span> &lt;span style="color:#58a1dd">st_blksize&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">blkcnt_t&lt;/span> &lt;span style="color:#58a1dd">st_blocks&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">timespec&lt;/span> &lt;span style="color:#58a1dd">st_atim&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">timespec&lt;/span> &lt;span style="color:#58a1dd">st_mtim&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">struct&lt;/span> &lt;span style="color:#58a1dd">timespec&lt;/span> &lt;span style="color:#58a1dd">st_ctim&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">long&lt;/span> &lt;span style="color:#58a1dd">__unused&lt;/span>[&lt;span style="color:#a6be9d">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä½¿ç”¨ &lt;code>stat&lt;/code> å‘½ä»¤æŸ¥çœ‹ &lt;code>/usr/bin/sudo&lt;/code> å‘½ä»¤å±æ€§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span> File: /usr/bin/sudo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Size: 149080 Blocks: 296 IO Block: 4096 regular file
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device: 2h/2d Inode: 3659174697569688 Links: 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access: (4755/-rwsr-xr-x) Uid: ( 0/ root) Gid: ( 0/ root)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access: 2018-05-12 07:38:43.000000000 +0800
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Modify: 2018-01-18 08:08:16.000000000 +0800
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Change: 2018-05-12 07:49:34.051952000 +0800
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Birth: -
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/62181312-84b53080-b385-11e9-822d-89833ef8ac3a.png" alt="">&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° sudo å‘½ä»¤çš„ç¨‹åºæ–‡ä»¶ï¼Œæ‰€æœ‰è€… ID å’Œ ç»„ ID éƒ½æ˜¯ &lt;strong>0&lt;/strong>ï¼Œå³ &lt;code>root&lt;/code>ï¼Œä¸æ™®é€šæ–‡ä»¶ä¸åŒä¹‹å¤„ &lt;code>sudo&lt;/code> è®¾ç½®äº† &lt;code>S_ISUID&lt;/code> æˆ‘ä»¬æŸ¥çœ‹ GNU &lt;a href="https://www.gnu.org/software/libc/manual/html_node/Permission-Bits.html">14.9.5 The Mode Bits for Access Permission&lt;/a> ä»¥åŠ &lt;a href="https://www.gnu.org/software/libc/manual/html_node/How-Change-Persona.html#How-Change-Persona">30.4 How an Application Can Change Persona&lt;/a> å…¶ä¸­æœ‰ä¸€æ®µ&lt;/p>
&lt;blockquote>
&lt;p>If a process has a file ID (user or group), then it can at any time change its effective ID to its real ID and back to its file ID. Programs use this feature to relinquish their special privileges except when they actually need them. This makes it less likely that they can be tricked into doing something inappropriate with their privileges.&lt;/p>
&lt;/blockquote>
&lt;p>sudo å‘½ä»¤å¯åŠ¨åå¯ä»¥è¿è¡Œ &lt;code>setuid(0)&lt;/code> å°†è‡ªèº«æƒé™è®¾ç½®ä¸º &lt;code>root&lt;/code> ç„¶åéªŒè¯ç”¨æˆ·å‡­æ®ï¼Œæœ‰æ•ˆæ—¶åˆ™å¯ä»¥ä»¥ root ç”¨æˆ·æƒé™è¿è¡Œç›¸åº”çš„å‘½ä»¤ã€‚åœ¨ Linux/POSIX ç³»ç»Ÿä¸­ï¼Œè™½ç„¶ &lt;code>sudo&lt;/code> çš„åŸç†å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯å®ç°ä¸€ä¸ª sudo ç¨‹åºï¼Œå¤„ç†å¥½ä¸åŒç”¨æˆ·çš„ç¯å¢ƒå˜é‡ï¼Œæƒé™çš„æœ‰æ•ˆæœŸï¼Œè¿™äº›éƒ½éœ€è¦ä¸€äº›ä»£ç å®ç°ï¼Œç´¢æ€§æœ‰å¼€æºçš„ &lt;code>sudo&lt;/code> å¯ä¾›äººä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="åœ¨-windows-å®ç°-sudo">åœ¨ Windows å®ç° Sudo&lt;/h2>
&lt;p>ç†è§£ Windows æƒé™æœºåˆ¶éœ€è¦äº†è§£ &lt;a href="https://en.wikipedia.org/wiki/Access-control_list">ACL&lt;/a> ä»¥åŠ &lt;a href="https://en.wikipedia.org/wiki/User_Account_Control">User Account Control (UAC)&lt;/a>ã€‚åœ¨ Windows ç³»ç»Ÿä¸Šå¹¶ä¸å­˜åœ¨åŸç”Ÿçš„ sudo å‘½ä»¤ï¼Œæ ‡å‡†ç”¨æˆ·çš„ææƒåœ¨å¼€å¯ UAC æ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸ªææƒå¯¹è¯æ¡†å’Œå®‰å…¨æ¡Œé¢ï¼Œé‚£ä¹ˆåœ¨ Windows ä¸­ï¼Œä»æ ‡å‡†ç”¨æˆ·åˆ°ç‰¹æƒç”¨æˆ· (Administrator) å†…éƒ¨æ˜¯æ€æ ·çš„å®ç°å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªä¸éœ€è¦ UI äº¤äº’çš„ &lt;code>Windows sudo&lt;/code> åˆåº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>Windows å±äºå¤šç”¨æˆ·æ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œçš„æƒé™è®¨è®ºå¹¶æœªè®²è¿°æ¥å®¾è´¦æˆ·ï¼Œä»…é™äºæ ‡å‡†è´¦æˆ·ï¼Œå³åŒæ—¶å±äº User å’Œ Administrators ç»„ä¸”å¼€å¯äº† UAC æç¤ºçš„è´¦æˆ·ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="uac-ææƒä¸-sudo-å®ç°æ¢è®¨">UAC ææƒä¸ sudo å®ç°æ¢è®¨&lt;/h3>
&lt;p>åœ¨ &lt;a href="https://forcemz.net/windows/2018/12/01/PrivexecNew/">ã€ŠPrivexec æ‚è°ˆã€‹&lt;/a> ä¸€æ–‡ä¸­ï¼Œå°±è®²è¿‡ UAC ææƒï¼Œè¿™é‡Œå†é‡å¤ä¸€éã€‚&lt;/p>
&lt;p>åœ¨ Windows ä¸­ï¼Œå¦‚æœè¦å®ç° &lt;code>UAC&lt;/code> ææƒï¼Œéœ€è¦è°ƒç”¨ &lt;code>ShellExecute&lt;/code> ä»¥ &lt;code>runas&lt;/code> çš„å‚æ•°å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚æˆ–è€…è®¾ç½®å¼•ç”¨ç¨‹åºæ¸…å•ï¼ˆæ­¤ç±»ç”± shell æ‰“å¼€æ—¶ä¼šææƒï¼Œä¹Ÿæ˜¯ ShellExecute ä¸€ç±»ï¼‰ï¼Œæ¸…å•ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;trustInfo&lt;/span> &lt;span style="color:#58a1dd">xmlns=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;urn:schemas-microsoft-com:asm.v2&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;security&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;requestedPrivileges&lt;/span> &lt;span style="color:#58a1dd">xmlns=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;urn:schemas-microsoft-com:asm.v3&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;requestedExecutionLevel&lt;/span> &lt;span style="color:#58a1dd">level=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;requireAdministrator&amp;#39;&lt;/span> &lt;span style="color:#58a1dd">uiAccess=&lt;/span>&lt;span style="color:#a6be9d">&amp;#39;false&amp;#39;&lt;/span> &lt;span style="color:#58a1dd">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/requestedPrivileges&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/security&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;lt;/trustInfo&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ &lt;code>Windows 10&lt;/code> ä¸ºä¾‹ï¼Œ&lt;code>ShellExecute&lt;/code> ææƒæœ€ç»ˆç”± &lt;code>AicLaunchAdminProcess&lt;/code> å‡½æ•°å®ç°ï¼Œæ­¤å‡½æ•°ç›®å‰å®ç°åœ¨ &lt;code>Windows.Storage.dll&lt;/code> ä¸­ï¼ŒUAC ææƒéœ€è¦ä¸ &lt;code>Appinfo&lt;/code> æœåŠ¡é€šä¿¡ï¼Œ&lt;code>Appinfo&lt;/code> éªŒè¯ææƒè¡Œä¸ºåä½¿ç”¨ &lt;code>CreateProcessAsUserW&lt;/code> å¯åŠ¨è¿›ç¨‹ï¼Œå¹¶å°†å…¶çˆ¶è¿›ç¨‹è®¾ç½®ä¸º &lt;code>ShellExecute&lt;/code> è°ƒç”¨è€…ã€‚è°ƒç”¨ç»†èŠ‚(Windows Vista)&lt;sup>1&lt;/sup>å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>AppInfo goes and talks to the Local Security Authority to get the elevated token of the logged in user of Session 1.&lt;/li>
&lt;li>AppInfo loads up a STARTUPINFOEX structure (new to Vista), and calls the brand new Vista API InitializeProcThreadAttributeList() with room for one attribute.&lt;/li>
&lt;li>OpenProcess() is called to get a handle to the process that initiated the RPC call.&lt;/li>
&lt;li>UpdateProcThreadAttribute() is called with &lt;code>PROC_THREAD_ATTRIBUTE_PARENT_PROCESS&lt;/code>, and uses the handle retrieved in step 3.&lt;/li>
&lt;li>CreateProcessAsUser() is called with &lt;code>EXTENDED_STARTUPINFO_PRESENT&lt;/code> and the results of steps 1 and 4.&lt;/li>
&lt;li>DeleteProcThreadAttributeList() is called.&lt;/li>
&lt;li>Results are gathered, and handles are cleaned up.&lt;/li>
&lt;/ol>
&lt;p>Appinfo æœåŠ¡æè¿°ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨è¾…åŠ©ç®¡ç†æƒé™ä¾¿äºäº¤äº’å¼åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚å¦‚æœåœæ­¢æ­¤æœåŠ¡ï¼Œç”¨æˆ·å°†æ— æ³•ä½¿ç”¨è¾…åŠ©ç®¡ç†æƒé™å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè€Œæ‰§è¡Œæ‰€éœ€ç”¨æˆ·ä»»åŠ¡å¯èƒ½éœ€è¦è¿™äº›æƒé™ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å¦‚æœåœ¨æ ‡å‡†ç”¨æˆ·ä¸­ä½¿ç”¨ &lt;code>CreateProcessW&lt;/code> å¯åŠ¨éœ€è¦æå‡çš„è¿›ç¨‹ï¼Œä¼šè¿”å› &lt;code>elevation required&lt;/code>ï¼ˆGetLastError 740ï¼‰é”™è¯¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Windows ä¸­ï¼Œææƒæœ¬è´¨ä¸Šæ˜¯é€šè¿‡å»ç‰¹æƒæœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œæ ¡éªŒåï¼Œç”±ç‰¹æƒç”¨æˆ·åˆ›å»ºè¿›ç¨‹ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ &lt;code>S_ISUID&lt;/code> è¿™æ ·çš„æœºåˆ¶ï¼Œå½“ç„¶ UAC ç™½åå•çš„è‡ªåŠ¨æå‡å’Œ &lt;code>setuid&lt;/code> ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…æ˜¯ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹ä¾¿æ˜¯åˆ›å»ºäº†ç®¡ç†å‘˜æƒé™ï¼Œåè€…æ˜¯ fork-exec åï¼Œé€šè¿‡ &lt;code>setuid&lt;/code> åˆ‡æ¢åˆ° &lt;code>root&lt;/code>ï¼ˆLinux/Apple sudo å‡æ˜¯å¦‚æ­¤ï¼‰ã€‚&lt;/p>
&lt;p>sudo æ˜¯ CUI ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ç±»ä¼¼ sudo è¿™æ ·çš„ç¨‹åºï¼Œåƒæ ‡å‡†è¾“å…¥è¾“å‡ºçš„ç»§æ‰¿ï¼Œå·¥ä½œç›®å½•çš„è®¾ç½®éƒ½å¿…ä¸å¯å°‘ï¼Œé—æ†¾çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ ShellExecuteEx å¯åŠ¨ç®¡ç†å‘˜è¿›ç¨‹æ—¶ï¼Œæ— æ³•è®¾ç½®å­è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œä¹Ÿæ— æ³•è®©å­è¿›ç¨‹ç»§æ‰¿å½“å‰çš„æ§åˆ¶å°ï¼Œç»ˆç«¯ï¼Œå› æ­¤ææƒåï¼Œå¦‚æœå­è¿›ç¨‹å­ç³»ç»Ÿæ˜¯ &lt;code>Windows CUI&lt;/code> æ—¶ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªæ–°çš„æ§åˆ¶å°çª—å£ã€‚&lt;/p>
&lt;p>åœ¨ UAC ææƒçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“åˆ›å»ºè¿›ç¨‹å®é™…ä¸Šæ˜¯ç”± Appinfo æœåŠ¡åˆ›å»ºçš„ï¼Œå› æ­¤ï¼Œå¦‚æœåœ¨ &lt;code>CreateProcessAsUserW&lt;/code> ä¹‹é™…ç›´æ¥ &lt;code>lpCurrentDirectory&lt;/code> å³å¯è®¾ç½®å­è¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚&lt;/p>
&lt;p>sudo ä¸éœ€è¦ UI äº¤äº’éªŒè¯ç”¨æˆ·çš„æƒé™ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥åœ¨ç»ˆç«¯æˆ–è€…æ§åˆ¶å°æç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œåœ¨ Appinfo ä¸­è°ƒç”¨ &lt;a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-logonuserw">&lt;code>LogonUserW&lt;/code>&lt;/a> éªŒè¯ç”¨æˆ·å‡­æ®çš„åˆæ³•æ€§ã€‚å½“ç„¶ï¼Œå¯†ç åœ¨è·¨è¿›ç¨‹ä¼ è¾“çš„è¿‡ç¨‹ä¸­è¦ä¿è¯å®‰å…¨ã€‚&lt;/p>
&lt;p>å”¯ä¸€å€¼å¾—å•†æ¦·çš„æ˜¯ï¼ŒAppInfo æœåŠ¡å¦‚ä½•è·å¾—è°ƒç”¨è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæ ‡å‡†é”™è¯¯ï¼Œå°†æ§åˆ¶å°æˆ–è€…ç®¡é“ç»™å­è¿›ç¨‹ç»§æ‰¿ã€‚Windows æ‹¥æœ‰æ§åˆ¶å° API &lt;a href="https://docs.microsoft.com/en-us/windows/console/attachconsole">&lt;code>AttachConsole&lt;/code>&lt;/a>ï¼Œå¯ä»¥è®©è¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„æ§åˆ¶å°ï¼Œè¿™åœ¨åé¢æœ‰ä»‹ç»ï¼Œä½†æ˜¯å¦å¯ä»¥ä¸éœ€è¦ &lt;code>AttachConsole&lt;/code> ç›´æ¥è·å–ç‰¹å®šè¿›ç¨‹çš„æ§åˆ¶å°å¥æŸ„ï¼Œå¹¶å°†å­è¿›ç¨‹çš„ &lt;code>STARTUPINFOW&lt;/code> çš„ &lt;code>hStdInput&lt;/code>,&lt;code>hStdOutput&lt;/code> ä»¥åŠ &lt;code>hStdError&lt;/code> è®¾ç½®åˆ°æ§åˆ¶å°ã€‚å¦‚æœè°ƒç”¨è¿›ç¨‹çš„ç»ˆç«¯æ˜¯ cygwinï¼Œmsys2 è¿™æ ·çš„ä»¥ç®¡é“æ¨¡æ‹Ÿçš„ï¼Œåˆ™éœ€è¦è·å¾—è¿™äº›ç®¡é“çš„åç§°ï¼Œç„¶åä½¿ç”¨ &lt;code>CreateFileA&lt;/code> åˆ›å»ºå¥æŸ„ï¼Œç»‘å®šåˆ°å­è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºé”™è¯¯ã€‚è¦å¤„ç†ä¸åŒçš„æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ã€‚&lt;/p>
&lt;p>åœ¨ Appinfo æœåŠ¡ä¸­å®ç° sudo çš„é€»è¾‘çš„å›°éš¾åœ¨äº Windows å›¢é˜Ÿéœ€è¦è°¨æ…å¤„ç†å„ç§æƒ…å†µï¼Œé¿å…å®‰å…¨é—®é¢˜å¼•å…¥ Windowsã€‚å¹¶ä¸”ï¼Œå®ç° sudo é€»è¾‘åˆ°ä¸Šçº¿å¯èƒ½éœ€è¦å‡ ä¸ª Windows å‘è¡Œç‰ˆã€‚&lt;/p>
&lt;h3 id="sudo-bridge-è®¾æƒ³">sudo bridge è®¾æƒ³&lt;/h3>
&lt;p>åœ¨ WSL å‘å¸ƒä¹‹åï¼Œ&lt;a href="https://github.com/rprichard/winpty">winpty&lt;/a> Ryan Prichard å¼€æºäº† &lt;a href="https://github.com/rprichard/wslbridge">wslbridge&lt;/a> é¡¹ç›®ï¼Œwslbridge åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œå‰ç«¯æ˜¯ä¸€ä¸ªåŸºäº cygwin çš„ Windows ç¨‹åºï¼Œåç«¯æ˜¯ä¸€ä¸ª Linux ç¨‹åºï¼Œå½“ä½¿ç”¨ PTY æ¨¡å¼æ—¶ wslbridge-backend ä¼šä½¿ç”¨ &lt;code>forkpty&lt;/code> åˆ›å»ºä¸€ä¸ª &lt;code>pseudoterminal&lt;/code> ç„¶åå°†ç»ˆç«¯çš„æ•°æ®é€šè¿‡ socket å‘é€åˆ° wslbridge-frontend ï¼ˆé€šå¸¸ä¼šè¢« mintty conemu è¿™æ ·çš„ç»ˆç«¯è¯»å–å‘ˆç°ç»™ç”¨æˆ·ï¼‰. wslbridge-frontend æ¥å—åˆ°ç”¨æˆ·è¾“å…¥çš„æ•°æ®å‘é€åˆ° wslbridge-backend. å¦‚æœä¸ä½¿ç”¨ &lt;code>PTY&lt;/code> æ¨¡å¼ï¼Œwslbridge è¿˜å¯ä»¥ä½¿ç”¨ Pipe å»æ¨¡æ‹Ÿç»ˆç«¯è¡Œä¸ºï¼Œè¿™å’Œ Cygwin/MSYS åœ¨ Windows çš„æœºåˆ¶æ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>Windows Terminal é¡¹ç›®å®é™…ä¸ŠåŒ…æ‹¬äº† Windows conhost çš„æºç ï¼ŒåŸºæœ¬ä¸Š OpenConsole ä¸ç›®å‰ Windows 10 conhost.exe çš„ä»£ç ç»å¤§å¤šæ•°æ˜¯ç›¸åŒçš„ã€‚è¦äº†è§£æ§åˆ¶å°çš„ä¸€äº›æºç å¯ä»¥å¥½å¥½çš„çœ‹çœ‹ä»£ç ã€‚&lt;/p>
&lt;p>WindowsTerminal.exe æ˜¯ä¸€ä¸ª UWP ç¨‹åºï¼Œåœ¨å¯åŠ¨ç»ˆç«¯æ—¶ï¼Œé€šè¿‡ conhost.exe(OpenConsole) åˆ›å»ºä¸€ä¸ª PTY æ¨¡å¼çš„ç»ˆç«¯: &lt;a href="https://github.com/microsoft/terminal/blob/8fa42e09dfc6cd57d29e517a002d8c7a99e2aebd/src/cascadia/TerminalConnection/ConhostConnection.cpp#L94">CreateConPty&lt;/a>ã€‚åˆ›å»ºç»ˆç«¯çš„ &lt;code>CreateConPty&lt;/code> ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Function Description:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - Creates a headless conhost in &amp;#34;pty mode&amp;#34; and launches the given commandline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// attached to the conhost. Gives back handles to three different pipes:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// * hInput: The caller can write input to the conhost, encoded in utf-8, on
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// this pipe. For keys that don&amp;#39;t have character representations, the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// caller should use the `TERM=xterm` VT sequences for encoding the input.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// * hOutput: The caller should read from this pipe. The headless conhost will
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// &amp;#34;render&amp;#34; it&amp;#39;s state to a stream of utf-8 encoded text with VT sequences.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// * hSignal: The caller can use this to resize the size of the underlying PTY
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// using the SignalResizeWindow function.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Arguments:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - cmdline: The commandline to launch as a console process attached to the pty
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// that&amp;#39;s created.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - startingDirectory: The directory to start the process in
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - w: The initial width of the pty, in characters
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - h: The initial height of the pty, in characters
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - hInput: A handle to the pipe for writing input to the pty.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - hOutput: A handle to the pipe for reading the output of the pty.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - hSignal: A handle to the pipe for writing signal messages to the pty.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - piPty: The PROCESS_INFORMATION of the pty process. NOTE: This is *not* the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// PROCESS_INFORMATION of the process that&amp;#39;s created as a result the cmdline.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - extraEnvVars : A map of pairs of (Name, Value) representing additional
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// environment variable strings and values to be set in the client process
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// environment. May override any already present in parent process.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Return Value:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// - S_OK if we succeeded, or an appropriate HRESULT for failing format the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// commandline or failing to launch the conhost
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span> &lt;span style="color:#ff636f">__declspec&lt;/span>(&lt;span style="color:#58a1dd">noinline&lt;/span>) &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">CreateConPty&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">cmdline&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">optional&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">startingDirectory&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">w&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">h&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hInput&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hOutput&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hSignal&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PROCESS_INFORMATION&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">piPty&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">DWORD&lt;/span> &lt;span style="color:#58a1dd">dwCreationFlags&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">EnvironmentVariableMapW&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">extraEnvVars&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> {}) &lt;span style="color:#ff636f">noexcept&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Create some anon pipes so we can pass handles down and into the console.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// IMPORTANT NOTE:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// We&amp;#39;re creating the pipe here with un-inheritable handles, then marking
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the conhost sides of the pipes as inheritable. We do this because if
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the entire pipe is marked as inheritable, when we pass the handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// to CreateProcess, at some point the entire pipe object is copied to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the conhost process, which includes the terminal side of the pipes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// (_inPipe and _outPipe). This means that if we die, there&amp;#39;s still
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// outstanding handles to our side of the pipes, and those handles are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// in conhost, despite conhost being unable to reference those handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// and close them.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// CRITICAL: Close our side of the handles. Otherwise you&amp;#39;ll get the same
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// problem if you close conhost, but not us (the terminal).
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SECURITY_ATTRIBUTES&lt;/span> &lt;span style="color:#58a1dd">sa&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> { &lt;span style="color:#a6be9d">0&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">nLength&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">sa&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">bInheritHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">FALSE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">lpSecurityDescriptor&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">hInput&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#58a1dd">hOutput&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">hSignal&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetHandleInformation&lt;/span>(&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">HANDLE_FLAG_INHERIT&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetHandleInformation&lt;/span>(&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">HANDLE_FLAG_INHERIT&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetHandleInformation&lt;/span>(&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">HANDLE_FLAG_INHERIT&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;conhost.exe&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --headless&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstringstream&lt;/span> &lt;span style="color:#58a1dd">ss&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">w&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">h&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --width &amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>)&lt;span style="color:#58a1dd">w&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --height &amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>)&lt;span style="color:#58a1dd">h&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --signal 0x&amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">hex&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">HandleToUlong&lt;/span>(&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">ss&lt;/span>.&lt;span style="color:#58a1dd">str&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; -- &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">cmdline&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">STARTUPINFO&lt;/span> &lt;span style="color:#58a1dd">si&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> { &lt;span style="color:#a6be9d">0&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">cb&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">STARTUPINFOW&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdInput&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdOutput&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdError&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">dwFlags&lt;/span> &lt;span style="color:#ff636f">|=&lt;/span> &lt;span style="color:#58a1dd">STARTF_USESTDHANDLES&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">unique_ptr&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">wchar_t&lt;/span>[]&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">mutableCommandline&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_unique&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">wchar_t&lt;/span>[]&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">length&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">mutableCommandline&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">E_OUTOFMEMORY&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">StringCchCopy&lt;/span>(&lt;span style="color:#58a1dd">mutableCommandline&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>(), &lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">length&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">c_str&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">SUCCEEDED&lt;/span>(&lt;span style="color:#58a1dd">hr&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">LPCWSTR&lt;/span> &lt;span style="color:#58a1dd">lpCurrentDirectory&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">startingDirectory&lt;/span>.&lt;span style="color:#58a1dd">has_value&lt;/span>() &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#58a1dd">startingDirectory&lt;/span>.&lt;span style="color:#58a1dd">value&lt;/span>().&lt;span style="color:#58a1dd">c_str&lt;/span>() &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">wchar_t&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">newEnvVars&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">zeroNewEnv&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">wil&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">scope_exit&lt;/span>([&lt;span style="color:#ff636f">&amp;amp;&lt;/span>] {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SecureZeroMemory&lt;/span>(&lt;span style="color:#58a1dd">newEnvVars&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">newEnvVars&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">decltype&lt;/span>(&lt;span style="color:#58a1dd">newEnvVars&lt;/span>.&lt;span style="color:#58a1dd">begin&lt;/span>())&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">value_type&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">extraEnvVars&lt;/span>.&lt;span style="color:#58a1dd">empty&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">EnvironmentVariableMapW&lt;/span> &lt;span style="color:#58a1dd">tempEnvMap&lt;/span>{ &lt;span style="color:#58a1dd">extraEnvVars&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">zeroEnvMap&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">wil&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">scope_exit&lt;/span>([&lt;span style="color:#ff636f">&amp;amp;&lt;/span>] {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Can&amp;#39;t zero the keys, but at least we can zero the values.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#ff636f">auto&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> [&lt;span style="color:#58a1dd">name&lt;/span>, &lt;span style="color:#58a1dd">value&lt;/span>] &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">tempEnvMap&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SecureZeroMemory&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>(), &lt;span style="color:#58a1dd">value&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#ff636f">decltype&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>.&lt;span style="color:#58a1dd">begin&lt;/span>())&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">value_type&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">tempEnvMap&lt;/span>.&lt;span style="color:#58a1dd">clear&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">RETURN_IF_FAILED&lt;/span>(&lt;span style="color:#58a1dd">UpdateEnvironmentMapW&lt;/span>(&lt;span style="color:#58a1dd">tempEnvMap&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">RETURN_IF_FAILED&lt;/span>(&lt;span style="color:#58a1dd">EnvironmentMapToEnvironmentStringsW&lt;/span>(&lt;span style="color:#58a1dd">tempEnvMap&lt;/span>, &lt;span style="color:#58a1dd">newEnvVars&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Required when using a unicode environment block.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">dwCreationFlags&lt;/span> &lt;span style="color:#ff636f">|=&lt;/span> &lt;span style="color:#58a1dd">CREATE_UNICODE_ENVIRONMENT&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">LPWCH&lt;/span> &lt;span style="color:#58a1dd">lpEnvironment&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">newEnvVars&lt;/span>.&lt;span style="color:#58a1dd">empty&lt;/span>() &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span> &lt;span style="color:#ff636f">:&lt;/span> &lt;span style="color:#58a1dd">newEnvVars&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">fSuccess&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">!!&lt;/span>&lt;span style="color:#58a1dd">CreateProcessW&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">mutableCommandline&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpProcessAttributes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpThreadAttributes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// bInheritHandles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">dwCreationFlags&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// dwCreationFlags
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">lpEnvironment&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpEnvironment
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">lpCurrentDirectory&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpCurrentDirectory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">si&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpStartupInfo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">piPty&lt;/span> &lt;span style="color:#828b96;font-style:italic">// lpProcessInformation
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">fSuccess&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#58a1dd">S_OK&lt;/span> : &lt;span style="color:#58a1dd">HRESULT_FROM_WIN32&lt;/span>(&lt;span style="color:#58a1dd">GetLastError&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®é™…ä¸Šæ˜¯é€šè¿‡ä¸‰æ ¹ç®¡é“ä¸ conhost ç›¸è¿ï¼Œconhost.exe å°†æ•°æ®é€šè¿‡ç®¡é“å‘é€åˆ° WindowsTerminal.exeï¼Œä»ç®¡é“æ¥æ”¶åˆ°ä¿¡å·å’Œæ•°æ®ã€‚&lt;/p>
&lt;p>åœ¨å®ç° wsudo çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æœºåˆ¶ï¼Œç®€å•ç‚¹å°±æ˜¯åˆ›å»ºä¸€ä¸ª sudo-service ä½œä¸ºç‰¹æƒæœåŠ¡è¿è¡Œï¼Œå½“ç”¨æˆ·è¿è¡Œ sudo æ—¶ï¼Œä¸æœåŠ¡é€šä¿¡ï¼ŒæˆæƒæˆåŠŸåï¼Œsudo-service åˆ›å»ºä¸€ä¸ª &lt;code>ConPty&lt;/code> ï¼ˆæˆ–è€…ç›´æ¥ä½¿ç”¨ OpenConsoleï¼‰ä¸ä½œä¸ºç‰¹æƒè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚sudo-service ä¸ sudo äº¤äº’æ•°æ®å³å¯ã€‚æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/62018098-da55d580-b1eb-11e9-8cab-8a68ea273d46.png" alt="">&lt;/p>
&lt;p>è¿™ç§æœºåˆ¶çš„ç¼ºé™·æ˜¯ï¼Œéœ€è¦å¤šæ¬¡è½¬å‘æ•°æ®ï¼Œä»¥è¾“å…¥ä¸ºä¾‹ï¼Œæ•°æ®è¾“å…¥ä»ç”¨æˆ·åˆ° sudo, sudo å‘é€ç»™ sudo-service, sudo-service å†™å…¥åˆ° OpenConsole. OpenConsole å†™å…¥åˆ°ç‰¹æƒè¿›ç¨‹ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¤§é‡æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦å¤§é‡ IO å’Œ CPUã€‚ä¸è¿‡è¿™ç§æƒ…å†µä¸‹æ— éœ€è€ƒè™‘ Console å’Œ Cygwin/MSYS PTY çš„å·®å¼‚ã€‚&lt;/p>
&lt;h3 id="ntsetinformationprocess-çš„-sudo-æœºåˆ¶">NtSetInformationProcess çš„ sudo æœºåˆ¶&lt;/h3>
&lt;p>åœ¨ Github ä¸Šï¼ŒParker Snell å¼€å‘äº† &lt;a href="https://github.com/parkovski/wsudo">wsudo: Proof of concept sudo for Windows&lt;/a>ï¼ˆå’Œ Privexec wsudo åŒåï¼‰ï¼Œåœ¨è¿™ä¸ª wsudo é‡Œé¢ï¼Œä½¿ç”¨ C/S æ¶æ„å’Œ &lt;code>NtSetInformationProcess&lt;/code> å®ç°äº† sudo çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶å®é™…ä¸Šä¸ Linux sudo ç±»ä¼¼ï¼Œå³éƒ½æ˜¯ä»æ ‡å‡†ç”¨æˆ·ä¸­å¯åŠ¨ï¼Œè¿™æ ·ä¾¿å¯ä»¥å®Œæ•´çš„ç»§æ‰¿å½“å‰çš„ç»ˆç«¯è®¾å¤‡ï¼Œç¯å¢ƒå˜é‡ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œè¿™é‡Œæ˜¯ wsudo_client æ˜¯é€šè¿‡è¯·æ±‚ wsudo_serverï¼Œæˆæƒè¯·æ±‚æˆåŠŸè¿”å›åï¼Œä½¿ç”¨ &lt;code>CREATE_SUSPENDED&lt;/code> æ ‡å¿—åˆ›å»ºæš‚åœçš„å­è¿›ç¨‹ï¼Œå°†è¿›ç¨‹çš„å¥æŸ„å‘é€ç»™ &lt;code>wsudo_server&lt;/code>ï¼Œ&lt;code>wsudo_server&lt;/code> ä½¿ç”¨ &lt;code>NtSetInformationProcess&lt;/code> ä¿®æ”¹å­è¿›ç¨‹çš„ &lt;code>Token&lt;/code>ï¼Œå°†å…¶æå‡ä¸ºç‰¹æƒè¿›ç¨‹ï¼Œwsudo_client å†è¿è¡Œ &lt;code>ResumeThread&lt;/code> å°†å…¶å”¤é†’ã€‚åœ¨ ReactOS ä¸­ &lt;code>CreateProcessAsUser&lt;/code> å®é™…ä¸ŠåŒæ ·ä½¿ç”¨äº† &lt;code>NtSetInformationProcess&lt;/code>ï¼Œå³ä½¿ç”¨ &lt;code>CreateProcessW&lt;/code> åˆ›å»ºæŒ‚èµ·çš„è¿›ç¨‹åï¼Œä½¿ç”¨ &lt;code>NtSetInformationProcess&lt;/code> è®¾ç½®è¿›ç¨‹çš„ &lt;code>Token&lt;/code> ç„¶åä½¿è¿›ç¨‹çš„ä¸»çº¿ç¨‹æ¢å¤è¿è¡Œã€‚åœ¨ Windows &lt;code>CreateProcessAsUser&lt;/code> çš„æœºåˆ¶å¤§è‡´å¦‚æ­¤ï¼Œä½†å…·ä½“çš„å®ç°ç»†èŠ‚å­˜åœ¨å·®å¼‚ã€‚æ­¤æ–¹æ¡ˆä¸ &lt;code>CreateProcessAsUser&lt;/code> ä¸åŒçš„æ˜¯å¹¶éç”±å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å»ä¿®æ”¹ &lt;code>Token&lt;/code>ï¼Œè€Œæ˜¯äº¤ç”± &lt;code>wsudo_server&lt;/code> è¿™æ ·çš„ç‰¹æƒæœåŠ¡ä¿®æ”¹å…¶ &lt;code>Token&lt;/code>ã€‚å› æ­¤ &lt;code>CreateProcessAsUser&lt;/code> å®é™…æ›´å€¾å‘äºé™æƒã€‚è€Œåœ¨ &lt;code>wsudo_server&lt;/code> è¿™ä¸€ç«¯ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§é™æƒï¼ˆLocal System æƒé™é«˜äº Administratorï¼‰ï¼Œä¸è¿‡æ•´ä½“ä¸Šçœ‹å°±ä¸ä¸€æ ·äº†ã€‚&lt;/p>
&lt;p>ä¸è¿‡åœ¨æ­¤ä¾‹ä¸­ï¼Œwsudo_server æ˜¯ç›´æ¥æ‹·è´çš„æœåŠ¡çš„ &lt;code>Token&lt;/code>ï¼Œè¿™ç§æœºåˆ¶æœ‰å¾ˆå¤§çš„é£é™©ï¼Œå»ºè®®çš„ç­–ç•¥æ˜¯ä½¿ç”¨ &lt;code>LogonUserW&lt;/code> è·å¾—å—é™çš„ç®¡ç†å‘˜ Token åï¼Œå†ä½¿ç”¨ &lt;code>GetTokenInformation&lt;/code> è·å¾— &lt;code>TokenLinkedToken&lt;/code>ï¼Œç”± &lt;code>LinkedToken&lt;/code> åˆ›å»ºç®¡ç†å‘˜è¿›ç¨‹ï¼Œè¿™ä¸ appinfo æœåŠ¡çš„æœºåˆ¶ç±»ä¼¼ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>WTSQueryUserToken&lt;/code> è·å¾—ç®¡ç†å‘˜è¿›ç¨‹çš„ Token å†ä½¿ç”¨ &lt;code>GetTokenInformation&lt;/code> è·å¾— &lt;code>TokenLinkedToken&lt;/code> åˆ›å»ºç®¡ç†å‘˜è¿›ç¨‹ï¼Œä½† &lt;code>LogonUserW&lt;/code> ç”Ÿæˆçš„ä»¤ç‰Œå¯èƒ½æœ‰ä¸€äº›é™åˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HObject&lt;/span> &lt;span style="color:#58a1dd">currentToken&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// if (!OpenProcessToken(clientProcess, TOKEN_DUPLICATE | TOKEN_READ,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">OpenProcessToken&lt;/span>(&lt;span style="color:#58a1dd">GetCurrentProcess&lt;/span>(), &lt;span style="color:#58a1dd">TOKEN_DUPLICATE&lt;/span> &lt;span style="color:#ff636f">|&lt;/span> &lt;span style="color:#58a1dd">TOKEN_READ&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">currentToken&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Client {}: Couldn&amp;#39;t open client process token: {}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">_clientId&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">lastErrorString&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PSID&lt;/span> &lt;span style="color:#58a1dd">ownerSid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PSID&lt;/span> &lt;span style="color:#58a1dd">groupSid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PACL&lt;/span> &lt;span style="color:#58a1dd">dacl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PACL&lt;/span> &lt;span style="color:#58a1dd">sacl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PSECURITY_DESCRIPTOR&lt;/span> &lt;span style="color:#58a1dd">secDesc&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">SUCCEEDED&lt;/span>(&lt;span style="color:#58a1dd">GetSecurityInfo&lt;/span>(&lt;span style="color:#58a1dd">currentToken&lt;/span>, &lt;span style="color:#58a1dd">SE_KERNEL_OBJECT&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">DACL_SECURITY_INFORMATION&lt;/span> &lt;span style="color:#ff636f">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SACL_SECURITY_INFORMATION&lt;/span> &lt;span style="color:#ff636f">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GROUP_SECURITY_INFORMATION&lt;/span> &lt;span style="color:#ff636f">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">OWNER_SECURITY_INFORMATION&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">ownerSid&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">groupSid&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">dacl&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sacl&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">secDesc&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Client {}: Couldn&amp;#39;t get security info: {}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">_clientId&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">lastErrorString&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">WSUDO_SCOPEEXIT&lt;/span> { &lt;span style="color:#58a1dd">LocalFree&lt;/span>(&lt;span style="color:#58a1dd">secDesc&lt;/span>); };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SECURITY_ATTRIBUTES&lt;/span> &lt;span style="color:#58a1dd">secAttr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">secAttr&lt;/span>.&lt;span style="color:#58a1dd">nLength&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">SECURITY_ATTRIBUTES&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">secAttr&lt;/span>.&lt;span style="color:#58a1dd">bInheritHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">secAttr&lt;/span>.&lt;span style="color:#58a1dd">lpSecurityDescriptor&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">secDesc&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HObject&lt;/span> &lt;span style="color:#58a1dd">newToken&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">DuplicateTokenEx&lt;/span>(&lt;span style="color:#58a1dd">currentToken&lt;/span>, &lt;span style="color:#58a1dd">MAXIMUM_ALLOWED&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">secAttr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SecurityImpersonation&lt;/span>, &lt;span style="color:#58a1dd">TokenPrimary&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">newToken&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">error&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Client {}: Couldn&amp;#39;t duplicate token: {}&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">_clientId&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">lastErrorString&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_userToken&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">move&lt;/span>(&lt;span style="color:#58a1dd">newToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">log&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">info&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Client {}: Authorized; stored new token.&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">_clientId&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§åœ¨ Windows ä¸­å®ç° &lt;code>sudo&lt;/code> çš„æœºåˆ¶è¾ƒç®€å•ï¼Œå¤æ‚æ€§è¾ƒä½ã€‚å½“ç„¶éœ€è¦å®‰è£…æœåŠ¡ï¼Œè¿›ç¨‹é—´å®‰å…¨é€šä¿¡ï¼Œé¿å…ææƒæ¼æ´ï¼Œè¿™äº›é—®é¢˜éƒ½éœ€è¦è§£å†³ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“çš„ã€‚è€Œä¸”å¯¹äºä½¿ç”¨ &lt;code>NtSetInformationProcess&lt;/code> ä¿®æ”¹è¿›ç¨‹æƒé™ï¼ŒWindows å†…æ ¸å›¢é˜Ÿå¥½åƒå¹¶ä¸æ„è§ç”¨æˆ·è¿™æ ·åšï¼ˆ&lt;a href="https://social.msdn.microsoft.com/forums/windowsdesktop/en-US/86602194-c8f7-4c42-b349-fd78e1bdb5f2/ntsetinformationprocess-processaccesstoken-fails-with-statusnotsupported">NTSetInformationProcess (ProcessAccessToken) fails with STATUS_NOT_SUPPORTED&lt;/a> 2007-01-03ï¼‰ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Hello.
I am a developer on the Windows Kernel Team. Before continuing, I want to stress as a disclaimer that NtSetInformationProcess, class ProcessAccessToken, is an undocumented and unsupported infterface. It is reserved for system component use and is subject to change between operating system releases. That being said, I would like to address your particular concern.
The NT kernel was never intended to allow token switching once a process started running. This is because handles, etc. may have been opened in an old security context, inflight operations may use inconsistent security contexts, etc. As such, it typically does not make sense to switch a process&amp;#39; token once it has begun execution. However, this was not enforced until Vista.
Unfortunately, it is difficult to properly implement setuid() semantics on NT as you have noted, though it too could be susceptible to the issues outlined above. After exploring alternative implementations for Interix we settled on leaving the lazy swap behavior intact for EXEs launched from POSIX binaries (image type = POSIX in the PE image). This was a reasonable compromise since the change was not security-based in nature, and allowed the legacy behavior to persist in conjunction with binaries that had (or should have) better control of their environment.
Arun Kishan
Windows Kernel Team
&lt;/code>&lt;/pre>&lt;p>ä¸è¿‡ä¸Šè¿°å›å¤æ˜¯ 2007 å¹´ï¼Œæ—¶è‡³ä»Šæ—¥ï¼Œä¸çŸ¥é“ Windows å†…æ ¸å›¢é˜Ÿæœ‰æ²¡æœ‰æ–°çš„çœ‹æ³•ã€‚&lt;/p>
&lt;p>é—æ†¾çš„æ˜¯ Parker Snell é‡‡å–çš„æ˜¯ GPLv3 åè®®ï¼Œå¦‚æœè¦ä½¿ç”¨æ­¤æ–¹æ¡ˆï¼Œåˆ™å¯èƒ½éœ€è¦åœ¨ &lt;code>cleanroot&lt;/code> ä¸­å®ç°ï¼Œåœ¨ Windows Terminal çš„è¯„è®ºä¸­ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ·»åŠ æ­¤æ–¹æ¡ˆçš„ä»‹ç»ã€‚&lt;/p>
&lt;h3 id="éœ€è¦-ui-äº¤äº’çš„-wsudo">éœ€è¦ UI äº¤äº’çš„ wsudo&lt;/h3>
&lt;p>å‰é¢ä¸‰ç§æƒ…å†µéƒ½æ˜¯éœ€è¦é‡æ–°å®ç°ä¸€ä¸ªæœåŠ¡æˆ–è€…åœ¨ç°æœ‰æœåŠ¡åŸºç¡€ä¸Šæ”¹è¿›ï¼Œåœ¨æœåŠ¡ä¸­åˆ›å»ºç®¡ç†å‘˜è¿›ç¨‹çš„ Tokenï¼Œè¿™å¯¹äºå¾®è½¯æ¥è¯´å­˜åœ¨è¯¸å¤šé¡¾è™‘ï¼Œè€Œç¬¬ä¸‰æ–¹å¼€å‘è€…å®ç°ä¹Ÿéœ€è¦æ…é‡è€ƒè™‘é¿å…å®‰å…¨é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¿ç•™ UAC çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/windows/console/attachconsole">AttachConsole&lt;/a> å°†è¿›ç¨‹é™„åŠ åˆ°æ—§çš„æ§åˆ¶å°ä¸Šï¼Œå¦‚æœå¯ä»¥æ¥å—éœ€è¦ UI äº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>AttachConsole&lt;/code> å®ç°ä¸å®Œæ•´çš„ &lt;code>sudo&lt;/code>ã€‚&lt;/p>
&lt;p>åœ¨ &lt;a href="https://github.com/M2Team/Privexec">Privexec&lt;/a> ä¸­ï¼Œæˆ‘é€šè¿‡ &lt;a href="https://github.com/M2Team/Privexec/blob/master/wsudo/wsudo-tie.cc">&lt;code>wsudo-tie&lt;/code>&lt;/a> å‘½ä»¤ä½œä¸ºä¸­é—´ä»¶å®ç°ä¸å®Œæ•´çš„ &lt;code>sudo&lt;/code>ã€‚å½“ç”¨æˆ·åœ¨æ§åˆ¶å°ä¸­ä½¿ç”¨ &lt;code>wsudo -A&lt;/code> å¯åŠ¨ç®¡ç†å‘˜è¿›ç¨‹æ—¶ï¼Œå¦‚æœç›®æ ‡å¯æ‰§è¡Œç¨‹åºçš„å­ç³»ç»Ÿä¸º &lt;code>Windows CUI&lt;/code>ï¼ˆæˆ–è€…åç¼€ä¸º &lt;code>.bat&lt;/code>,&lt;code>.com&lt;/code>,&lt;code>.cmd&lt;/code>ï¼‰ï¼Œå¹¶ä¸”å¯åŠ¨å‚æ•°æ²¡æœ‰ &lt;code>--hide&lt;/code> &lt;code>--new-console&lt;/code>åˆ™ä½¿ç”¨ ShellExecuteEx å¯åŠ¨ &lt;code>wsudo-tie&lt;/code>ï¼Œåœ¨ &lt;code>wsudo-tie&lt;/code> ä¸­ï¼Œè®¾ç½®å¥½å·¥ä½œç›®å½•ï¼Œç¯å¢ƒå˜é‡ï¼Œå¹¶è°ƒç”¨ &lt;code>FreeConsole&lt;/code>ï¼Œ&lt;code>AttachConsole&lt;/code> åï¼Œå¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œè¿™æ ·æ— è®ºæ˜¯å·¥ä½œç›®å½•è¿˜æ˜¯ç¯å¢ƒå˜é‡ç­‰ï¼Œéƒ½ä¸é¢„æœŸçš„ç›¸ç¬¦ã€‚ä¸‹å›¾åœ¨æ§åˆ¶å°ä¸­ä½¿ç”¨ wsudo å¯åŠ¨ä¸€ä¸ªç®¡ç†å‘˜æƒé™çš„ wsudoï¼Œåè€…å†å¯åŠ¨äº† &lt;code>TrustedInstaller&lt;/code> çš„ &lt;code>pwsh&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/62051234-8972cb00-b245-11e9-958d-e3af4ca614f7.png" alt="">&lt;/p>
&lt;p>è¿™ç§æ–¹æ¡ˆå€Ÿé‰´äº† &lt;a href="https://github.com/lukesampson/psutils/blob/master/sudo.ps1">lukesampson/psutils&lt;/a> çš„ sudo æœºåˆ¶ï¼Œä½†æœ‰æ‰€æ”¹å–„ã€‚&lt;/p>
&lt;p>wsudo-tie çš„æ–¹æ¡ˆå¹¶ä¸é€‚åˆ Cygwin/MSYS çš„ç»ˆç«¯ï¼Œå¦‚ Minttyï¼Œå› ä¸ºè¿™äº›ç»ˆç«¯ä½¿ç”¨ç®¡é“æ¨¡æ‹Ÿè€Œä¸æ˜¯åƒ ConEmu å†…éƒ¨æœ‰ä¸ªæ§åˆ¶å°ï¼Œæ­¤æ—¶ä½¿ç”¨ AttachConsole ä¼šå¤±è´¥ã€‚&lt;/p>
&lt;p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ &lt;code>wsudo-tie&lt;/code> ä¸­ï¼Œ&lt;code>CreateProcessW&lt;/code> å¯åŠ¨ &lt;code>.bat&lt;/code>/&lt;code>.cmd&lt;/code> å¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„æƒ…å†µï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ &lt;code>bela::ExecutableExistsInPath&lt;/code> é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚&lt;/p>
&lt;p>åœ¨è¿™ç§æ–¹æ¡ˆä¸­ï¼Œå¼¹å‡ºå®‰å…¨æ¡Œé¢æ—¶ï¼Œæ˜¾ç¤ºçš„æ˜¯ wsudo-tie çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç›®æ ‡è¿›ç¨‹çš„ä¿¡æ¯ï¼Œè¿™å°±æ„å‘³ç€æ²¡æœ‰å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œæ•°å­—ç­¾åæ ¡éªŒï¼Œè¦å®ç°æ•°å­—ç­¾åæ ¡éªŒï¼Œè¿˜æœ‰å¾ˆå¤šäº‹æƒ…è¦åšã€‚&lt;/p>
&lt;p>AttachConsole çš„ç›¸å…³æµç¨‹å¯ä»¥å‚è€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/microsoft/terminal/blob/0d8f2998d6fdfa6013854ea66ccf26ed34ba8de2/src/server/IoDispatchers.cpp#L141">Windows Terminal: oDispatchers::ConsoleHandleConnectionRequest&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/microsoft/terminal/blob/0d8f2998d6fdfa6013854ea66ccf26ed34ba8de2/src/server/IoDispatchers.cpp#L267">Windows Terminal: IoDispatchers::ConsoleClientDisconnectRoutine&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/reactos/reactos/blob/3f1ab92d3aca8b7b0965a1004e4a5f25b4d64025/dll/win32/kernel32/client/console/console.c#L2675">ReactOS: AttachConsole&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>åœ¨ Windows ä¸Šå®ç°é Windows å“²å­¦çš„ sudo è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œsudo è™½ç„¶å¥½ç©ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥éµå¾ª &lt;strong>æœ€å°ç‰¹æƒåŸåˆ™ &lt;a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">Principle of least privilege&lt;/a>&lt;/strong> ï¼Œå‡å°‘ææƒè¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="å¤‡æ³¨">å¤‡æ³¨&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://www.codeproject.com/Articles/19165/Vista-UAC-The-Definitive-Guide">Vista UAC: The Definitive Guide&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blogs.msdn.microsoft.com/winsdk/2013/03/22/how-to-launch-a-process-as-a-full-administrator-when-uac-is-enabled/">How to launch a process as a Full Administrator when UAC is enabled?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blogs.msdn.microsoft.com/winsdk/2010/05/31/dealing-with-administrator-and-standard-users-context/">Dealing with Administrator and standard userâ€™s context&lt;/a>&lt;/li>
&lt;/ol>
- https://forcemz.net/posts/2019/2019-08-07-implement-sudo-in-windows/ - Copyright (c) 2009-2024 J23</description></item><item><title>æœåŠ¡ç«¯ Git é’©å­çš„å¦™ç”¨</title><link>https://forcemz.net/posts/2019/2019-07-30-gnk-server-side/</link><pubDate>Tue, 30 Jul 2019 20:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-07-30-gnk-server-side/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-07-30-gnk-server-side/ -&lt;h1 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h1>
&lt;p>åœ¨ &lt;a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">ã€ŠPro Gitã€‹&lt;/a> çš„ &lt;strong>Server-Side Hooks&lt;/strong> ä»‹ç»äº†ä¸‰ç§é’©å­ï¼Œåˆ†åˆ«æ˜¯ &lt;code>pre-receive&lt;/code> å·²ç» &lt;code>update&lt;/code> è¿˜æœ‰ &lt;code>post-receive&lt;/code>ã€‚GITEE æœ€åˆæ˜¯åŸºäº Gitlab å‘å±•è€Œæ¥ï¼Œæœ€å¼€å§‹åœ¨æœåŠ¡ç«¯ä½¿ç”¨çš„æ˜¯ &lt;code>update&lt;/code> é’©å­ã€‚æˆ‘ä»¬ä½¿ç”¨ &lt;code>update&lt;/code> é’©å­å®Œæˆä¸€äº›ä¿æŠ¤åˆ†æ”¯/åªè¯»åˆ†æ”¯çš„åŠŸèƒ½ã€‚éšç€ Gitee çš„ä¸æ–­å‘å±•ï¼Œä¹Ÿæœ‰äººæå‡ºäº†ä¸€äº›æ–°çš„æœåŠ¡éœ€æ±‚ï¼Œä¸ºäº†è§£å†³å¤§ä»“åº“å¤§æ–‡ä»¶ï¼Œæˆ‘ä»¬å¼€å‘äº† Git Native Hook (GNK)ã€‚æ–°çš„é’©å­åˆ©ç”¨äº† git çš„ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œåœ¨ä¸åŒçš„é˜¶æ®µå®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä»‹ç»ä¸€ä¸‹è¿™äº›é’©å­çš„å¦™ç”¨ã€‚&lt;/p>
&lt;p>åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œä½ å¯ä»¥é˜…è¯» &lt;a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">ã€ŠPro Gitã€‹&lt;/a> å…³äºæœåŠ¡ç«¯é’©å­çš„æŠ€æœ¯ç»†èŠ‚ï¼Œä½ è¿˜å¯ä»¥é˜…è¯» &lt;a href="https://forcemz.net/git/2017/11/22/GitNativeHookDepthOptimization/">ã€ŠGit åŸç”Ÿé’©å­çš„æ·±åº¦ä¼˜åŒ–ã€‹&lt;/a>ä»¥åŠ&lt;a href="https://forcemz.net/git/2019/04/01/ImplementGitDirPermissionControl/">ã€Šå®ç° Git ç›®å½•æƒé™æ§åˆ¶ã€‹&lt;/a>ã€‚&lt;/p>
&lt;h2 id="åˆ†æ”¯æƒé™ç®¡ç†">åˆ†æ”¯æƒé™ç®¡ç†&lt;/h2>
&lt;p>äººä»¬å¯¹äºæƒé™ç®¡ç†çš„è¦æ±‚å¾€å¾€ä¼šæœ‰ä¸€ä¸ªå˜è¿è¿‡ç¨‹ï¼Œä»æœ€å¼€å§‹çš„ä¸€åˆ€åˆ‡ï¼Œåˆ°åæ¥çš„ç²¾ç»†åŒ–æ§åˆ¶ï¼Œäº‹å®å‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœä¸æä¾›ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼Œé‚£ä¹ˆæ€»ä¼šæœ‰ç”¨æˆ·æå‡ºéœ€æ±‚çš„ã€‚&lt;/p>
&lt;p>åœ¨å®ç° GNK ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ gitlab-shell çš„æŸä¸ªè„šæœ¬è½¯é“¾åˆ° hooks ç›®å½•ä½œä¸º update é’©å­ï¼Œæ¯æ›´æ–°ä¸€ä¸ªå¼•ç”¨ï¼Œupdate é’©å­å°†è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ ¼å¼ä¸º:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$GIT_DIR&lt;/span>/hooks/update refname oldrev newrev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åªè¦ä»¥ &lt;code>refs/heads/&lt;/code> å¼€å¤´çš„å¼•ç”¨è¢«ä¿®æ”¹äº†ï¼Œå¹¶ä¸”æ­¤å¼•ç”¨å¯¹åº”çš„åˆ†æ”¯åå·²ç»è¢«å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ä½œä¸ºåªè¯»åˆ†æ”¯æˆ–è€…ä¿æŠ¤åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥è®©é’©å­è¿”å›éé›¶å€¼ï¼Œè®©æ¨é€å¤±è´¥ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åˆ†æ”¯æƒé™ç»†ç²’åº¦ç®¡ç†çš„åŠŸèƒ½ã€‚ç„¶è€Œä¸åˆ©çš„å› ç´ æ˜¯ï¼Œå½“ä¸€æ¬¡æ€§æ¨é€å¤šä¸ªåˆ†æ”¯æ—¶ï¼Œupdate é’©å­å°†è¢«å¯åŠ¨å¤šæ¬¡ï¼Œupdate é’©å­éœ€è¦é‰´æƒï¼Œé‰´æƒè¯·æ±‚ä¹Ÿä¼šå‘é€å¤šæ¬¡ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸åˆ©äºç³»ç»Ÿä¼˜åŒ–çš„ã€‚&lt;/p>
&lt;p>åœ¨ GNK ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ GNK pre-receive é’©å­å®ç°é‰´æƒï¼Œpre-receive åœ¨æ ‡å‡†è¾“å…¥è¯»å–æ‰€æœ‰è¢«æ›´æ–°çš„å¼•ç”¨ï¼Œå¾ªç¯çš„ä½¿ç”¨ &lt;code>getline&lt;/code> å³å¯è·å¾—æ‰€æœ‰ä¿®æ”¹çš„åˆ†æ”¯ï¼Œè¿™æ ·ä¸€æ¥å¤šä¸ªåˆ†æ”¯çš„éªŒè¯å°±å¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼Œè¿™å¯ä»¥æå¤§çš„å‡å°‘é‰´æƒè¯·æ±‚æ¬¡æ•°ã€‚&lt;/p>
&lt;p>pre-receive æ ‡å‡†è¾“å…¥æ ¼å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>refname SP oldrev SP newrev LF
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>refnameN SP oldrev SP newrev LF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é™¤äº†ä¿æŠ¤åˆ†æ”¯ï¼Œåªè¯»åˆ†æ”¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ GNK ä¸­å®ç°ç¦æ­¢ç”¨æˆ·æ¨é€åˆ›å»ºæ–°çš„åˆ†æ”¯åŠŸèƒ½ï¼Œæˆ‘ä»¬çŸ¥é“å½“ &lt;strong>oldrev&lt;/strong> ä¸º &lt;strong>0000000000000000000000000000000000000000&lt;/strong> æ—¶ï¼Œè¡¨ç¤ºç”¨æˆ·åˆ›å»ºäº†æ–°çš„å¼•ç”¨ï¼ˆnewrev ä¸ oldrev æ˜¯ä¸èƒ½åŒæ—¶ä¸º &lt;code>zerooid&lt;/code> çš„ï¼Œè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼‰ã€‚å¦‚æœå­˜åœ¨ oldrev ä¸ºå…¨é›¶ä¸” &lt;code>refname&lt;/code> ä»¥ &lt;code>refs/heads/&lt;/code> å¼€å¤´ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥çŸ¥é“ç”¨æˆ·åˆ›å»ºäº†æ–°çš„åˆ†æ”¯ï¼Œä½¿ç”¨ä¸€ä¸ª &lt;code>bool&lt;/code> ç±»å‹çš„ &lt;code>nbe&lt;/code> å‘ŠçŸ¥ API ï¼ŒAPI æˆæƒå¤±è´¥ pre-receive è¿”å›éé›¶å€¼å³å¯ç¦æ­¢ç”¨æˆ·æ¨é€åˆ›å»ºåˆ†æ”¯ã€‚&lt;/p>
&lt;h2 id="å­˜å‚¨é…é¢å’Œå¤§æ–‡ä»¶">å­˜å‚¨é…é¢å’Œå¤§æ–‡ä»¶&lt;/h2>
&lt;p>åœ¨ update é’©å­ä¸­ï¼Œæ£€æµ‹å­˜å‚¨åº“é…é¢å¾€å¾€ä¸åˆ‡å®é™…ï¼Œå¤šæ¬¡è°ƒç”¨ update é’©å­å¯èƒ½éœ€è¦æ‰§è¡Œå¤šæ¬¡ç»Ÿè®¡å­˜å‚¨åº“ä½“ç§¯ï¼Œè¿™æ˜¯ä¸åˆ’ç®—çš„ï¼Œä½†ä¸åšå­˜å‚¨åº“ä½“ç§¯æ£€æµ‹ï¼Œå­˜å‚¨åº“é…é¢é™åˆ¶å¾ˆå®¹æ˜“å¤±æ•ˆï¼Œå‡ºç°é™åˆ¶é€ƒé€¸ã€‚åœ¨ GNK ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ pre-receive è¿›è¡Œé…é¢è®¡ç®—ï¼Œå½“ç”¨æˆ·é…é¢è¶…å‡ºé™åˆ¶æ—¶ï¼Œå…è®¸ä¸‰æ¬¡é‡è¯•æœºä¼šï¼Œå¦‚æœå¼ºåˆ¶æ¨é€åè¿è¡Œå¼ºåˆ¶ gc åï¼Œå­˜å‚¨åº“ä½“ç§¯æ¢å¤åˆ°é™åˆ¶ä¹‹ä¸‹ï¼Œç”¨æˆ·å³å¯æ­£å¸¸ä½¿ç”¨å­˜å‚¨åº“ã€‚åŒæ—¶å¦‚æœç”¨æˆ·çš„é™åˆ¶æ¬¡æ•°è¿˜å­˜åœ¨ï¼Œä½†å­˜å‚¨åº“ä½“ç§¯å°äºé…é¢é™åˆ¶ï¼Œä¾ç„¶æ˜¯å¯ä»¥æ¨é€çš„ï¼Œè¿™é€šå¸¸ä¸ git è‡ªåŠ¨ gc æœ‰å…³ã€‚&lt;/p>
&lt;p>ç»å¤§å¤šæ•°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½æ˜¯é’ˆå¯¹æ–‡æœ¬ä¼˜åŒ–çš„ï¼Œæˆ–è€…æ˜¯åŸºäºæ–‡æœ¬è¡¥ä¸çš„ï¼Œgit æ˜¯åŸºäºæ–‡ä»¶å¿«ç…§çš„ï¼Œè¿™äº›ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåœ¨ç®¡ç†æ–‡æœ¬æ–‡ä»¶ï¼Œç¨‹åºæºç æœ‰ç€å¤©ç„¶çš„ä¼˜åŠ¿ã€‚è€Œå¤§æ–‡ä»¶å¾€å¾€ä¼šå¸¦æ¥éº»çƒ¦ã€‚&lt;/p>
&lt;p>git ä½¿ç”¨ &lt;a href="https://linux.die.net/man/2/mmap">mmap(2)&lt;/a> è¯»å†™æ–‡ä»¶ï¼Œä½¿ç”¨ &lt;a href="https://github.com/madler/zlib">zlib&lt;/a> å°†åŸå§‹çš„æ–‡ä»¶ï¼Œtree ç»“æ„ï¼Œcommit æ–‡ä»¶å‹ç¼©æˆ blob, tree, commitã€‚æ‰€ä»¥ä¸€äº›é™åˆ¶ç¡®å®å­˜åœ¨ï¼Œç¬¬ä¸€ï¼Œ32 ä½ç¨‹åºçš„å†…å­˜æœ€å¤§æ˜¯ 4GBï¼Œå› æ­¤ï¼Œä½ åº”è¯¥å§‹ç»ˆä½¿ç”¨ 64 ä½ç³»ç»Ÿå’Œ 64 ä½ gitï¼Œæ— è®ºæ˜¯ Windows Linux è¿˜æ˜¯ macOSã€‚zlib çš„å‹ç¼©ç®—æ³• &lt;code>deflate&lt;/code> å†å²æ‚ ä¹…ï¼Œå‹ç¼©è§£å‹æ•°åº¦å¹¶ä¸å¿«ï¼Œå¹¶ä¸”å‹ç¼©æ¯”ä¹Ÿä¸é«˜ï¼Œå¤§æ–‡ä»¶å¸¦æ¥çš„åæœå¾ˆæ˜æ˜¾ï¼Œæ¨é€çš„è¿‡ç¨‹æ‰“åŒ…è§£åŒ…çš„æ—¶é—´æ€¥å‰§å¢åŠ ï¼Œç”¨æˆ·ä»è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‹‰å–æ•°æ®çš„æ—¶é—´åŒæ ·å¦‚æ­¤ï¼Œå¦‚æœæ–‡ä»¶ä¸æ˜¯ ANSI/UTF-8/UTF-16 è¿™æ ·çš„æ–‡æœ¬æ–‡ä»¶ä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆ CPU çš„å ç”¨å°†æ›´é«˜ï¼Œè€—æ—¶ä¹Ÿæ›´é•¿ã€‚&lt;/p>
&lt;p>åœ¨ gitlab-shell ä¸­ï¼Œç”±äºå½“æ—¶çš„å¼€å‘è€…å¯¹é’©å­è®¤è¯†çš„å±€é™æ€§ï¼Œä½¿ç”¨ &lt;code>commit between&lt;/code> æœºåˆ¶åœ¨ &lt;code>update&lt;/code> é’©å­ä¸­éå†æ¯”è¾ƒæ–‡ä»¶ä¿®æ”¹ï¼ŒæŸ¥çœ‹æ–‡ä»¶åŸå§‹å¤§å°ï¼Œè¿™æ ·å¸¦æ¥çš„åæœæ˜¯å¤§æ–‡ä»¶é™åˆ¶å®¹æ˜“è¢«çªç ´ï¼Œä¸åŒçš„å¼•ç”¨ä¹‹é—´å¯èƒ½å‡ºç°æ–‡ä»¶é‡å¤æ£€æŸ¥ï¼ŒAPI å¤šæ¬¡è°ƒç”¨ï¼Œæ‚¬ç©ºå¯¹è±¡ä¸æ–­äº§ç”Ÿã€‚åœ¨ GNK ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ pre-receive é’©å­åˆ†ææ¾æ•£å¯¹è±¡å’Œ &lt;code>packet index&lt;/code> æ–‡ä»¶ï¼Œåˆ¤æ–­å‹ç¼©åçš„æ–‡ä»¶å¤§å°æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¶…å‡ºé™åˆ¶ã€‚è¿™é‡Œæ›´å¤šçš„ç»†èŠ‚å¯ä»¥é˜…è¯» &lt;a href="https://forcemz.net/git/2017/11/22/GitNativeHookDepthOptimization/">ã€ŠGit åŸç”Ÿé’©å­çš„æ·±åº¦ä¼˜åŒ–ã€‹&lt;/a>ã€‚è¿™ç§æœºåˆ¶çš„å¥½å¤„æ˜¯ä½¿ç”¨ç¯å¢ƒéš”ç¦»é¿å…äº†äº§ç”Ÿæ‚¬ç©ºå¯¹è±¡ä»è€Œé¿å…ç”¨æˆ·å­˜å‚¨åº“é…é¢çš„è¯¯æ¶ˆè€—ã€‚è€Œåˆ†æ &lt;code>.idx&lt;/code> æ–‡ä»¶æ¯”è§£æ commit ç„¶åè§£æ blob è¦é«˜æ•ˆçš„å¤šï¼Œä»¥ Linux å†…æ ¸æ‰“åŒ…ä½“ç§¯ &lt;code>1345.25 MB&lt;/code> å¯¹è±¡ &lt;code>6361509&lt;/code>ï¼Œè€—æ—¶é•¿ &lt;code>553ms&lt;/code>ã€‚è€Œæˆ‘ä»¬å¾ˆå°‘ç›´æ¥æ¨é€è¶…è¿‡ 1GB çš„å­˜å‚¨åº“ï¼Œå°±ç®—å­˜å‚¨åº“ 1GBï¼Œå¯¹è±¡ä¹Ÿå¾ˆå°‘è¶…è¿‡ 600Wã€‚åŒæ · GNK pre-receive ä¹Ÿåªéœ€è¦åœ¨æˆæƒé˜¶æ®µè¿”å›é…é¢ä¿¡æ¯å³å¯ï¼Œä¸éœ€è¦å¤šæ¬¡è¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="å­˜å‚¨åº“æ•°æ®æœé›†">å­˜å‚¨åº“æ•°æ®æœé›†&lt;/h2>
&lt;p>åœ¨ä½¿ç”¨ gitlab-shell update é’©å­æ—¶ï¼Œå­˜å‚¨åº“ä½“ç§¯çš„æ›´æ–°å¹¶ä¸åŠæ—¶ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦æ‰‹åŠ¨ç‚¹å‡»æ›´æ–°ã€‚&lt;/p>
&lt;p>åœ¨ GNK ä¸­ï¼Œæˆ‘ä»¬åœ¨ pre-receive è®¡ç®—äº†å­˜å‚¨åº“ä½“ç§¯ï¼Œè¿™ä¸ªæ•°æ®é™¤äº†ä¸é…é¢åšæ¯”è¾ƒä¹‹å¤–ï¼Œè¿˜å¯ä»¥è¢«æ”¶é›†èµ·æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä¸€äº›ä¿¡æ¯åºåˆ—åŒ–æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”± blaze è·å–å¤„ç†ï¼Œæ›´æ–°ç”¨æˆ·çš„å­˜å‚¨åº“å¤§å°ã€‚&lt;/p>
&lt;p>å­˜å‚¨åº“å¤§å°åœ¨æ•°æ®åº“ä¸­ä»¥ MB ä¸ºå•ä½ï¼Œæˆ‘ä»¬çš„æ›´æ–°é‡‡ç”¨äº†æ¨¡ç³Šç­–ç•¥ï¼Œä½“ç§¯è½¬æ¢ç›¸ç­‰åä¸æ›´æ–°ï¼Œå­˜å‚¨åº“ä½“ç§¯å¤§äº 80MB æ—¶ï¼Œä½“ç§¯å˜æ›´åœ¨ 2MB åŠä»¥ä¸Šåˆ™æ›´æ–°ï¼Œå…¶ä½™æ˜¯ 1MB, å­˜å‚¨åº“ä½“ç§¯è¿‘ä¼¼ä¸å˜ä¸æ›´æ–°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">const&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">KB&lt;/span> &lt;span style="color:#ff636f">int64&lt;/span> = &lt;span style="color:#a6be9d">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">MB&lt;/span> &lt;span style="color:#ff636f">int64&lt;/span> = &lt;span style="color:#a6be9d">1024&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">GB&lt;/span> &lt;span style="color:#ff636f">int64&lt;/span> = &lt;span style="color:#a6be9d">1024&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">1024&lt;/span> &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// FastAbs todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">FastAbs&lt;/span>(&lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">int64&lt;/span>) &lt;span style="color:#ff636f">int64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">y&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#a6be9d">63&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">n&lt;/span> ^ &lt;span style="color:#58a1dd">y&lt;/span>) &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">y&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// RecordSize todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">RecordSize&lt;/span>(&lt;span style="color:#58a1dd">size&lt;/span>, &lt;span style="color:#58a1dd">oldsize&lt;/span> &lt;span style="color:#ff636f">int64&lt;/span>) &lt;span style="color:#ff636f">int64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">newsize&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span> &lt;span style="color:#ff636f">/&lt;/span> &lt;span style="color:#58a1dd">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// When repo size%MB &amp;gt;720KB ~ size/MB+1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">size&lt;/span>&lt;span style="color:#ff636f">%&lt;/span>&lt;span style="color:#58a1dd">MB&lt;/span> &amp;gt; &lt;span style="color:#a6be9d">720&lt;/span>&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">KB&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">newsize&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">newsize&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">oldsize&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> (&lt;span style="color:#58a1dd">oldsize&lt;/span> &amp;gt; &lt;span style="color:#a6be9d">80&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">FastAbs&lt;/span>(&lt;span style="color:#58a1dd">newsize&lt;/span>&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#58a1dd">oldsize&lt;/span>) &amp;lt; &lt;span style="color:#a6be9d">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">oldsize&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">newsize&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ GNK pre-receive è¿›è¡Œå­˜å‚¨åº“å¤§å°åˆ†ææ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å­˜å‚¨åº“æ¾æ•£å¯¹è±¡è¿›è¡Œè®¡ç®—ï¼Œå½“æ¾æ•£å¯¹è±¡æ•°ç›®è¶…è¿‡ä¸€å®šé™åˆ¶ï¼Œåˆ™å¯ä»¥äº§ç”Ÿä¸€ä¸ªä»»åŠ¡ç»™ blazeï¼Œè®©å…¶å¯åŠ¨ä¸€ä¸ªæ™®é€šçš„ &lt;code>git gc&lt;/code> è¿›ç¨‹ï¼Œå°†æ¾æ•£å¯¹è±¡æ‰“åŒ…åˆ° pack æ–‡ä»¶ä»è€Œæé«˜å­˜å‚¨åº“çš„å“åº”é€Ÿåº¦ã€‚&lt;/p>
&lt;h2 id="åªè¯»ç›®å½•å’Œç¦æ­¢æ¨é€æš´éœ²é‚®ç®±">åªè¯»ç›®å½•å’Œç¦æ­¢æ¨é€æš´éœ²é‚®ç®±&lt;/h2>
&lt;p>åœ¨ &lt;a href="https://forcemz.net/git/2019/04/01/ImplementGitDirPermissionControl/">ã€Šå®ç° Git ç›®å½•æƒé™æ§åˆ¶ã€‹&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘æåˆ°è¿‡å¦‚ä½•å®ç° git ç›®å½•æƒé™æ§åˆ¶ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¢åŠ è‡ªå®šä¹‰åŠŸèƒ½åº”å½“é¿å…ä¿®å¤ git æºç ï¼Œè€Œåº”è¯¥åœ¨é’©å­ä¸­è‡ªå®šä¹‰å®ç°ï¼Œæ‰€ä»¥æœ€åçš„é€‰æ‹©æ˜¯åœ¨ update é’©å­ä¸­å®ç°åªè¯»ï¼Œå…·ä½“çš„å®ç°å¯ä»¥é˜…è¯» ã€Šå®ç° Git ç›®å½•æƒé™æ§åˆ¶ã€‹ã€‚&lt;/p>
&lt;p>ä¸åªè¯»ç›®å½•ç±»ä¼¼ï¼Œlibgit2 åœ¨ pre-receive é˜¶æ®µå¹¶ä¸èƒ½å¾ˆå¥½çš„å¤„ç†ç¯å¢ƒéš”ç¦»æœºåˆ¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ GNK ä¸­é€‰æ‹©åœ¨ update é˜¶æ®µåœ¨ æ¯ä¸€æ¬¡ update é’©å­æ‰§è¡Œæ—¶è¿›è¡Œ &lt;code>revwalk&lt;/code> æ£€æŸ¥ç”¨æˆ·çš„é‚®ç®±æ˜¯å¦åœ¨æäº¤çš„ commit ä¸­ã€‚ä¸ºäº†é¿å…å¤šæ¬¡è¯·æ±‚ API æœåŠ¡ï¼Œé€šè¿‡ &lt;code>basalt--git-srv&lt;/code> &lt;code>brzox--git-srv&lt;/code> çš„æ¨é€è¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p>
&lt;h2 id="æ¨é€åŠ¨æ€">æ¨é€åŠ¨æ€&lt;/h2>
&lt;p>ç”¨æˆ·æ¨é€ä»£ç åï¼ŒGitee åº”è¯¥å‡ºç°æ¨é€åŠ¨æ€ã€‚åœ¨ gitlab-shell ä¸­ï¼Œæ­¤åŠŸèƒ½æœ‰ update é’©å­å®ç°ï¼Œå¤šåˆ†æ”¯æ—¶å¾€å¾€éœ€è¦è¯·æ±‚å¤šæ¬¡ï¼Œè€Œåœ¨ GNK post-receive ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>redis pipeline&lt;/code> ä»¥åŠåˆ†ç»„åˆå¹¶ç­–ç•¥ï¼Œä¼˜åŒ–äº†å¤§é‡åˆ†æ”¯æ¨é€æ—¶ï¼Œå¤šæ¬¡è®¿é—® redis ã€‚&lt;/p>
&lt;h2 id="å¤‡ä»½">å¤‡ä»½&lt;/h2>
&lt;p>post-receive å¾€å¾€ä¸ä¼šå½±å“å­˜å‚¨åº“æ˜¯å¦æ¨é€æˆåŠŸï¼Œä¸»è¦çš„ç›®çš„å°±æ˜¯ä¸ºäº†å‘ŠçŸ¥ç”¨æˆ·æ¨é€æˆåŠŸï¼Œæ­¤æ—¶æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ post-receive å®ç°å­˜å‚¨åº“åŒæ­¥ï¼Œåœ¨ GNK ä¸­ï¼Œå¼€å¯ post-receive åŒæ­¥åï¼Œpost-receive å‘é€ä»»åŠ¡ç»™ blazeï¼Œblaze æˆ–è€…å­˜å‚¨åº“çš„å¤‡ä»½æœºå™¨ï¼Œå®ç°å¤‡ä»½ï¼Œç›®å‰ gitee çš„ä¼ä¸šå­˜å‚¨åº“æ‰€åœ¨çš„æœåŠ¡å™¨å·²ç»ä½¿ç”¨æ­¤æ–¹æ¡ˆç¨³å®šè¿è¡Œã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>å®ç°ä¸€ä¸ªå¥½çš„åŠŸèƒ½éœ€è¦å¯¹èƒŒæ™¯æœ‰å……è¶³çš„äº†è§£ï¼Œæ”¹å–„ git æœåŠ¡çš„ä½“éªŒä¹Ÿè¦ä» git çš„ç‰¹æ€§å‡ºå‘ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-07-30-gnk-server-side/ - Copyright (c) 2009-2024 J23</description></item><item><title>Windows å‘½ä»¤è¡Œè½¬ä¹‰æ‚è°ˆ</title><link>https://forcemz.net/posts/2019/2019-07-20-cmdline-escape/</link><pubDate>Sat, 20 Jul 2019 20:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-07-20-cmdline-escape/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-07-20-cmdline-escape/ -&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h2>
&lt;p>2019 å¹´äº”æœˆçš„ Microsoft Build å¤§ä¼šï¼Œå¾®è½¯å®£å¸ƒäº† Windows Terminalï¼Œå¹¶åœ¨ Github ä¸Šå¼€æºï¼š&lt;a href="https://github.com/microsoft/terminal">https://github.com/microsoft/terminal&lt;/a>ã€‚æˆ‘ä½œä¸ºæŠ€æœ¯çˆ±å¥½è€…ï¼Œè‚¯å®šè¦å°é²œä¸€ç•ªã€‚&lt;/p>
&lt;p>ä½¿ç”¨æˆªå›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/58634006-b05e6080-82d9-11e9-9e3f-2715647edf1b.png" alt="">&lt;/p>
&lt;p>åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¤šæ ‡ç­¾ï¼Œäºšå…‹åŠ›çš„çª—å£èƒŒæ™¯å’Œ &lt;code>Colour Emojis&lt;/code> éƒ½è®©æˆ‘éå¸¸æ»¡æ„ï¼Œè€Œä¸”ä½¿ç”¨ Direct2D ç»˜åˆ¶çš„ emojiï¼Œçœ‹èµ·æ¥è¦æ¯” Mintty ä½¿ç”¨ GDI+PNG çš„ emoji æ–¹æ¡ˆå¥½çš„å¤šï¼ˆPNG çš„ emoji æ— è®ºæ˜¯æ”¾å¤§å’Œç¼©å°éƒ½æ›´å®¹æ˜“å¤±çœŸï¼ŒMintty å¹¶æ²¡æœ‰ Segoe UI å­—ä½“çš„ emoji é£æ ¼ï¼Œå…¶ä»–é£æ ¼æˆ‘å¹¶ä¸å¤ªå–œæ¬¢ï¼‰ã€‚ä¸è¿‡æˆ‘åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€ä¸ª BUGï¼Œå³ &lt;a href="https://github.com/microsoft/terminal/issues/1090">Bug Report: The conhost command line is not properly escaped #1090 &lt;/a>ï¼Œåæ¥æˆ‘åˆæäº¤äº†ä¸€ä¸ª PR ä¿®å¤äº†æ­¤é—®é¢˜ï¼Œåœ¨ç ”ç©¶å…¶ä»–è½¯ä»¶æºç æ—¶ï¼Œæˆ‘å‘ç°è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯ä¸ªä¾‹ï¼Œå› æ­¤æœ‰å¿…è¦å¯¹æ­¤é—®é¢˜è¿›è¡Œä¸€æ¬¡è®¨è®ºï¼Œä¾¿æœ‰äº†æ­¤æ–‡ã€‚&lt;/p>
&lt;h2 id="windows-terminal-çš„å‘½ä»¤è¡Œè½¬ä¹‰é”™è¯¯">Windows Terminal çš„å‘½ä»¤è¡Œè½¬ä¹‰é”™è¯¯&lt;/h2>
&lt;p>åœ¨ Windows Termianl å¼€æºä¹‹å¤„ï¼Œæˆ‘ä¾¿å®‰è£…äº† Windows Termianlï¼Œå¹¶ä¸”æ¯ä¸ªå‘¨æœ«éƒ½å¯èƒ½ä¼šæ‹‰å–æœ€æ–°ä»£ç æ„å»º Windows Termianlã€‚ä½†åœ¨è‡ªå®šä¹‰ &lt;code>profile.json&lt;/code> æ—¶ï¼Œæˆ‘å‘ç° Windows Termianl å¯åŠ¨æŸä¸ª &lt;code>profiles&lt;/code> ä¼šä¸é¢„æœŸä¸ä¸€è‡´ï¼Œç›¸å…³çš„é…ç½®å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;acrylicOpacity&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">0.75&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;closeOnExit&amp;#34;&lt;/span>: &lt;span style="color:#ff636f">false&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;colorScheme&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Campbell&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;commandline&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;\&amp;#34;C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe\&amp;#34; -NoExit -Command \&amp;#34;$Host.UI.RawUI.WindowTitle=\\\&amp;#34;Windows Pwsh ğŸ’™ (7 Preview)\\\&amp;#34;\&amp;#34;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;cursorColor&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;#FFFFFF&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;cursorShape&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;bar&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;fontFace&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Consolas&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;fontSize&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">12&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;guid&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;{08a0be98-ff68-4e3a-a054-0fbd3969d3bb}&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;historySize&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">9001&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;icon&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;ms-appdata:///roaming/pwsh-32.png&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;name&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;Windows Pwsh \ud83d\udc99 (7 Preview)&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;padding&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;0, 0, 0, 0&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;snapOnInput&amp;#34;&lt;/span>: &lt;span style="color:#ff636f">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;startingDirectory&amp;#34;&lt;/span>: &lt;span style="color:#a6be9d">&amp;#34;C:\\Users\\CharlieInc&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">&amp;#34;useAcrylic&amp;#34;&lt;/span>: &lt;span style="color:#ff636f">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­çš„ &lt;code>commandline&lt;/code> æ˜¯å¯åŠ¨ Shell çš„å‘½ä»¤ï¼Œè¿™é‡Œçš„ç›®çš„æ˜¯å¯åŠ¨ &lt;code>PowerShell 7 Preview&lt;/code> å¹¶å°†å…¶æ ‡é¢˜è®¾ç½®æˆ &lt;code>Emoji&lt;/code>, è¿™é‡Œ &lt;code>\ud83d\udc99&lt;/code> å®é™…ä¸Šæ˜¯ &lt;code>U+1F499&lt;/code> å³ &amp;lsquo;ğŸ’™&amp;rsquo;ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>echo -e &amp;quot;\U0001F499&amp;quot;&lt;/code> è¾“å‡ºã€‚ä½† Windows Terminal ä¸­ï¼ŒæŠ¥å‘Šäº†å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/58741634-e7558300-844d-11e9-9b7e-dcdff905ffa3.png" alt="">&lt;/p>
&lt;p>æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨å‘½ä»¤è¡Œå¾—åˆ°å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/6904176/58741666-38657700-844e-11e9-8711-e813c22bc137.png" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Pwsh è¿›ç¨‹çš„å‘½ä»¤è¡Œä¸ JSON é…ç½®ä¸­çš„å·²ç»ä¸ä¸€è‡´äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-batch" data-lang="batch">&lt;span style="display:flex;">&lt;span>:&lt;span style="color:#828b96;font-style:italic">: want&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">&amp;#34;C:\Program Files\PowerShell\7-preview\pwsh.exe&amp;#34;&lt;/span> -NoExit -Command &lt;span style="color:#a6be9d">&amp;#34;$Host.UI.RawUI.WindowTitle=\&amp;#34;&lt;/span>Windows Pwsh ğŸ’™ (7 Preview)\&lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>:&lt;span style="color:#828b96;font-style:italic">: got&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">&amp;#34;C:\Program Files\PowerShell\7-preview\pwsh.exe&amp;#34;&lt;/span> -NoExit -Command $Host.UI.RawUI.WindowTitle=&lt;span style="color:#a6be9d">&amp;#34;Windows Pwsh ğŸ’™ (7 Preview)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŒ‰ç…§ Windows å‘½ä»¤è¡Œè§£æè§„èŒƒ &lt;a href="https://docs.microsoft.com/zh-cn/previous-versions/17w5ykft(v=vs.85)">Parsing C++ Command-Line Arguments &lt;/a>ï¼Œpwsh åœ¨è§£æå‘½ä»¤è¡Œæ—¶ï¼Œ è·å¾—åˆ°çš„å‘½ä»¤è¡Œä¼šç¼–æˆå¦‚ä¸‹æ•°ç»„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>ARGV0: C:\Program Files\PowerShell\7-preview\pwsh.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV1: -NoExit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV2: -Command
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV3: $Host.UI.RawUI.WindowTitle=Windows Pwsh ğŸ’™ (7 Preview)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†å®é™…ä¸Šæˆ‘ä»¬é¢„æœŸçš„å‘½ä»¤è¡Œåº”è¯¥æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>ARGV0: C:\Program Files\PowerShell\7-preview\pwsh.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV1: -NoExit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV2: -Command
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ARGV3: $Host.UI.RawUI.WindowTitle=&amp;#34;Windows Pwsh ğŸ’™ (7 Preview)&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€æ¥åœ¨ Pwsh è§£æå‘½ä»¤è¡Œåè®¾ç½® &lt;code>$Host.UI.RawUI.WindowTitle&lt;/code> è‚¯å®šå°±ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆé—®é¢˜æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬æŸ¥çœ‹è¿›ç¨‹æ ‘ï¼Œå‘ç° Pwsh çš„çˆ¶è¿›ç¨‹æ˜¯ OpenConsoleï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ &lt;code>conhost.exe&lt;/code>, å³ Windows æ§åˆ¶å°çª—å£ä¸»æœºçš„å¼€æºç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>é€šè¿‡åˆ†æ OpenConsole çš„æºç ï¼Œæˆ‘å‘ç°é—®é¢˜å‡ºç°åœ¨åˆæˆå­è¿›ç¨‹å‘½ä»¤è¡Œå‡ºé”™äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">ConsoleArguments&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">_GetClientCommandline&lt;/span>(&lt;span style="color:#58a1dd">_Inout_&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">vector&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">args&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">index&lt;/span>, &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">skipFirst&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">start&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">begin&lt;/span>()&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#58a1dd">index&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Erase the first token.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// Used to get rid of the explicit commandline token &amp;#34;--&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">skipFirst&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Make sure that the arg we&amp;#39;re deleting is &amp;#34;--&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">FAIL_FAST_IF&lt;/span>(&lt;span style="color:#ff636f">!&lt;/span>(&lt;span style="color:#58a1dd">CLIENT_COMMANDLINE_ARG&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">start&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">c_str&lt;/span>()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">erase&lt;/span>(&lt;span style="color:#58a1dd">start&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_clientCommandline&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">index&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>(); &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_clientCommandline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">args&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_clientCommandline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">erase&lt;/span>(&lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">begin&lt;/span>()&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#58a1dd">index&lt;/span>, &lt;span style="color:#58a1dd">args&lt;/span>.&lt;span style="color:#58a1dd">begin&lt;/span>()&lt;span style="color:#ff636f">+&lt;/span>&lt;span style="color:#58a1dd">j&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">S_OK&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ&lt;code>_clientCommandline&lt;/code> ä»…ä»…åªæ˜¯ç®€å•ç›¸åŠ ï¼Œæ²¡æœ‰åšä»»ä½•çš„è½¬ä¹‰ï¼Œä¸€æ—¦æŸä¸€ä¸ªå‚æ•°ä¸­éœ€è¦è½¬ä¹‰å´æœªè½¬ä¹‰ï¼Œåˆ™ä¼šå¯¼è‡´å­è¿›ç¨‹å‘½ä»¤è¡Œä¸é¢„æœŸä¸ç›¸ç¬¦ï¼Œäºæ˜¯æˆ‘ä¾¿æ‰“å¼€äº† Issue: &lt;a href="https://github.com/microsoft/terminal/issues/1090">Bug Report: The conhost command line is not properly escaped #1090 &lt;/a>ï¼Œç”±äºæˆ‘åœ¨å®ç° &lt;a href="https://github.com/M2Team/Privexec">Privexec/wsudo&lt;/a>ï¼Œå·²ç»æœ‰è¿‡æ­¤ç±»ç»éªŒï¼Œè¿˜åœ¨æ­¤ Issue ä¸­æ·»åŠ äº†ä¸€æ®µä»£ç å‘ŠçŸ¥å¦‚ä½•è½¬ä¹‰ï¼Œä½†æœ€åˆ Windows Terminal çš„æ„è§æ˜¯ç›´æ¥ä½¿ç”¨ &lt;code>ConPTY&lt;/code> æ›¿æ¢ &lt;code>Conhost&lt;/code>ï¼Œä¹Ÿå°±æ˜¯çœå»äº†ä½¿ç”¨ Conhost ä½œä¸º ConPTYï¼Œå¥½å§ï¼Œè¿™æœ‰ç‚¹ç»•ï¼Œç›®å‰ Windows Terminal ä¾ç„¶ä½¿ç”¨ Conhost åˆ›å»º ConPTY, ç„¶åï¼ŒWindowsTerminal.exe é€šè¿‡ä¸‰æ¡ç®¡é“è¿æ¥ Conhost.exe åˆ†åˆ«æ˜¯è¾“å…¥è¾“å‡ºå’Œä¿¡å·ç®¡é“ã€‚åˆ›å»º &lt;a href="https://github.com/microsoft/terminal/blob/master/src/inc/conpty.h">Conhost-ConPTY&lt;/a> çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/rprichard/win32-console-docs
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/microsoft/terminal/blob/master/src/server/Entrypoints.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/microsoft/terminal/blob/master/src/cascadia/TerminalConnection/ConptyConnection.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/microsoft/terminal/blob/master/src/server/DeviceComm.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/microsoft/terminal/blob/master/src/cascadia/TerminalConnection/ConhostConnection.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// https://github.com/microsoft/terminal/blob/master/src/inc/conpty.h
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">__declspec&lt;/span>(&lt;span style="color:#58a1dd">noinline&lt;/span>) &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">CreateConPty&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span>&lt;span style="color:#ff636f">&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">cmdline&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">w&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">short&lt;/span> &lt;span style="color:#58a1dd">h&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hInput&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hOutput&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">hSignal&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">PROCESS_INFORMATION&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">piPty&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Create some anon pipes so we can pass handles down and into the console.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// IMPORTANT NOTE:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// We&amp;#39;re creating the pipe here with un-inheritable handles, then marking
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the conhost sides of the pipes as inheritable. We do this because if
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the entire pipe is marked as inheritable, when we pass the handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// to CreateProcess, at some point the entire pipe object is copied to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// the conhost process, which includes the terminal side of the pipes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// (_inPipe and _outPipe). This means that if we die, there&amp;#39;s still
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// outstanding handles to our side of the pipes, and those handles are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// in conhost, despite conhost being unable to reference those handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// and close them.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// CRITICAL: Close our side of the handles. Otherwise you&amp;#39;ll get the same
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// problem if you close conhost, but not us (the terminal).
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HANDLE&lt;/span> &lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SECURITY_ATTRIBUTES&lt;/span> &lt;span style="color:#58a1dd">sa&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> { &lt;span style="color:#a6be9d">0&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">nLength&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">sa&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">bInheritHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">FALSE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">lpSecurityDescriptor&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">hInput&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#58a1dd">hOutput&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Mark inheritable for signal handle when creating. It&amp;#39;ll have the same value on the other side.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">sa&lt;/span>.&lt;span style="color:#58a1dd">bInheritHandle&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">TRUE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CreatePipe&lt;/span>(&lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">hSignal&lt;/span>, &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">sa&lt;/span>, &lt;span style="color:#a6be9d">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetHandleInformation&lt;/span>(&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">HANDLE_FLAG_INHERIT&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">SetHandleInformation&lt;/span>(&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>, &lt;span style="color:#58a1dd">HANDLE_FLAG_INHERIT&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring&lt;/span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;conhost.exe&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --headless&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstringstream&lt;/span> &lt;span style="color:#58a1dd">ss&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">w&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">h&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --width &amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>)&lt;span style="color:#58a1dd">w&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --height &amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ff636f">unsigned&lt;/span> &lt;span style="color:#ff636f">long&lt;/span>)&lt;span style="color:#58a1dd">h&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ss&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; --signal 0x&amp;#34;&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">hex&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">HandleToUlong&lt;/span>(&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">ss&lt;/span>.&lt;span style="color:#58a1dd">str&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34; -- &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">conhostCmdline&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">cmdline&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">STARTUPINFO&lt;/span> &lt;span style="color:#58a1dd">si&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> { &lt;span style="color:#a6be9d">0&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">cb&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">sizeof&lt;/span>(&lt;span style="color:#58a1dd">STARTUPINFOW&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdInput&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdOutput&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">hStdError&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">si&lt;/span>.&lt;span style="color:#58a1dd">dwFlags&lt;/span> &lt;span style="color:#ff636f">|=&lt;/span> &lt;span style="color:#58a1dd">STARTF_USESTDHANDLES&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">unique_ptr&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">wchar_t&lt;/span>[]&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">mutableCommandline&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">make_unique&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">wchar_t&lt;/span>[]&lt;span style="color:#ff636f">&amp;gt;&lt;/span>(&lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">length&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">mutableCommandline&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">E_OUTOFMEMORY&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">HRESULT&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">StringCchCopy&lt;/span>(&lt;span style="color:#58a1dd">mutableCommandline&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>(), &lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">length&lt;/span>() &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">conhostCmdline&lt;/span>.&lt;span style="color:#58a1dd">c_str&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">SUCCEEDED&lt;/span>(&lt;span style="color:#58a1dd">hr&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">hr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">fSuccess&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">!!&lt;/span>&lt;span style="color:#58a1dd">CreateProcessW&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">mutableCommandline&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpProcessAttributes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpThreadAttributes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// bInheritHandles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// dwCreationFlags
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpEnvironment
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpCurrentDirectory
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">si&lt;/span>, &lt;span style="color:#828b96;font-style:italic">// lpStartupInfo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">piPty&lt;/span> &lt;span style="color:#828b96;font-style:italic">// lpProcessInformation
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">inPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">outPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">CloseHandle&lt;/span>(&lt;span style="color:#58a1dd">signalPipeConhostSide&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">fSuccess&lt;/span> &lt;span style="color:#ff636f">?&lt;/span> &lt;span style="color:#58a1dd">S_OK&lt;/span> : &lt;span style="color:#58a1dd">HRESULT_FROM_WIN32&lt;/span>(&lt;span style="color:#58a1dd">GetLastError&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†ç”±äº &lt;a href="https://github.com/microsoft/terminal/issues/1131">Switch from ConhostConnection to the official ConPTY API #1131&lt;/a> ä¾èµ– &lt;a href="https://github.com/microsoft/terminal/issues/1130">&lt;code>winconpty.c&lt;/code>&lt;/a>ï¼Œä½† &lt;code>winconpty.c&lt;/code> è¿Ÿè¿Ÿæ²¡æœ‰å¼€æºï¼Œå› æ­¤ï¼Œæ­¤é—®é¢˜ä¸€ç›´æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œåæ¥éšç€ Windows Terminal çš„å…¬å¼€é¢„è§ˆï¼Œæ­¤é—®é¢˜ä¹Ÿä¸æ–­ç”±ç”¨æˆ·æŠ¥å‘Šã€‚äºæ˜¯æˆ‘æäº¤äº†ä¸€ä¸ª &lt;a href="https://github.com/microsoft/terminal/pull/1815">Fix The conhost command line is not properly escaped&lt;/a>, è¯•å›¾ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œç»è¿‡ä¸€ä¸ªæ˜ŸæœŸçš„ç­‰å¾…ï¼ŒPR ç»ˆäºè¢«åˆå¹¶ï¼Œç›®å‰ä½¿ç”¨æœ€æ–°æºç æ„å»ºçš„ Windows Terminal å·²ç»èƒ½å¤ŸæŒ‰ç…§é¢„æœŸå·¥ä½œï¼Œæˆ‘çš„ Windows Terminal é…ç½®æ–‡ä»¶ä¹Ÿå·²ç»æ›´æ–°ï¼š&lt;a href="https://gist.github.com/fcharlie/7530d36175bc5249f1ae92be536238cd">https://gist.github.com/fcharlie/7530d36175bc5249f1ae92be536238cd&lt;/a>&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜åœ¨ conhost ä¸­éƒ½èƒ½å‡ºç°ï¼Œå¯èƒ½å¹¶ä¸æ˜¯ä¸ªä¾‹ï¼Œé‚£ä¹ˆåº”è¯¥å¾ˆå¤šè½¯ä»¶éƒ½ä¼šå‡ºç°å‘½ä»¤è¡Œæ­£ç¡®è½¬ä¹‰ã€‚&lt;/p>
&lt;h2 id="windows-ucrt-çš„è¿›ç¨‹å¯åŠ¨å‡½æ•°">Windows UCRT çš„è¿›ç¨‹å¯åŠ¨å‡½æ•°&lt;/h2>
&lt;p>åœ¨ Windows ä¸­ï¼Œé€šå¸¸ç¼–å†™ C ç¨‹åºå¯åŠ¨è¿›ç¨‹é™¤äº†ä½¿ç”¨ &lt;code>CreateProcess&lt;/code> API ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ &lt;code>_spawn*&lt;/code> &lt;code>_exec*&lt;/code> ä¹‹ç±»çš„å‡½æ•°ï¼Œä½†åœ¨ Windows 1903ï¼ˆ10.0.18362.0ï¼‰UCRT çš„æºç ä¸­ï¼Œéƒ½æ˜¯è°ƒç”¨ &lt;code>common_spawnvp&lt;/code> å®ç°ï¼Œè€Œå‘½ä»¤è¡Œåˆæˆçš„ä»£ç æ˜¯é€šè¿‡å¦‚ä¸‹å‡½æ•°å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// &amp;#34;C:\Program Files (x86)\Windows Kits\10\Source\10.0.18362.0\ucrt\exec\cenvarg.cpp&amp;#34; +24
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Converts a main()-style argv arguments vector into a command line. On success,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// returns a pointer to the newly constructed arguments block; the caller is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// responsible for freeing the string. On failure, returns null and sets errno.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">template&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#ff636f">typename&lt;/span> &lt;span style="color:#58a1dd">Character&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">static&lt;/span> &lt;span style="color:#58a1dd">errno_t&lt;/span> &lt;span style="color:#ff636f">__cdecl&lt;/span> &lt;span style="color:#58a1dd">construct_command_line&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Character&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">argv&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Character&lt;/span>&lt;span style="color:#ff636f">**&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">command_line_result&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ) &lt;span style="color:#ff636f">throw&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">typedef&lt;/span> &lt;span style="color:#58a1dd">__crt_char_traits&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">Character&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">traits&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">command_line_result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Compute the number of bytes required to store the arguments in argv in a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// command line string (including spaces between arguments and a terminator):
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">command_line_count&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> [&lt;span style="color:#ff636f">&amp;amp;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">Character&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">it&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">argv&lt;/span>; &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">it&lt;/span>; &lt;span style="color:#58a1dd">n&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">traits&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">tcslen&lt;/span>(&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">it&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>) { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// If there were no arguments, return 1 so that we can return an empty
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#828b96;font-style:italic">// string:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">__max&lt;/span>(&lt;span style="color:#58a1dd">n&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">__crt_unique_heap_ptr&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">Character&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">command_line&lt;/span>(&lt;span style="color:#58a1dd">_calloc_crt_t&lt;/span>(&lt;span style="color:#58a1dd">Character&lt;/span>, &lt;span style="color:#58a1dd">command_line_count&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">command_line&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">__acrt_errno_map_os_error&lt;/span>(&lt;span style="color:#58a1dd">ERROR_NOT_ENOUGH_MEMORY&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">errno&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">ENOMEM&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Character&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#ff636f">const&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">source_it&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">argv&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Character&lt;/span>&lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#58a1dd">result_it&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">command_line&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// If there are no arguments, just return the empty string:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">source_it&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\0&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">command_line_result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">command_line&lt;/span>.&lt;span style="color:#58a1dd">detach&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Copy the arguments, separated by spaces:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">while&lt;/span> (&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">source_it&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\0&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">_ERRCHECK&lt;/span>(&lt;span style="color:#58a1dd">traits&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">tcscpy_s&lt;/span>(&lt;span style="color:#58a1dd">result_it&lt;/span>, &lt;span style="color:#58a1dd">command_line_count&lt;/span> &lt;span style="color:#ff636f">-&lt;/span> (&lt;span style="color:#58a1dd">result_it&lt;/span> &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">command_line&lt;/span>.&lt;span style="color:#58a1dd">get&lt;/span>()), &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">source_it&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">result_it&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">traits&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">tcslen&lt;/span>(&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">source_it&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">result_it&lt;/span>&lt;span style="color:#ff636f">++&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39; &amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">++&lt;/span>&lt;span style="color:#58a1dd">source_it&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// Replace the last space with a terminator:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">result_it&lt;/span>[&lt;span style="color:#ff636f">-&lt;/span>&lt;span style="color:#a6be9d">1&lt;/span>] &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">command_line_result&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">command_line&lt;/span>.&lt;span style="color:#58a1dd">detach&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®é™…ä¸Šè¿™ä¸ª UCRT å‡ºç°æ­¤é—®é¢˜ï¼Œä¿®å¤çš„å¯èƒ½æ€§è¦å°äº Windows Terminalï¼Œæ¯•ç«Ÿæ²¡å•¥æ¸ é“ã€‚è¿™å’Œ SSH çš„å‘½ä»¤è¡Œè½¬ä¹‰ä¸€æ ·éš¾ä¿®ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–è½¯ä»¶ä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ &lt;a href="https://github.com/DaanDeMeyer/reproc/issues/18">reproc&lt;/a>ã€‚&lt;/p>
&lt;h2 id="è¯´ä¸å®Œçš„è½¬ä¹‰">è¯´ä¸å®Œçš„è½¬ä¹‰&lt;/h2>
&lt;p>è½¬ä¹‰é—®é¢˜ä¸ä»…ä»…æ˜¯å‘½ä»¤è¡Œéœ€è¦æ³¨æ„çš„ï¼Œåœ¨æŸ¥è¯¢æ•°æ®åº“ï¼Œè§£æç½‘ç»œè¯·æ±‚ï¼Œæ–¹æ–¹é¢é¢éƒ½éœ€è¦æ³¨æ„åˆ°è½¬ä¹‰é—®é¢˜ï¼Œä¸€äº›å®‰å…¨æ¼æ´ä¹Ÿæ˜¯æœ‰ç¼ºä¹è½¬ä¹‰å¯¼è‡´çš„ã€‚å†™ä»£ç è™½æ˜“ï¼Œå†™å¥½ä»£ç éš¾ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜åœ¨ Windows ä¸­å‘ç”Ÿé¢‘ç‡è¾ƒé«˜çš„åŸå› ä¹‹ä¸€æ˜¯åœ¨ Windows è¿›ç¨‹ PEB ä¸­ï¼Œå‘½ä»¤è¡Œä¸ POSIX çš„å‘½ä»¤è¡Œä¿å­˜æ ¼å¼å·®å¼‚ï¼ŒWindows å‘½ä»¤è¡Œå‚æ•°æ˜¯ &lt;code>CommandLine&lt;/code> å½¢å¼ï¼Œè€Œ POSIX ä»¥ Linux ä¸ºä¾‹æ˜¯ &lt;code>Argv&lt;/code>ã€‚å†…å­˜ä¸­å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">wchar_t&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">WinCommandLine&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">L&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">C:&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">Program Files&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">PowerShell&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">7-preview&lt;/span>&lt;span style="color:#a6be9d">\\&lt;/span>&lt;span style="color:#a6be9d">pwsh.exe&lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> -NoExit -Command &lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">$Host.UI.RawUI.WindowTitle=&lt;/span>&lt;span style="color:#a6be9d">\\\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">Windows Pwsh ğŸ’™ (7 Preview)&lt;/span>&lt;span style="color:#a6be9d">\\\&amp;#34;\&amp;#34;\0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">argvblock&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;pwsh&lt;/span>&lt;span style="color:#a6be9d">\0&lt;/span>&lt;span style="color:#a6be9d">-NoExit&lt;/span>&lt;span style="color:#a6be9d">\0&lt;/span>&lt;span style="color:#a6be9d">-Command&lt;/span>&lt;span style="color:#a6be9d">\0\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">$Host.UI.RawUI.WindowTitle=&lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">Windows Pwsh ğŸ’™ (7 Preview)&lt;/span>&lt;span style="color:#a6be9d">\&amp;#34;\0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">//char *const argv[]={0x0100,...};
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› æ­¤ï¼Œä»¥ Argv çš„è¿™ç§å‘½ä»¤è¡Œå½¢å¼åœ¨ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨çœŸæ­£å¯åŠ¨è¿›ç¨‹æ—¶ï¼ŒWindows ä»éœ€è¦ä¸€æ¬¡è½¬æ¢ï¼Œè¿™å°±å®¹æ˜“å¸¦æ¥é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯å‘½ä»¤è¡Œè½¬ä¹‰é—®é¢˜åœ¨ Windows å¹³å°å¤ªæ¯”è¾ƒå¤šçš„åŸå› ã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>Windows Terminal å¼€æºè¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼Œå‚ä¸åˆ°å…¶ä¸­æ”¹è¿›åœ¨ Windows ç³»ç»Ÿçš„å¼€å‘ä½“éªŒæ„Ÿè§‰å¾ˆä¸é”™ï¼Œè€Œå…¶ä¸­çš„ OpenConsole æºç ä¹Ÿè®©æˆ‘æ›´åŠ æ·±å…¥äº†è§£äº† Windows Console çš„ä¸€äº›åŸç†ã€‚&lt;/p>
&lt;p>OpenConsole ç›®å‰å¯ä»¥å¼€å¯ æ³¨å†Œè¡¨é€‰é¡¹ &lt;code>HKCU\Console\UseDx&lt;/code>=&lt;code>DWORD(1)&lt;/code> åˆ‡æ¢åˆ°ä½¿ç”¨ DirectWrite æ¸²æŸ“å­—ä½“ï¼Œä½†æˆ‘ç›®å‰ï¼ˆ2019-07-20ï¼‰æµ‹è¯•è™½ç„¶ä½¿ç”¨ DirectWrite æ¸²æŸ“ï¼Œä½† Emoji æ— æ³•æ˜¾ç¤ºï¼Œè¿™ä¸ªé—®é¢˜æˆ‘å°†è¿›ä¸€æ­¥è·Ÿè¸ªã€‚&lt;/p>
&lt;p>æ§åˆ¶å°å›¢é˜Ÿè¿˜åœ¨ Windows Terminal æºç ä¸­æ·»åŠ äº†ä¸€ä¸ª Console æ§ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç¬¬ä¸‰æ–¹ç¨‹åºä¸­é›†æˆæ§åˆ¶å°çª—å£å°†æ›´åŠ å®¹æ˜“ã€‚Visual Studio &lt;a href="https://github.com/microsoft/WhackWhackTerminal">WhackWhackTerminal&lt;/a> çš„ä½œè€… Daniel Griffen è¿˜å¢åŠ äº†ä¸€äº› PR, å®ç° WPF æ§åˆ¶å°æ§ä»¶ï¼Œè¿™å¯ä»¥é¢„è§ï¼Œå¯èƒ½å°†æ–°çš„æ§åˆ¶å°é›†æˆåˆ° Visual Studioã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€äº›æ§åˆ¶å°çš„æ–‡æ¡£å’Œå…³é”®ä»£ç ï¼š&lt;/p>
&lt;ul>
&lt;li>WinPTY ä½œè€…çš„æ§åˆ¶å°æ–‡æ¡£ï¼š &lt;a href="https://github.com/rprichard/win32-console-docs">Console Handles and Standard Handles&lt;/a>&lt;/li>
&lt;li>Conhost å¯åŠ¨è¿›ç¨‹å¹¶åˆ›å»º ConDrv è®¾å¤‡ï¼š&lt;a href="https://github.com/microsoft/terminal/blob/master/src/server/Entrypoints.cpp">https://github.com/microsoft/terminal/blob/master/src/server/Entrypoints.cpp&lt;/a>&lt;/li>
&lt;li>Conhost è¯»å†™å†…æ ¸å¯¹è±¡(è¯»å†™æ§åˆ¶å°ç¨‹åºçš„è¾“å…¥è¾“å‡º): &lt;a href="https://github.com/microsoft/terminal/blob/master/src/server/DeviceComm.cpp">https://github.com/microsoft/terminal/blob/master/src/server/DeviceComm.cpp&lt;/a>&lt;/li>
&lt;li>Windows Terminal è¿æ¥å™¨ &lt;a href="https://github.com/microsoft/terminal/blob/master/src/cascadia/TerminalConnection/ConptyConnection.cpp">ConptyConnection&lt;/a> åŠ &lt;a href="https://github.com/microsoft/terminal/blob/master/src/cascadia/TerminalConnection/ConhostConnection.cpp">ConhostConnection&lt;/a>&lt;/li>
&lt;/ul>
- https://forcemz.net/posts/2019/2019-07-20-cmdline-escape/ - Copyright (c) 2009-2024 J23</description></item><item><title>ä¸ƒæœˆçš„æŠ€æœ¯åˆ†äº«</title><link>https://forcemz.net/posts/2019/2019-07-09-july-tech-sharing/</link><pubDate>Tue, 09 Jul 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-07-09-july-tech-sharing/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-07-09-july-tech-sharing/ -&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>å†™ä»£ç æ˜¯ä¸€ä¸ªä¸æ–­ç§¯ç´¯çš„è¿‡ç¨‹ï¼Œå°†ä¸€äº›å¥½çš„æƒ³æ³•è½¬å˜ä¸ºè§£å†³å®é™…é—®é¢˜çš„ç¨‹åºé€šå¸¸è®©ç¨‹åºå‘˜æ„Ÿåˆ°æ„‰æ‚¦ã€‚è€Œæœ€è¿‘æˆ‘ä¹Ÿæœ‰ä¸¤ä¸ªè¿˜ç®—å¥½çš„æƒ³æ³•ï¼Œåœ¨æœ¬æ–‡ä¸­åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p>
&lt;h2 id="æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€çš„é…ç½®è§£æ">æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€çš„é…ç½®è§£æ&lt;/h2>
&lt;p>åœ¨ Gitee çš„åŸºç¡€æœåŠ¡ç»„ä»¶ä¸­ï¼Œåƒ Basalt (git ssh æœåŠ¡å™¨)ï¼Œgit-diamond (Gitee å†…éƒ¨çš„ git åè®®æœåŠ¡å™¨)ï¼Œgit-srv (Gitee åˆ†å¸ƒå¼ git ä¼ è¾“åç«¯) éƒ½æ”¯æŒè¿™æ ·å½¢å¼çš„é…ç½®ï¼š &lt;code>${APPDIR}/run/git-srv.pid&lt;/code> ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ&lt;code>APPDIR&lt;/code> è¢«è§£é‡Šæˆç›¸åº”ç»„ä»¶çš„å®‰è£…æ ¹ç›®å½•ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè§£æåˆ° &lt;code>${APPDIR}/run/git-srv.pid&lt;/code> åï¼Œä½¿ç”¨æ¨å¯¼å‡½æ•°ï¼Œå°†å…¶å±•å¼€ä¸º &lt;code>/home/git/oscstudio/run/git-srv.pid&lt;/code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œé»˜è®¤é…ç½®æƒ…å†µä¸‹ï¼ŒGitee çš„è¿™äº›ç»„ä»¶éƒ½æ”¯æŒå®‰è£…åˆ°ä»»æ„ä½ç½®ï¼Œè€Œæ— éœ€åœ¨ç¼–è¯‘æ—¶è®¾ç½® &lt;code>--prefix&lt;/code>ã€‚è€Œåƒ nginx è¿™æ ·çš„è½¯ä»¶ï¼Œåœ¨æ„å»ºæ—¶ï¼Œä½¿ç”¨ &lt;code>--prefix&lt;/code> æŒ‡å®šäº†å®‰è£…ç›®å½•åï¼Œå¦‚æœä¸ä½¿ç”¨ &lt;code>-p&lt;/code> æŒ‡å®š &lt;code>prefix&lt;/code>ï¼Œæ˜¯æ— æ³•å®‰è£…åˆ°ä»»æ„ä½ç½®çš„ã€‚&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œç¯å¢ƒå˜é‡å±•å¼€è¿˜å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†ç¯å¢ƒå˜é‡å±•å¼€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/p>
&lt;p>åœ¨ Golang çš„æºç ä¸­ï¼Œæœ‰ä¸€ä¸ª &lt;a href="https://github.com/golang/go/blob/06ef108cec98b3dfc0fba3f49e733a18eb9badd5/src/os/env.go#L50">&lt;code>os.ExpandEnv&lt;/code>&lt;/a> å‡½æ•°å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æ‰€æœ‰ä»¥æ ¼å¼ &lt;code>${var}&lt;/code> å’Œ &lt;code>$var&lt;/code> çš„å­—ç¬¦ä¸² ï¼Œè€Œè¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯ &lt;code>os.Expand&lt;/code> ä½¿ç”¨ &lt;code>os.GetEnv&lt;/code> çš„ç‰¹ä¾‹ï¼Œå› æ­¤ï¼Œä½ å®Œå…¨å¯ä»¥å°è£…è‡ªå·±çš„ &lt;code>GetEnv&lt;/code>ã€‚åœ¨ &lt;a href="https://gitee.com/oscstudio/gitenv/blob/master/envctx.go">&lt;code>oscstudio/gitenv&lt;/code>&lt;/a> ä¸­ï¼Œæˆ‘ä»¬å°±æœ‰ä¸€ä¸ª &lt;code>Envcontext&lt;/code> ç”¨äºå®ç°ä¸Šè¿° &lt;code>APPDIR&lt;/code> è¿™æ ·çš„ç¯å¢ƒå˜é‡è§£æã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">package&lt;/span> &lt;span style="color:#58a1dd">gitenv&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6be9d">&amp;#34;path/filepath&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Envcontext is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">type&lt;/span> &lt;span style="color:#58a1dd">Envcontext&lt;/span> &lt;span style="color:#ff636f">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Env&lt;/span> &lt;span style="color:#ff636f">map&lt;/span>[&lt;span style="color:#ff636f">string&lt;/span>]&lt;span style="color:#ff636f">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// NewEnvcontext todo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> &lt;span style="color:#58a1dd">NewEnvcontext&lt;/span>() (&lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>, &lt;span style="color:#ff636f">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exe&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Executable&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">err&lt;/span> &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>, &lt;span style="color:#58a1dd">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>{&lt;span style="color:#58a1dd">Env&lt;/span>: &lt;span style="color:#58a1dd">make&lt;/span>(&lt;span style="color:#ff636f">map&lt;/span>[&lt;span style="color:#ff636f">string&lt;/span>]&lt;span style="color:#ff636f">string&lt;/span>)}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exedir&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">filepath&lt;/span>.&lt;span style="color:#58a1dd">Dir&lt;/span>(&lt;span style="color:#58a1dd">exe&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">filepath&lt;/span>.&lt;span style="color:#58a1dd">Base&lt;/span>(&lt;span style="color:#58a1dd">exedir&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;bin&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#a6be9d">&amp;#34;APPDIR&amp;#34;&lt;/span>] = &lt;span style="color:#58a1dd">filepath&lt;/span>.&lt;span style="color:#58a1dd">Dir&lt;/span>(&lt;span style="color:#58a1dd">exedir&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#a6be9d">&amp;#34;APPDIR&amp;#34;&lt;/span>] = &lt;span style="color:#58a1dd">exedir&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ec&lt;/span>, &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Append env
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>) &lt;span style="color:#58a1dd">Append&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">value&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">len&lt;/span>(&lt;span style="color:#58a1dd">value&lt;/span>) &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">errors&lt;/span>.&lt;span style="color:#58a1dd">New&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;Empty key value&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#58a1dd">key&lt;/span>] = &lt;span style="color:#58a1dd">value&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Delete Env
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>) &lt;span style="color:#58a1dd">Delete&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">_&lt;/span>, &lt;span style="color:#58a1dd">ok&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#58a1dd">key&lt;/span>]; &lt;span style="color:#58a1dd">ok&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">delete&lt;/span>(&lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>, &lt;span style="color:#58a1dd">key&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#ff636f">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">fmt&lt;/span>.&lt;span style="color:#58a1dd">Errorf&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;&amp;#39;%s&amp;#39; not exists&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">key&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Expand callback
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>) &lt;span style="color:#58a1dd">Expand&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">_&lt;/span>, &lt;span style="color:#58a1dd">ok&lt;/span> &lt;span style="color:#ff636f">:=&lt;/span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#58a1dd">s&lt;/span>]; &lt;span style="color:#58a1dd">ok&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Env&lt;/span>[&lt;span style="color:#58a1dd">s&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Getenv&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Expandenv is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">func&lt;/span> (&lt;span style="color:#58a1dd">ec&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">Envcontext&lt;/span>) &lt;span style="color:#58a1dd">Expandenv&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span> &lt;span style="color:#ff636f">string&lt;/span>) &lt;span style="color:#ff636f">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">os&lt;/span>.&lt;span style="color:#58a1dd">Expand&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">ec&lt;/span>.&lt;span style="color:#58a1dd">Expand&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿° &lt;code>Envcontext&lt;/code> æ˜¯åŸºäº Golang çš„ï¼Œä½† Gitee å¾ˆå¤šæœåŠ¡æ˜¯åŸºäº C++ ç¼–å†™ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª C++ ç‰ˆæœ¬ï¼Œä¸ºäº†æ”¯æŒå¼‚æ„æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>absl::flat_hash_map&lt;/code> å­˜å‚¨è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†ä¿®æ”¹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª &lt;strong>header-only&lt;/strong> ç‰ˆæœ¬ï¼ˆå€Ÿé‰´äº† Golang çš„æ€è·¯ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">////////
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#828b96;font-style:italic">#ifndef EXPAND_ENV_HPP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#define EXPAND_ENV_HPP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;string_view&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;absl/strings/str_format.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#include&lt;/span> &lt;span style="color:#828b96;font-style:italic">&amp;lt;absl/container/flat_hash_map.h&amp;gt;&lt;/span>&lt;span style="color:#828b96;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">namespace&lt;/span> &lt;span style="color:#58a1dd">env&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">class&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">public&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Derivative&lt;/span>() &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Derivative&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Derivative&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#ff636f">operator&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>) &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">AddBashCompatible&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">argv&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">EraseEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">SetEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>, &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">force&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">PutEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">nv&lt;/span>, &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">force&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">GetEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">ExpandEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">raw&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">w&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">disableos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">private&lt;/span>&lt;span style="color:#ff636f">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">AppendEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">w&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">flat_hash_map&lt;/span>&lt;span style="color:#ff636f">&amp;lt;&lt;/span>&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>&lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">namespace&lt;/span> &lt;span style="color:#58a1dd">env_internal&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">is_shell_specia_var&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;*&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;#&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;$&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;@&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;!&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;?&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;-&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;0&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;9&amp;#39;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">is_alphanum&lt;/span>(&lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;_&amp;#39;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;0&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;9&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">||&lt;/span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;z&amp;#39;&lt;/span>) &lt;span style="color:#ff636f">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;gt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">ch&lt;/span> &lt;span style="color:#ff636f">&amp;lt;=&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;Z&amp;#39;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">resovle_shell_name&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>, &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">off&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">front&lt;/span>() &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;{&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;gt;&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">is_shell_specia_var&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#a6be9d">1&lt;/span>]) &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#a6be9d">2&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;}&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#a6be9d">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>(); &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;}&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">1&lt;/span>, &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">is_shell_specia_var&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#a6be9d">0&lt;/span>])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#a6be9d">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">is_alphanum&lt;/span>(&lt;span style="color:#58a1dd">s&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>]); &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">s&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">i&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">os_expand_env&lt;/span>(&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">value&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">v&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">getenv&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>.&lt;span style="color:#58a1dd">data&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">v&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#ff636f">nullptr&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">value&lt;/span>.&lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">v&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#828b96;font-style:italic">// namespace env_internal
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">AddBashCompatible&lt;/span>(&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>, &lt;span style="color:#ff636f">char&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#ff636f">const&lt;/span> &lt;span style="color:#ff636f">*&lt;/span>&lt;span style="color:#58a1dd">argv&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// $0~$N
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#ff636f">int&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">argc&lt;/span>; &lt;span style="color:#58a1dd">i&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">emplace&lt;/span>(&lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">AlphaNum&lt;/span>(&lt;span style="color:#58a1dd">i&lt;/span>).&lt;span style="color:#58a1dd">Piece&lt;/span>(), &lt;span style="color:#58a1dd">argv&lt;/span>[&lt;span style="color:#58a1dd">i&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">emplace&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;$&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">absl&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">AlphaNum&lt;/span>(&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">getpid&lt;/span>()).&lt;span style="color:#58a1dd">Piece&lt;/span>()); &lt;span style="color:#828b96;font-style:italic">// current process PID
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">EraseEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">erase&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>) &lt;span style="color:#ff636f">!=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">SetEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">value&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">force&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">force&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">// envblock[key] = value;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">insert_or_assign&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">value&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">emplace&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">value&lt;/span>).&lt;span style="color:#58a1dd">second&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">PutEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">nv&lt;/span>, &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">force&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">nv&lt;/span>.&lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#a6be9d">&amp;#39;=&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">wstring_view&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">npos&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">SetEnv&lt;/span>(&lt;span style="color:#58a1dd">nv&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#58a1dd">force&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">SetEnv&lt;/span>(&lt;span style="color:#58a1dd">nv&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#a6be9d">0&lt;/span>, &lt;span style="color:#58a1dd">pos&lt;/span>), &lt;span style="color:#58a1dd">nv&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#58a1dd">pos&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>), &lt;span style="color:#58a1dd">force&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">[[nodiscard]]&lt;/span> &lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">GetEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">it&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">it&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">end&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">it&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">second&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">AppendEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">key&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">w&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">it&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">find&lt;/span>(&lt;span style="color:#58a1dd">key&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">it&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#58a1dd">envblock&lt;/span>.&lt;span style="color:#58a1dd">end&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">it&lt;/span>&lt;span style="color:#ff636f">-&amp;gt;&lt;/span>&lt;span style="color:#58a1dd">second&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">// Expand Env string to normal string only support Unix style&amp;#39;${KEY}&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>&lt;span style="color:#ff636f">inline&lt;/span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">Derivative&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">ExpandEnv&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string_view&lt;/span> &lt;span style="color:#58a1dd">raw&lt;/span>, &lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&lt;/span>&lt;span style="color:#58a1dd">w&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">bool&lt;/span> &lt;span style="color:#58a1dd">disableos&lt;/span>) &lt;span style="color:#ff636f">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">reserve&lt;/span>(&lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>() &lt;span style="color:#ff636f">*&lt;/span> &lt;span style="color:#a6be9d">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">for&lt;/span> (&lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>; &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>(); &lt;span style="color:#58a1dd">j&lt;/span>&lt;span style="color:#ff636f">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">raw&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>] &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">&amp;#39;$&amp;#39;&lt;/span> &lt;span style="color:#ff636f">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span> &lt;span style="color:#ff636f">&amp;lt;&lt;/span> &lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">size&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#58a1dd">i&lt;/span>, &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">-&lt;/span> &lt;span style="color:#58a1dd">i&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">size_t&lt;/span> &lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">auto&lt;/span> &lt;span style="color:#58a1dd">name&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">env_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">resovle_shell_name&lt;/span>(&lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>), &lt;span style="color:#58a1dd">off&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">name&lt;/span>.&lt;span style="color:#58a1dd">empty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">off&lt;/span> &lt;span style="color:#ff636f">==&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">push_back&lt;/span>(&lt;span style="color:#58a1dd">raw&lt;/span>[&lt;span style="color:#58a1dd">j&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">AppendEnv&lt;/span>(&lt;span style="color:#58a1dd">name&lt;/span>, &lt;span style="color:#58a1dd">w&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#ff636f">!&lt;/span>&lt;span style="color:#58a1dd">disableos&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">env_internal&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">os_expand_env&lt;/span>(&lt;span style="color:#58a1dd">std&lt;/span>&lt;span style="color:#ff636f">::&lt;/span>&lt;span style="color:#58a1dd">string&lt;/span>(&lt;span style="color:#58a1dd">name&lt;/span>), &lt;span style="color:#58a1dd">w&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">+=&lt;/span> &lt;span style="color:#58a1dd">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">i&lt;/span> &lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#58a1dd">j&lt;/span> &lt;span style="color:#ff636f">+&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">w&lt;/span>.&lt;span style="color:#58a1dd">append&lt;/span>(&lt;span style="color:#58a1dd">raw&lt;/span>.&lt;span style="color:#58a1dd">substr&lt;/span>(&lt;span style="color:#58a1dd">i&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">return&lt;/span> &lt;span style="color:#58a1dd">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#828b96;font-style:italic">// namespace env
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª &lt;code>Derivative&lt;/code> ç±»æ˜¯æˆ‘å€Ÿé‰´ &lt;code>Golang&lt;/code> å…ˆåœ¨ bela ä¸­å®ç°çš„ï¼Œåœ¨ bela ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† &lt;a href="https://github.com/greg7mdp/parallel-hashmap">parallel-hashmap&lt;/a> ä½œä¸ºç¯å¢ƒå˜é‡å®¹å™¨ï¼Œå¹¶ä¸”æä¾›äº†æ”¯æŒ &lt;code>std::wstring&lt;/code> å¼‚æ„æŸ¥æ‰¾çš„&lt;a href="https://github.com/fcharlie/bela/blob/master/include/bela/phmap/std_wstring.patch">è¡¥ä¸&lt;/a>ã€‚å¹¶ä¸”è¿˜ä½¿ç”¨ &lt;code>parallel_flat_hash_map&lt;/code> å®ç°äº†çº¿ç¨‹å®‰å…¨çš„ &lt;code>DerivativeMT&lt;/code>ï¼Œæµ‹è¯•æ— è¯¯åå°†å…¶ç§»æ¤åˆ°åˆ° Gitee çš„é¡¹ç›®ä¸­ã€‚&lt;/p>
&lt;p>&lt;strong>2019-07-10&lt;/strong> &lt;a href="https://github.com/greg7mdp">Gregory Popovitch&lt;/a> æ¥å—äº†æˆ‘çš„ &lt;a href="https://github.com/greg7mdp/parallel-hashmap/pull/15">PR&lt;/a>ï¼Œç›®å‰å·²ç»ä½¿ç”¨å®˜æ–¹çš„ &lt;code>parallel-hashmap&lt;/code> ä½œä¸º Bela çš„ç¯å¢ƒå˜é‡å®¹å™¨ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦åœ¨ Windows ä¸­ä½¿ç”¨ &lt;code>Derivative&lt;/code>ï¼Œå»ºè®®ä½¿ç”¨ &lt;a href="https://github.com/fcharlie/bela/blob/master/include/bela/env.hpp">&lt;code>bela&lt;/code>&lt;/a>ï¼Œå…¶ä»–ç¯å¢ƒå¯ä»¥ä½¿ç”¨è¿™ä¸ª &lt;code>header-only&lt;/code> ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="å¯å›æ»šçš„-shell-è‡ªè§£å‹å®‰è£…åŒ…">å¯å›æ»šçš„ Shell è‡ªè§£å‹å®‰è£…åŒ…&lt;/h2>
&lt;p>æˆ‘åœ¨ Gitee å¼€å‘ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œé™¤äº†è¦ä¸º Gitee å…¬æœ‰äº‘æä¾›æŠ€æœ¯æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¸ºç§æœ‰åŒ–æä¾›æŠ€æœ¯æ”¯æŒï¼Œå› æ­¤ï¼Œè¿™äº›åŸºç¡€ç»„ä»¶å¦‚è‹¥èƒ½é™æ€ç¼–è¯‘ï¼Œè§£å‹åç›´æ¥è¿è¡Œæ˜¯æœ€ç®€å•ä¸è¿‡çš„ï¼Œä½†æ˜¯å½“å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œå‡çº§è½¯ä»¶æ—¶ï¼Œå´ä¸å¾—ä¸è€ƒè™‘é…ç½®æ˜¯å¦è¦†ç›–ï¼Œå¦‚ä½•æ”¯æŒäºŒè¿›åˆ¶å›æ»šçš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬ä½¿ç”¨ cmake ä½œä¸ºæ„å»ºç³»ç»Ÿæ—¶ï¼Œcmake æ‹¥æœ‰æ‰“åŒ…å·¥å…· &lt;code>cpack&lt;/code>ï¼Œåœ¨ Linux ä¸­ï¼Œ&lt;code>cpack&lt;/code> å¯ä»¥æ‰“åŒ…ä¸€ä¸ª &lt;code>STGZ&lt;/code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æœ‰äº›ç‰¹åˆ«ï¼Œæ–‡ä»¶å‰éƒ¨æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œåé¢åˆ™æ˜¯ä¸€ä¸ª &lt;code>tar.gz&lt;/code> æ–‡ä»¶ï¼Œå½“æ‰§è¡Œæ­¤æ–‡ä»¶å‰éƒ¨çš„è„šæœ¬æ—¶ï¼Œè„šæœ¬ä¼šè¯»å–æ–‡ä»¶ä¸­ &lt;code>.tar.gz&lt;/code> æ–‡ä»¶çš„åç§»ï¼Œä»¥ç®¡é“çš„æ–¹å¼è°ƒç”¨ &lt;code>tar&lt;/code> è§£å‹ã€‚è¿™æ ·å°±å®ç°äº†å®‰è£…ã€‚&lt;code>cmake&lt;/code> ä½¿ç”¨ä¸€ä¸ªåä¸ºï¼š&lt;a href="https://github.com/Kitware/CMake/blob/master/Modules/CPack.STGZ_Header.sh.in">CPack.STGZ_Header.sh.in&lt;/a> çš„æ¨¡æ¿ï¼Œå¦‚æœè¦å®‰è£…åæ‰§è¡Œç‰¹å®šçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥åœ¨é¡¹ç›®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¿®æ”¹åçš„ &lt;code>CPack.STGZ_Header.sh.in&lt;/code> è¦†ç›– cmake è‡ªèº«çš„æ¨¡æ¿å³å¯ã€‚&lt;/p>
&lt;p>åœ¨ cmake ä¸­ï¼Œé…ç½®æ–‡ä»¶çš„å®‰è£…æ”¯æŒ &lt;code>RENAME&lt;/code>ï¼Œä½† &lt;code>target&lt;/code> æš‚ä¸æ”¯æŒ &lt;code>RENAME&lt;/code>ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† target ä¿®æ”¹ä¸ºåŸæ¥çš„ &lt;code>$TARGET_NAME.new&lt;/code>ï¼Œåœ¨è§£å‹åˆ°å®‰è£…ç›®å½•åï¼Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ£€æµ‹ç›¸åº”çš„ target æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨åˆ™é‡å‘½åï¼Œç„¶åå°† &lt;code>$TARGET_NAME.new&lt;/code> é‡å‘½åä¸º &lt;code>$TARGET_NAME&lt;/code>ï¼Œè¿™æ ·ä¾¿èƒ½å¤Ÿæ”¯æŒäºŒè¿›åˆ¶å›æ»šã€‚é…ç½®æ–‡ä»¶é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿è¡Œ diff å»æ£€æµ‹é…ç½®æ–‡ä»¶å“ªé‡Œå‘ç”Ÿäº†ä¿®æ”¹ï¼Œæç¤ºç”¨æˆ·æ›´æ–°ã€‚&lt;/p>
&lt;p>åœ¨ Gitee ä¸­ï¼Œæœ‰ä¸€äº›é¡¹ç›®åŸºäº Golang ç¼–å†™ï¼Œè€Œ cmake ç›®å‰å¹¶ä¸æ”¯æŒ golangï¼Œè™½ç„¶ä½¿ç”¨ cmake å¯ä»¥æ‰“åŒ…ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›éº»çƒ¦ï¼Œå®é™…ä¸Šç¼–å†™ stgz æ„å»ºè„šæœ¬éå¸¸ç®€å•ï¼Œç›¸åº”è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>ä¸»æ„å»ºè„šæœ¬ï¼ˆbaliï¼šæˆ‘ä½¿ç”¨ &lt;a href="https://github.com/fcharlie/bali">https://github.com/fcharlie/bali&lt;/a> ä½œä¸º Golang é¡¹ç›®çš„æ„å»ºè½¯ä»¶ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#!/usr/bin/env pwsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">param&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">ValidateSet&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;linux&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;drawin&amp;#34;&lt;/span>, &lt;span style="color:#a6be9d">&amp;#34;windows&amp;#34;&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">Alias&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;T&amp;#34;&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$Target&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;linux&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">String&lt;/span>]&lt;span style="color:#58a1dd">$Arch&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;amd64&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">Alias&lt;/span>(&lt;span style="color:#a6be9d">&amp;#34;h&amp;#34;&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#58a1dd">Switch&lt;/span>]&lt;span style="color:#58a1dd">$Help&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$Help&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;charlie&amp;#39;s mkstgz script tools
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> -T|--target target name, Linux, macOS, Windows
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> -h|--help print usage and exit.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$BALIUTILS&lt;/span> = &lt;span style="color:#58a1dd">Get-Command&lt;/span> &lt;span style="color:#58a1dd">-CommandType&lt;/span> &lt;span style="color:#58a1dd">Application&lt;/span> &lt;span style="color:#58a1dd">bali&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$BALIUTILS&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Please install bali to allow mkstgz&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$AppDir&lt;/span> = &lt;span style="color:#58a1dd">Split-Path&lt;/span> &lt;span style="color:#58a1dd">-Parent&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$result&lt;/span> = &lt;span style="color:#58a1dd">Start-Process&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;bali&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-ArgumentList&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;-t &lt;/span>&lt;span style="color:#58a1dd">$Target&lt;/span>&lt;span style="color:#a6be9d"> -Arch &lt;/span>&lt;span style="color:#58a1dd">$Arch&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WorkingDirectory&lt;/span> &lt;span style="color:#58a1dd">$AppDir&lt;/span> &lt;span style="color:#58a1dd">-NoNewWindow&lt;/span> &lt;span style="color:#58a1dd">-Wait&lt;/span> &lt;span style="color:#58a1dd">-PassThru&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$result&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;bali build MyPackage failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$Baliobj&lt;/span> = &lt;span style="color:#58a1dd">Get-Content&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/bali.json&amp;#34;&lt;/span> | &lt;span style="color:#58a1dd">ConvertFrom-Json&lt;/span> &lt;span style="color:#58a1dd">-ErrorAction&lt;/span> &lt;span style="color:#58a1dd">SilentlyContinue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Baliobj&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;parse &lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/bali.json failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$null&lt;/span> &lt;span style="color:#ff636f">-eq&lt;/span> &lt;span style="color:#58a1dd">$Baliobj&lt;/span>.&lt;span style="color:#58a1dd">version&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$version&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$version&lt;/span> = &lt;span style="color:#58a1dd">$Baliobj&lt;/span>.&lt;span style="color:#58a1dd">version&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;The version of MyPackage detected is: &lt;/span>&lt;span style="color:#58a1dd">$version&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Get-ChildItem&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/build/bin&amp;#34;&lt;/span> | &lt;span style="color:#58a1dd">ForEach-Object&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Rename-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#58a1dd">$_&lt;/span>.&lt;span style="color:#58a1dd">FullName&lt;/span> &lt;span style="color:#58a1dd">-NewName&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>$(&lt;span style="color:#58a1dd">$_&lt;/span>.&lt;span style="color:#58a1dd">FullName&lt;/span>)&lt;span style="color:#a6be9d">.new&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Get-ChildItem&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/build/config&amp;#34;&lt;/span> | &lt;span style="color:#58a1dd">ForEach-Object&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Rename-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#58a1dd">$_&lt;/span>.&lt;span style="color:#58a1dd">FullName&lt;/span> &lt;span style="color:#58a1dd">-NewName&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>$(&lt;span style="color:#58a1dd">$_&lt;/span>.&lt;span style="color:#58a1dd">FullName&lt;/span>)&lt;span style="color:#a6be9d">.template&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Copy-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>&lt;span style="color:#a6be9d">/post_install.sh&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Destination&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/build/bin/post_install.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$TarDistPath&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/MyPackage-&lt;/span>&lt;span style="color:#58a1dd">$Target&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$Arch&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$version&lt;/span>&lt;span style="color:#a6be9d">.tar.gz&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$StgzDistPath&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/MyPackage-&lt;/span>&lt;span style="color:#58a1dd">$Target&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$Arch&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$version&lt;/span>&lt;span style="color:#a6be9d">.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$StgzFileName&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;MyPackage-&lt;/span>&lt;span style="color:#58a1dd">$Target&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$Arch&lt;/span>&lt;span style="color:#a6be9d">-&lt;/span>&lt;span style="color:#58a1dd">$version&lt;/span>&lt;span style="color:#a6be9d">.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Compress MyPackage to &lt;/span>&lt;span style="color:#58a1dd">$TarDistPath&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$TarArg&lt;/span> = &lt;span style="color:#a6be9d">&amp;#34;-czf &lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TarDistPath&lt;/span>&lt;span style="color:#a6be9d">`&amp;#34;&lt;/span>&lt;span style="color:#a6be9d"> .&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">$TarStatus&lt;/span> = &lt;span style="color:#58a1dd">Start-Process&lt;/span> &lt;span style="color:#58a1dd">-FilePath&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;tar&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-ArgumentList&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TarArg&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-WorkingDirectory&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$AppDir&lt;/span>&lt;span style="color:#a6be9d">/build&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Wait&lt;/span> &lt;span style="color:#58a1dd">-NoNewWindow&lt;/span> &lt;span style="color:#58a1dd">-PassThru&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> (&lt;span style="color:#58a1dd">$TarStatus&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span> &lt;span style="color:#ff636f">-ne&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#58a1dd">$TarStatus&lt;/span>.&lt;span style="color:#58a1dd">ExitCode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Copy-Item&lt;/span> &lt;span style="color:#58a1dd">-Path&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$PSScriptRoot&lt;/span>&lt;span style="color:#a6be9d">/stgz.sh&amp;#34;&lt;/span> &lt;span style="color:#58a1dd">-Destination&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$StgzDistPath&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Create a self-extracting file for MyPackage`: &lt;/span>&lt;span style="color:#58a1dd">$StgzDistPath&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$writer&lt;/span> = &lt;span style="color:#58a1dd">New-Object&lt;/span> &lt;span style="color:#58a1dd">System&lt;/span>.&lt;span style="color:#58a1dd">IO&lt;/span>.&lt;span style="color:#58a1dd">FileStream&lt;/span>(&lt;span style="color:#58a1dd">$StgzDistPath&lt;/span>, [&lt;span style="color:#58a1dd">System.IO.FileMode&lt;/span>]::&lt;span style="color:#58a1dd">Append&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">catch&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;unable open &lt;/span>&lt;span style="color:#58a1dd">$StgzDistPath&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$reader&lt;/span> = &lt;span style="color:#58a1dd">New-Object&lt;/span> &lt;span style="color:#58a1dd">System&lt;/span>.&lt;span style="color:#58a1dd">IO&lt;/span>.&lt;span style="color:#58a1dd">FileStream&lt;/span>(&lt;span style="color:#58a1dd">$TarDistPath&lt;/span>, [&lt;span style="color:#58a1dd">System.IO.FileMode&lt;/span>]::&lt;span style="color:#58a1dd">Open&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">catch&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$writer&lt;/span>.&lt;span style="color:#58a1dd">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#58a1dd">-ForegroundColor&lt;/span> &lt;span style="color:#58a1dd">Red&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;unable open &lt;/span>&lt;span style="color:#58a1dd">$TarDistPath&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$reader&lt;/span>.&lt;span style="color:#58a1dd">CopyTo&lt;/span>(&lt;span style="color:#58a1dd">$writer&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$writer&lt;/span>.&lt;span style="color:#58a1dd">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">$reader&lt;/span>.&lt;span style="color:#58a1dd">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#58a1dd">char&lt;/span>]&lt;span style="color:#58a1dd">$Esc&lt;/span> = &lt;span style="color:#58a1dd">0x1b&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">Write-Host&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$Esc&lt;/span>&lt;span style="color:#a6be9d">[32mPackaged successfully&lt;/span>&lt;span style="color:#58a1dd">$Esc&lt;/span>&lt;span style="color:#a6be9d">[0m
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">Your can run &amp;#39;&lt;/span>&lt;span style="color:#58a1dd">$StgzFileName&lt;/span>&lt;span style="color:#a6be9d"> --prefix=/path/to/MyPackage&amp;#39; to install MyPackage&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>STGZ æ–‡ä»¶å¤´éƒ¨ï¼ˆstgz.shï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic"># Display usage&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stgz_usage&lt;span style="color:#ff636f">()&lt;/span> &lt;span style="color:#ff636f">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cat &lt;span style="color:#a6be9d">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">Usage: $0 [options]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">Options: [defaults in brackets after descriptions]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> --help print this message
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> --version print cmake installer version
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d"> --prefix=dir directory in which to install
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6be9d">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stgz_fix_slashes&lt;span style="color:#ff636f">()&lt;/span> &lt;span style="color:#ff636f">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> | sed &lt;span style="color:#a6be9d">&amp;#39;s/\\/\//g&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stgz_echo_exit&lt;span style="color:#ff636f">()&lt;/span> &lt;span style="color:#ff636f">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">for&lt;/span> a in &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$@&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>; &lt;span style="color:#ff636f">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$a&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> | grep &lt;span style="color:#a6be9d">&amp;#34;^--prefix=&amp;#34;&lt;/span> &amp;gt;/dev/null 2&amp;gt;/dev/null; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">stgz_prefix_dir&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">a&lt;/span>/--prefix=&lt;span style="color:#a6be9d">\/&lt;/span>//&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">stgz_prefix_dir&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>stgz_fix_slashes &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">stgz_prefix_dir&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$a&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> | grep &lt;span style="color:#a6be9d">&amp;#34;^--help&amp;#34;&lt;/span> &amp;gt;/dev/null 2&amp;gt;/dev/null; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stgz_usage
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;This is a self-extracting archive.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>&lt;span style="color:#58a1dd">pwd&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;x&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">stgz_prefix_dir&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> !&lt;span style="color:#ff636f">=&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;x&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">stgz_prefix_dir&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;The archive will be extracted to: &lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[&lt;/span> ! -d &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mkdir -p &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#ff636f">||&lt;/span> &lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Using traget directory: &lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Extracting, please wait...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">ARCHIVE&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>awk &lt;span style="color:#a6be9d">&amp;#39;/^__ARCHIVE_BELOW__/ {print NR + 1; exit 0; }&amp;#39;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tail &lt;span style="color:#a6be9d">&amp;#34;-n+&lt;/span>&lt;span style="color:#58a1dd">$ARCHIVE&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> | tar xzvm -C &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$toplevel&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &amp;gt;/dev/null 2&amp;gt;&amp;amp;&lt;span style="color:#a6be9d">1&lt;/span> 3&amp;gt;&amp;amp;&lt;span style="color:#a6be9d">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">/bin/post_install.sh&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> chmod +x &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">/bin/post_install.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bash &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">/bin/post_install.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">exit&lt;/span> &lt;span style="color:#a6be9d">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#This line must be the last line of the file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>__ARCHIVE_BELOW__
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®‰è£…åæ‰§è¡Œçš„ &lt;code>post-install.sh&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#828b96;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">BINPATH&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>dirname &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$0&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">BINPATH&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>realpath &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BINPATH&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">CONFIGPATH&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>realpath &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BINPATH&lt;/span>&lt;span style="color:#a6be9d">/../config&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#58a1dd">toplevel&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>realpath &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BINPATH&lt;/span>&lt;span style="color:#a6be9d">/../&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stgz_apply_target&lt;span style="color:#ff636f">()&lt;/span> &lt;span style="color:#ff636f">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;apply target &lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d"> &lt;/span>&lt;span style="color:#58a1dd">$2&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NEWNAME&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>basename &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NAME&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">NEWNAME&lt;/span>:&lt;span style="color:#58a1dd">0&lt;/span>:&lt;span style="color:#58a1dd">0&lt;/span>-4&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NBDIR&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$2&lt;/span>&lt;span style="color:#a6be9d">/bin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">TARGETFILE&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> ! -d &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mkdir -p &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.3&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rm &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.2&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.2&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.1&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.1&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.old&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.old&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NBDIR&lt;/span>&lt;span style="color:#a6be9d">/old/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#828b96;font-style:italic">###&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TARGETFILE&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TARGETFILE&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TARGETFILE&lt;/span>&lt;span style="color:#a6be9d">.old&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TARGETFILE&lt;/span>&lt;span style="color:#a6be9d">.new&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$TARGETFILE&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stgz_apply_config&lt;span style="color:#ff636f">()&lt;/span> &lt;span style="color:#ff636f">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;Install config &lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d"> to &lt;/span>&lt;span style="color:#58a1dd">$2&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NEWNAME&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#ff636f">$(&lt;/span>basename &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#ff636f">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NAME&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">NEWNAME&lt;/span>:&lt;span style="color:#58a1dd">0&lt;/span>:&lt;span style="color:#58a1dd">0&lt;/span>-9&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">NCDIR&lt;/span>&lt;span style="color:#ff636f">=&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$2&lt;/span>&lt;span style="color:#a6be9d">/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> ! -d &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mkdir -p &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">if&lt;/span> &lt;span style="color:#ff636f">[[&lt;/span> -f &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#ff636f">]]&lt;/span>; &lt;span style="color:#ff636f">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;File &lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d"> exists in &lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> git --no-pager diff --no-index &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;rename &lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d"> to &lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$1&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$NCDIR&lt;/span>&lt;span style="color:#a6be9d">/&lt;/span>&lt;span style="color:#58a1dd">$NAME&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff636f">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">for&lt;/span> file in &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BINPATH&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>/*.new; &lt;span style="color:#ff636f">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;apply &lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">file&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stgz_apply_target &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#a6be9d">${&lt;/span>&lt;span style="color:#58a1dd">file&lt;/span>&lt;span style="color:#a6be9d">}&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$toplevel&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">for&lt;/span> file in &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$CONFIGPATH&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>/*.template; &lt;span style="color:#ff636f">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#58a1dd">echo&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;apply &lt;/span>&lt;span style="color:#58a1dd">$file&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stgz_apply_config &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$file&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span> &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$toplevel&lt;/span>&lt;span style="color:#a6be9d">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff636f">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm &lt;span style="color:#a6be9d">&amp;#34;&lt;/span>&lt;span style="color:#58a1dd">$BINPATH&lt;/span>&lt;span style="color:#a6be9d">/post_install.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šä¸‰ä¸ªè„šæœ¬å°±å¯ä»¥åƒ bali æ„å»ºçš„é¡¹ç›®æ‰“åŒ…æˆ &lt;code>STGZ&lt;/code> æ–‡ä»¶ï¼Œè¿è¡Œ &lt;code>MyPackage-$Target-$Arch-$version.sh --prefix=/path/to/MyPackage&lt;/code> åå°±å¯ä»¥äº†ï¼Œä¸ä¼šè¦†ç›–é…ç½®è¿˜æ”¯æŒäºŒè¿›åˆ¶å›æ»šï¼Œè¿™å¯¹äºéœ€è¦å¹³æ»‘é‡å¯çš„ä¸šåŠ¡æ¥è¯´è¿˜æ˜¯æœ‰ä¸€äº›å¸®åŠ©çš„ã€‚&lt;/p>
&lt;h2 id="æœ€å">æœ€å&lt;/h2>
&lt;p>æ²¡ä»€ä¹ˆå¯è¯´çš„äº†ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-07-09-july-tech-sharing/ - Copyright (c) 2009-2024 J23</description></item><item><title>åå’Œæ”¾å®½ - æ‚¨çš„è®¡ç®—æœºéœ€è¦æ›´æ–°</title><link>https://forcemz.net/posts/2019/2019-06-25-talk-computer-update/</link><pubDate>Tue, 25 Jun 2019 10:00:00 +0800</pubDate><guid>https://forcemz.net/posts/2019/2019-06-25-talk-computer-update/</guid><description>æ±ŸäºŒåä¸‰çš„æ€è€ƒ https://forcemz.net/posts/2019/2019-06-25-talk-computer-update/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>ä»Šå¤©åœ¨å¾®åšä¸Šçœ‹åˆ°äº†æ–°æµªç§‘æŠ€çš„ä¸€ç¯‡å¾®åšï¼Œå…¶ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>#åˆ›äº‹è®°#ã€ç”¨ä¸èƒœå…¶çƒ¦çš„updateï¼Œå°†Windowsç”¨æˆ·æ†ç»‘ä¸Šæœªæ¥æˆ˜è½¦ã€‘ç½‘å‹è‹¦Windowsä¹…çŸ£ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒWindows Updateæ˜¯å¾ˆçƒ¦äººçš„æ›´æ–°ï¼Œå…¶ä¸­ä»¥win10çš„ç”¨æˆ·æœ€ä¸ºæ°´æ·±ç«çƒ­ã€‚ç›®å‰çœ‹æ¥ï¼Œç”¨æˆ·è¿˜éœ€è¦åœ¨ä¸€æ¬¡æ¬¡æ¼«é•¿è€Œçç¢çš„æ›´æ–°å‡çº§ä¸­ç­‰å¾…ï¼Œè€Œæ—¶ä»£çš„æ´ªæµç»ˆä¼šèœ¿èœ’åœ°ä¹¦å†™å‡ºå¾®è½¯çš„å¯¹ä¸é”™ã€‚@è„‘æä½“Unity Windowsä¸èƒœå…¶çƒ¦çš„update&lt;/p>
&lt;/blockquote>
&lt;p>é“¾æ¥ä¸ºï¼š&lt;a href="https://m.weibo.cn/status/4385983862343989">https://m.weibo.cn/status/4385983862343989&lt;/a>ã€‚&lt;/p>
&lt;p>åœ¨è¿™ç‰‡å¾®åšä¸­ï¼Œæ–°æµªç§‘æŠ€ç«Ÿç„¶èƒ½è¯´å‡º â€œç½‘å‹è‹¦Windowsä¹…çŸ£â€ è¿™ç§è¯ï¼Œæˆ‘åªå¬è¯´è¿‡â€œå¤©ä¸‹è‹¦ç§¦ä¹…çŸ£â€å’Œâ€œæ¶ˆè´¹è€…è‹¦è”æƒ³ä¹…çŸ£â€ï¼Œè¿™ä¸ªçœŸçš„æ˜¯è¿‡åˆ†çš„æŒ‡è´£ã€‚å›½å†…çš„ç§‘æŠ€åª’ä½“åœ¨æŠ€æœ¯ç´ å…»ä¸Šæ€èƒ½æœ‰å¦‚æ­¤çš„è®¤è¯†ï¼ç§‘æŠ€åª’ä½“å°šä¸”å¦‚æ­¤ï¼Œé‚£ä¹ˆå¤§ä¼—çš„å¯¹äºè½¯ä»¶æ›´æ–°å¯èƒ½å°±åŸºæœ¬æ²¡å•¥ç§¯æçš„çœ‹æ³•äº†ã€‚2017-2018 å¹´&lt;strong>æ°¸æ’ä¹‹è“&lt;/strong>å‹’ç´¢ç—…æ¯’è‚†è™çš„ç»å†è¿˜å†å†åœ¨ç›®ï¼Œè€Œè¢«æ„ŸæŸ“çš„æœºå™¨åŸºæœ¬ä¸Šéƒ½æ˜¯æœªå®‰è£…è¡¥ä¸ï¼ˆåŒ…æ‹¬å·²ç»åœæ­¢æŠ€æœ¯æ”¯æŒçš„ XP ç³»ç»Ÿï¼‰çš„æ“ä½œç³»ç»Ÿã€‚å¯¹è½¯ä»¶æ›´æ–°æ²¡æœ‰ä¸€ä¸ªæ¸…é†’çš„è®¤è¯†ï¼Œè¿™ä¿¡æ¯åŒ–æ€¥é€Ÿå‘å±•çš„æ—¶ä»£æ—¶éå¸¸å±é™©çš„ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°è¿‘å‡ å¹´ç½‘ç»œçŠ¯ç½ªçš„å±‚å‡ºä¸ç©·ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹è®¡ç®—æœºæ¼æ´å‘èµ·çš„ç½‘ç»œçŠ¯ç½ªã€‚æ‰€ä»¥ï¼ŒåŠæ—¶çš„æŸ¥æ¼è¡¥ç¼ºéå¸¸æœ‰å¿…è¦ï¼Œè€Œæœ¬æ–‡ä¹Ÿå°±è¦æ¥è®¨è®ºè½¯ä»¶çš„æ›´æ–°é—®é¢˜ã€‚&lt;/p>
&lt;h1 id="è½¯ä»¶çš„æ›´æ–°">è½¯ä»¶çš„æ›´æ–°&lt;/h1>
&lt;p>è½¯ä»¶çš„æ›´æ–°ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯&lt;strong>å®‰å…¨æ›´æ–°&lt;/strong>ï¼Œå¦ä¸€ä¸ªæ˜¯&lt;strong>åŠŸèƒ½æ›´æ–°&lt;/strong>ï¼ˆå¢åŠ æˆ–åºŸé™¤åŠŸèƒ½ï¼‰ã€‚é€šå¸¸æ¥è¯´ï¼Œå®‰å…¨æ›´æ–°æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå®‰å…¨æ›´æ–°èƒ½å¤Ÿä¿®å¤è®¡ç®—æœºæ¼æ´ï¼Œæé«˜è½¯ä»¶çš„ç¨³å®šæ€§ã€‚è€ŒåŠŸèƒ½æ›´æ–°åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ²¡æœ‰é‚£ä¹ˆå¿…ä¸å¯ç¼ºï¼Œä½†åŠŸèƒ½æ›´æ–°åœ¨æé«˜è½¯ä»¶æœåŠ¡è´¨é‡ï¼Œç®€åŒ–ç”¨æˆ·æ“ä½œç­‰æ–¹é¢ä¸¾è¶³è½»é‡ã€‚&lt;/p>
&lt;h2 id="å®‰å…¨æ›´æ–°">å®‰å…¨æ›´æ–°&lt;/h2>
&lt;p>æ— è®ºæ˜¯ä½•ç§è®¡ç®—æœºï¼Œæ“ä½œç³»ç»Ÿï¼Œç³»ç»Ÿæ ¸å¿ƒç»„ä»¶ï¼ŒåŸºç¡€è½¯ä»¶çš„å®‰å…¨æ›´æ–°æ˜¯æœ€ä¸ºé‡è¦çš„ã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼Œç¡¬ä»¶ï¼Œè½¯ä»¶çš„å®‰å…¨çŠ¶å†µå¹¶ä¸å®¹ä¹è§‚ã€‚ä¸‹é¢æ˜¯ä¸€äº›æ¼æ´çš„å›é¡¾ã€‚&lt;/p>
&lt;p>2014å¹´4æœˆï¼Œå›½å¤–é»‘å®¢æ›å…‰äº† OpenSSL Heartbleed æ¼æ´ï¼ˆåœ¨å›½å†…ç§°ä¸ºå¿ƒè¡€æ¼æ´ï¼‰ï¼š&lt;a href="https://www.us-cert.gov/ncas/alerts/TA14-098A">OpenSSL &amp;lsquo;Heartbleed&amp;rsquo; vulnerability (CVE-2014-0160)&lt;/a>ï¼Œæ­¤æ¼æ´å±å®³ä¹‹å¤§ï¼Œå½±å“ä¹‹å¤§ï¼Œå ªç§°ç½‘ç»œå®‰å…¨é‡Œç¨‹ç¢‘æ—¶é—´ã€‚æ­¤æ¼æ´æ˜¯åˆ©ç”¨ OpenSSL TLS å¿ƒè·³åŒ…æ²¡æœ‰åšè¾¹ç•Œæ£€æŸ¥è¿›è¡Œæ”»å‡»ï¼Œé»‘å®¢å¯ä»¥æ‹¿åˆ°ç”¨æˆ·åŠ å¯†åçš„æ•°æ®ï¼Œæ­¤æ¼æ´ä½¿å¾—å—å½±å“çš„ç”¨æˆ·ä½¿ç”¨ HTTPS è®¿é—®ç½‘é“¶ï¼Œåœ¨çº¿æ”¯ä»˜ç­‰è¡Œä¸ºéƒ½å˜å¾—ä¸å®‰å…¨ã€‚ å…¨çƒæœ‰å¤§é‡ç½‘ç«™ä½¿ç”¨ OpenSSL å®ç° HTTPS æ¥å…¥ï¼Œè¿™äº›ç½‘ç«™éƒ½å—åˆ°äº†å½±å“ã€‚è¿™ä»¶äº‹è¿˜æ·±è¿œå½±å“äº† OpenSSL çš„å¼€å‘æµç¨‹ï¼Œæ”¹å˜äº† SSL/TLS åº“çš„æ ¼å±€ï¼Œå¯¼è‡´äº† OpenSSL çš„åˆ†è£‚ï¼Œæ¯”å¦‚ OpenBSD fork OpenSSL åˆ›å»ºäº† LibreSSLã€‚Google fork OpenSSL åˆ›å»º boringssl é¡¹ç›®ï¼Œç”šè‡³ä¸€äº›å‚å•†å¼€å§‹ä½¿ç”¨è‡ªå·±çš„ SSL/TLS å®ç°ï¼Œå¦‚ Amazon çš„ &lt;a href="https://github.com/awslabs/s2n">s2n&lt;/a> ä»¥åŠ Facebook çš„ &lt;a href="https://github.com/facebookincubator/fizz">Fizz(TLS 1.3)&lt;/a>ã€‚è€Œä¸€äº›å…¶ä»–åŠ å¯†/TLS åº“ä¹Ÿå—åˆ°äº†æ›´å¤šå…³æ³¨ï¼Œå¦‚ ARM çš„ &lt;a href="https://github.com/ARMmbed/mbedtls">mbedtls&lt;/a>ã€‚&lt;/p>
&lt;p>2017å¹´3æœˆè¡¥ä¸æ˜ŸæœŸäºŒï¼Œå¾®è½¯å‘å¸ƒäº† SMB æœåŠ¡æ¼æ´ï¼Œè€Œåœ¨çŸ­çŸ­çš„ä¸€ä¸ªæœˆä¹‹åï¼Œé»‘å®¢å›¢é˜Ÿå°±å°†æ­¤æ¼æ´åˆ©ç”¨ï¼Œå¹¶å‘å¸ƒäº†ç›¸åº”çš„ç½‘ç»œæ”»å‡»å·¥å…·ï¼Œéšåï¼Œå‹’ç´¢ç—…æ¯’çˆ†å‘ï¼Œä¸­å›½ï¼Œè‹±å›½ï¼Œä¿„ç½—æ–¯ï¼Œæ•´ä¸ªæ¬§æ´²éƒ½å—åˆ°å½±å“ï¼Œç‰¹åˆ«æ˜¯é«˜æ ¡æ ¡å†…ç½‘ï¼Œå¤§å‹ä¼ä¸šå†…ç½‘æ”¿åºœæœºæ„ä¸“ç½‘ã€‚è€Œåœ¨æ•´ä¸ªæ—¶é—´ä¸­ï¼Œè¿™äº›è¢«å‹’ç´¢ç—…æ¯’æ”»å‡»çš„ç”µè„‘å‡ ä¹éƒ½æ˜¯æœªåŠæ—¶å®‰è£…æ›´æ–°æˆ–è€…ç”Ÿå‘½å‘¨æœŸå·²ç»ç»ˆç»“çš„è®¡ç®—æœºã€‚è€Œé«˜æ ¡å†…ç½‘ï¼Œå¤§å‹ä¼ä¸šå†…ç½‘ï¼Œæ”¿åºœæœºæ„ä¸“ç½‘çš„è®¡ç®—æœºé€šå¸¸åœ¨è½¯ä»¶æ›´æ–°ä¸Šæ¯”è¾ƒæ¶ˆæï¼Œå› æ­¤æŸå¤±ç‰¹åˆ«ä¸¥é‡ã€‚ç›¸å…³æ¼æ´åˆ†æï¼š&lt;a href="https://www.fireeye.com/blog/threat-research/2017/05/smb-exploited-wannacry-use-of-eternalblue.html">SMB Exploited: WannaCry Use of &amp;ldquo;EternalBlue&amp;rdquo;&lt;/a>&lt;/p>
&lt;p>2018å¹´ï¼ŒIntel ä¸æ–­çš„çˆ†å‡º CPU æ¼æ´ï¼Œâ€œç†”æ–­â€ï¼ˆMeltdownï¼‰å’Œâ€œå¹½çµâ€ï¼ˆSpectreï¼‰åŠå…¶å˜ç§ï¼Œè¿™äº›æ¼æ´è®©äº‘æœåŠ¡å‚å•†æƒŠå‡ºä¸€èº«å†·æ±—ï¼ŒAzure äºšé©¬é€Šéƒ½åœæœºç»´æŠ¤ã€‚è¿™ç§æ¼æ´çš„å±å®³éå¸¸ä¸¥é‡ï¼Œå¯¹äºä½¿ç”¨è™šæ‹Ÿæœºæˆ–è€…å®¹å™¨éš”ç¦»çš„äº‘æœåŠ¡å‚å•†ï¼ŒCPU æ¼æ´å¯ä»¥è½»æ˜“çªç ´å®¿ä¸»æœºéš”ç¦»ï¼Œæ›´å¯è·å¾—å…³é”®æ•°æ®ã€‚è¿˜æœ‰é»‘å®¢æ¼”ç¤ºä½¿ç”¨ JavaScript åˆ©ç”¨æ¼æ´æ”»å‡»ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿéš¾ä»¥å…å—å…¶å®³ã€‚Clang GCC å‡å¢åŠ äº†é˜²å¾¡ CPU æ¼æ´çš„ä»£ç ã€‚MSVC å‘å¸ƒäº†æŠµå¾¡ Spectre æ¼æ´çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>2019-06-24 CURL ä½œè€… åˆæ’°æ–‡æŠ«éœ²äº† &lt;a href="https://daniel.haxx.se/blog/2019/06/24/openssl-engine-code-injection-in-curl/">OPENSSL ENGINE CODE INJECTION IN CURL&lt;/a> &lt;a href="https://curl.haxx.se/docs/CVE-2019-5443.html">CVE-2019-5443: Windows OpenSSL engine code injection&lt;/a>ï¼Œæ­¤ç¼ºé™·å¯ä»¥å¯¼è‡´éç‰¹æƒç”¨æˆ·å°†æ¶æ„é…ç½®æ”¾ç½®åœ¨ OpenSSL æœç´¢ç›®å½•ï¼Œå½“ç‰¹æƒç”¨äºè¿è¡Œ cURL æ—¶ï¼Œå®ç°æ”»å‡»ã€‚æ¼æ´çœŸæ˜¯é˜²ä¸èƒœé˜²ã€‚&lt;/p>
&lt;p>&lt;a href="https://www.zerodayinitiative.com/">Zero Day Initiative: ZDI&lt;/a> æ˜¯è¶‹åŠ¿ç§‘æŠ€å»ºç«‹çš„ä¸€ä¸ªé›¶æ—¥æ¼æ´è®¡åˆ’ï¼Œåœ¨ 2019-06 æœˆçš„é›¶æ—¥æ¼æ´åˆ†äº«ç›®å‰å°±æœ‰ 3ä¸ªï¼Œç›¸å…³åšå®¢åœ°å€ï¼š&lt;a href="https://www.zerodayinitiative.com/blog">https://www.zerodayinitiative.com/blog&lt;/a>ï¼Œ6 æœˆä»½çš„é›¶æ—¥æ¼æ´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡ Ruby On Rails è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œä¸»åŠ¨å­˜å‚¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–ã€‚å½±å“ç‰ˆæœ¬ 6.0.0.X å’Œ 5.2.Xã€‚&lt;/li>
&lt;li>é€šè¿‡ CVE-2019-1069 åˆ©ç”¨ Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼Œæ­¤æ“ä½œå¯ä»¥æå‡åˆ° SYTSEM æƒé™ã€‚&lt;/li>
&lt;li>MINDSHAREï¼šä½¿ç”¨ BELKIN SURF N300 è·¯ç”±å™¨è¿›è¡Œç¡¬ä»¶é€†è½¬ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸Šè¿°é›¶æ—¥æ¼æ´ä»¥ CVE-2019-1069 å½±å“æœ€ä¸ºå¹¿æ³›ï¼Œå¦‚æœæ¯ä¸ªæœˆæŠ«éœ²çš„æ¼æ´æ•°æ¯”è¾ƒæ¥è¿‘ï¼Œé‚£ä¹ˆå½“è®¡ç®—å³ä¸€å¹´æœªæ›´æ–°æ—¶ï¼Œæ‰€é¢ä¸´çš„æ¼æ´é£é™©å°†éå¸¸é«˜ï¼Œç”¨æˆ·çš„æ•°æ®å®‰å…¨å°†æ— æ³•å¾—åˆ°ä¿è¯ã€‚åŠæ—¶çš„å®‰å…¨æ›´æ–°åº”è¯¥ä¹Ÿå¿…é¡»æ˜¯è®¡ç®—æœºç”¨æˆ·çš„å¸¸è§„æ“ä½œã€‚&lt;/p>
&lt;h2 id="åŠŸèƒ½æ›´æ–°">åŠŸèƒ½æ›´æ–°&lt;/h2>
&lt;p>ä¸å®‰å…¨æ›´æ–°ä¸åŒçš„æ˜¯ï¼ŒåŠŸèƒ½æ›´æ–°æ›´å¤šçš„æ˜¯æ”¹è¿›ç”¨æˆ·ä½“éªŒï¼Œè€Œæ²¡æœ‰å®‰å…¨æ›´æ–°é‚£ä¹ˆæ€¥è¿«ã€‚ä½†ä¸€äº›åŠŸèƒ½æ›´æ–°ä¹Ÿéå¸¸é‡è¦ã€‚&lt;/p>
&lt;p>2015 å¹´ IETF æ‰¹å‡†äº† HTTP/2 åè®®ï¼Œä¸»è¦ &lt;a href="https://httpwg.org/specs/rfc7540.html">RFC7450: Hypertext Transfer Protocol Version 2 (HTTP/2)&lt;/a> å’Œ &lt;a href="https://httpwg.org/specs/rfc7541.html">RFC7451: HPACK: Header Compression for HTTP/2&lt;/a>ã€‚HTTP/2 æœ‰ä»¥ä¸‹æ–°ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>å¤šè·¯å¤ç”¨ï¼Œåˆ©ç”¨äºŒè¿›åˆ¶åˆ†å¸§ï¼Œå°†å¤šä¸ª HTTP è¯·æ±‚é€šè¿‡åŒä¸€æ¡ä¿¡é“ä¼ è¾“ï¼Œè¿™èŠ‚çœäº†ç½‘ç»œè¿æ¥æ•°ç›®ï¼Œæé«˜äº†ä¿¡é“çš„ä½¿ç”¨ç‡ã€‚&lt;/li>
&lt;li>å¤´éƒ¨å‹ç¼©ï¼Œåœ¨ HTTP/1.1 ä¸­ï¼ŒåŸºäºæ–‡æœ¬çš„å¤´éƒ¨éå¸¸å†—é•¿ï¼Œå æ®äº†å¾ˆå¤šç©ºé—´ï¼Œåœ¨ HTTP/2 ä¸­ä½¿ç”¨å¤´éƒ¨å‹ç¼©å°†èŠ‚çœä¸€éƒ¨åˆ†æµé‡ã€‚&lt;/li>
&lt;li>æœåŠ¡ç«¯æ¨é€ æ¯”å¦‚ä½ è¯·æ±‚ä¸€ä¸ª HTML é¡µé¢ï¼Œæœ‰å¯èƒ½éœ€è¦è¯·æ±‚ç›¸åº”çš„ CSS/JS æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯æ¨é€åˆ™å¯è®©å®¢æˆ·ç«¯å‡å°‘è¯·æ±‚ã€‚&lt;/li>
&lt;li>æµé‡æ§åˆ¶&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>HTTP/2 çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œä½†ä½ å¦‚æœä¸å‡çº§æµè§ˆå™¨ï¼Œåˆ™æ— æ³•äº«å—åˆ°è¿™äº›æ–°ç‰¹æ–°ï¼Œå¯¹äº Windows è€Œè¨€ï¼ŒWinHTTP/WinINet å‡åªæœ‰ Windows 10 æ‰æ”¯æŒ HTTP/2ï¼Œå¦‚æœæ²¡æœ‰å‡çº§åˆ° Windows 10ï¼Œåˆ™ä¾èµ–è¿™ä¸¤ä¸ªç³»ç»Ÿåº“çš„è½¯ä»¶æ— æ³•æ”¯æŒ HTTP/2ã€‚è€Œç›®å‰çš„æµè§ˆå™¨å‡å·²æ”¯æŒ HTTP/2ï¼Œä¸»æµç½‘ç«™å¾ˆå¤šéƒ½å·²ç»æ”¯æŒ HTTP/2ã€‚ä½¿ç”¨æœ€æ–°å‘å¸ƒçš„ curl è¿è¡Œ &lt;code>curl -V&lt;/code> å¦‚æœæœ‰ &lt;code>HTTP2&lt;/code> å­—æ®µï¼Œåˆ™å¯ä»¥ç”¨ &lt;code>curl&lt;/code> å»æ£€æµ‹æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ HTTP/2: &lt;code>curl -I --verbose https://bing.com&lt;/code>ã€‚&lt;/p>
&lt;p>2018å¹´ TLS 1.3 &lt;a href="https://tools.ietf.org/html/rfc8446">RFC8446: The Transport Layer Security (TLS) Protocol Version 1.3&lt;/a> å‘å¸ƒï¼ŒTLS 1.3 æ–°å¢äº† 0-RTT æé«˜äº† Handshake æ€§èƒ½ï¼Œåˆ é™¤äº†ä¸€äº›ä¸å®‰å…¨çš„åŠ å¯†æœºåˆ¶ï¼Œå¢å¼ºäº†å®‰å…¨æ€§ã€‚è¦ä½¿ç”¨ TLS 1.3 ä½ åº”è¯¥ä½¿ç”¨è¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå¼€å‘è½¯ä»¶æ—¶åº”è¯¥é€‰æ‹© OpenSSL 1.1.1c æˆ–è€…æ›´æ–°ç‰ˆæœ¬ï¼ŒTLS 1.3 å®ç°åˆ—è¡¨å¯ä»¥å‚è€ƒï¼š&lt;a href="https://github.com/tlswg/tls13-spec/wiki/Implementations">Implementations&lt;/a>ã€‚&lt;/p>
&lt;p>å‡ ä¹æ¯å¹´ Unicode ç»„ç»‡éƒ½ä¼šå‘å¸ƒæ–°çš„ Unicode ç‰ˆæœ¬ï¼Œåœ¨æ–°çš„ Unicode ç‰ˆæœ¬ä¸­ä¼šå¢åŠ ä¸€äº›æ–°çš„å­—ç¬¦åŒ…æ‹¬ emojiï¼Œåœ¨ä»Šå¹´æ—¥æœ¬å¾³ä»çš‡å¤ªå­å³ä½ï¼Œå¹´å·&lt;code>ä»¤å’Œ&lt;/code>ï¼ŒUnicode å‘å¸ƒäº† &lt;code>unicode-12.1-reiwa&lt;/code> åœ¨ BMP å¹³é¢å¢åŠ äº† &lt;code>ä»¤å’Œ&lt;/code> çš„åˆä½“å­— &lt;code>U+32FF&lt;/code>ã€‚Windows å‘å¸ƒäº†ä¸€äº›åˆ—æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰æ›´æ–°ï¼Œæ—¥æœ¬éƒ½å¯èƒ½å‘ç”Ÿæ··ä¹±ã€‚è€Œæ–°çš„ emoji åˆ™ç»™ç”¨æˆ·å¸¦æ¥äº†æ›´å¤šçš„ä¹è¶£ã€‚åœ¨ Windows 10 ä¸­ï¼Œæ–°å¢äº†å½©è‰²å­—ä½“ï¼Œä»¥å‰çš„ emoji éƒ½æ˜¯é»‘è‰²çš„ï¼Œæ–°çš„æ›´æ–°è®© emoji å›å½’äº†æœ¬è‰²ã€‚&lt;/p>
&lt;p>2018 å¹´ Git Wire Protocol å‘å¸ƒï¼Œæ­¤åè®®çš„ä¼˜åŠ¿çš„æ”¹è¿›äº† git clone çš„æµç¨‹ï¼Œç‰¹åˆ«æ˜¯å¼•ç”¨å‘ç°ï¼Œæµ…è¡¨å…‹éš†ï¼Œå¢åŠ äº†æ‰©å±•æœºåˆ¶ï¼Œä¸ºä»¥åçš„æ–°å¢åŠŸèƒ½å¢åŠ äº†æ›´å¤šçš„å¯èƒ½ã€‚ç¬”è€…ç¬¬ä¸€æ—¶é—´å®ç°äº† Gitee å¯¹ Wire Protocol çš„æ”¯æŒï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰åŠæ—¶å‡çº§åˆ° git æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ— æ³•äº«å—è¿™äº›ç‰¹æ€§äº†ã€‚&lt;/p>
&lt;h2 id="windows-æ›´æ–°çš„è®¨è®º">Windows æ›´æ–°çš„è®¨è®º&lt;/h2>
&lt;p>Windows æ›´æ–°çš„è¢«æ‰¹è¯„æœ€å¤šçš„æ˜¯æ—©æœŸçš„å¼ºåˆ¶æ›´æ–°ï¼ˆå¼ºåˆ¶é‡å¯ï¼‰ï¼Œä¸è¿‡åœ¨ Windows 10 1903, è¿™ç§æƒ…å†µå·²ç»æ²¡æœ‰å‘ç”Ÿäº†ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ­¤ç« èŠ‚æ—¶ï¼ŒWindows Update æé†’æˆ‘é‡å¯ï¼ˆæ²¡æœ‰å¼¹çª—ï¼Œä»…ä»»åŠ¡æ  Windows Update å›¾æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚æ³¨ï¼šç¬”è€…æœªè®¾ç½®æš‚åœæ›´æ–°ã€‚ï¼‰ï¼Œä½†å¹¶æœªå¹²æ‰°æˆ‘å·¥ä½œã€‚å®é™…ä¸Šç›®å‰çš„ Ubuntu ç³»ç»Ÿä¹Ÿä¼šæé†’ç”¨æˆ·æ›´æ–°ç³»ç»Ÿï¼Œå¹¶ä¸”æ›´æ–°å®Œæœ‰å¯èƒ½æé†’ç”¨æˆ·é‡å¯è®¡ç®—æœºï¼Œ1903 ä¸å…¶æ˜¯ç›¸ä¼¼çš„ã€‚è™½ç„¶ Windows æ›´æ–°å·²ç»å¾—åˆ°äº†å¾ˆå¤§çš„æ”¹è¿›ï¼Œä½†è¯è¯´å›æ¥ï¼Œå¾®è½¯ä¾ç„¶åº”è¯¥ä¸æ–­çš„æé«˜è½¯ä»¶è´¨é‡ï¼Œæé«˜ç¨³å®šæ€§ã€‚ç‰¹åˆ«è¦æ¥çº³ç”¨æˆ·çš„åé¦ˆæ„è§ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>&lt;strong>å†å²æ˜¯ä¸æ–­å‘å±•çš„ï¼Œè½¯ç¡¬ä»¶æ˜¯ä¸æ–­æ›´æ–°çš„&lt;/strong>ï¼Œç£ç›˜åœ¨ä½¿ç”¨å‡ å¹´ä¹‹åä¾¿å®¹æ˜“å‡ºç°åé“ï¼Œç£ç›˜è¯»å†™é€Ÿåº¦ä¸‹é™ï¼Œè¿™æ—¶ç¡¬ä»¶å°±éœ€è¦æ›´æ–°äº†ï¼Œè€Œè½¯ä»¶åˆ™éœ€è¦ç»å¸¸æ›´æ–°ï¼Œæ— è®ºå®‰å…¨æ›´æ–°è¿˜æ˜¯åŠŸèƒ½æ›´æ–°ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸ºäº†è®©ç”¨æˆ·æ›´å¥½çš„æ›´å®‰å…¨çš„ä½¿ç”¨è®¡ç®—æœºã€‚
å¦å¤–ï¼Œéšç€ç¡¬ä»¶çš„æ›´æ–°ï¼Œè½¯ä»¶æ›´éœ€è¦åŠæ—¶æ›´æ–°ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œç¡¬ä»¶æ›´æ–°åï¼Œè½¯ä»¶åŠæ—¶æ›´æ–°èƒ½å¤Ÿæ›´å¥½çš„å‘æŒ¥å‡ºæ–°ç¡¬ä»¶çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚å½“ç¡¬ä»¶å¢åŠ  SSE AVX è¿™ç§æŒ‡ä»¤æ—¶ï¼Œè½¯ä»¶æ›´æ–°é€‚é…äº†å°±å¯èƒ½å¸¦æ¥å¤§é‡çš„æ–°èƒ½æå‡ã€‚
äººæœ‰ç”Ÿè€ç—…æ­»ï¼Œè½¯ä»¶æœ‰æ›´æ–°è¿­ä»£ã€‚éƒ½æ˜¯å†å²çš„é½¿è½®æ»šæ»šå‘å‰ã€‚&lt;/p>
- https://forcemz.net/posts/2019/2019-06-25-talk-computer-update/ - Copyright (c) 2009-2024 J23</description></item></channel></rss>