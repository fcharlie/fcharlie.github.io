<!doctype html><html lang=en><head><title>Clangbuilder 已支持自动构建 CURL</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>归档
</a><a class="a-block drawer-menu-item false" href=/categories>分类
</a><a class="a-block drawer-menu-item false" href=/tags>标签
</a><a class="a-block drawer-menu-item false" href=/about>关于
</a><a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#curl class=nav-curl>cURL</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://forcemz.net/>Charlie's Rethinking
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://forcemz.net/><div class=single-column-header-title>Charlie's Rethinking</div><div class=single-column-header-subtitle>Themed by Diary.</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Clangbuilder 已支持自动构建 CURL<div class=post-meta><time itemprop=datePublished>2018-11-15 10:00
</time><i class=material-icons>folder</i>
<a href=/categories/toolset>toolset</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h1 id=curl>cURL</h1><p>cURL 是一个非常著名的开源 URL 数据传输工具，支持 <code>HTTP</code>,<code>HTTPS</code>,<code>FTP</code>,<code>SCP</code>,<code>SFTP</code>,<code>Telnet</code> 等协议。绝大多数操作系统都自带了，也包括 Windows 10 17134/17763。但系统自带的版本通常都不会及时更新到最新版本，而 <code>cURL</code> 是一个非常活跃的项目，大约2个月就会发布一个新版本。每一次更新都会修复大量 bug，新增很多新特性，比如最近增加了 <code>DOH</code> 更好的 <code>TLS1.3</code> 支持。</p><p>系统自带的 <code>curl -V</code> 输出：</p><pre tabindex=0><code>curl 7.55.1 (Windows) libcurl/7.55.1 WinSSL
Release-Date: [unreleased]
Protocols: dict file ftp ftps http https imap imaps pop3 pop3s smtp smtps telnet tftp
Features: AsynchDNS IPv6 Largefile SSPI Kerberos SPNEGO NTLM SSL
</code></pre><p>实际上，在 cURL 下载页面 <a href=https://curl.haxx.se/download.html>https://curl.haxx.se/download.html</a> Windows 平台有好几个二进制发行包，官方也提供了二进制下载：<a href=https://curl.haxx.se/windows/>https://curl.haxx.se/windows/</a> 基于 <code>Mingw64</code> 构建。在 Github 上有构建项目：<a href=https://github.com/curl/curl-for-win>https://github.com/curl/curl-for-win</a>。而这个发行版也是 curl 一个开发者个人项目纳入到 curl 中的。</p><p>我们还可以使用 <code>vcpkg</code> 安装 <code>curl</code>，但截至目前，<code>vcpkg</code> 的 <code>OpenSSL</code> 版本依然是 <strong>1.0.2p</strong> 无法支持 <code>TLS 1.3</code>。</p><p>笔者想要使用 <code>Visual C++</code> 构建静态链接支持 <code>TLS 1.3</code> 的 <code>curl</code>，最后发现都得自己一步一步来，于是就写了构建脚本。</p><p>话不多说，一切尽在代码中。Github 源代码地址：<a href=https://github.com/fstudio/clangbuilder/blob/526183ade63a4a9b8bd2f4b99872536c9da9e997/sources/wincurl/wincurl.ps1>sources/wincurl/wincurl.ps1</a></p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#828b96;font-style:italic>#!/usr/bin/env pwsh</span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># Require Clangbuilder install perl</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>param</span>(
</span></span><span style=display:flex><span>    [<span style=color:#58a1dd>String</span>]<span style=color:#58a1dd>$WD</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># Import version info</span>
</span></span><span style=display:flex><span>. <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$PSScriptRoot</span><span style=color:#a6be9d>/version.ps1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># thanks https://github.com/curl/curl-for-win</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#a6be9d>&#34;Download urls:
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>zlib: </span><span style=color:#58a1dd>$ZLIB_URL</span><span style=color:#a6be9d>
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>openssl: </span><span style=color:#58a1dd>$OPENSSL_URL</span><span style=color:#a6be9d>
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>brotli: </span><span style=color:#58a1dd>$BROTLI_URL</span><span style=color:#a6be9d>
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>libssh2: </span><span style=color:#58a1dd>$LIBSSH2_URL</span><span style=color:#a6be9d>
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>nghttp2: </span><span style=color:#58a1dd>$NGHTTP2_URL</span><span style=color:#a6be9d>
</span></span></span><span style=display:flex><span><span style=color:#a6be9d>curl: </span><span style=color:#58a1dd>$CURL_URL</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>################################################## Found commands</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#58a1dd>Net.ServicePointManager</span>]::<span style=color:#58a1dd>SecurityProtocol</span> = [<span style=color:#58a1dd>Net.SecurityProtocolType</span>]::<span style=color:#58a1dd>Tls12</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Import-Module</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$PSScriptRoot</span><span style=color:#a6be9d>/Utility&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$clexe</span> = <span style=color:#58a1dd>Get-Command</span> <span style=color:#58a1dd>-CommandType</span> <span style=color:#58a1dd>Application</span> <span style=color:#a6be9d>&#34;cl&#34;</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$clexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install Visual Studio 2017 or BuildTools (C++) and Initialzie DevEnv&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#a6be9d>&#34;Find cl.exe: </span>$(<span style=color:#58a1dd>$clexe</span>.<span style=color:#58a1dd>Version</span>)<span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$tarexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;tar&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$decompress</span> = <span style=color:#a6be9d>&#34;-xvf&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$tarexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$tarexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;cmake&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$tarexe</span>) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install tar or cmake.&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$decompress</span> = <span style=color:#a6be9d>&#34;-E tar -xvf&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Use </span><span style=color:#58a1dd>$tarexe</span><span style=color:#a6be9d> as tar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>Function</span> <span style=color:#58a1dd>DecompressTar</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff636f>param</span>(
</span></span><span style=display:flex><span>        [<span style=color:#58a1dd>String</span>]<span style=color:#58a1dd>$URL</span>,
</span></span><span style=display:flex><span>        [<span style=color:#58a1dd>String</span>]<span style=color:#58a1dd>$File</span>,
</span></span><span style=display:flex><span>        [<span style=color:#58a1dd>String</span>]<span style=color:#58a1dd>$Hash</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>Test-Path</span> <span style=color:#58a1dd>$File</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>WinGet</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$URL</span> <span style=color:#58a1dd>-O</span> <span style=color:#58a1dd>$File</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#ff636f>return</span> <span style=color:#58a1dd>$false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff636f>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff636f>if</span> ((<span style=color:#58a1dd>Get-FileHash</span> <span style=color:#58a1dd>-Algorithm</span> <span style=color:#58a1dd>SHA256</span> <span style=color:#58a1dd>$File</span>).<span style=color:#58a1dd>Hash</span> <span style=color:#ff636f>-ne</span> <span style=color:#58a1dd>$Hash</span>) {
</span></span><span style=display:flex><span>            <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$File</span><span style=color:#a6be9d> exists and hash not match </span><span style=color:#58a1dd>$Hash</span><span style=color:#a6be9d>.&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#58a1dd>Remove-Item</span> <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>$File</span>
</span></span><span style=display:flex><span>            <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>WinGet</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$URL</span> <span style=color:#58a1dd>-O</span> <span style=color:#58a1dd>$File</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#ff636f>return</span> <span style=color:#58a1dd>$false</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff636f>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$File</span><span style=color:#a6be9d> exists and hash is match. use it.&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> ((<span style=color:#58a1dd>Get-FileHash</span> <span style=color:#58a1dd>-Algorithm</span> <span style=color:#58a1dd>SHA256</span> <span style=color:#58a1dd>$File</span>).<span style=color:#58a1dd>Hash</span> <span style=color:#ff636f>-ne</span> <span style=color:#58a1dd>$Hash</span>) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>Remove-Item</span> <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>$File</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>WinGet</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$URL</span> <span style=color:#58a1dd>-O</span> <span style=color:#58a1dd>$File</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#ff636f>return</span> <span style=color:#58a1dd>$false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> ((<span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$tarexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$decompress</span><span style=color:#a6be9d> </span><span style=color:#58a1dd>$File</span><span style=color:#a6be9d>&#34;</span>) <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Decompress </span><span style=color:#58a1dd>$File</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>return</span> <span style=color:#58a1dd>$false</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#58a1dd>$true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$curlexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;curl&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$curlexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install curl or upgrade to Windows 10 17134 or Later.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Find curl install: </span><span style=color:#58a1dd>$curlexe</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$cmakeexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;cmake&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$cmakeexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install cmake.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Find cmake install: </span><span style=color:#58a1dd>$cmakeexe</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$Ninjaexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;ninja&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$Ninjaexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install ninja.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Find cmake install: </span><span style=color:#58a1dd>$Ninjaexe</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$Patchexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;patch&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$Patchexe</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$Gitexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;git&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$Gitexe</span>) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install git for windows (or PortableGit).&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$gitinstall</span> = <span style=color:#58a1dd>Split-Path</span> <span style=color:#58a1dd>-Parent</span> (<span style=color:#58a1dd>Split-Path</span> <span style=color:#58a1dd>-Parent</span> <span style=color:#58a1dd>$gitexe</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> ([<span style=color:#58a1dd>String</span>]::<span style=color:#58a1dd>IsNullOrEmpty</span>(<span style=color:#58a1dd>$gitinstall</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install git for windows (or PortableGit).&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$patchx</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$gitinstall</span> <span style=color:#a6be9d>&#34;usr/bin/patch.exe&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#a6be9d>&#34;Try to find patch from </span><span style=color:#58a1dd>$patchx</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>Test-Path</span> <span style=color:#58a1dd>$patchx</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>$xinstall</span> = <span style=color:#58a1dd>Split-Path</span> <span style=color:#58a1dd>-Parent</span> <span style=color:#58a1dd>$gitinstall</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>if</span> ([<span style=color:#58a1dd>String</span>]::<span style=color:#58a1dd>IsNullOrEmpty</span>(<span style=color:#58a1dd>$xinstall</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install git for windows (or PortableGit).&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#58a1dd>$patchx</span> = <span style=color:#58a1dd>Join-Path</span>  <span style=color:#58a1dd>$xinstall</span> <span style=color:#a6be9d>&#34;usr/bin/patch.exe&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>Test-Path</span> <span style=color:#58a1dd>$patchx</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please install git for windows (or PortableGit).&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$Patchexe</span> = <span style=color:#58a1dd>$patchx</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span>  <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Found patch install: </span><span style=color:#58a1dd>$Patchexe</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$Perlexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;perl&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$Perlexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Please add perl to your environment.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span>  <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;Found perl install: </span><span style=color:#58a1dd>$Perlexe</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>########################################################## Check WD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> ([<span style=color:#58a1dd>String</span>]::<span style=color:#58a1dd>IsNullOrEmpty</span>(<span style=color:#58a1dd>$WD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$cbroot</span> = <span style=color:#58a1dd>Split-Path</span> <span style=color:#58a1dd>-Parent</span> (<span style=color:#58a1dd>Split-Path</span> <span style=color:#58a1dd>-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span>)
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$WD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$cbroot</span> <span style=color:#a6be9d>&#34;out/curl&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$WD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Cyan</span> <span style=color:#a6be9d>&#34;Build curl on windows use&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Set-Location</span> <span style=color:#58a1dd>$WD</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$Prefix</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#a6be9d>&#34;build&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CURLOUT</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#a6be9d>&#34;out&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#a6be9d>&#34;we will deploy curl to: </span><span style=color:#58a1dd>$CURLPrefix</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$Prefix</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>################################################## Zlib</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$ZLIB_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$ZLIB_FILENAME</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$ZLIB_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ZLIBDIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PWD</span> <span style=color:#58a1dd>$ZLIB_FILENAME</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ZLIBBD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$ZLIBDIR</span> <span style=color:#a6be9d>&#34;build&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Apply zlib.patch ...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ZLIB_PACTH</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/zlib.patch&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Patchexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-Nbp1 -i </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$ZLIB_PACTH</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$ZLIBDIR</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Apply </span><span style=color:#58a1dd>$ZLIB_PACTH</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$ZLIBBD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$cmakeflags</span> = <span style=color:#a6be9d>&#34;-GNinja &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCMAKE_BUILD_TYPE=Release &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DCMAKE_INSTALL_PREFIX=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DSKIP_INSTALL_FILES=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DSKIP_BUILD_EXAMPLES=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DBUILD_SHARED_LIBS=OFF </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$ZLIBDIR</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$cmakeexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$cmakeflags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$ZLIBBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;zlib: create build.ninja error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;all&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$ZLIBBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;zlib: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;install&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$ZLIBBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;zlib: install error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Rename-Item</span> <span style=color:#58a1dd>-Path</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/zlibstatic.lib&#34;</span>   <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/zlib.lib&#34;</span>  <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#Copy-Item -Path &#34;$ZLIBDIR/LICENSE&#34; </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>##################################################### OpenSSL</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Build OpenSSL </span><span style=color:#58a1dd>$OPENSSL_VERSION</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$OPENSSL_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$OPENSSL_FILE</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$OPENSSL_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># Update env</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$env:INCLUDE</span> = <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>\include;</span><span style=color:#58a1dd>$env:INCLUDE</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$env:LIB</span> = <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>\lib;</span><span style=color:#58a1dd>$env:LIB</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># perl Configure no-shared no-ssl3 enable-capieng -utf-8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$opensslflags</span> = <span style=color:#a6be9d>&#34;Configure no-shared no-unit-test no-tests no-ssl3 enable-capieng -utf-8 &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;VC-WIN64A </span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>--prefix=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> </span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>--openssldir=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$Nasmexe</span> = <span style=color:#58a1dd>Findcommand</span> <span style=color:#58a1dd>-Name</span> <span style=color:#a6be9d>&#34;nasm&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$null</span> <span style=color:#ff636f>-eq</span> <span style=color:#58a1dd>$Nasmexe</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Not found nasm, build openssl no-asm&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>$opensslflags</span> += <span style=color:#a6be9d>&#34; no-asm&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$openssldir</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#58a1dd>$OPENSSL_FILE</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Perlexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$opensslflags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$openssldir</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;openssl: config error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>nmake</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-f makefile&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$openssldir</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;openssl: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>nmake</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-f makefile install_sw&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$openssldir</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;openssl: install_sw error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># build brotli static</span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>######################################################### Brotli</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Build brotli </span><span style=color:#58a1dd>$BROTLI_VERSION</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$BROTLI_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$BROTLI_FILE</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$BROTLI_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BDIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#58a1dd>$BROTLI_FILE</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BBUILD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$BDIR</span> <span style=color:#a6be9d>&#34;out&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BPATCH</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/brotli.patch&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$BBUILD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Patchexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-Nbp1 -i </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$BPATCH</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$BDIR</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Apply </span><span style=color:#58a1dd>$BPATCH</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$brotliflags</span> = <span style=color:#a6be9d>&#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DBROTLI_DISABLE_TESTS=ON </span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DCMAKE_INSTALL_PREFIX=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> ..&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$cmakeexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$brotliflags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$BBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;brotli: create build.ninja error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;all&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$BBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;brotli: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;install&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$BBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;brotli: install error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>## Fix curl not exists</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Move-Item</span> <span style=color:#58a1dd>-Path</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlicommon-static.lib&#34;</span>   <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlicommon.lib&#34;</span>  <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Move-Item</span> <span style=color:#58a1dd>-Path</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlidec-static.lib&#34;</span>   <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlidec.lib&#34;</span>  <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Move-Item</span> <span style=color:#58a1dd>-Path</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlienc-static.lib&#34;</span>   <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>/lib/brotlienc.lib&#34;</span>  <span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>######################################################### Nghttp2</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Build nghttp2 </span><span style=color:#58a1dd>$NGHTTP2_VERSION</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$NGHTTP2_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$NGHTTP2_FILE</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$NGHTTP2_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$NGDIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#58a1dd>$NGHTTP2_FILE</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$NGBUILD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$NGDIR</span> <span style=color:#a6be9d>&#34;build&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$NGPATCH</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/nghttp2.patch&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$NGBUILD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Patchexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-Nbp1 -i </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$NGPATCH</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$NGDIR</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Apply </span><span style=color:#58a1dd>$NGPATCH</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ngflags</span> = <span style=color:#a6be9d>&#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DENABLE_LIB_ONLY=ON -DENABLE_ASIO_LIB=OFF </span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DCMAKE_INSTALL_PREFIX=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> ..&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$cmakeexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$ngflags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$NGBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;nghttp2: create build.ninja error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;all&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$NGBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;nghttp2: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;install&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$NGBUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;nghttp2: install error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>############################################################# Libssh2</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Build libssh2 </span><span style=color:#58a1dd>$LIBSSH2_VERSION</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$LIBSSH2_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$LIBSSH2_FILE</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$LIBSSH2_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#58a1dd>$LIBSSH2DIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#58a1dd>$LIBSSH2_FILE</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$LIBSSH2BUILD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$LIBSSH2DIR</span> <span style=color:#a6be9d>&#34;build&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$LIBSSH2PATCH</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/libssh2.patch&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$LIBSSH2BUILD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Patchexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-Nbp1 -i </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$LIBSSH2PATCH</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$LIBSSH2DIR</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Apply </span><span style=color:#58a1dd>$LIBSSH2PATCH</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$libssh2flags</span> = <span style=color:#a6be9d>&#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DBUILD_EXAMPLES=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DBUILD_TESTING=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DENABLE_ZLIB_COMPRESSION=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DCMAKE_INSTALL_PREFIX=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> ..&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$cmakeexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$libssh2flags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$LIBSSH2BUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;libssh2: create build.ninja error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;all&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$LIBSSH2BUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;libssh2: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;install&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$LIBSSH2BUILD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;libssh2: install error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>############################################################## CURL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Yellow</span> <span style=color:#a6be9d>&#34;Final build curl </span><span style=color:#58a1dd>$CURL_VERSION</span><span style=color:#a6be9d>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>DecompressTar</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$CURL_URL</span> <span style=color:#ff636f>-File</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$CURL_FILE</span><span style=color:#a6be9d>.tar.gz&#34;</span> <span style=color:#58a1dd>-Hash</span> <span style=color:#58a1dd>$CURL_HASH</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CURLDIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$WD</span> <span style=color:#58a1dd>$CURL_FILE</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CURLBD</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$CURLDIR</span> <span style=color:#a6be9d>&#34;build&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CURLPATCH</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/curl.patch&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CURLICON</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$PSScriptRoot</span> <span style=color:#a6be9d>&#34;patch/curl.ico&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>MkdirAll</span> <span style=color:#58a1dd>-Dir</span> <span style=color:#58a1dd>$CURLBD</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>exit</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># copy icon to path</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Copy-Item</span> <span style=color:#58a1dd>$CURLICON</span> <span style=color:#58a1dd>-Destination</span> <span style=color:#a6be9d>&#34;</span><span style=color:#58a1dd>$CURLDIR</span><span style=color:#a6be9d>/src&#34;</span><span style=color:#58a1dd>-Force</span> <span style=color:#58a1dd>-ErrorAction</span> <span style=color:#58a1dd>SilentlyContinue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Patchexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;-Nbp1 -i </span><span style=color:#a6be9d>`&#34;</span><span style=color:#58a1dd>$CURLPATCH</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$CURLDIR</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;Apply </span><span style=color:#58a1dd>$CURLPATCH</span><span style=color:#a6be9d> failed&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#https://github.com/curl/curl/blob/master/CMake/FindBrotli.cmake</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BROTLIDEC_LIBRARY</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$Prefix</span> <span style=color:#a6be9d>&#34;lib/brotlidec-static.lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BROTLICOMMON_LIBRARY</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$Prefix</span> <span style=color:#a6be9d>&#34;lib/brotlicommon-static.lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$BROTLI_INCLUDE_DIR</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$Prefix</span> <span style=color:#a6be9d>&#34;include&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>## Use codepage 1252</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$curlflags</span> = <span style=color:#a6be9d>&#34;-GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DUSE_NGHTTP2=ON -DBUILD_TESTING=OFF &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DBUILD_CURL_EXE=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCURL_STATIC_CRT=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCMAKE_USE_OPENSSL=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCMAKE_USE_WINSSL=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCMAKE_USE_LIBSSH2=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCURL_BROTLI=ON &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;-DCMAKE_RC_FLAGS=-c1252 &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DBROTLI_DIR=</span><span style=color:#58a1dd>$Prefix</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> &#34;</span> + `
</span></span><span style=display:flex><span>    <span style=color:#a6be9d>&#34;</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d>-DCMAKE_INSTALL_PREFIX=</span><span style=color:#58a1dd>$CURLOUT</span><span style=color:#a6be9d>`&#34;</span><span style=color:#a6be9d> ..&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$cmakeexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#58a1dd>$curlflags</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$CURLBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;curl: create build.ninja error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;all&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$CURLBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;curl: build error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$ec</span> = <span style=color:#58a1dd>Exec</span> <span style=color:#58a1dd>-FilePath</span> <span style=color:#58a1dd>$Ninjaexe</span> <span style=color:#58a1dd>-Argv</span> <span style=color:#a6be9d>&#34;install&#34;</span> <span style=color:#58a1dd>-WD</span> <span style=color:#58a1dd>$CURLBD</span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (<span style=color:#58a1dd>$ec</span> <span style=color:#ff636f>-ne</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;curl: install error&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff636f>return</span> <span style=color:#a6be9d>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic># download curl-ca-bundle.crt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>$CA_BUNDLE</span> = <span style=color:#58a1dd>Join-Path</span> <span style=color:#58a1dd>$CURLOUT</span> <span style=color:#a6be9d>&#34;bin/curl-ca-bundle.crt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>if</span> (!(<span style=color:#58a1dd>WinGet</span> <span style=color:#58a1dd>-URL</span> <span style=color:#58a1dd>$CA_BUNDLE_URL</span> <span style=color:#58a1dd>-O</span> <span style=color:#58a1dd>$CA_BUNDLE</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Red</span> <span style=color:#a6be9d>&#34;download curl-ca-bundle.crt  error&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>Write-Host</span> <span style=color:#58a1dd>-ForegroundColor</span> <span style=color:#58a1dd>Green</span> <span style=color:#a6be9d>&#34;curl: build completed&#34;</span>
</span></span></code></pre></div><p>构建的 <code>curl -v</code> 输出：</p><pre tabindex=0><code>$ curl -V
curl 7.62.0 (Windows) libcurl/7.62.0 OpenSSL/1.1.1 (WinSSL) zlib/1.2.11 brotli/1.0.7 libssh2/1.8.0 nghttp2/1.34.0
Release-Date: 2018-10-31
Protocols: dict file ftp ftps gopher http https imap imaps ldap pop3 pop3s rtsp scp sftp smtp smtps telnet tftp
Features: AsynchDNS IPv6 Largefile SSPI Kerberos SPNEGO NTLM SSL libz brotli HTTP2 HTTPS-proxy MultiSSL
</code></pre><hr width=100% id=EOF><p style=color:#777>Last modified on 2018-11-15</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2018/2018-11-18-git-namespace-snapshot/>Next<br>基于 Git Namespace 的存储库快照方案
</a><a class=older-posts href=/posts/2018/2018-07-15-git-lfs-rethinking/>Previous<br>Git LFS 的反思</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://forcemz.net/><div class=nav-title>Charlie's Rethinking</div><div class=nav-subtitle>Themed by Diary.</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>归档
</a><a class="a-block nav-link-item false" href=/categories>分类
</a><a class="a-block nav-link-item false" href=/tags>标签
</a><a class="a-block nav-link-item false" href=/about>关于
</a><a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#curl class=nav-curl>cURL</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><script src=/js/journal.js></script></body></html>