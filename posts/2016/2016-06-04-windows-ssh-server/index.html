<!doctype html><html lang=en><head><title>Windows 10 原生 SSH 功能探索</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>归档
</a><a class="a-block drawer-menu-item false" href=/categories>分类
</a><a class="a-block drawer-menu-item false" href=/tags>标签
</a><a class="a-block drawer-menu-item false" href=/about>关于
</a><a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#windows-10-%e5%8e%9f%e7%94%9f-ssh-%e5%8a%9f%e8%83%bd%e6%8e%a2%e7%b4%a2 class=nav-windows-10-原生-ssh-功能探索>Windows 10 原生 SSH 功能探索</a></li><ul><li><a href=#insider class=nav-insider>Insider</a></li><ul><li><a href=#sshsession-insider class=nav-sshsession-insider>SshSession Insider</a></li></ul><li><a href=#%e5%a6%82%e4%bd%95%e4%bd%93%e9%aa%8c class=nav-如何体验>如何体验</a></li><li><a href=#%e5%85%b3%e4%ba%8e%e6%9c%8d%e5%8a%a1 class=nav-关于服务>关于服务</a></li><li><a href=#windows-%e4%b8%8a-ssh--%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 class=nav-windows-上-ssh--解决方案>Windows 上 SSH 解决方案</a></li><li><a href=#ssh-%e5%ba%93 class=nav-ssh-库>SSH 库</a></li><li><a href=#%e5%85%b3%e4%ba%8e-win32-openssh class=nav-关于-win32-openssh>关于 Win32-OpenSSH</a></li><li><a href=#update class=nav-update>Update</a></li><li><a href=#the-end-2018-07-14 class=nav-the-end-2018-07-14>The End (2018-07-14)</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://forcemz.net/>江二十三的思考
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://forcemz.net/><div class=single-column-header-title>江二十三的思考</div><div class=single-column-header-subtitle>Themed by Diary.</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Windows 10 原生 SSH 功能探索<div class=post-meta><time itemprop=datePublished>2016-06-04 20:00
</time><i class=material-icons>folder</i>
<a href=/categories/windows>windows</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h1 id=windows-10-原生-ssh-功能探索>Windows 10 原生 SSH 功能探索</h1><p>在 Windows 10 Insider 14352 中，增加了两个服务 SshBrokerGroup SshProxyGroup，
通过命令</p><p><code>netstat -aon |findstr "22"</code></p><p>即可找到 端口 22 绑定的进程也就是 SshProxyGroup 服务进程，而 22 端口是 SSH 服务器监听的端口，
在 Windows 目录 <em>C:\Windows\System32</em> 可以发现 几个与 SSH 相关的 dll 和 exe：</p><ul><li>SshBroker.dll</li><li>SshProxy.dll</li><li>SshSession.exe</li><li>SshSftp.exe</li></ul><p>实际上 Windows SSH 服务器名称应该是: <strong>Microsoft SSH Server for Windows</strong></p><h2 id=insider>Insider</h2><p>在 Windows 注册表中，对 SSH 服务配置</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\SshBroker
</span></span><span style=display:flex><span>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\SshProxy
</span></span><span style=display:flex><span>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\SharedAccess\Parameters\FirewallPolicy\FirewallRules
</span></span><span style=display:flex><span>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Ssh\Broker
</span></span></code></pre></div><p>其中在 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Ssh\Broker\DevToolsUser</code> auth-method 中支持 key 和密码两种验证方式</p><p>UA 标识为 <strong>SSH-2.0-MS_1.100</strong></p><h3 id=sshsession-insider>SshSession Insider</h3><p>SshSession 基于 C++ 开发，大量使用了 C++11 的特性，尤其是 lambda，加密 API 使用的是 Windows 自身的加密 API。</p><p>通过调试至少可以发现 SshSession 包含以下源码：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>onecore\net\ssh\sshsession\session.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\channel\channeldirecttcpip.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\transport\transportimpl.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\auths\authsmethodpassword.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\authpublickey\authpublickeybase.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kex\kexdiffiehellman.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kex\kexgssapi.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kex\hexecdh.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kex\kexbase.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kex\kexdhbase.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\kexhostkey\kexhostkeybase.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\mac\macbcrypt.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\cipher\cipherbcrypt.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\compression\compressionzlib.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\random\randomdefault.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\core\buffer.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\core\dispatcherport.cpp
</span></span><span style=display:flex><span>onecore\net\ssh\core\timerimpl.cpp
</span></span></code></pre></div><h2 id=如何体验>如何体验</h2><p>开启 SshProxy 和 SshBroker 服务，打开 MSYS2 或者 git for Windows 或者是 Bash on Windows (Bash on Windows 需指定账户名)</p><blockquote><p>ssh localhost</p></blockquote><p>输入当前账户密码即可登录。</p><h2 id=关于服务>关于服务</h2><p>在 Windows Insider 14361 中，SSH Proxy ，SSH Broker 服务修改为非默认启动。</p><h2 id=windows-上-ssh--解决方案>Windows 上 SSH 解决方案</h2><p>在 Windows 上，SSH 客户端（服务器）解决方案有很多，包括</p><ul><li>putty</li><li>secureCRT</li><li>MobaXterm</li><li>KiTTY</li><li>mRemoteNG</li><li>Xshell 4</li><li>Bitvise SSH Client</li><li>Token2Shell</li><li>Cygwin runtime based OpenSSH</li></ul><p>Windows 10 UWP 应用的 SSH 客户端其中有免费方案 SSH Remote，
收费方案：<a href=http://www.microsoft.com/zh-cn/store/apps/token2shell-md/9nblggh2ncx9>Token2Shell/MD</a> （Token2Shell 是桌面版）
Token2Shell/MD 对于 DPI 缩放支持较好。</p><p><img src="https://store-images.s-microsoft.com/image/apps.23934.13510798885708666.95e390d3-4778-4e6b-8dfa-1bd63d467671.e8096d29-4323-464a-a2fe-65a70d4d847c?w=580&amp;h=326&amp;q=60&amp;mode=letterbox&amp;background=black" alt=Token2Shell/MD></p><p>无论是 MSYS，MSYS2，Cygwin 中的 SSH 都是使用的 OpenSSH 方案，当然三者都是基于 cygwin 的兼容层实现的。</p><h2 id=ssh-库>SSH 库</h2><p>SSH 相应的库有多种实现，这里选择几个比较流行的实现：</p><p>| Name | License | Language | Features | Who uses | WebSite |
|&mdash;&mdash;&ndash;|&mdash;&mdash;&mdash;&mdash;-|&mdash;&mdash;&mdash;&ndash;|&mdash;&mdash;&mdash;&mdash;-|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;|
| libssh | LGPL | C C++ | Client Serer, Linux, Windows, Unix,BSD | Github | <a href=https://www.libssh.org/>https://www.libssh.org/</a> |
| libssh2 | MIT | C | Client , Linux, Windows, Unix,BSD | libgit2 | <a href=https://www.libssh2.org/>https://www.libssh2.org/</a> |
| ssh.net | Unknown | C# | Client , Windows | Posh-SSH |http://sshnet.codeplex.com |</p><h2 id=关于-win32-openssh>关于 Win32-OpenSSH</h2><p>Windows PowerShell 团队在 Github 上，fork 创建了 Windows 平台原生的 OpenSSH <a href=github.com/PowerShell/Win32-OpenSSH>Win32-OpenSSH</a>，
在 Win32-OpenSSH 中，PowerShell 团队使用 IOCP， Win32 加密 API 来替代 OpenSSH 加密和网络方面的实现。这样一来，OpenSSH 在 Windows
上可以获得更优异的性能。</p><h2 id=update>Update</h2><p>14383 not found SSH Server Broker and SSH Server Proxy</p><p>14385 Found</p><p>14388 Not Found</p><p>14390 Not Found</p><p>14393 Red Stone Found</p><h2 id=the-end-2018-07-14>The End (2018-07-14)</h2><p>Windows 内置的 SSH 服务器主要用于 IOT(?) 目前已经删除，目前 Windows 可以安装经过微软官方移植的 OpenSSH 客户端。</p><hr width=100% id=EOF><p style=color:#777>Last modified on 2016-06-04</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2016/2016-07-09-git-storage/>Next<br>Git 存储格式与运用
</a><a class=older-posts href=/posts/2016/2016-04-23-windows-containers/>Previous<br>Windows Containers 与 Project Centennial</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://forcemz.net/><div class=nav-title>江二十三的思考</div><div class=nav-subtitle>Themed by Diary.</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>归档
</a><a class="a-block nav-link-item false" href=/categories>分类
</a><a class="a-block nav-link-item false" href=/tags>标签
</a><a class="a-block nav-link-item false" href=/about>关于
</a><a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#windows-10-%e5%8e%9f%e7%94%9f-ssh-%e5%8a%9f%e8%83%bd%e6%8e%a2%e7%b4%a2 class=nav-windows-10-原生-ssh-功能探索>Windows 10 原生 SSH 功能探索</a></li><ul><li><a href=#insider class=nav-insider>Insider</a></li><ul><li><a href=#sshsession-insider class=nav-sshsession-insider>SshSession Insider</a></li></ul><li><a href=#%e5%a6%82%e4%bd%95%e4%bd%93%e9%aa%8c class=nav-如何体验>如何体验</a></li><li><a href=#%e5%85%b3%e4%ba%8e%e6%9c%8d%e5%8a%a1 class=nav-关于服务>关于服务</a></li><li><a href=#windows-%e4%b8%8a-ssh--%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 class=nav-windows-上-ssh--解决方案>Windows 上 SSH 解决方案</a></li><li><a href=#ssh-%e5%ba%93 class=nav-ssh-库>SSH 库</a></li><li><a href=#%e5%85%b3%e4%ba%8e-win32-openssh class=nav-关于-win32-openssh>关于 Win32-OpenSSH</a></li><li><a href=#update class=nav-update>Update</a></li><li><a href=#the-end-2018-07-14 class=nav-the-end-2018-07-14>The End (2018-07-14)</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><script src=/js/journal.js></script></body></html>