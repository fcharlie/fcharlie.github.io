<!doctype html><html lang=en><head><title>Kismet 杂谈</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>归档
</a><a class="a-block drawer-menu-item false" href=/categories>分类
</a><a class="a-block drawer-menu-item false" href=/tags>标签
</a><a class="a-block drawer-menu-item false" href=/about>关于
</a><a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#%e5%89%8d%e8%a8%80 class=nav-前言>前言</a></li><ul><li><a href=#sha-3 class=nav-sha-3>SHA-3</a></li><li><a href=#kismet class=nav-kismet>Kismet</a></li><li><a href=#kismet-uwp class=nav-kismet-uwp>Kismet UWP</a></li><li><a href=#%e9%99%84%e5%bd%95 class=nav-附录>附录</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://forcemz.net/>江二十三的思考
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://forcemz.net/><div class=single-column-header-title>江二十三的思考</div><div class=single-column-header-subtitle>Themed by Diary.</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Kismet 杂谈<div class=post-meta><time itemprop=datePublished>2017-05-14 10:00
</time><i class=material-icons>folder</i>
<a href=/categories/developer>developer</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h1 id=前言>前言</h1><p>年初以来，互联网安全领域频繁发生大事件，二月下旬，Google 研究人员攻破了 SHA-1算法，在版本控制领域，主要的版本控制系统都使用了 SHA-1 算法<sup>1</sup>，由于工作需要，我对此格外关注，也了解了其他 SHA 算法，比如 SHA-256/SHA-512 ，基于 Keccak 的 SHA-3 等，寻找 GUI Hash 计算工具时发现大多数工具都未提供 SHA-3 算法支持，并且界面也不符合我的喜好，在闲暇时间，我就开发了 kismat Hash 计算工具，包括传统的Win32 桌面程序和 UWP 程序。</p><h2 id=sha-3>SHA-3</h2><p>在 SHA-1 被攻破的十年前，NIST 就已经开始了 SHA-3 算法的征集，经过几年的选拔和测试，2012 年 Keccak 被选为优胜者，成为了 SHA-3。</p><p><strong>Keccak</strong> 官方网站：<a href=http://keccak.noekeon.org/>http://keccak.noekeon.org/</a> 在这里，你可以下载 NIST 的原始版本。
在 <a href=https://github.com/gvanas/KeccakCodePackage>Keccak Code Package</a><sup>2</sup> 项目中你可以下载 SHA-3 以及各种变种。</p><p>Github 上 C/C++ 的 SHA-3 实现非常多，但是基础平台的加密算法库都未实现，如 Windows CNG, Apple Security.framework,OpenSSL。在 Window 中截至到 Windows 10 10.0.15063, CNG 依然没有支持 SHA-3，同样的，虽然 OpenSSL 添加了 <code>keccak1600.c</code> 但是其 SHA-3 依然未完全实现。</p><p>ARM mbed 的 <code>mbedtls</code><sup>3</sup> Google 的 <code>Boringssl</code><sup>4</sup> OpenBSD 的 <code>LibreSSL</code><sup>5</sup> 也未支持 SHA-3。</p><p>下面是 <code>bcrypt.h</code> 关于加密算法的定义：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RSA_ALGORITHM                    L&#34;RSA&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RSA_SIGN_ALGORITHM               L&#34;RSA_SIGN&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_DH_ALGORITHM                     L&#34;DH&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_DSA_ALGORITHM                    L&#34;DSA&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RC2_ALGORITHM                    L&#34;RC2&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RC4_ALGORITHM                    L&#34;RC4&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_AES_ALGORITHM                    L&#34;AES&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_DES_ALGORITHM                    L&#34;DES&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_DESX_ALGORITHM                   L&#34;DESX&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_3DES_ALGORITHM                   L&#34;3DES&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_3DES_112_ALGORITHM               L&#34;3DES_112&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_MD2_ALGORITHM                    L&#34;MD2&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_MD4_ALGORITHM                    L&#34;MD4&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_MD5_ALGORITHM                    L&#34;MD5&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SHA1_ALGORITHM                   L&#34;SHA1&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SHA256_ALGORITHM                 L&#34;SHA256&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SHA384_ALGORITHM                 L&#34;SHA384&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SHA512_ALGORITHM                 L&#34;SHA512&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_AES_GMAC_ALGORITHM               L&#34;AES-GMAC&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_AES_CMAC_ALGORITHM               L&#34;AES-CMAC&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDSA_P256_ALGORITHM             L&#34;ECDSA_P256&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDSA_P384_ALGORITHM             L&#34;ECDSA_P384&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDSA_P521_ALGORITHM             L&#34;ECDSA_P521&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDH_P256_ALGORITHM              L&#34;ECDH_P256&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDH_P384_ALGORITHM              L&#34;ECDH_P384&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDH_P521_ALGORITHM              L&#34;ECDH_P521&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RNG_ALGORITHM                    L&#34;RNG&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RNG_FIPS186_DSA_ALGORITHM        L&#34;FIPS186DSARNG&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_RNG_DUAL_EC_ALGORITHM            L&#34;DUALECRNG&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#if (NTDDI_VERSION &gt;= NTDDI_WIN8)
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SP800108_CTR_HMAC_ALGORITHM      L&#34;SP800_108_CTR_HMAC&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_SP80056A_CONCAT_ALGORITHM        L&#34;SP800_56A_CONCAT&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_PBKDF2_ALGORITHM                 L&#34;PBKDF2&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_CAPI_KDF_ALGORITHM               L&#34;CAPI_KDF&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_TLS1_1_KDF_ALGORITHM             L&#34;TLS1_1_KDF&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_TLS1_2_KDF_ALGORITHM             L&#34;TLS1_2_KDF&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#endif
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#if (NTDDI_VERSION &gt;= NTDDI_WINTHRESHOLD)
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDSA_ALGORITHM                  L&#34;ECDSA&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_ECDH_ALGORITHM                   L&#34;ECDH&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#define BCRYPT_XTS_AES_ALGORITHM                L&#34;XTS-AES&#34;
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>#endif
</span></span></span></code></pre></div><p>如果开发者需要支持 SHA-3 ，又要考虑提供库的稳定性，可以选择 <a href=https://github.com/rhash/RHash>RHash</a> , CMake 3.8 开始使用 RHash 支持 SHA-3 ,地址为：<a href=https://gitlab.kitware.com/cmake/cmake/tree/master/Utilities/cmlibrhash>Utilities/cmlibrhash</a>。</p><p>在其他语言中，大多是第三方库支持 SHA-3，然而标准库或者平台 API 并未实现（这些语言标准库可能使用 Windows CNG 或者 OpenSSL 的加密算法实现）。</p><h2 id=kismet>Kismet</h2><p>Kismet 是一个传统的 Win32 程序，使用 ATL 封装窗口，Direct2D 绘制界面，Hash 库使用的正是 RHash，RHash 支持 MD4,MD5,SHA-1,SHA-224/256,SHA-384/512,SHA-3 (224,256,384,512) ,能够很大程度的避免引入多个依赖库。如果使用 Windows CNG，还需要额外添加 SHA-3 支持，反而没有直接使用 RHash 方便。</p><p>Kismet Github 托管地址为： <a href=https://github.com/fcharlie/Kismet>https://github.com/fcharlie/Kismet</a> 开源协议为 MIT。</p><p>Kismet 包装 RHash 的代码在： <a href=https://github.com/fcharlie/Kismet/blob/master/Kismet/Hashsum.cpp>Hashusm.cpp</a> 中，Hashsum 接口类为：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff636f>class</span> <span style=color:#58a1dd>Hashsum</span> {
</span></span><span style=display:flex><span><span style=color:#ff636f>public</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>	<span style=color:#ff636f>virtual</span> <span style=color:#ff636f>void</span> <span style=color:#58a1dd>Initialize</span>(<span style=color:#ff636f>int</span> <span style=color:#58a1dd>width</span>) <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>virtual</span> <span style=color:#ff636f>void</span> <span style=color:#58a1dd>Update</span>(<span style=color:#ff636f>const</span> <span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>buf</span>, <span style=color:#58a1dd>size_t</span> <span style=color:#58a1dd>len</span>) <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>virtual</span> <span style=color:#ff636f>void</span> <span style=color:#58a1dd>Final</span>(<span style=color:#ff636f>bool</span> <span style=color:#58a1dd>ucase</span>, <span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>hash</span>) <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>二进制数据转 16 进制：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff636f>static</span> <span style=color:#ff636f>inline</span> <span style=color:#ff636f>void</span> <span style=color:#58a1dd>BinaryToHex</span>(<span style=color:#ff636f>const</span> <span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>buf</span>, <span style=color:#58a1dd>size_t</span> <span style=color:#58a1dd>len</span>, <span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>str</span>) {
</span></span><span style=display:flex><span>	<span style=color:#ff636f>char</span> <span style=color:#58a1dd>to_hex</span>[] <span style=color:#ff636f>=</span> <span style=color:#a6be9d>&#34;0123456789abcdef&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>for</span> (<span style=color:#ff636f>uint32_t</span> <span style=color:#58a1dd>i</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>; <span style=color:#58a1dd>i</span> <span style=color:#ff636f>&lt;</span> <span style=color:#58a1dd>len</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>++</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span> <span style=color:#58a1dd>val</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>i</span>];
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>str</span>.<span style=color:#58a1dd>push_back</span>(<span style=color:#58a1dd>to_hex</span>[<span style=color:#58a1dd>val</span> <span style=color:#ff636f>&gt;&gt;</span> <span style=color:#a6be9d>4</span>]);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>str</span>.<span style=color:#58a1dd>push_back</span>(<span style=color:#58a1dd>to_hex</span>[<span style=color:#58a1dd>val</span> <span style=color:#ff636f>&amp;</span> <span style=color:#a6be9d>0xf</span>]);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>static</span> <span style=color:#ff636f>inline</span> <span style=color:#ff636f>void</span> <span style=color:#58a1dd>BinaryToHexUCase</span>(<span style=color:#ff636f>const</span> <span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>buf</span>, <span style=color:#58a1dd>size_t</span> <span style=color:#58a1dd>len</span>, <span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>str</span>) {
</span></span><span style=display:flex><span>	<span style=color:#ff636f>char</span> <span style=color:#58a1dd>to_hex</span>[] <span style=color:#ff636f>=</span> <span style=color:#a6be9d>&#34;0123456789ABCDEF&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>for</span> (<span style=color:#ff636f>uint32_t</span> <span style=color:#58a1dd>i</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>; <span style=color:#58a1dd>i</span> <span style=color:#ff636f>&lt;</span> <span style=color:#58a1dd>len</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>++</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span> <span style=color:#58a1dd>val</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>i</span>];
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>str</span>.<span style=color:#58a1dd>push_back</span>(<span style=color:#58a1dd>to_hex</span>[<span style=color:#58a1dd>val</span> <span style=color:#ff636f>&gt;&gt;</span> <span style=color:#a6be9d>4</span>]);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>str</span>.<span style=color:#58a1dd>push_back</span>(<span style=color:#58a1dd>to_hex</span>[<span style=color:#58a1dd>val</span> <span style=color:#ff636f>&amp;</span> <span style=color:#a6be9d>0xf</span>]);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>而使用 Hashsum 的代码如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#58a1dd>Hashsum</span> <span style=color:#ff636f>*</span> <span style=color:#58a1dd>CreateHashsum</span>(<span style=color:#ff636f>const</span> <span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#ff636f>&amp;</span> <span style=color:#58a1dd>file</span>, <span style=color:#ff636f>int</span> <span style=color:#58a1dd>alg</span>, <span style=color:#ff636f>int</span> <span style=color:#58a1dd>width</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>Hashsum</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>nullptr</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>switch</span> (<span style=color:#58a1dd>alg</span>) {
</span></span><span style=display:flex><span>	<span style=color:#ff636f>case</span> <span style=color:#58a1dd>kFilesumMD5</span>:
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>MD5Hashsum</span>();
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>case</span> <span style=color:#58a1dd>kFilesumSHA1</span>:
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>SHA1Sum</span>();
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>case</span> <span style=color:#58a1dd>kFilesumSHA1DC</span>:
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>SHADC1Sum</span>();
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>case</span> <span style=color:#58a1dd>kFilesumSHA2</span>:
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>width</span> <span style=color:#ff636f>&lt;=</span> <span style=color:#a6be9d>256</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>SHA256Sum</span>();
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#ff636f>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>SHA512Sum</span>();
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>case</span> <span style=color:#58a1dd>kFilesumSHA3</span>:
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>new</span> <span style=color:#58a1dd>SHA3Sum</span>();
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Initialize</span>(<span style=color:#58a1dd>width</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>default</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#ff636f>nullptr</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>return</span> <span style=color:#58a1dd>sum</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在 GUI 程序的开发过程中，如果在主线程执行耗时的操作会导致界面失去响应，这个时候就需要使用多线程，使用 Win32 API <code>CreateThread</code> CRT 的 <code>_beginthread</code> 这些都需要传递全局函数，使用 lambda 的话非常 Ugly。这个是用可以使用 <code>std::thread</code> 但是如果执行了多个计算过程，就会需要启动多个线程，不过对于 Kismet 这样的小工具无关紧要。我在开发 Git LFS Server (Moses) 时使用了 <code>cpprestsdk</code> 了解了 <code>PPL</code><sup>6</sup> ,在 Windows 10 中，如果使用 C++/CX 开发 App 时也是使用了 PPL<sup>7</sup>。在 Kismet 中，我也就采用了 PPL，代码如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#58a1dd>LRESULT</span> <span style=color:#58a1dd>NeonWindow</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>Filesum</span>(<span style=color:#ff636f>const</span> <span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#ff636f>&amp;</span> <span style=color:#58a1dd>file</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>file</span>.<span style=color:#58a1dd>empty</span>()) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>S_FALSE</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>locked</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>S_FALSE</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>FilesumAlgw</span> <span style=color:#58a1dd>aw</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> (<span style=color:#ff636f>!</span><span style=color:#58a1dd>HashsumAlgmCheck</span>(<span style=color:#58a1dd>ComboBox_GetCurSel</span>(<span style=color:#58a1dd>hCombo</span>), <span style=color:#58a1dd>aw</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>filetext</span>.<span style=color:#58a1dd>clear</span>();
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>hash</span>.<span style=color:#58a1dd>clear</span>();
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>sizetext</span>.<span style=color:#58a1dd>clear</span>();
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>wstring</span> <span style=color:#58a1dd>title</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>title</span>.<span style=color:#58a1dd>append</span>(<span style=color:#a6be9d>L</span><span style=color:#a6be9d>&#34;(&#34;</span>).<span style=color:#58a1dd>append</span>(<span style=color:#58a1dd>aw</span>.<span style=color:#58a1dd>name</span>).<span style=color:#58a1dd>append</span>(<span style=color:#a6be9d>L</span><span style=color:#a6be9d>&#34;) &#34;</span>).<span style=color:#58a1dd>append</span>(<span style=color:#58a1dd>PathFindFileNameW</span>(<span style=color:#58a1dd>file</span>.<span style=color:#58a1dd>data</span>()));
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>UpdateTitle</span>(<span style=color:#58a1dd>title</span>);
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>showerror</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>Concurrency</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>create_task</span>([<span style=color:#ff636f>this</span>, <span style=color:#58a1dd>file</span>,<span style=color:#58a1dd>aw</span>]()<span style=color:#ff636f>-&gt;</span><span style=color:#ff636f>bool</span> {
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>shared_ptr</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>Hashsum</span><span style=color:#ff636f>&gt;</span> <span style=color:#58a1dd>sum</span>(<span style=color:#58a1dd>CreateHashsum</span>(<span style=color:#58a1dd>file</span>, <span style=color:#58a1dd>aw</span>.<span style=color:#58a1dd>alm</span>, <span style=color:#58a1dd>aw</span>.<span style=color:#58a1dd>width</span>));
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#ff636f>!</span><span style=color:#58a1dd>sum</span>) {
</span></span><span style=display:flex><span>			<span style=color:#ff636f>return</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>AllocSingle</span> <span style=color:#58a1dd>as</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>BYTE</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>buffer</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>as</span>.<span style=color:#58a1dd>Alloc</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>BYTE</span><span style=color:#ff636f>&gt;</span>(<span style=color:#58a1dd>AllocSingle</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>kInternalBufferSize</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>as</span>.<span style=color:#58a1dd>size</span>() <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span> <span style=color:#ff636f>||</span> <span style=color:#58a1dd>buffer</span> <span style=color:#ff636f>==</span> <span style=color:#ff636f>nullptr</span>) {
</span></span><span style=display:flex><span>			<span style=color:#ff636f>return</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#ff636f>auto</span> <span style=color:#58a1dd>hFile</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>CreateFileW</span>(<span style=color:#58a1dd>file</span>.<span style=color:#58a1dd>data</span>(),
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>GENERIC_READ</span>,
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>FILE_SHARE_READ</span>,
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>NULL</span>,
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>OPEN_EXISTING</span>,
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>FILE_ATTRIBUTE_NORMAL</span>,
</span></span><span style=display:flex><span>			<span style=color:#ff636f>nullptr</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>hFile</span> <span style=color:#ff636f>==</span> <span style=color:#58a1dd>INVALID_HANDLE_VALUE</span>) {
</span></span><span style=display:flex><span>			<span style=color:#ff636f>return</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>LARGE_INTEGER</span> <span style=color:#58a1dd>li</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>GetFileSizeEx</span>(<span style=color:#58a1dd>hFile</span>, <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>li</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>file</span>.<span style=color:#58a1dd>size</span>() <span style=color:#ff636f>&gt;</span> <span style=color:#a6be9d>64</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>filetext</span>.<span style=color:#58a1dd>assign</span>(<span style=color:#58a1dd>PathFindFileNameW</span>(<span style=color:#58a1dd>file</span>.<span style=color:#58a1dd>data</span>()));
</span></span><span style=display:flex><span>			<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>filetext</span>.<span style=color:#58a1dd>size</span>() <span style=color:#ff636f>&gt;</span> <span style=color:#a6be9d>64</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>filetext</span>.<span style=color:#58a1dd>resize</span>(<span style=color:#a6be9d>64</span>);
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>filetext</span>.<span style=color:#58a1dd>append</span>(<span style=color:#a6be9d>L</span><span style=color:#a6be9d>&#34;...&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#ff636f>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>filetext</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>file</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sizetext</span>.<span style=color:#58a1dd>assign</span>(<span style=color:#58a1dd>std</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>to_wstring</span>(<span style=color:#58a1dd>li</span>.<span style=color:#58a1dd>QuadPart</span>));
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>InvalidateRect</span>(<span style=color:#ff636f>nullptr</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>DWORD</span> <span style=color:#58a1dd>dwRead</span>;
</span></span><span style=display:flex><span>		<span style=color:#ff636f>int64_t</span> <span style=color:#58a1dd>cmsize</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>		<span style=color:#ff636f>uint32_t</span> <span style=color:#58a1dd>pg</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>		<span style=color:#ff636f>for</span> (;;) {
</span></span><span style=display:flex><span>			<span style=color:#ff636f>if</span> (<span style=color:#ff636f>!</span><span style=color:#58a1dd>ReadFile</span>(<span style=color:#58a1dd>hFile</span>, <span style=color:#58a1dd>buffer</span>, <span style=color:#58a1dd>AllocSingle</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>kInternalBufferSize</span>, <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>dwRead</span>, <span style=color:#ff636f>nullptr</span>)) {
</span></span><span style=display:flex><span>				<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Update</span>(<span style=color:#58a1dd>buffer</span>, <span style=color:#58a1dd>dwRead</span>);
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>cmsize</span> <span style=color:#ff636f>+=</span> <span style=color:#58a1dd>dwRead</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>auto</span> <span style=color:#58a1dd>N</span> <span style=color:#ff636f>=</span> (<span style=color:#ff636f>uint32_t</span>)(<span style=color:#58a1dd>cmsize</span> <span style=color:#ff636f>*</span> <span style=color:#a6be9d>100</span> <span style=color:#ff636f>/</span> <span style=color:#58a1dd>li</span>.<span style=color:#58a1dd>QuadPart</span>);
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>progress</span> <span style=color:#ff636f>=</span> (<span style=color:#ff636f>uint32_t</span>)<span style=color:#58a1dd>N</span>;
</span></span><span style=display:flex><span>			<span style=color:#828b96;font-style:italic>/// when number is modify, Flush Window
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>			<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>pg</span> <span style=color:#ff636f>!=</span> <span style=color:#58a1dd>N</span>) {
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>pg</span> <span style=color:#ff636f>=</span> (<span style=color:#ff636f>uint32_t</span>)<span style=color:#58a1dd>N</span>;
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>InvalidateRect</span>(<span style=color:#ff636f>nullptr</span>,<span style=color:#58a1dd>FALSE</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>dwRead</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>AllocSingle</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>kInternalBufferSize</span>)
</span></span><span style=display:flex><span>				<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>CloseHandle</span>(<span style=color:#58a1dd>hFile</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>hash</span>.<span style=color:#58a1dd>clear</span>();
</span></span><span style=display:flex><span>		<span style=color:#ff636f>bool</span> <span style=color:#58a1dd>ucase</span> <span style=color:#ff636f>=</span> (<span style=color:#58a1dd>Button_GetCheck</span>(<span style=color:#58a1dd>hCheck</span>) <span style=color:#ff636f>==</span> <span style=color:#58a1dd>BST_CHECKED</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sum</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Final</span>(<span style=color:#58a1dd>ucase</span>, <span style=color:#58a1dd>hash</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>true</span>;
</span></span><span style=display:flex><span>	}).<span style=color:#58a1dd>then</span>([<span style=color:#ff636f>this</span>](<span style=color:#ff636f>bool</span> <span style=color:#58a1dd>result</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#ff636f>!</span><span style=color:#58a1dd>result</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>showerror</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>true</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>InvalidateRect</span>(<span style=color:#ff636f>nullptr</span>,<span style=color:#58a1dd>FALSE</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>locked</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>false</span>;
</span></span><span style=display:flex><span>	});
</span></span><span style=display:flex><span>	<span style=color:#ff636f>return</span> <span style=color:#58a1dd>S_OK</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>使用 PPL 和 lambda 能够很方便的使用窗口类的变量，PPL 使用线程池也是非常高效的。</p><p>窗口图形方面，我使用的是 Direct2D，在 Windows 10 中，Direct2D 对 Emoji 的支持更好了，能够支持彩色 ❤ 。同样在文字渲染方面也优于 GDI。</p><p>使用 Direct2D <code>ID2D1RenderTarget::DrawText</code> 时，将 <code>D2D1_DRAW_TEXT_OPTIONS options</code> 设置为 <code>D2D1_DRAW_TEXT_OPTIONS_ENABLE_COLOR_FONT</code>，就可以支持彩色 Emoji 了。下面是 Kismet 工具的一些截图：</p><p>无状态窗口：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/none.png alt=none></p><p>自定义标题栏：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/title.png alt=title></p><p>冲突检测：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/coll.png alt=coll></p><p>计算中：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/progress.png alt=progress></p><p>计算完成：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/complete.png alt=complete></p><p>SHA-3 512：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/sha3-512.png alt=sha3-512></p><p>自定义主题色：</p><p><img src=https://github.com/fcharlie/Kismet/raw/master/docs/images/theme.png alt=theme></p><h2 id=kismet-uwp>Kismet UWP</h2><p>UWP 程序应该是以后 Windows App 开发的趋势，作为 Microsoft 技术爱好者，自然也会开发简易的 UWP App 。</p><p>RHash 移植到 UWP 还是很容易的，得益于 Windows ucrt<sup>8</sup>, RHash 可以无缝迁移到 UWP 中，唯一比较麻烦的是，UWP App 读取文件的缓冲区是 <code>Windows::Storage::Streams::IBuffer</code>，而 RHash 使用的是直接内存，解决方案如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#58a1dd>byte</span> <span style=color:#ff636f>*</span> <span style=color:#58a1dd>KismetUWP</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>MainPage</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>GetPointerToPixelData</span>(<span style=color:#58a1dd>Windows</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>Storage</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>Streams</span><span style=color:#ff636f>::</span><span style=color:#58a1dd>IBuffer</span> <span style=color:#ff636f>^</span> <span style=color:#58a1dd>pixelBuffer</span>, <span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span> <span style=color:#ff636f>*</span> <span style=color:#58a1dd>length</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>Object</span><span style=color:#ff636f>^</span> <span style=color:#58a1dd>obj</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>pixelBuffer</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>ComPtr</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>IInspectable</span><span style=color:#ff636f>&gt;</span> <span style=color:#58a1dd>insp</span>(<span style=color:#ff636f>reinterpret_cast</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>IInspectable</span><span style=color:#ff636f>*&gt;</span>(<span style=color:#58a1dd>obj</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#828b96;font-style:italic>// Query the IBufferByteAccess interface.
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>	<span style=color:#58a1dd>ComPtr</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>IBufferByteAccess</span><span style=color:#ff636f>&gt;</span> <span style=color:#58a1dd>bufferByteAccess</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>insp</span>.<span style=color:#58a1dd>As</span>(<span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>bufferByteAccess</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#828b96;font-style:italic>// Retrieve the buffer data.
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>	<span style=color:#58a1dd>byte</span><span style=color:#ff636f>*</span> <span style=color:#58a1dd>pixels</span> <span style=color:#ff636f>=</span> <span style=color:#ff636f>nullptr</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>bufferByteAccess</span><span style=color:#ff636f>-&gt;</span><span style=color:#58a1dd>Buffer</span>(<span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>pixels</span>);
</span></span><span style=display:flex><span>	<span style=color:#ff636f>return</span> <span style=color:#58a1dd>pixels</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>通过 <code>GetPointerToPixelData</code> 将 IBuffer 转换为 <code>BYTE*</code>。这样是有代价的，一个较大的文件 Kismet 的计算速度快于 Kismet UWP。</p><p>在 UWP 程序中，IO 的读写往往异步的，开发者使用 PPL 即可，如果在 Visual Studio 2015 Update 2 以上版本中设置了 <code>/await</code> 就可以使用 <code>co_wait</code> 简化异步操作。MSDN 文档：<a href=https://blogs.msdn.microsoft.com/vcblog/2016/04/04/using-c-coroutines-to-simplify-async-uwp-code/>https://blogs.msdn.microsoft.com/vcblog/2016/04/04/using-c-coroutines-to-simplify-async-uwp-code/</a></p><p>Kismet UWP 在 Github 上的地址为：<a href=https://github.com/fcharlie/KismetUWP>https://github.com/fcharlie/KismetUWP</a></p><p>Kismet UWP 的截图如下：</p><p>初始界面：</p><p><img src=https://github.com/fcharlie/KismetUWP/raw/master/docs/images/none.png alt=u1></p><p>计算完成：</p><p><img src=https://github.com/fcharlie/KismetUWP/raw/master/docs/images/hash.png alt=u2></p><p>由于开发者账号的缘故，Kismet UWP 并未发布到 Windows Store，需要使用的用户可以自己克隆构建。</p><h2 id=附录>附录</h2><ol><li>Git 将对象类型（blob,tree,commit）与长度以及文件内容连接在一起做 SHA-1 计算。Subversion 的 SHA-1 冲突要严重多了。</li><li>KCP KeccakCodePackage <a href=https://github.com/gvanas/KeccakCodePackage>(https://github.com/gvanas/KeccakCodePackage)</a></li><li>Mbedtls <a href=https://github.com/ARMmbed/mbedtls>https://github.com/ARMmbed/mbedtls</a></li><li>BoringSSL <a href=https://github.com/google/boringssl>https://github.com/google/boringssl</a></li><li>LibreSSL <a href=http://www.libressl.org/>http://www.libressl.org/</a></li><li>Parallel Patterns Library (PPL) <a href=https://msdn.microsoft.com/en-us/library/dd492418.aspx>https://msdn.microsoft.com/en-us/library/dd492418.aspx</a></li><li>Asynchronous programming in C++ <a href=https://docs.microsoft.com/en-us/windows/uwp/threading-async/asynchronous-programming-in-cpp-universal-windows-platform-apps>https://docs.microsoft.com/en-us/windows/uwp/threading-async/asynchronous-programming-in-cpp-universal-windows-platform-apps</a></li><li>CRT Library Features <a href=https://msdn.microsoft.com/en-us/library/abx4dbyh.aspx>https://msdn.microsoft.com/en-us/library/abx4dbyh.aspx</a></li></ol><hr width=100% id=EOF><p style=color:#777>Last modified on 2017-05-14</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2017/2017-06-05-color-console/>Next<br>Privexec 的内幕（一）标准输出原理与彩色输出实现
</a><a class=older-posts href=/posts/2017/2017-05-11-angelo/>Previous<br>基于 AspNetCore 的 Git HTTP 服务器</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://forcemz.net/><div class=nav-title>江二十三的思考</div><div class=nav-subtitle>Themed by Diary.</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>归档
</a><a class="a-block nav-link-item false" href=/categories>分类
</a><a class="a-block nav-link-item false" href=/tags>标签
</a><a class="a-block nav-link-item false" href=/about>关于
</a><a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#%e5%89%8d%e8%a8%80 class=nav-前言>前言</a></li><ul><li><a href=#sha-3 class=nav-sha-3>SHA-3</a></li><li><a href=#kismet class=nav-kismet>Kismet</a></li><li><a href=#kismet-uwp class=nav-kismet-uwp>Kismet UWP</a></li><li><a href=#%e9%99%84%e5%bd%95 class=nav-附录>附录</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><script src=/js/journal.js></script></body></html>