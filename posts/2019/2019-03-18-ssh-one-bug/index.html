<!doctype html><html lang=en><head><title>记录 SSH 的一个 Bug</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>归档
</a><a class="a-block drawer-menu-item false" href=/categories>分类
</a><a class="a-block drawer-menu-item false" href=/tags>标签
</a><a class="a-block drawer-menu-item false" href=/about>关于
</a><a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><ul><li><a href=#%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e9%94%99%e8%af%af%e7%9a%84%e5%91%bd%e4%bb%a4%e8%a1%8c class=nav-服务器上错误的命令行>服务器上错误的命令行</a></li><li><a href=#%e6%99%ae%e9%81%8d%e7%9a%84%e7%b3%9f%e7%b3%95 class=nav-普遍的糟糕>普遍的糟糕</a></li><li><a href=#openssh-%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%9a%84%e5%91%bd%e4%bb%a4%e8%a1%8c%e8%a7%a3%e6%9e%90 class=nav-openssh-服务端的命令行解析>OpenSSH 服务端的命令行解析</a></li><li><a href=#%e5%b0%9d%e8%af%95%e4%bf%ae%e5%a4%8d class=nav-尝试修复>尝试修复</a></li><li><a href=#%e6%9c%80%e5%90%8e class=nav-最后>最后</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://forcemz.net/>Charlie's Rethinking
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://forcemz.net/><div class=single-column-header-title>Charlie's Rethinking</div><div class=single-column-header-subtitle>Themed by Diary.</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>记录 SSH 的一个 Bug<div class=post-meta><time itemprop=datePublished>2019-03-18 18:00
</time><i class=material-icons>folder</i>
<a href=/categories/ssh>ssh</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h2 id=服务器上错误的命令行>服务器上错误的命令行</h2><p>最近在改进 BSSHD，将不被允许的命令打印到日志，但是我遇到了一个不符合预期的输出，比如，在客户端运行 SSH，命令如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh git@localhost <span style=color:#58a1dd>echo</span> <span style=color:#a6be9d>&#34;There are spaces in the statement&#34;</span> <span style=color:#ff636f>done</span>
</span></span></code></pre></div><p>我将命令行使用如下处理后输出：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#58a1dd>fmt</span>.<span style=color:#58a1dd>Fprintf</span>(<span style=color:#58a1dd>os</span>.<span style=color:#58a1dd>Stderr</span>, <span style=color:#a6be9d>&#34;%s\n&#34;</span>, <span style=color:#58a1dd>strings</span>.<span style=color:#58a1dd>Join</span>(<span style=color:#58a1dd>s</span>.<span style=color:#58a1dd>Command</span>(), <span style=color:#a6be9d>&#34;;&#34;</span>))
</span></span></code></pre></div><p>我们在服务器上命令行的输出如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>echo;There;are;spaces;in;the;statement;<span style=color:#ff636f>done</span>
</span></span></code></pre></div><p>上述输出与预期完全不一致，通常情况下，命令行的输出应该如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>echo;There are spaces in the statement;<span style=color:#ff636f>done</span>
</span></span></code></pre></div><p>我们可以编译一个命令行程序验证一下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#828b96;font-style:italic>// echo.go
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>// go build echo.go
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span><span style=color:#ff636f>package</span> <span style=color:#58a1dd>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6be9d>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6be9d>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6be9d>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff636f>func</span> <span style=color:#58a1dd>main</span>(){
</span></span><span style=display:flex><span> <span style=color:#58a1dd>fmt</span>.<span style=color:#58a1dd>Fprintf</span>(<span style=color:#58a1dd>os</span>.<span style=color:#58a1dd>Stderr</span>, <span style=color:#a6be9d>&#34;%s\n&#34;</span>, <span style=color:#58a1dd>strings</span>.<span style=color:#58a1dd>Join</span>(<span style=color:#58a1dd>os</span>.<span style=color:#58a1dd>Args</span>, <span style=color:#a6be9d>&#34;;&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后运行输出结果如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./echo <span style=color:#a6be9d>&#34;There are spaces in the statement&#34;</span> <span style=color:#ff636f>done</span>
</span></span><span style=display:flex><span>./echo;There are spaces in the statement;<span style=color:#ff636f>done</span>
</span></span></code></pre></div><p>这就说明，SSH 的解析出了问题。我们使用的是 <a href=https://github.com/gliderlabs/ssh>github.com/gliderlabs/ssh</a>，这个问题是否是与 <code>gliderlabs/ssh</code> 解析有关，我们不能过早的下结论，我们可以修改 <code>gliderlabs/ssh</code> 的源码验证一番。</p><p><code>gliderlabs/ssh</code> 的命令行解析代码在：<a href=https://github.com/gliderlabs/ssh/blob/ef6d89046be36104109e42ac1fee6601f9be95d7/session.go#L217>https://github.com/gliderlabs/ssh/blob/ef6d89046be36104109e42ac1fee6601f9be95d7/session.go#L217</a>：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>			<span style=color:#ff636f>var</span> <span style=color:#58a1dd>payload</span> = <span style=color:#ff636f>struct</span>{ <span style=color:#58a1dd>Value</span> <span style=color:#ff636f>string</span> }{}
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>gossh</span>.<span style=color:#58a1dd>Unmarshal</span>(<span style=color:#58a1dd>req</span>.<span style=color:#58a1dd>Payload</span>, <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>payload</span>)
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>sess</span>.<span style=color:#58a1dd>cmd</span>, <span style=color:#58a1dd>_</span> = <span style=color:#58a1dd>shlex</span>.<span style=color:#58a1dd>Split</span>(<span style=color:#58a1dd>payload</span>.<span style=color:#58a1dd>Value</span>, <span style=color:#ff636f>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#828b96;font-style:italic>// If there&#39;s a session policy callback, we need to confirm before
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>			<span style=color:#828b96;font-style:italic>// accepting the session.
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>			<span style=color:#ff636f>if</span> <span style=color:#58a1dd>sess</span>.<span style=color:#58a1dd>sessReqCb</span> <span style=color:#ff636f>!=</span> <span style=color:#ff636f>nil</span> <span style=color:#ff636f>&amp;&amp;</span> !<span style=color:#58a1dd>sess</span>.<span style=color:#58a1dd>sessReqCb</span>(<span style=color:#58a1dd>sess</span>, <span style=color:#58a1dd>req</span>.<span style=color:#58a1dd>Type</span>) {
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>sess</span>.<span style=color:#58a1dd>cmd</span> = <span style=color:#ff636f>nil</span>
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>req</span>.<span style=color:#58a1dd>Reply</span>(<span style=color:#ff636f>false</span>, <span style=color:#ff636f>nil</span>)
</span></span><span style=display:flex><span>				<span style=color:#ff636f>continue</span>
</span></span><span style=display:flex><span>			}
</span></span></code></pre></div><p>我们可以在 <code>shlex.Split</code> 前面插入一段代码</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>		<span style=color:#58a1dd>fmt</span>.<span style=color:#58a1dd>Fprintf</span>(<span style=color:#58a1dd>os</span>.<span style=color:#58a1dd>Stderr</span>, <span style=color:#a6be9d>&#34;command: [%s]\n&#34;</span>, <span style=color:#58a1dd>payload</span>.<span style=color:#58a1dd>Value</span>)
</span></span></code></pre></div><p>然后或得 BSSHD 命令行输出：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>command: [echo There are spaces in the statement done]
</span></span><span style=display:flex><span>echo;There;are;spaces;in;the;statement;done
</span></span></code></pre></div><p>而 command 的内容直接从 SSH Exe 请求的加密数据解析出来的，这就意味着 SSH 传入了错误的命令。那么我们翻阅 OpenSSH 源码。</p><h2 id=普遍的糟糕>普遍的糟糕</h2><p>在 OpenSSH 的源码镜像中：<a href=https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/ssh.c#L1061>https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/ssh.c#L1061</a> 有一段代码：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* A command has been specified.  Store it into the buffer. */</span>
</span></span><span style=display:flex><span>		<span style=color:#ff636f>for</span> (<span style=color:#58a1dd>i</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>; <span style=color:#58a1dd>i</span> <span style=color:#ff636f>&lt;</span> <span style=color:#58a1dd>ac</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>++</span>) {
</span></span><span style=display:flex><span>			<span style=color:#ff636f>if</span> ((<span style=color:#58a1dd>r</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>sshbuf_putf</span>(<span style=color:#58a1dd>command</span>, <span style=color:#a6be9d>&#34;%s%s&#34;</span>,
</span></span><span style=display:flex><span>			    <span style=color:#58a1dd>i</span> <span style=color:#ff636f>?</span> <span style=color:#a6be9d>&#34; &#34;</span> <span style=color:#ff636f>:</span> <span style=color:#a6be9d>&#34;&#34;</span>, <span style=color:#58a1dd>av</span>[<span style=color:#58a1dd>i</span>])) <span style=color:#ff636f>!=</span> <span style=color:#a6be9d>0</span>)
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>fatal</span>(<span style=color:#a6be9d>&#34;%s: buffer error: %s&#34;</span>,
</span></span><span style=display:flex><span>				    <span style=color:#58a1dd>__func__</span>, <span style=color:#58a1dd>ssh_err</span>(<span style=color:#58a1dd>r</span>));
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>这段代码将字符串数组变成了字符串，但忘记了字符串数组中的每一个都有可能含有空格字符，那么在命令行解析之时就会出现与预期不一致的结果。这个问题在 Dropbear SSH 中也出现了：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#828b96;font-style:italic>//https://github.com/mkj/dropbear/blob/cb945f9f670e95305c7c5cc5ff344d1f2707b602/cli-runopts.c#L390
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>	<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>i</span> <span style=color:#ff636f>&lt;</span> (<span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span>)<span style=color:#58a1dd>argc</span>) {
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Build the command to send */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>cmdlen</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>		<span style=color:#ff636f>for</span> (<span style=color:#58a1dd>j</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>i</span>; <span style=color:#58a1dd>j</span> <span style=color:#ff636f>&lt;</span> (<span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span>)<span style=color:#58a1dd>argc</span>; <span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>)
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>cmdlen</span> <span style=color:#ff636f>+=</span> <span style=color:#58a1dd>strlen</span>(<span style=color:#58a1dd>argv</span>[<span style=color:#58a1dd>j</span>]) <span style=color:#ff636f>+</span> <span style=color:#a6be9d>1</span>; <span style=color:#828b96;font-style:italic>/* +1 for spaces */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Allocate the space */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>cli_opts</span>.<span style=color:#58a1dd>cmd</span> <span style=color:#ff636f>=</span> (<span style=color:#ff636f>char</span><span style=color:#ff636f>*</span>)<span style=color:#58a1dd>m_malloc</span>(<span style=color:#58a1dd>cmdlen</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>cli_opts</span>.<span style=color:#58a1dd>cmd</span>[<span style=color:#a6be9d>0</span>] <span style=color:#ff636f>=</span> <span style=color:#a6be9d>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Append all the bits */</span>
</span></span><span style=display:flex><span>		<span style=color:#ff636f>for</span> (<span style=color:#58a1dd>j</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>i</span>; <span style=color:#58a1dd>j</span> <span style=color:#ff636f>&lt;</span> (<span style=color:#ff636f>unsigned</span> <span style=color:#ff636f>int</span>)<span style=color:#58a1dd>argc</span>; <span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>strlcat</span>(<span style=color:#58a1dd>cli_opts</span>.<span style=color:#58a1dd>cmd</span>, <span style=color:#58a1dd>argv</span>[<span style=color:#58a1dd>j</span>], <span style=color:#58a1dd>cmdlen</span>);
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>strlcat</span>(<span style=color:#58a1dd>cli_opts</span>.<span style=color:#58a1dd>cmd</span>, <span style=color:#a6be9d>&#34; &#34;</span>, <span style=color:#58a1dd>cmdlen</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* It&#39;ll be null-terminated here */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>TRACE</span>((<span style=color:#a6be9d>&#34;cmd is: %s&#34;</span>, <span style=color:#58a1dd>cli_opts</span>.<span style=color:#58a1dd>cmd</span>))
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>而像 libssh libssh2 以及 go <code>crypto/ssh</code> 的惯用方法也未考虑到命令行存在空格的问题，因此，很多基于这些库实现的客户端也未考虑这个问题。</p><p>另外，在 <a href=https://tools.ietf.org/html/rfc4254#section-6.5>SSH RFC 4252</a> 中，对 <code>exec</code> 命令行的解析，仅仅只有如下一段话：</p><pre tabindex=0><code>      byte      SSH_MSG_CHANNEL_REQUEST
      uint32    recipient channel
      string    &#34;exec&#34;
      boolean   want reply
      string    command

   This message will request that the server start the execution of the
   given command.  The &#39;command&#39; string may contain a path.  Normal
   precautions MUST be taken to prevent the execution of unauthorized
   commands.
</code></pre><p>SSH 的规范并没有指出命令行的解析格式规则，但实际上，<code>command</code> 的解析应当符合 POSIX 1003.1 的 Shell 部分。当然，显式描述一下会更好。</p><p>我觉得 Windows 这一点做的比较好，文档规范比较完备：<a href="https://docs.microsoft.com/en-us/previous-versions/ms880421(v=msdn.10)">Parsing C Command-Line Arguments</a>。</p><h2 id=openssh-服务端的命令行解析>OpenSSH 服务端的命令行解析</h2><p>在 OpenSSH SSHD 的源码中，命令行的处理流程如下：</p><p>当请求为 <code>exec</code> 时：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#828b96;font-style:italic>//https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L2221
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;shell&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_shell_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;exec&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_exec_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;pty-req&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_pty_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;x11-req&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_x11_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;auth-agent-req@openssh.com&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_auth_agent_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;subsystem&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_subsystem_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		} <span style=color:#ff636f>else</span> <span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strcmp</span>(<span style=color:#58a1dd>rtype</span>, <span style=color:#a6be9d>&#34;env&#34;</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>session_env_req</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>);
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>获得 <code>Command</code> 并执行命令：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#828b96;font-style:italic>//https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L2047
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span><span style=color:#ff636f>static</span> <span style=color:#ff636f>int</span>
</span></span><span style=display:flex><span><span style=color:#58a1dd>session_exec_req</span>(<span style=color:#ff636f>struct</span> <span style=color:#58a1dd>ssh</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>Session</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>s</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>u_int</span> <span style=color:#58a1dd>success</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>int</span> <span style=color:#58a1dd>r</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>command</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>NULL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> ((<span style=color:#58a1dd>r</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>sshpkt_get_cstring</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#ff636f>&amp;</span><span style=color:#58a1dd>command</span>, <span style=color:#58a1dd>NULL</span>)) <span style=color:#ff636f>!=</span> <span style=color:#a6be9d>0</span> <span style=color:#ff636f>||</span>
</span></span><span style=display:flex><span>	    (<span style=color:#58a1dd>r</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>sshpkt_get_end</span>(<span style=color:#58a1dd>ssh</span>)) <span style=color:#ff636f>!=</span> <span style=color:#a6be9d>0</span>)
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>sshpkt_fatal</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>r</span>, <span style=color:#a6be9d>&#34;%s: parse packet&#34;</span>, <span style=color:#58a1dd>__func__</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>success</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>do_exec</span>(<span style=color:#58a1dd>ssh</span>, <span style=color:#58a1dd>s</span>, <span style=color:#58a1dd>command</span>) <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>free</span>(<span style=color:#58a1dd>command</span>);
</span></span><span style=display:flex><span>	<span style=color:#ff636f>return</span> <span style=color:#58a1dd>success</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>无论是何种途径，在 OpenSSH 中，sshd 启动进程都是通过 <code>sh -c</code> 这样的方式实现的，这就意味着，命令行应当符合 shell 的标准。</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#828b96;font-style:italic>// https://github.com/openssh/openssh-portable/blob/9edbd7821e6837e98e7e95546cede804dac96754/session.c#L1681
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>	<span style=color:#ff636f>if</span> (<span style=color:#ff636f>!</span><span style=color:#58a1dd>command</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ff636f>char</span> <span style=color:#58a1dd>argv0</span>[<span style=color:#a6be9d>256</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Start the shell.  Set initial character to &#39;-&#39;. */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>argv0</span>[<span style=color:#a6be9d>0</span>] <span style=color:#ff636f>=</span> <span style=color:#a6be9d>&#39;-&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>strlcpy</span>(<span style=color:#58a1dd>argv0</span> <span style=color:#ff636f>+</span> <span style=color:#a6be9d>1</span>, <span style=color:#58a1dd>shell0</span>, <span style=color:#ff636f>sizeof</span>(<span style=color:#58a1dd>argv0</span>) <span style=color:#ff636f>-</span> <span style=color:#a6be9d>1</span>)
</span></span><span style=display:flex><span>		    <span style=color:#ff636f>&gt;=</span> <span style=color:#ff636f>sizeof</span>(<span style=color:#58a1dd>argv0</span>) <span style=color:#ff636f>-</span> <span style=color:#a6be9d>1</span>) {
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>errno</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>EINVAL</span>;
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>perror</span>(<span style=color:#58a1dd>shell</span>);
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>exit</span>(<span style=color:#a6be9d>1</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Execute the shell. */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>0</span>] <span style=color:#ff636f>=</span> <span style=color:#58a1dd>argv0</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>1</span>] <span style=color:#ff636f>=</span> <span style=color:#58a1dd>NULL</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>execve</span>(<span style=color:#58a1dd>shell</span>, <span style=color:#58a1dd>argv</span>, <span style=color:#58a1dd>env</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#828b96;font-style:italic>/* Executing the shell failed. */</span>
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>perror</span>(<span style=color:#58a1dd>shell</span>);
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>exit</span>(<span style=color:#a6be9d>1</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#828b96;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>	 * Execute the command using the user&#39;s shell.  This uses the -c
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>	 * option to execute the command.
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>0</span>] <span style=color:#ff636f>=</span> (<span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span>) <span style=color:#58a1dd>shell0</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>1</span>] <span style=color:#ff636f>=</span> <span style=color:#a6be9d>&#34;-c&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>2</span>] <span style=color:#ff636f>=</span> (<span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span>) <span style=color:#58a1dd>command</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>argv</span>[<span style=color:#a6be9d>3</span>] <span style=color:#ff636f>=</span> <span style=color:#58a1dd>NULL</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>execve</span>(<span style=color:#58a1dd>shell</span>, <span style=color:#58a1dd>argv</span>, <span style=color:#58a1dd>env</span>);
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>perror</span>(<span style=color:#58a1dd>shell</span>);
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>exit</span>(<span style=color:#a6be9d>1</span>);
</span></span></code></pre></div><p>这里还有一个问题，服务器上的 Shell 可能是 Dash shell，抑或是 Bash Shell，还有可能是 Zsh 等等，不同的 shell 语法的村子一定的差异，对 <code>sh -c '$command'</code> 的解析并不一定相同，这也可能导致更多的不确定性。</p><h2 id=尝试修复>尝试修复</h2><p>我创建了一个 PR：<a href=https://github.com/openssh/openssh-portable/pull/123>Fix SSH incorrect command line conversion</a>，这个 PR 将命令行参数编码，核心代码如下：</p><div class=highlight><pre tabindex=0 style=color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff636f>static</span> <span style=color:#ff636f>const</span> <span style=color:#ff636f>char</span><span style=color:#ff636f>*</span> <span style=color:#58a1dd>escape_argument</span>(<span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>buf</span>, <span style=color:#ff636f>int</span> <span style=color:#58a1dd>bufsize</span>, <span style=color:#ff636f>char</span> <span style=color:#ff636f>*</span><span style=color:#58a1dd>arg</span>){
</span></span><span style=display:flex><span>	<span style=color:#ff636f>int</span> <span style=color:#58a1dd>len</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>strlen</span>(<span style=color:#58a1dd>arg</span>);
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>len</span> <span style=color:#ff636f>==</span> <span style=color:#a6be9d>0</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#a6be9d>&#34;</span><span style=color:#a6be9d>\&#34;\&#34;</span><span style=color:#a6be9d>&#34;</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span>(<span style=color:#58a1dd>len</span><span style=color:#ff636f>+</span><span style=color:#a6be9d>2</span><span style=color:#ff636f>&gt;=</span><span style=color:#58a1dd>bufsize</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>arg</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>int</span> <span style=color:#58a1dd>hasspace</span>, <span style=color:#58a1dd>i</span> ,<span style=color:#58a1dd>n</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>hasspace</span> <span style=color:#ff636f>=</span> <span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>n</span> <span style=color:#ff636f>=</span> <span style=color:#58a1dd>len</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>for</span> (<span style=color:#58a1dd>i</span><span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>len</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>++</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>switch</span>(<span style=color:#58a1dd>arg</span>[<span style=color:#58a1dd>i</span>]){
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39;&#34;&#39;</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39;\\&#39;</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>n</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39; &#39;</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39;\t&#39;</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>hasspace</span> <span style=color:#ff636f>=</span><span style=color:#a6be9d>1</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>default</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span>(<span style=color:#58a1dd>hasspace</span>){
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>n</span><span style=color:#ff636f>+=</span><span style=color:#a6be9d>2</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span> (<span style=color:#58a1dd>n</span> <span style=color:#ff636f>==</span> <span style=color:#58a1dd>len</span><span style=color:#ff636f>||</span><span style=color:#58a1dd>bufsize</span><span style=color:#ff636f>+</span><span style=color:#a6be9d>1</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>n</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>return</span> <span style=color:#58a1dd>arg</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>int</span> <span style=color:#58a1dd>j</span><span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>int</span> <span style=color:#58a1dd>slashes</span><span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span>(<span style=color:#58a1dd>hasspace</span>){
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>&#39;&#34;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>for</span>(<span style=color:#58a1dd>i</span><span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>&lt;</span><span style=color:#58a1dd>len</span>; <span style=color:#58a1dd>i</span><span style=color:#ff636f>++</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>switch</span>(<span style=color:#58a1dd>arg</span>[<span style=color:#58a1dd>i</span>]){
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39;\\&#39;</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#58a1dd>arg</span>[<span style=color:#58a1dd>i</span>];
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>case</span> <span style=color:#a6be9d>&#39;&#34;&#39;</span><span style=color:#ff636f>:</span>{
</span></span><span style=display:flex><span>				<span style=color:#ff636f>for</span>(;<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>&gt;</span><span style=color:#a6be9d>0</span>;<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>--</span>){
</span></span><span style=display:flex><span>					<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>&#39;\\&#39;</span>;
</span></span><span style=display:flex><span>					<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>&#39;\\&#39;</span>;
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#58a1dd>arg</span>[<span style=color:#58a1dd>i</span>];
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff636f>default</span><span style=color:#ff636f>:</span>
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>				<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#58a1dd>arg</span>[<span style=color:#58a1dd>i</span>];
</span></span><span style=display:flex><span>			<span style=color:#ff636f>break</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff636f>if</span>(<span style=color:#58a1dd>hasspace</span>){
</span></span><span style=display:flex><span>		<span style=color:#ff636f>for</span>(;<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>&gt;</span><span style=color:#a6be9d>0</span>;<span style=color:#58a1dd>slashes</span><span style=color:#ff636f>--</span>){
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>&#39;\\&#39;</span>;
</span></span><span style=display:flex><span>			<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>&#39;&#34;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#58a1dd>j</span><span style=color:#ff636f>++</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#58a1dd>buf</span>[<span style=color:#58a1dd>j</span>]<span style=color:#ff636f>=</span><span style=color:#a6be9d>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#828b96;font-style:italic>//memchr(, int __c, size_t __n)
</span></span></span><span style=display:flex><span><span style=color:#828b96;font-style:italic></span>	<span style=color:#ff636f>return</span> <span style=color:#58a1dd>buf</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>但 PR 被关闭了,这个问题最终需要 SSH 协议的改进，否则难以修复。而在 OpenSSH BUG 社区实际上早有讨论：<a href="http://bugzilla.mindrot.org/show_bug.cgi?id=2283">http://bugzilla.mindrot.org/show_bug.cgi?id=2283</a>。</p><h2 id=最后>最后</h2><p>SSH 并不完美，OpenSSH 也不完美。</p><hr width=100% id=EOF><p style=color:#777>Last modified on 2019-03-18</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2019/2019-04-01-implement-git-dir-accesss-control/>Next<br>实现 Git 目录权限控制
</a><a class=older-posts href=/posts/2019/2019-03-15-make-a-git-ssh-server/>Previous<br>构建恰当的 Git SSH Server</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://forcemz.net/><div class=nav-title>Charlie's Rethinking</div><div class=nav-subtitle>Themed by Diary.</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>归档
</a><a class="a-block nav-link-item false" href=/categories>分类
</a><a class="a-block nav-link-item false" href=/tags>标签
</a><a class="a-block nav-link-item false" href=/about>关于
</a><a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><ul><li><a href=#%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e9%94%99%e8%af%af%e7%9a%84%e5%91%bd%e4%bb%a4%e8%a1%8c class=nav-服务器上错误的命令行>服务器上错误的命令行</a></li><li><a href=#%e6%99%ae%e9%81%8d%e7%9a%84%e7%b3%9f%e7%b3%95 class=nav-普遍的糟糕>普遍的糟糕</a></li><li><a href=#openssh-%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%9a%84%e5%91%bd%e4%bb%a4%e8%a1%8c%e8%a7%a3%e6%9e%90 class=nav-openssh-服务端的命令行解析>OpenSSH 服务端的命令行解析</a></li><li><a href=#%e5%b0%9d%e8%af%95%e4%bf%ae%e5%a4%8d class=nav-尝试修复>尝试修复</a></li><li><a href=#%e6%9c%80%e5%90%8e class=nav-最后>最后</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copyright (c) 2009-2024 J23</div></div><script src=/js/journal.js></script></body></html>